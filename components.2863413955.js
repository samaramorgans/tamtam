!function(){"use strict";function e(e){var t=ca.call(e,ua),n=e[ua];try{e[ua]=void 0;var o=!0}catch(e){}var s=la.call(e);return o&&(t?e[ua]=n:delete e[ua]),s}function t(e){return pa.call(e)}function n(n){return null==n?void 0===n?da:ha:fa&&fa in Object(n)?e(n):t(n)}function o(e){return null!=e&&"object"==typeof e}function s(e){if(!o(e)||n(e)!=_a)return!1;var t=ga(e);if(null===t)return!0;var s=ka.call(t,"constructor")&&t.constructor;return"function"==typeof s&&s instanceof s&&ya.call(s)==ba}function i(e,t,n){function o(){d===h&&(d=h.slice())}function r(){return p}function a(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return o(),d.push(e),function(){if(t){t=!1,o();var n=d.indexOf(e);d.splice(n,1)}}}function c(e){if(!s(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(f)throw new Error("Reducers may not dispatch actions.");try{f=!0,p=u(p,e)}finally{f=!1}for(var t=h=d,n=0;n<t.length;n++)(0,t[n])();return e}var l;if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(i)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var u=e,p=t,h=[],d=h,f=!1;return c({type:Ca.INIT}),l={dispatch:c,subscribe:a,getState:r,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");u=e,c({type:Ca.INIT})}},l[wa]=function(){var e,t=a;return e={subscribe:function(e){function n(){e.next&&e.next(r())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");return n(),{unsubscribe:t(n)}}},e[wa]=function(){return this},e},l}function r(){for(var e=arguments,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=e[o];return 0===n.length?function(e){return e}:1===n.length?n[0]:n.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function a(){for(var e=arguments,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=e[o];return function(e){return function(t,o,s){var i=e(t,o,s),a=i.dispatch,c=[],l={getState:i.getState,dispatch:function(e){return a(e)}};return c=n.map(function(e){return e(l)}),a=r.apply(void 0,c)(i.dispatch),Ea({},i,{dispatch:a})}}}function c(){}function l(e){return Array.isArray(e)?e.slice():e instanceof Map?new Map(e):e instanceof Set?new Set(e):e&&"object"==typeof e?Object.assign({},e):e}function u(e,t){return null!=e&&"object"==typeof e&&(e instanceof Map||e instanceof Set?e.has(t):t in e)}function p(e,t){if(null!=e)return e instanceof Map?e.get(t):e[t]}function h(e,t,n){if(null==e)return n;for(var o=0,s=t.length,i=void 0;o<s;o++){if(i=t.item(o),!u(e,i))return n;e=p(e,i)}return e}function d(e,t,n){if(null!=e)return e instanceof Map?e.set(t,n):e instanceof Set?e.add(n):e[t]=n,e}function f(e,t){return e instanceof Map||e instanceof Set?e.delete(t):Array.isArray(e)?e.splice(t,1):"object"==typeof e&&delete e[t],e}function g(e){if(e instanceof Map)return Array.from(e.keys());if(Array.isArray(e)){if("function"==typeof e.keys)return Array.from(e.keys());for(var t=[],n=0,o=e.length;n<o;n++)t.push(n);return t}return e&&"object"==typeof e?Object.keys(e):[]}function _(e,t){if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]!==t[n])return!1;return!0}function m(e){var t=[];return e.walk(function(e,n){e.value&&t.push(n)}),t}function v(e,t,n){var o=this;if(this.key===Aa)for(var s=g(e),i=0,r=s.length;i<r;i++)o.target.set(t.push(s[i]),p(e,s[i]));else u(e,this.key)&&this.target.set(t.push(this.key),p(e,this.key))}function y(e,t){return e.assign("online",t)}function k(e,t){var n=t&&"object"==typeof t?t.id:t;return e.get(["contacts",n])}function b(e,t){var n=k(e,t);if(!n)throw new Error("Отсутствует информация о пользователе с ID: "+t);return n}function w(e,t,n){return Array.isArray(t)&&t.forEach(function(t){return C(e,t)}),n&&Object.keys(n).forEach(function(t){var o=n[t];e=A(e,t,o)}),e}function C(e,t){var n=["contacts",t.id],o=e.get(n);return t=O(t),e=o&&o.deleted&&!t.deleted?e.set(n,t):e.assign(n,t)}function E(e){var t=e.get("contacts");return t instanceof Map||e.set("contacts",t.reduce(function(e,t){return e.set(t.id,O(t))},new Map)),e}function A(e,t,n){return e.has(["contacts",t])&&e.set(["contacts",t,"presence"],n),e}function T(e,t){return e.set(["contacts",t,"status"],"BLOCKED")}function S(e,t){return e.delete(["contacts",t,"status"])}function I(e,t){var n=t.reduce(function(e,t){return e.set(t.id,O(t))},new Map);return e.set("blackList",n),e}function O(e){return Object.assign({},e,{name:e.name||e.names&&e.names[0].name||"(no name)"})}function x(e,t){var n=e.presence,o=t.presence;return n&&o?n.on&&o.on?o.seen-n.seen:n.on?-1:o.on?1:o.seen-n.seen:n?-1:o?1:0}function D(e){var t=e.get("contacts");return Array.from(t.values()).filter(function(e){return!e.current&&e.own}).sort(x)}function M(e,t,n){var o=$(e,t),s=o.concat("posting");if(!e.has(o))return console.warn("Отсутствует чат",t),e;if(!n)return e.delete(s);if(n.edit?e=j(e,o,{type:"EDIT",message:n.edit,insertText:!0}):n.reply?e=j(e,o,{type:"REPLY",message:n.reply}):e.has(s)||(e=j(e,o,{type:"NEW"})),"text"in n){var i=e.get(s);e="NEW"!==i.type||null!=n.text&&""!==n.text||i.upload?e.set(s.concat("text"),n.text):e.delete(s)}if("shares"in n){var r=s.concat("shares"),a=e.get(r),c=Object.assign({},a,n.shares);c.attachments&&(c.selected&&-1!==c.links.indexOf(c.selected)&&c.attachments.get(c.selected)||(c.selected=c.links.find(function(e){return null!==c.attachments.get(e)}))),e=e.assign(r,c)}return e}function j(e,t,n){var o;if(n.message&&!(o=e.get(t.concat("messages",n.message))))return console.warn("В чате %o отсутствует сообщение %o",t,n.message),e;var s=n.type||"NEW",i=t.concat("posting"),r=e.get(i);if(!r||r.type!==s||r.link!=o){var a={type:s};"REPLY"!==s&&(a.text=n.insertText&&o&&o.text),o&&(a.link=o),"REPLY"===s?e.assign(i,a):e.set(i,a)}return e}function P(e,t,n){void 0===n&&(n=null);var o=$(e,t);if(!o)return e;var s=e.get(o);return null===n&&null===(n=L(e,s))?e:(s.messages&&s.messages.forEach(function(t,i){R(e,s,o.concat("messages",i),n)}),s.lastMessage&&R(e,s,o.concat("lastMessage"),n),e)}function L(e,t){if(!t||!t.participants)return null;if(Array.isArray(t.participants)){for(var n=0,o=t.participants.length;n<o;n++)if(t.participants[n].user.current)return t.participants[n].time}else if("object"==typeof t.participants){var s=e.get("auth.profile.id"),i=Object.entries(t.participants).find(function(e){return parseInt(e[0],10)===s});if(i)return i[1]}return Date.now()}function N(e,t,n,o){return void 0===o&&(o=L(e,t)),null!=o&&("CHANNEL"===t.type?n.time>o:!b(e,n.sender).current&&n.time>o)}function R(e,t,n,o){var s=e.get(n);if(s){var i=N(e,t,s,o);if(i!==s.unread)return e.assign(n,{unread:i})}return e}function z(e){return e.uid?e.uid:e.cid&&e.sender?("object"==typeof e.sender?e.sender.id:e.sender)+"-"+e.cid:""+(e.id||e.cid)}function H(e,t,n){return n?(n.result&&(n=Object.assign({},n,{result:n.result.map(function(t){return t.chat&&!Array.isArray(t.chat.participants)&&(t=Object.assign({},t,{chat:q(e,t.chat)})),t})})),e.assign(t,n)):e.delete(t)}function F(e,t,n){var o=e.get(t);return o?H(e,t,{result:(o.result||[]).concat(n.result),total:"total"in n?n.total:o.total,marker:"marker"in n?n.marker:null,loadState:za.idle}):e}function U(e){return e.delete("search")}function q(e,t){var n=t.participants;n&&!Array.isArray(n)&&(n=Object.keys(n).map(function(e){return{user:Number(e),time:t.participants[e]}}));var o=Object.assign({},t,{participants:n,selected:!!t.selected,unreadCount:t.newMessages||0,owner:b(e,t.owner),placeholder:ce(e,t),messages:B(e,t),lastMessage:t.lastMessage&&V(e,t,t.lastMessage),settings:t.settings||Fa});return delete o.newMessages,o}function $(e,t){if(0===t)return["newChat"];var n=[Ha,t];return e.has(n)?n:e.get(["peekChat","id"])===t?["peekChat"]:void 0}function G(e){return Array.from(e.get(Ha).values())}function B(e,t){var n=t.messages;return n?Array.isArray(n)?n.map(V.bind(null,e,t)):n:null}function V(e,t,n){var o=n.attaches&&n.attaches.map(function(e){return"userId"in e&&(e=Object.assign({},e,{user:e.userId})),"userIds"in e&&(e=Object.assign({},e,{users:e.userIds})),e}),s=tt(e,t,n);return Object.assign({},n,{uid:n.uid||z(n),unread:N(e,t,n),removable:s||"DIALOG"===t.type,editable:s&&Ye(e,n)&&nt(n)&&ot(n),attaches:o})}function W(e,t,n,o){return Array.isArray(t)&&(t=t.filter(function(t){return"REMOVED"!==t.status||(e=Ee(e,t.id),!1)})),e=K(e,t,n),o&&Object.keys(o).forEach(function(t){t=Number(t);var n=e.get([Ha,t]);n&&o[t].forEach(function(o){o=V(e,n,o);var s=[Ha,t,"messages",z(o)];"DELETED"===o.status?e=e.delete(s):"EDITED"===o.status&&e.has(s)&&(e=e.set(s,o)),n.lastMessage&&n.lastMessage.id===o.id&&(e=e.set([Ha,t,"lastMessage"],o))})}),e}function K(e,t,n){return null!=n&&e.set("chatMarker",n),e.set("chatsLoaded",!0),t.reduce(function(e,t){return Y(e,t)},e)}function Y(e,t){var n=q(e,t),o=e.get("peekChat");return o&&o.id===t.id?e.delete("peekChat"):o=e.get([Ha,t.id]),o&&(o.selected&&(n.selected=o.selected),o.lastEventTime!==n.lastEventTime&&(n.selected?t.messages&&(n.messages=se(Y,t.messages.map(V.bind(null,e,o)))):n.messages=null)),n.messages?n.messages=re(n.messages):o&&o.messages&&(n.messages=o.messages),e=e.assign([Ha,t.id],n),P(e,t.id)}function Z(e,t,n,o){var s=$(e,t);if(!s)return console.warn("Отсуствует чат с id",t),e;if(n&&n.length){var i=e.get(s);e=J(e,t,se(i,n.map(V.bind(null,e,i))))}else{var r=s.concat("messages");e.get(r)||(e=e.set(r,new Map))}return X(e,t,o)}function J(e,t,n){var o=$(e,t);if(!o)throw new Error("Не могу записать сообщения чата "+t+": объект чата отсутствует в хранилище");var s=e.get(o),i=n[n.length-1];return e=e.assign(o,{lastMessage:!s.lastMessage||s.lastMessage.time<i.time?i:s.lastMessage,messages:re(n)}),P(e,t)}function Q(e,t){var n=$(e,t);return n&&e.set(n.concat("messages"),new Map),ee(e,t)}function X(e,t,n){var o=$(e,t);if(!o)return e;var s,i=e.get(o.concat("messages"));return i&&i.forEach(function(e){e.time===n&&(s=e)}),s?e.set(o.concat("focusedMessage"),z(s)):ee(e,t)}function ee(e,t){var n=$(e,t);return n?e.delete(n.concat("focusedMessage")):e}function te(e,t,n){var o=$(e,t);if(!o)return e;var s=e.get(o);e=rt(e=xe(e,t,n=V(e,s,n)),o,n),(!s.lastMessage||s.messages&&(s.messages.has(s.lastMessage.uid)||s.messages.has(s.lastMessage.id)))&&(e=e.set(o.concat("messages",n.uid),n));var i=!s.lastMessage||s.lastMessage.time<=n.time,r=k(e,n.sender),a=r&&r.current;return i&&(e=e.assign(o,{lastEventTime:a?s.lastEventTime:n.time,lastMessage:n})),n.unread&&!a&&(e=e.set(o.concat("unreadCount"),(s.unreadCount||0)+1)),e}function ne(e,t,n,o){var s=$(e,t);if(!s)return e;var i=e.get(s);return i.messages&&i.messages.forEach(function(t,i){i!==n&&t.id!==n&&t.cid!==n||(e=e.assign(s.concat("messages",i),{text:o,status:"EDITED"}))}),M(e,t)}function oe(e,t){return t.messages.forEach(function(n,o){"REMOVED"===n.status&&e.delete([Ha,t.id,"messages",o])}),e}function se(e,t){if(!e||!e.messages||!ie(e,t))return t;var n=Array.from(e.messages.values()),o=t[0];return o&&o.time<=n[0].time?t.concat(n):n.concat(t)}function ie(e,t){for(var n=0,o=t.length;n<o;n++)if(e.messages.has(z(t[n])))return!0;return!1}function re(e){return e instanceof Map?e:e.reduce(function(e,t){var n=t.uid,o=e.get(n);return o&&(t=t.updateTime>o.updateTime||t.time>o.time||!o.id&&t.id?Object.assign({},o,t):Object.assign({},t,o)),e.set(t.uid,t)},new Map)}function ae(e){var t=e.get(Ha);return t instanceof Map?e:(e.set(Ha,new Map),K(e,t))}function ce(e,t){if(1===t.participantsCount)return"Empty chat";var n=Array.isArray(t.participants)?t.participants.map(function(e){return e.user}):Object.keys(t.participants||{}).map(function(t){return k(e,Number(t))}).filter(Boolean);if("DIALOG"===t.type)return n.find(function(e){return!e.current}).name;var o=n.slice(0,4).map(function(e){return e.name}).join(", ");return n.length>4&&(o+="..."),o}function le(e,t,n){var o=$(e,t);return o?("peekChat"!==o[0]&&(e.get("peekChat.selected")&&(e=e.set("peekChat.selected",!1)),e=e.delete("peekChat")),e.get(o).selected||(e.set(o.concat("selected"),!0),e.get(Ha).forEach(function(n,o){var s=o===t;e.set([Ha,o,"selected"],s),s&&(e.delete([Ha,o,"search"]),n.messages&&oe(e,n))})),X(e,t,n)):(console.warn("No chat with id",t),e)}function ue(e,t){return Qe(e).set("peekChat",q(e,Object.assign({},t,{selected:!0})))}function pe(e,t,n){if(!qa[n])throw new Error("Неизвестный статус загрузки: "+n);var o=$(e,t);return o?e.assign(o,{loadState:qa[n]}):e}function he(e,t,n){var o=$(e,t);if(o){var s=e.get(o),i=n&&"object"==typeof n?z(n):n;if(s.messages.has(i)&&(e="REMOVED"===n.status?e.set(o.concat("messages",i),n):e.delete(o.concat("messages",i))),e=it(e,o,i),s.lastMessage&&z(s.lastMessage)===i&&s.messages){var r=st(e.get(o)),a=o.concat("lastMessage");e=r?e.set(a,r):e.delete(a)}}return e}function de(e,t,n){var o=$(e,t);if(!o)return e;var s=(e=te(e,t,n)).get(o);return e=s.pending?e.set(o.concat("pending",s.pending.length),n):e.set(o.concat("pending"),[n]),M(e,t)}function fe(e,t,n){var o,s=$(e,t);if(!s)throw new Error("Не могу записать сообщения чата "+t+": объект чата отсутствует в хранилище");e=ge(e,t,n.cid),s[0]!==Ha&&(console.info("Move chat %d from peek to chat list",t),o=e.get(s),e.delete(s),s=[Ha,t],e.set(s,o),e=le(e,t));var i=z(n=V(e,o=o||e.get(s),n));return o.messages.has(i)&&(e=e.assign(s.concat("messages",i),n),n.error||(e=e.delete(s.concat("messages",i,"error"))),e=e.delete(s.concat("messages",i,"posting")),o.lastEventTime<n.time&&(e=e.set(s.concat("lastEventTime"),n.time))),P(e,t)}function ge(e,t,n){var o=$(e,t);if(o){var s=e.get(o.concat("pending"))||[],i=s.findIndex(function(e){return e.cid===n});if(-1!==i){var r=1===s.length?o.concat("pending"):o.concat("pending",i);return e.delete(r)}}return e}function _e(e,t,n,o){var s=$(e,t),i=e.get(s);if(!i||!i.messages)return console.warn("Отсутствует чат или сообщения в чате",t),e;var r=Ge(e=ge(e,t,n)).id;return i.messages.forEach(function(t,i){if(t.cid===n&&t.sender.id===r){var a=s.concat("messages",i,"error");e=o?e.set(a,o):e.delete(a)}}),e}function me(e,t,n){var o=$(e,t);return o?(n.forEach(function(t){var n=o.concat("messages",t);if(e.has(n)){e=e.assign(n,{status:"REMOVED",error:null});var s=(e=it(e,o,t)).get(o);if(e.get(n).id===s.lastMessage.id){var i=o.concat("lastMessage"),r=st(s);e=r?e.set(i,r):e.delete(i)}}else console.warn("Отсутствует сообщение по ключу",n)}),e):e}function ve(e,t,n){var o=$(e,t);return o?e.set(o.concat("messages",n,"editable"),!1):e}function ye(e,t,n,o,s){var i=$(e,t);if(!i)return e;var r=i.concat("participants"),a=e.get(r),c=Ge(e);if(null==n&&(n=c.id),a)for(var l=0;l<a.length;l++)if(a[l].user.id===n){e=e.set(r.concat(l,"time"),o);break}return n===c.id&&(e=P(e,t,o,400)),null!=s&&(e=e.set(i.concat("unreadCount"),s)),e}function ke(e,t,n){var o=$(e,t);if(o){var s=o.concat("typingParticipants"),i=e.get(s);i&&i.has(n)||e.set(s,new Map(i).set(n,n))}return e}function be(e,t,n){var o=$(e,t);if(o){var s=o.concat("typingParticipants");e.delete(s.concat(n));var i=e.get(s);i&&!i.size&&e.delete(s)}return e}function we(e,t){var n=$(e,t);return n?e.delete(n.concat("lastMessage")).set(n.concat("messages"),new Map):e}function Ce(e,t){return Ee(e,Ve(e,t))}function Ee(e,t){return e.delete($(e,t))}function Ae(e){return e.delete("peekChat").set(Ha,new Map)}function Te(e,t,n){n||(n=e.get("auth.profile"));var o=n&&"object"==typeof n?n.id:n,s=$(e,t);if(s){var i=e.get(s);if(Array.isArray(i.participants)){var r=i.participants.filter(function(e){return e.user.id!==o});e=e.assign(s,{participants:r,participantsCount:r.length})}e=Ie(e,t)}return e}function Se(e,t,n){var o=$(e,t);return o?e.set(o.concat("title"),n):e}function Ie(e,t){var n=$(e,t);if(n){var o=ce(e,e.get(n));return e.set(n.concat("placeholder"),o)}return e}function Oe(e,t,n,o){var s=$(e,t);if(!s)return e;var i={};return null!=n&&(i.iconUrl=n),null!=o&&(i.fullIconUrl=o),e.assign(s,i)}function xe(e,t,n){return $(e,t)&&n.attaches&&n.attaches.forEach(function(o){"CONTROL"===o._type&&("title"===o.event?e=Se(e,t,o.title):"icon"===o.event?e=Oe(e,t,o.url,o.fullUrl):"add"===o.event?e=Re(e,t,o.userIds):"remove"===o.event?e=Le(e,t,o.userId):"leave"===o.event?e=Te(e,t,n.sender):"joinByLink"===o.event&&(e=Re(e,t,[o.userId])))}),e}function De(e,t,n,o,s){var i=$(e,t).concat("messages",n),r=e.get(i);if(!r)return e;r.link&&"FORWARD"===r.link.type&&(r=r.link.message,i=i.concat("link","message"));var a=!1,c=r.attaches.findIndex(function(e){return"VIDEO"===e._type?e.videoId===o:"SHARE"===e._type&&e.media.videoId===o&&(a=!0,!0)});return-1===c?e:a?e.set(i.concat("attaches",c,"media","urlData"),s):e.set(i.concat("attaches",c,"urlData"),s)}function Me(e,t,n){var o=$(e,t);return o?e.set(o.concat("media","loadState"),qa[n]):e}function je(e,t,n){var o=$(e,t);return o?Me(e,t,qa.idle).assign(o.concat("media"),n):e}function Pe(e,t,n,o){var s=$(e,t);if(s){if(e=Me(e,t,qa.idle),!n)return e.set(s.concat(o?"hasNext":"hasPrev"),!1);var i=s.concat("media","items"),r=e.get(i);return e.set(i,o?Ke(r,n):Ke(n,r))}return e}function Le(e,t,n){var o=$(e,t),s=e.get(o);if("CHANNEL"===s.type&&s.members.items){var i=s.members.items.filter(function(e){return at(e)!==n});e.set(o.concat("members","items"),i)}else if(s.participants){var r=s.participants.length,a=s.participants.filter(function(e){return at(e.user)!==n});e=Ie(e=e.assign(o,{participants:a,participantsCount:s.participantsCount+a.length-r}),t)}return e}function Ne(e,t,n){var o=$(e,t),s=e.get(o);if(s&&s.admins)for(var i=0;i<s.admins.length;i++)if(s.admins[i].id===n)return e.delete(o.concat("admins",i));return e}function Re(e,t,n){var o=$(e,t);if(!o)throw new Error("Отсутствует чат с ID "+t);var s=e.get(o);if("CHANNEL"===s.type){var i=s.members.items.slice(),r=new Set(i.map(at));n.map(Number).forEach(function(e){r.has(e)||(i.push(e),r.add(e))}),e=e.set(o.concat("members","items"),i)}else if(s.participants){var a=s.participants.slice(),c=a.length,l=new Set(a.map(function(e){return at(e.user)}));n.map(Number).forEach(function(e){l.has(e)||(l.add(e),a.push({time:0,user:e}))}),ct(e=e.assign(o,{participants:a,participantsCount:s.participantsCount+a.length-c}),t,n),e=Ie(e,t)}return e}function ze(e,t,n){var o=$(e,t);if(o){var s=e.get(o).admins.length;n.forEach(function(t,n){e=e.set(o.concat("admins",s+n),b(e,t))})}return e}function He(e,t,n){var o=$(e,t),s=o&&e.get(o.concat("messages"));return s&&s.forEach(function(t,s){var i=n[t.id];i&&(e=e.set(o.concat("messages",s,"stats"),i))}),e}function Fe(e,t,n){var o=$(e,t);return o&&e.has(o.concat("members"))?e.set(o.concat("members","loadState"),n):e}function Ue(e,t,n,o){var s=$(e,t);if(!s)throw new Error("Отсутствует чат с ID "+t);var i=s.concat("members"),r=e.get(i),a=e.get("contacts");n=n.map(function(e){var t=e.contact.id,n=a.get(t);return Object.assign({},e.contact,{presence:e.presence,current:!(!n||!n.current)})});var c=new Set(r&&r.items?r.items.concat(n):n);return e.set(i,Object.assign({},r,{loadState:"idle",marker:o,items:Array.from(c.values())}))}function qe(e,t){return e.set("joinChat",{chat:t})}function $e(e){return e.delete("joinChat")}function Ge(e){return e.get("auth.profile")}function Be(e,t,n){return e.assign($(e,t),{lastError:n})}function Ve(e,t){var n=e.get(Ha);for(var[o,s]of n)if(We(s,t))return o;return null}function We(e,t){return"DIALOG"===e.type&&e.participants.find(function(e){var n=e.user;return!n.current&&n.id===t})}function Ke(e,t){var n=new Map(e);for(var[o,s]of t)n.set(o,s);return n}function Ye(e,t){var n=1e3*(e.get("config.server.edit-timeout")-15);return Date.now()-t.time<n}function Ze(e,t,n){if("search"!==(t=Array.isArray(t)?t:t.split("."))[0]||!n)return e;var o=Je(n);return(e.get(t.concat("result"))||[]).forEach(function(s,i){var r=Je(s)===o&&s.section===n.section;if(r!=s.selected&&(e=e.set(t.concat("result",i,"selected"),r)),r)e=e.has([Ha,s.chatId])?le(e,s.chatId):ue(e,s.chat);else if(s.selected){var a=$(e,s.chatId);a&&(e=e.delete(a.concat("search")))}}),t.length>1&&(e.get("search.result")||[]).forEach(function(t,n){e=e.set(["search","result",n,"selected"],!1)}),e}function Je(e){return e.chatId||e.chat&&e.chat.id}function Qe(e){return e.get(Ha).forEach(function(t,n){t.selected&&(e=e.set([Ha,n,"selected"],!1))}),e.delete("peekChat")}function Xe(e,t,n){return e.set([Ha,t,"nextLink"],n)}function et(e,t){return e.set(["createdChannel"],t)}function tt(e,t,n){return"CHANNEL"===t.type?b(e,t.owner).current||t.admins&&t.admins.some(function(t){return b(e,t).current}):b(e,n.sender).current}function nt(e){return!e.link||"FORWARD"!==e.link.type}function ot(e){return!(e.attaches&&e.attaches.length>0&&"STICKER"===e.attaches[0]._type)}function st(e){if(e.messages)for(var t=e.messages instanceof Map?Array.from(e.messages.values()):e.messages,n=t.length-1;n>=0;n--)if("REMOVED"!==t[n].status)return t[n];return null}function it(e,t,n){var o=e.get(t.concat("messages",n));return e.get(t.concat("media"))&&o&&o.attaches?(o.attaches.forEach(function(n){if("PHOTO"===n._type){var s=e.get(t.concat("media")),i=o.id+"-"+n.photoId;if(s.selected===i){var r=Array.from(s.items.keys()),a=r.indexOf(i);a>-1&&(r.splice(a,1),a===r.length&&(a-=1),e=e.assign(t.concat("media"),{selected:r[a],previous:0===a?null:r[a-1],next:a===r.length-1?null:r[a+1]}))}else if(s.previous===i){var c=Array.from(s.items.keys()),l=c.indexOf(i);e=l>0?e.set(t.concat("media","previous"),c[l-1]):e.delete(t.concat("media","previous"))}else if(s.next===i){var u=Array.from(s.items.keys()),p=u.indexOf(i);e=p>-1&&p<u.length-2?e.set(t.concat("media","next"),u[p+1]):e.delete(t.concat("media","next"))}e=e.delete(t.concat("media","items",i))}}),e):e}function rt(e,t,n){if(!n||!n.attaches)return e;if("REMOVED"===n.status)return it(e,t,n.uid);var o=e.get(t.concat("media"));return o&&o.items?(n.attaches.forEach(function(s){var i=n.id+"-"+s.photoId;"PHOTO"===s._type&&(e=e.set(t.concat("media","items",i),{message:n,photo:s})),o.next||(e=e.set(t.concat("media","next"),i),o.next=i)}),e):e}function at(e){return e&&"object"==typeof e?e.id:e}function ct(e,t,n){var o=$(e,t).concat("participants"),s=e.get(o).map(function(e){return at(e.user)});if(!n.every(function(e){return-1!==s.indexOf(e)}))throw new Error("Несоответствие участников чата: ожидаем "+n+", получили "+Array.from())}function lt(e,t){return e.assign("auth",{loadState:Ga[t]})}function ut(e,t,n){return n&&(e=lt(e,Ga.idle)),t?(t.error?t=t.error:t.code&&(t=t.code),e.set("auth.lastError",t)):e.delete("auth.lastError")}function pt(e){var t=e.get("auth.state");(!t||t===Ba.verify&&e.get("auth.verification.nextAttempt")<Date.now())&&(e=kt(e));var n=e.get("auth.profile");n&&(e=_t(e,n));var o=e.get("auth.phone");return o&&"string"!=typeof o||(e=Ct(e,o)),e}function ht(e,t){return e.set("auth.okProfile",t)}function dt(e,t){return t?e.assign("auth",{state:Ba.verify,verification:Object.assign({},t,{nextAttempt:Date.now()+1e3*t.codeDelay})}):e.assign("auth",{state:Ba.unauthorized,verification:null})}function ft(e,t,n){if(!t)throw new Error("Отсутствует профиль пользователя");return e=_t(e,t),(e=ut(e,null)).assign("auth",{state:Ba.authorized,verification:null,token:n})}function gt(e){var t=e.get("auth");return e.delete("chatMarker").set("chats",new Map).set("contacts",new Map).set("config",{}).set("auth",{state:Ba.unauthorized,phone:t.phone,okProfile:t.okProfile})}function _t(e,t){if(null==t)throw new Error("Указан пустой профиль пользователя");if(t&&"object"!=typeof t){var n=e.get(["contacts",t]);if(!n)throw new Error('В ветке "contacts" отсутствуют данные о пользователе '+t);t=n}if(t){e.assign("auth",{profile:t});var o=["contacts",t.id];!e.has(o)&&e.get("contacts")instanceof Map&&e.set(o,O(t)),e.assign(["contacts",t.id],{current:!0})}return e}function mt(e,t){return e.assign("auth",{token:t})}function vt(e,t){return e.assign("auth",{tokens:t})}function yt(e,t){return e.assign("auth",{state:Ba.confirm,profile:t})}function kt(e){return e.assign("auth",{state:Ba.unauthorized,loadState:Ga.idle,verification:null,recovery:null})}function bt(e,t){return e.set("auth.recovery",t)}function wt(e){return e.set("auth.state",Ba.create)}function Ct(e,t){var n="";t&&("string"==typeof t&&(n=t),"code"in t&&"phone"in t&&(n=""+t.code+t.phone));var o=("+"===n[0]?"+":"")+n.replace(/\D/g,"");return e.assign("auth.phone",Object.assign({},t,{display:n,clean:o,valid:/^\+?[0-9]{3,20}$/.test(o)}))}function Et(e,t,n){return n.reduce(function(e,n){return At(e,t,n.file,n.type)},e)}function At(e,t,n,o){var s=$(e,t);if(!s)return console.warn("Отсутствует чат",t),e;e.has(s.concat("posting"))||(e=M(e,t,{}));var i=s.concat("posting","upload");return e.has(i)||e.set(i,new Map),e.assign(i.concat(n),{file:n,_type:o,status:Wa.idle})}function Tt(e,t,n){var o=$(e,t);if(!o)return console.warn("Отсутствует чат",t),e;var s=o.concat("posting"),i=s.concat("upload"),r=(e=e.delete(i.concat(n))).get(i);return r&&!r.size&&(e=M(e=e.delete(i),t,{text:e.get(s.concat("text"))})),e}function St(e,t,n,o){return Ot(e,t,n).forEach(function(t){e=o.progress?e.assign(t,{status:Wa.loading,error:null}).assign(t.concat("progress"),o.progress):o.error?e.assign(t,{status:Wa.error,error:o.error,progress:null}):e.assign(t,o)}),e}function It(e,t,n,o){return Ot(e,t,n).forEach(function(t){e.get(t).status!==Wa.completed&&(e=e.assign(t,Object.assign({},o,{status:Wa.completed,progress:null})))}),e}function Ot(e,t,n){var o=$(e,t);if(!o)return null;var s=[],i=e.get(o),r=o.concat("posting","upload",n);e.has(r)&&s.push(r);var a=xt(i.messages,n);a&&s.push(o.concat("messages",a));var c=xt(i.pending,n);return c&&s.push(o.concat("pending",c)),s}function xt(e,t){var n;return e&&e.forEach(function(e,o){if(!e.id&&!n&&e.attaches)for(var s=0;s<e.attaches.length;s++)if(e.attaches[s].file===t){n=[o,"attaches",s];break}}),n}function Dt(e){var t=e.get("config");return t.chats instanceof Map?e:e.set("config",Object.assign({},t,{chats:jt(t,new Map)}))}function Mt(e,t){var n=e.get("config")||{},o={};for(var s in t){var i=t[s];"chats"===s?o[s]=jt(t,new Map(n[s])):null!=i&&!Array.isArray(i)&&"object"==typeof i&&s in n?o[s]=Object.assign({},n[s],i):o[s]=i}return e.assign("config",o)}function jt(e,t){return e.chats?Object.keys(e.chats||{}).reduce(function(t,n){var o=e.chats[n],s=o.dontDisturbUntil;return s>0&&Date.now()>s&&(o.dontDisturbUntil=0),t.set(+n,o)},t):t}function Pt(e){var t=e.get(Za);t instanceof Map||(e.set(Za,new Map),Array.isArray(t)&&t.forEach(function(t){return e.set([Za,t.id],t)}));var n=e.get("assets");return n instanceof Map||(e.set("assets",new Map),n.recentEmoji&&e.set("assets.recentEmoji",n.recentEmoji)),e}function Lt(e,t){return e=e.assign([Za,t.id],t)}function Nt(e,t){return Array.isArray(t)&&t.forEach(function(t){return Lt(e,t)}),e}function Rt(e,t,n){return e.assign("assets",{stickerSections:t,stickerSectionsOrder:n})}function zt(e,t,n){var o="assets.stickerSuggestions",s=e.get(o);if(!s||!s.has(t)||s.get(t).size<n.size){var i=new Map(s);i.set(t,n),e.set(o,i)}return e}function Ht(e,t){return e.set("assets.recentEmoji",t)}function Ft(e,t){return e.set("assets.stickerSections.RECENT.result",t)}function Ut(e){return e.has(Qa)?e:Bt(e,{title:null,placeholder:null,icon:null,invited:new Map,contacts:e.get("contacts")})}function qt(e){return e.delete(Qa)}function $t(e,t){var n=e.get(Qa);return n&&!n.invited.has(t)&&n.contacts.has(t)?(e=e.set([Qa,"invited",t],e.get([Qa,"contacts",t])),Vt(e)):e}function Gt(e,t){var n=e.get(Qa);return n&&n.invited.has(t)?Vt(e.delete([Qa,"invited",t])):e}function Bt(e,t){return e.assign(Qa,t)}function Vt(e){var t=Array.from(e.get([Qa,"invited"]).values());return e.set([Qa,"placeholder"],t.map(function(e){return e.name}).join(", "))}function Wt(e){return G(e).filter(function(e){return"DIALOG"===e.type}).map(function(e){return e.participants.find(function(e){return!e.user.current}).user.id})}function Kt(e){var t=new Set(Wt(e)),n=D(e).filter(function(e){return!t.has(e.id)});return e.set([ec,"contacts"],n.slice(0,5))}function Yt(e,t){return e.set([ec,"chats"],t.map(function(t){return q(e,t)}))}function Zt(e,t,n){if(n.get("contacts")instanceof Map){var o=e&&"object"==typeof e?e.id:Number(e);return n.key(["contacts",o])}}function Jt(e,t,n){var o=e&&"object"==typeof e?e.id:Number(e);return n.key(["stickers",o])}function Qt(e,t,n){var o=t.item(1),s=e&&"object"==typeof e?z(e):e;if(null!=s)return n.key(["chats",o,"messages",s])}function Xt(e,t,n){var o=e&&"object"==typeof e?e.id:Number(e);return n.key(["chats",o])}function en(e,t,n){var o=t.item(1);return n.key(["config","chats",o])}function tn(e){return oc.map(function(t){return e+"."+t}).concat(nn(e+".lastMessage"),nn(e+".messages.*"))}function nn(e){return sc.map(function(t){return e+"."+t})}function on(e,t){var n=null;return t&&(t.getImmutableStore=function(){return n}),function(t,o){n&&n.value===t||(n=ic(new ja(t)));var s=e(n,o);return s instanceof ja?((n=s).save(),n.value):s}}function sn(){return function(e){return function(t){return function(n){if("undefined"==typeof process&&-1!==location.hash.indexOf("logger")){var o;return console.groupCollapsed(n.type),console.info("action",n),console.time(n.type),o=t(n),console.timeEnd(n.type),console.log("next state",e.getState()),console.groupEnd(n.type),o}return t(n)}}}}function rn(e,t,n){void 0===n&&(n={});var o,s,i=null,r=0,a=function(){r=!1===n.leading?0:Date.now(),i=null,s=e.apply(void 0,o),i||(o=null)};return function(){for(var c=[],l=arguments.length;l--;)c[l]=arguments[l];var u=Date.now();r||!1!==n.leading||(r=u);var p=t-(u-r);return o=c,p<=0||p>t?(i&&(clearTimeout(i),i=null),r=u,s=e.apply(void 0,o),i||(o=null)):i||!1===n.trailing||(i=setTimeout(a,p)),s}}function an(e,t){var n=2147483648;return(~~(e/n)^~~(t/n))*n+(2147483647&e^2147483647&t)}function cn(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?cn(t):t)},[])}function ln(e,t,n){return null!=e&&n.indexOf(e)===t}function un(e,t,n){return void 0===t&&(t=1e3),new Promise(function(o,s){e.then(o,s),setTimeout(s.bind(null,n),t)})}function pn(e,t,n){var o=new Error(t||e);return o.code=e,n&&Object.assign(o,n),o}function hn(e,t){if(!e||!t)return!1;if(e!==t){var n=e.length;if(n!==t.length)return!1;for(;n--;)if(e[n]!==t[n])return!1}return!0}function dn(e){return e.messages&&0!==e.messages.length?fn(e.messages):null}function fn(e){if(!e)return null;var t=new Map;return e.forEach(function(e){"REMOVED"!==e.status&&(e.attaches&&e.attaches.forEach(function(n){"PHOTO"===n._type&&t.set(e.id+"-"+n.photoId,{photo:n,message:e})}),e.link&&"FORWARD"==e.link.type&&e.link.message.attaches&&e.link.message.attaches.forEach(function(n){"PHOTO"===n._type&&t.set(e.id+"-"+n.photoId,{photo:n,message:e})}))}),t}function gn(e,t){var n=Array.from(e.keys()),o=n.indexOf(t);return{previous:0===o?null:n[o-1],next:o===n.length-1?null:n[o+1]}}function _n(e){var t=[mn(e.shares)].concat(e.upload&&Array.from(e.upload.values())).filter(Boolean);return t.length?t:null}function mn(e){return e&&!e.disabled&&e.attachments&&e.selected&&e.attachments.has(e.selected)?e.attachments.get(e.selected):null}function vn(e){return kc[(e.type||"").match(/^\w+/)]}function yn(e,t){return kn(e).find(function(e){return e.file===t})}function kn(e){var t=[];return e?(bn(e).forEach(function(e){if(e.attaches)for(var n=0;n<e.attaches.length;n++)e.attaches[n].file&&t.push(e.attaches[n])}),e.posting&&e.posting.upload&&e.posting.upload.forEach(function(e){return t.push(e)}),t):t}function bn(e){return e.pending||[]}function wn(e){return"CHANNEL"===e.type&&e.options.SIGN_ADMIN?"CHANNEL_ADMIN":"CHANNEL"===e.type?"CHANNEL":"USER"}function Cn(e){return Array.isArray(e)||e instanceof Map?new Map(e):e&&"object"==typeof e?new Map(Object.entries(e)):e}function En(e){var t=Array.isArray(e.participants)?e.participants.map(function(e){return"object"==typeof e.user?e.user.id:e.user}).filter(Boolean):Object.keys(e.participants).map(Number).concat(e.owner);return e.lastMessage&&(t=t.concat(An(e.lastMessage))),Array.isArray(e.messages)&&(t=t.concat(cn(e.messages.map(An)))),Array.isArray(e.admins)&&(t=t.concat(e.admins.map(Tn))),t.filter(ln).filter(Boolean)}function An(e){return cn((e.attaches||[]).map(function(e){return[e.userId,e.userIds]})).concat(Tn(e.sender)).concat(e.link&&e.link.message?An(e.link.message):null).filter(ln)}function Tn(e){return e&&"object"==typeof e?e.id:e}function Sn(e,t,n){return{chatId:e,message:{cid:Date.now(),attaches:[Object.assign({},{_type:"CONTROL",event:t},n)]}}}function In(e){for(var t=Array.from(e.messages.values()),n=t.length-1;n>=0;n--){var o=t[n];if(o.editable)return o;if(o.sender.current)break}return null}function On(e,t,n,o){var s=Date.now();return{id:e,type:t,owner:n,cid:e,lastEventTime:s,created:s,status:"ACTIVE",participants:o.reduce(function(e,t){return e[t]=s,e},{})}}function xn(e,t){var n=e&&e.participants;if(t||(t=this._store.getState().auth.profile.id),n)for(var o=0,s=n.length;o<s;o++)if(n[o].user.id===t)return n[o].time;return-1}function Dn(e,t){var n=Array.from(e.values()),o=n[0].time,s=n[n.length-1].time,i=t>s;return t<o?{from:t,backward:Cc,forward:Cc,forwardTime:o}:i?{from:t,backward:Cc,forward:Cc,backwardTime:s}:null}function Mn(e){if(Array.isArray(e.participants)){var t=e.participants.find(function(e){return e.user.current});return t&&t.time}}function jn(e,t){var n,o=!1,s=function(){if(!o){clearTimeout(n);var i=Date.now();Pn(e,{interactive:!!t.getState().interactive},Hc).then(function(){return n=setTimeout(s,zc)}).catch(function(){console.log("no ping response for %d, reconnect",Date.now()-i),e.reopen()})}},i=function(){t.dispatch({type:La.SET_ONLINE}),s()},r=function(){return t.dispatch({type:La.SET_OFFLINE})};return e.on("connect",i),e.on("disconnect",r),s.dispose=function(){o=!0,clearTimeout(n),e.off("connect",i),e.off("disconnect",r)},e.connected&&s(),s}function Pn(e,t,n){return Promise.race([e.request(Rc,t),new Promise(function(e,t){return setTimeout(t,n)})])}function Ln(e){var t=e.get("recentEmoji");return{recentEmoji:t?Array.from(t):void 0}}function Nn(e){return Object.assign({},e,{chats:Gn(e.chats),notificationsEnabled:!!e.notificationsEnabled,background:e.background||0,alternativeKeyboardBehaviour:!!e.alternativeKeyboardBehaviour})}function Rn(e){return Object.assign({},e,{lastError:void 0,recovery:void 0,okProfile:void 0,loadState:"idle"})}function zn(e){var t=Wn(e),n=t.lastMessage,o=t.lastEventTime;return"DIALOG"!==e.type||n?Object.assign({},e,{loadState:"idle",lastError:void 0,typingParticipants:void 0,placeholder:void 0,owner:qn(e.owner),participants:(e.participants||[]).reduce(function(e,t){return e[t.user.id]=t.time,e},{}),lastEventTime:o,lastMessage:n,messages:Kn(e),pending:void 0,focusedMessage:void 0,search:void 0,posting:$n(e.posting),newMessages:e.unreadCount,media:void 0,members:void 0,nextLink:void 0,settings:void 0}):null}function Hn(e){return Object.assign({},e,{current:void 0,name:void 0})}function Fn(e){return Object.assign({},e,{unread:void 0,removable:void 0,editable:void 0,status:void 0,sender:qn(e.sender),attaches:e.attaches?e.attaches.map(Un):void 0,link:e.link?Object.assign({},e.link,{message:e.link.message&&Fn(e.link.message)}):void 0})}function Un(e){return(e=Object.assign({},e)).users&&(e.userIds=e.users.map(qn),delete e.users),e.user&&(e.userId=e.user.id,delete e.user),e}function qn(e){return e&&"object"==typeof e?e.id:"number"==typeof e||"string"==typeof e?e:void 0}function $n(e){if(e&&e.text)return Object.assign({},e,{link:e.link?Fn(e.link):void 0,upload:void 0,shares:void 0})}function Gn(e){if(e&&e.size>0){var t={};for(var[n,o]of e)t[n]=o;return t}}function Bn(e,t){if(e){var n=Array.from(e.values());return t?n.map(t):n}}function Vn(e){return e&&!e.error&&!e.posting&&"REMOVED"!==e.status}function Wn(e){var t=e.lastMessage?Fn(e.lastMessage):void 0,n=e.lastEventTime;if(e.messages&&!Vn(t))for(var o=Array.from(e.messages.values()),s=o.length-1;s>=0;){if(Vn(o[s])){n=(t=o[s]).time;break}s--}return{lastMessage:t,lastEventTime:n}}function Kn(e){if(e.selected&&e.messages)return Bn(e.messages).filter(Vn).map(Fn)}function Yn(e,t,n){var o=Object.assign({},Uc,n.userAgent),s={type:o.deviceType,id:qc},i=rc(t),r=new jc(e),a=new Nc(r),c=new Nc(r),l=new hc(i,c),u=new Sc(i,a),p=new Tc(i,a),h=new Mc(i,c,o),d=new uc(i,c,h,l,s),f=new Ec(i,a,p,l),g=new Ac(i,a),_=new xc(i,a),m=new Dc(i,a,f),v=new Ic(i,a,f);a.pause(),h.on("authorize",function(e){console.log("session authorized, resume main stream"),a.resume(),Zn(i,u,f,p,v,e),_.update()}).on("deauthorize",function(e){a.pause(),e&&"login.token"===e.code&&d.logout(),console.log("session deauthorized, pause main stream")}),[c,a].forEach(function(e){e.on("request-end",function(e,t,n){return l.net(e,t,n)})});var y=jn(c,i);return{stats:l,auth:d,chat:f,message:g,contacts:p,config:u,stickers:_,newChat:m,ping:y,onboarding:v,authorize:function(e){return d.authorize(e)},getState:function(){return i.getState()},subscribe:function(e){return i.subscribe(e)},dispatch:function(e){return i.dispatch(e)},_immutable:function(){return i.loophole.getImmutableStore()},serialize:function(){return Fc(i.getState())}}}function Zn(e,t,n,o,s,i){return Promise.resolve(i).then(function(e){return e.config&&t.save(e.config),e}).then(function(e){return s.update(),e}).then(function(t){return t.chatMarker?e.dispatch({type:Ua.REMOVE_ALL}):delete(t=Object.assign({},t)).chatMarker,t}).then(function(t){var o=Jn(e,t.chats);return o?(console.log("will load messages for",o),n.loadMessages(o.id).then(function(e){return o.messages=e,t})):t}).then(function(e){return Object.assign({},e,{contacts:[].concat(Object.assign({},e.profile),e.contacts.filter(function(t){return t.id!==e.profile.id}).map(function(e){return Object.assign({},e,{own:!0})}))})}).then(function(t){var n=new Set(t.contacts.map(function(e){return e.id})),s=e.getState().contacts||new Map,i=Qn(t.chats).filter(function(e){return!n.has(e)&&!s.has(e)});return i.length?(console.log("More users to fetch",i),o.load(i).then(function(e){return Object.assign({},t,{contacts:e.concat(t.contacts)})})):(console.log("No more users to fetch"),t)}).then(function(t){return console.log("auth payload",t),e.dispatch(Object.assign({},{type:La.LOGIN,profile:t.profile.id},t)),t})}function Jn(e,t){var n=null,o=e.getState().chats;return o&&o.forEach(function(e){e.selected&&(n=e.id)}),t.find(function(e){return e.id===n})}function Qn(e){return e&&e.length?e.map(En).reduce(function(e,t){return e.concat(t)}):[]}function Xn(e,t,n){void 0===n&&(n={});var o,s,i=null,r=0,a=function(){r=!1===n.leading?0:Date.now(),i=null,s=e.apply(void 0,o),i||(o=null)};return function(){for(var c=[],l=arguments.length;l--;)c[l]=arguments[l];var u=Date.now();r||!1!==n.leading||(r=u);var p=t-(u-r);return o=c,p<=0||p>t?(i&&(clearTimeout(i),i=null),r=u,s=e.apply(void 0,o),i||(o=null)):i||!1===n.trailing||(i=setTimeout(a,p)),s}}function eo(){var e=navigator.userAgent;if(-1!==e.indexOf("Opera"))return"Opera";if(-1!==e.indexOf("MSIE"))return"Microsoft Internet Explorer";if(-1!==e.indexOf("Chrome"))return"Chrome";if(-1!==e.indexOf("Safari"))return"Safari";if(-1!==e.indexOf("Firefox"))return"Firefox";var t=e.lastIndexOf(" ")+1,n=e.lastIndexOf("/");return t<n?e.substring(t,n):navigator.appName}function to(){var e=window.navigator.userAgent,t=window.navigator.platform,n=["Win32","Win64","Windows","WinCE"],o=["iPhone","iPad","iPod"];return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?"Mac OS":-1!==o.indexOf(t)?"iOS":-1!==n.indexOf(t)?"Windows":/Android/.test(e)?"Android":/Linux/.test(t)?"Linux":"Unknown"}function no(e){return/^image\//.test(e.type)?oo(e):/^video\//.test(e.type)?so(e):Promise.resolve()}function oo(e){return Promise.race([io(),new Promise(function(t){var n=new Image;n.onload=n.onerror=function(){var e;n.naturalWidth&&n.naturalHeight&&(e={width:n.naturalWidth,height:n.naturalHeight}),n.onload=n.onerror=null,URL.revokeObjectURL(n.src),t(e)},n.src=URL.createObjectURL(e)})])}function so(e){return Promise.race([io(),new Promise(function(t){var n=document.createElement("video");n.autoplay=!1,n.preload="metadata";var o=function(){var e;n.videoWidth&&n.videoHeight&&(e={width:n.videoWidth,height:n.videoHeight}),n.removeEventListener("loadedmetadata",o),n.removeEventListener("loadeddata",o),n.removeEventListener("error",o),URL.revokeObjectURL(n.src),t(e)};n.addEventListener("loadedmetadata",o),n.addEventListener("loadeddata",o),n.addEventListener("error",o),n.src=URL.createObjectURL(e)})])}function io(e){return void 0===e&&(e=Bc),new Promise(function(t){return setTimeout(t,e)})}function ro(e,t){t=t&&t.valueOf();var n=Vc.has(e)?Vc.get(e):e;if(t){var o="";return(Array.isArray(n)?n:[n]).forEach(function(e){"object"==typeof e?e.name in t&&(e.func?"plural"===e.func&&(o+=ao(t[e.name],e.values)):e.values?o+=e.values[t[e.name]]:o+=t[e.name]):o+=e}),o}return n}function ao(e,t){var n=-1;if((e=Math.abs(e)%100)>10&&e<20)n=2;else{var o=e%10;n=1===o?0:o>1&&o<5?1:2}return t[n]}function co(e){return e.uid||"user"+e.cid}function lo(e){return e&&e.unread&&e.sender&&!e.sender.current}function uo(e){var t=[],n=function(e,n){t.push(Object.assign({},n,{chatId:e.id,messageId:co(n),chatTitle:e.title||e.placeholder}))};return e.forEach(function(e){Wc(e)&&(lo(e.lastMessage)&&n(e,e.lastMessage),e.messages&&e.messages.forEach(function(t){lo(t)&&n(e,t)}))}),t.sort(function(e,t){return e.time-t.time})}function po(e){var t=0;return e.forEach(function(e){Wc(e)&&(t+=e.unreadCount)}),t}function ho(e){var t=0;return e.forEach(function(e){Wc(e)&&(t+=e.unreadCount?1:0)}),t}function fo(e,t){var n=-1;if((e=Math.abs(e)%100)>10&&e<20)n=2;else{var o=e%10;n=1===o?0:o>1&&o<5?1:2}return t[n]}function go(e){return(e||"").trim().toLowerCase()}function _o(e){var t={};return Object.keys(e).forEach(function(n){t[e[n]]=n}),t}function mo(e){return e.split("").map(function(e){return Yc[e]||e}).join("")}function vo(e){return"DIALOG"===e.type?e.participants.find(function(e){return!e.user.current}).user.avatarUrl:e.iconUrl}function yo(e,t){return e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&ko(e,t):!e||!t||"object"!=typeof e&&"object"!=typeof t?e===t:bo(e,t))}function ko(e,t,n){var o=e.length;if(o!==t.length)return!1;if(n){for(;o--;)if(e[o]!==t[o])return!1}else for(;o--;)if(!yo(e[o],t[o]))return!1;return!0}function bo(e,t){if(null==e||null==t||e.prototype!==t.prototype)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;if(!ko(n.sort(),o.sort()))return!1;for(var s=n.length-1,i=void 0;s>=0;s--)if(i=n[s],!yo(e[i],t[i]))return!1;return typeof e==typeof t}function wo(e,t){return Object.assign({},{isDelimiter:!0,type:e},t)}function Co(e){return e.attaches&&e.attaches[0]&&"CONTROL"===e.attaches[0]._type}function Eo(e){return e&&!e.isDelimiter&&!Co(e)}function Ao(e){return e&&e.sender&&e.sender.current&&"CHANNEL"!==e.type&&"CHANNEL_ADMIN"!==e.type}function To(e){return Array.isArray(e)?e.slice():Object.assign({},e)}function So(e,t,n){if(yo(e[t],n))return e;var o=To(e);return o[t]=n,o}function Io(e,t){if(!e)return t;var n=e;for(var o in t)yo(t[o],e[o])||(e===n&&(n=To(e)),n[o]=t[o]);return n}function Oo(e,t){void 0===t&&(t="id");for(var n=[],o=0,s=void 0;o<e.length;o++)n[(s=e[o])[t]]=s;return n}function xo(e,t){var n=e.attaches&&e.attaches[0],o="",s=e.text;switch(t&&"CHAT"===t.type&&(o=e.sender.name+": "),n&&n._type){case"STICKER":s=((n.tags&&n.tags[0]||"")+" "+ro("sticker")).trim();break;case"PHOTO":s="📷";break;case"VIDEO":s="📹";break;case"AUDIO":s="🔈";break;case"SHARE":s=n.url}return o+s}function Do(e,t){return uo(e).filter(function(e){var n=t.get(e.chatId);return(null==n||n<e.time)&&(t.set(e.chatId,e.time),!Co(e))})}function Mo(e){var t=new Map;return e.forEach(function(e){e.lastMessage&&t.set(e.id,e.lastMessage.time)}),t}function jo(e){return""+e+(-1===e.indexOf("?")?"?":"&")+"_="+Math.random()}function Po(e){if(!e)return"/";var t=e.id;return"DIALOG"===e.type?"/"+t:e.link&&-1===e.link.indexOf("join/")?"/"+e.link.substr(e.link.lastIndexOf("/")+1):"/c/"+Math.abs(t)}function Lo(e){return e?{chatId:e.id,link:e.link}:null}function No(e){return e?e.title||e.placeholder:null}function Ro(e){return!!e.match(/^\/\d+/i)}function zo(e){return!!e.match(/^\/c\/\d+/i)}function Ho(e){return zo(e)?e.substr(3):Ro(e)?e.substr(1):null}function Fo(e){var t=Po(e);t!==location.pathname&&history.pushState(Lo(e),No(e),t)}function Uo(){var e=history.state;if(e)return e;var t=location.pathname;if(!t||t.length<=1)return null;var n=Ho(t);return n?{chatId:-parseInt(n,10)}:{link:"https://tt.me"+t}}function qo(){return cl}function $o(e){var t=new URL(e,location.href);return t.protocol=t.protocol.replace("http","ws"),t.href}function Go(e){return e&&e.version!==$c?(console.info("Reset state due to version change"),!0):!(!e||-1===location.hash.indexOf("hard-reset"))&&(console.info("Reset state due to explicit request"),!0)}function Bo(){var e=localStorage.getItem("state"),t=e?JSON.parse(e):null;if(Go(t)){var n=t.auth;n&&(t={auth:{phone:n.phone,state:n.state,token:n.token}})}return t}function Vo(e,t){void 0===t&&(t=3e3);var n,o,s=!1,i=function(){s||(null==n?n=Date.now():(Date.now()-n>2*t&&(console.info("force connection ping"),e.ping()),n=Date.now()),o=setTimeout(i,t))};return i(),function(){s=!0,clearTimeout(o)}}function Wo(e){var t=!1;return e.forEach(function(e){e.posting&&(t=!0)}),t}function Ko(e,t){var n=-1;if((e=Math.abs(e)%100)>10&&e<20)n=2;else{var o=e%10;n=1===o?0:o>1&&o<5?1:2}return t[n]}function Yo(e){return(e||"").trim().toLowerCase()}function Zo(){document.addEventListener("keyup",hl)}function Jo(){document.removeEventListener("keyup",hl)}function Qo(e,t,n){pl.find(function(t){return t.component===e})||(pl.push({component:e,closeFn:t,keyHandler:n}),1===pl.length&&Zo())}function Xo(e){if(pl.length){var t=pl.findIndex(function(t){return t.component===e});t>-1&&pl.splice(t,1),pl.length||Jo()}}function es(e){return e&&e.length>0}function ts(e){return Array.isArray(e)?e:e instanceof Map||e instanceof Set?Array.from(e.values()):null!=e?[e]:[]}function ns(e,t){var n=e.presence,o=t.presence;return n&&o?n.on&&o.on?o.seen-n.seen:n.on?-1:o.on?1:o.seen-n.seen:n?-1:o?1:0}function os(e,t,n){for(var o=e.reduce(function(e,t,o){return e[t[n]]=o,e},{}),s=0,i=void 0;s<t.length;s++)if((i=t[s])[n]in o)return o[i[n]];return-1}function ss(e,t,n){var o=Math.floor(n/2),s=Math.min(e.length-1,t+o);return{from:Math.max(0,s-n),to:s}}function is(e){return"ACTIVE"===e.status||("CHANNEL"===e.type?"CLOSED"===e.status&&e.participants&&e.participants.find(function(e){return e.user.current}):"LEFT"===e.status)}function rs(e){return Math.max(e.lastEventTime,e.lastMessage?e.lastMessage.time:0)}function as(e,t){return rs(t)-rs(e)}function cs(e){return e.selected}function ls(e){return e.lastMessage&&e.lastMessage.sender&&e.lastMessage.sender.current}function us(e){return e===Ol.EXCLAMATION||e===Ol.QUOTATION||e===Ol.APOSTROPHE||e===Ol.LEFT_PRNTHS||e===Ol.RIGHT_PRNTHS||e===Ol.COMMA||e===Ol.PERIOD||e===Ol.COLON||e===Ol.SEMICOLON||e===Ol.QUESTION||e===Ol.LEFT_BRACKET||e===Ol.RIGHT_BRACKET||e===Ol.LEFT_BRACE||e===Ol.RIGHT_BRACE||e===Ol.DASH||e===Ol.EN_DASH||e===Ol.EM_DASH}function ps(e){return e===Ol.SPACE||e===Ol.NBSP||e===Ol.TAB}function hs(e){return e===Ol.NEW_LINE||e===Ol.RETURN||e===Ol.LINE_FEED}function ds(e,t){for(var n,o=new El(e),s=[];!o.eof();)o.start=o.pos,(n=ws(o,t)||ys(o)||gs(o)||_s(o)||ms(o)||vs(o))?s.push(n):fs(o,s);return s}function fs(e,t){if(e.next()){var n=t[t.length-1];n&&n.type===Al.STRING?n.end=e.pos:t.push(new Sl(Al.STRING,e))}}function gs(e){return e.eat(Ol.ASTERISK)?new Sl(Al.FORMATTING,e,{formatFlag:Tl.BOLD}):e.eat(Ol.UNDERSCORE)?new Sl(Al.FORMATTING,e,{formatFlag:Tl.ITALIC}):e.eat(Ol.BACKTICK)?new Sl(Al.FORMATTING,e,{formatFlag:Tl.CODE}):void 0}function _s(e){if(e.eatWhile(us))return new Sl(Al.PUNCTUATION,e)}function ms(e){if(e.eatWhile(ps))return new Sl(Al.WHITESPACE,e)}function vs(e){if(e.eat(hs))return new Sl(Al.NEW_LINE,e)}function ys(e){var t=e.pos;if(ks(e))for(var n=new Sl(Al.USER_STICKER,e),o=e.pos;!e.eof();){var s=e.pos;if(bs(e))return n.end=e.pos,n.opts.code=e.substring(o,s),n;e.next()}return e.pos=t,!1}function ks(e){for(var t=e.pos,n=0,o=Ol.USER_STICKER_BEGIN.length;n<o;n++)if(!e.eat(Ol.USER_STICKER_BEGIN[n]))return e.pos=t,!1;return!0}function bs(e){for(var t=e.pos,n=0,o=Ol.USER_STICKER_END.length;n<o;n++)if(!e.eat(Ol.USER_STICKER_END[n]))return e.pos=t,!1;return!0}function ws(e,t){for(var n=e.pos,o=t;o instanceof Map&&o.has(e.peek());)if(!0===(o=o.get(e.next())))return new Sl(Al.EMOJI,e);return e.pos=n,!1}function Cs(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){t&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e}function Es(e){return Object.prototype.toString.call(e)}function As(e){return"[object String]"===Es(e)}function Ts(e){return"[object Object]"===Es(e)}function Ss(e){return"[object RegExp]"===Es(e)}function Is(e){return"[object Function]"===Es(e)}function Os(e){return e.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function xs(e){return Object.keys(e||{}).reduce(function(e,t){return e||Ll.hasOwnProperty(t)},!1)}function Ds(e){e.__index__=-1,e.__text_cache__=""}function Ms(e){return function(t,n){var o=t.slice(n);return e.test(o)?o.match(e)[0].length:0}}function js(){return function(e,t){t.normalize(e)}}function Ps(e){function t(e){return e.replace("%TLDS%",o.src_tlds)}function n(e,t){throw new Error('(LinkifyIt) Invalid schema "'+e+'": '+t)}var o=e.re=Pl(e.__opts__),s=e.__tlds__.slice();e.onCompile(),e.__tlds_replaced__||s.push(Rl),s.push(o.src_xn),o.src_tlds=s.join("|"),o.email_fuzzy=RegExp(t(o.tpl_email_fuzzy),"i"),o.link_fuzzy=RegExp(t(o.tpl_link_fuzzy),"i"),o.link_no_ip_fuzzy=RegExp(t(o.tpl_link_no_ip_fuzzy),"i"),o.host_fuzzy_test=RegExp(t(o.tpl_host_fuzzy_test),"i");var i=[];e.__compiled__={},Object.keys(e.__schemas__).forEach(function(t){var o=e.__schemas__[t];if(null!==o){var s={validate:null,link:null};if(e.__compiled__[t]=s,Ts(o))return Ss(o.validate)?s.validate=Ms(o.validate):Is(o.validate)?s.validate=o.validate:n(t,o),void(Is(o.normalize)?s.normalize=o.normalize:o.normalize?n(t,o):s.normalize=js());As(o)?i.push(t):n(t,o)}}),i.forEach(function(t){e.__compiled__[e.__schemas__[t]]&&(e.__compiled__[t].validate=e.__compiled__[e.__schemas__[t]].validate,e.__compiled__[t].normalize=e.__compiled__[e.__schemas__[t]].normalize)}),e.__compiled__[""]={validate:null,normalize:js()};var r=Object.keys(e.__compiled__).filter(function(t){return t.length>0&&e.__compiled__[t]}).map(Os).join("|");e.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+o.src_ZPCc+"))("+r+")","i"),e.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+o.src_ZPCc+"))("+r+")","ig"),e.re.pretest=RegExp("("+e.re.schema_test.source+")|("+e.re.host_fuzzy_test.source+")|@","i"),Ds(e)}function Ls(e,t){var n=e.__index__,o=e.__last_index__,s=e.__text_cache__.slice(n,o);this.schema=e.__schema__.toLowerCase(),this.index=n+t,this.lastIndex=o+t,this.raw=s,this.text=s,this.url=s}function Ns(e,t){var n=new Ls(e,t);return e.__compiled__[n.schema].normalize(n,e),n}function Rs(e,t){if(!(this instanceof Rs))return new Rs(e,t);t||xs(e)&&(t=e,e={}),this.__opts__=Cs({},Ll,t),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=Cs({},Nl,e),this.__compiled__={},this.__tlds__=zl,this.__tlds_replaced__=!1,this.re={},Ps(this)}function zs(e,t){var n,o,s=e[0].formats.NONE,i=e.length;for(t.mentionHandler&&Hl.add("@",t.mentionHandler),n=0;n<i;n++)(o=e[n]).type===o.types.PUNCTUATION&&(Bs(e,n)||((o=o.clone()).type=o.types.STRING,o.format=s,e[n]=o));for(n=0;n<i;n++)if((o=e[n]).type===o.types.FORMATTING){var r=Hs(e,n),a=Fs(e,n);Gs(s&o.opts.formatFlag,r,a)?a?(o.format=s,s&=~o.opts.formatFlag):(s|=o.opts.formatFlag,o.format=s):((o=o.clone()).type=o.types.STRING,o.format=s,e[n]=o)}else o.format=s;return e=Vs(e),t.disableLinks||(e=Ws(e)),e}function Hs(e,t){return!qs(e,t)&&Us(e,t,!0)}function Fs(e,t){return!Us(e,t)&&qs(e,t,!0)}function Us(e,t,n){void 0===n&&(n=!1);for(var o=t-1;-1!==o;){var s=e[o];if(s.type!==s.types.FORMATTING&&(!n||s.type!==s.types.PUNCTUATION))return $s(s);o--}return!0}function qs(e,t,n){void 0===n&&(n=!1);for(var o=t+1;o!==e.length;){var s=e[o];if(s.type!==s.types.FORMATTING&&(!n||s.type!==s.types.PUNCTUATION))return $s(s);o++}return!0}function $s(e){return e.type===e.types.WHITESPACE||e.type===e.types.NEW_LINE}function Gs(e,t,n){return e&&n||!e&&t}function Bs(e,t){var n,o;return(o=qs(e,t,!0))||(n=Us(e,t,!0)),o||n}function Vs(e){for(var t=[],n=e.length,o=0;o<n;o++){var s=e[o];if(s.type===s.types.STRING){var i=t[t.length-1];i&&i.type===s.type&&s.format===i.format?i.end=s.end:t.push(s)}else t.push(s)}return t}function Ws(e){for(var t=e.length,n=0;n<t;n++){var o=e[n],s=!1;if(o.type===o.types.STRING&&Hl.pretest(o.value)&&(s=Hl.test(o.value)),s){var i=o.clone();i.type=o.types.LINK,i.opts={link:Hl.match(o.value)},e[n]=i}}return e}function Ks(e,t){for(var n=t.length,o=0;o<n;o++){var s=t[o].trim().toLowerCase();if(s)if(-1!==s.indexOf(" "))for(var i=-2;-1!==i;){var r=Qs(e,s,i);e=r.tokens,i=r.firstTokenIdx}else e=Js(e,s)}return e}function Ys(e,t){for(var n,o=-1,s=e.length,i=0;i<s;i++){var r=e[i];if(r.format&r.formats.HIGHLIGHTED){o=i;break}}if(-1===o)return e;for(;o&&t;)(n=e[o-1]).type===n.types.STRING&&t--,o--;for(;o&&(n=e[o-1]).type===n.types.FORMATTING;)o--;return o>0?e.slice(o):e}function Zs(e){return e.type===e.types.STRING||e.type===e.types.LINK}function Js(e,t){for(var n=[],o=e.length,s=0;s<o;s++){var i=e[s];Zs(i)?ti(t,n,i):n.push(i)}return n}function Qs(e,t,n){void 0===n&&(n=-1);var o=t.split(/\s+/),s=o.shift(),i=Xs(e,s,n);if(-1!==i){for(var r=[{tokenIdx:i,query:s}],a=!0,c=i;o.length;){if(c++,e.length<=c){a=!1;break}var l=e[c];if(Zs(l)){var u=l.value.toLowerCase(),p=o.shift();if(!o.length){if(0!==u.indexOf(p)){a=!1;break}}else if(u!==p){a=!1;break}r.push({tokenIdx:c,query:p})}}a&&(e=ei(e,r))}return{tokens:e,firstTokenIdx:i}}function Xs(e,t,n){for(var o=e.length,s=0;s<o;s++){var i=e[s];if(Zs(i)){var r=i.value.toLowerCase(),a=r.indexOf(t);if(s>n&&-1!==a&&a===r.length-t.length)return s}}return-1}function ei(e,t){for(var n=[],o=e.length,s=0;s<o;s++){var i=e[s];t.length&&s===t[0].tokenIdx?ti(t.shift().query,n,i):n.push(i)}return n}function ti(e,t,n){var o=n.value.toLowerCase().indexOf(e);if(-1!==o){var s,i=e.length,r=n.start+o,a=r+i;if(0!==o&&((s=n.clone()).end=r,t.push(s)),s=n.clone(),s.start=r,s.end=a,s.format=s.format|Tl.HIGHLIGHTED,t.push(s),a<n.end)return n=n.clone(),n.start=a,ti(e,t,n)}else t.push(n);return t}function ni(e){for(var t=e.length,n=[],o=0;o<t;o++){var s=e[o],i=n.length?n[n.length-1]:null;if(i&&oi(i)&&oi(s)&&i.format===s.format){var r=i.clone();r.type=r.types.STRING,r.end=s.end,n[n.length-1]=r}else n.push(s)}return n}function oi(e){return e.type===e.types.FORMATTING||e.type===e.types.STRING||e.type===e.types.PUNCTUATION||e.type===e.types.WHITESPACE}function si(e,t,n){void 0===n&&(n=0);var o=t.charCodeAt(n++);n===t.length?e.set(o,!0):(e.has(o)||e.set(o,new Map),si(e.get(o),t,n))}function ii(e){for(var t=0,n=e.length,o=[];t<n;t+=1)o.push(e.charCodeAt(t));return o}function ri(e){return Array.isArray(e)?e:e instanceof Map||e instanceof Set?Array.from(e.values()):null!=e?[e]:[]}function ai(e,t){return Array.isArray(e)?-1!==e.indexOf(t):e instanceof Map||e instanceof Set?e.has(t):e===t}function ci(e){return(e.format&e.formats.HIGHLIGHTED)===e.formats.HIGHLIGHTED}function li(e,t){return Ql.parse(e,{disableLinks:!0,highlights:t}).find(ci)}function ui(e){return e.user.name}function pi(e){var t=e;return"CHATS"===e.section&&"CHAT"===e.chat.type&&Array.isArray(e.chat.participants)&&(t=Jl({},t,{matchedParticipants:e.chat.participants.map(ui).filter(function(t){return li(t,e.highlights)}).join(", ")})),t}function hi(e,t,n){return{type:e,id:t,item:n}}function di(e){var t=e instanceof Date?e.getTime():e;return Math.floor(t/Xl)}function fi(e,t){return void 0===t&&(t=0),(di(e)+t)*Xl+eu}function gi(e,t,n,o){var s=[];o=o||"time";for(var i=0,r=void 0,a=void 0;i<e.length;i++)(a=fi(_i(e[i],o)))!==r&&(s.push(vi(e[i],a,t,n)),r=a),s.push(e[i]);return s}function _i(e,t){for(var n=e,o=t.split("."),s=0,i=void 0;s<o.length;s++){if(i=o[s],!(null!=n&&i in n))return null;n=n[i]}return n}function mi(e){var t=new Date,n=di(fi(t)),o=di(e);if(o===n)return tu.today;if(o===n-1)return tu.yesterday;var s=e.getDate()+" "+nu[e.getMonth()];return e.getFullYear()!==t.getFullYear()&&(s+=" "+e.getFullYear()),s}function vi(e,t,n,o){var s="date"+e[n],i=new Date(t);return o&&s in o?So(o[s],"label",mi(i)):wo("date",(r={date:i,label:mi(i)},r[n]=s,r));var r}function yi(e,t,n,o){for(var s,i=o&&o[ou]||wo("unread",(s={},s[t]=ou,s)),r=e.length-1;r>=1;r--)if(e[r][t]===n)return e.slice(0,r).concat(i,e.slice(r));return e}function ki(e){var t=null;return e.map(function(n,o){if(!Eo(n))return t=null,n;if("CHANNEL"===n.type||"CHANNEL_ADMIN"===n.type)return So(n,"sequence",{item:"first",view:"single",id:bi(n)});t=t&&"last"!==t.item&&"single"!==t.item?Object.assign({},t,{item:"middle"}):{item:"first",id:bi(n)};var s=e[o+1];return Eo(s)&&t.id===bi(s)?"single"===t.view?t.view=Ai(s)?"single":"first":Ai(s)?t.view="first"===t.item?"single":"last":t.view=t.item:(t.item="first"===t.item?"single":"last",t.view="single"===t.view?"single":t.item),Ai(n)&&(t.view="single"),So(n,"sequence",t)})}function bi(e){return e&&e.sender&&e.sender.id}function wi(e){return e.attaches&&e.attaches.some(Ti)}function Ci(e){return!e.text&&!e.link}function Ei(e){return e.attaches&&e.attaches.some(Si)}function Ai(e){return Eo(e)&&(Ci(e)&&wi(e)||Ei(e))}function Ti(e){return su.has(e._type)}function Si(e){return"STICKER"===e._type}function Ii(e,t,n,o){return Di(e,t,n,Ao,o)}function Oi(e,t,n,o){return Di(e,t,n,Eo,o)}function xi(e,t,n,o){var s=!1;return Di(e,t,n,function(e){return!(!Eo(e)||s||(s=!0,0))},o)}function Di(e,t,n,o,s){for(var i=e.slice(),r=Mi(n),a=i.length-1,c=void 0,l=void 0;a>=0&&n.size;a--)o(c=i[a],a,e)&&(!(l=r.get(c.time)).length||1===l.length&&l[0].user.current||i.splice(a+1,0,ji(c,t,l,s)));return i}function Mi(e){var t=new Map(e);return{get:function(e){var n=[];return t.forEach(function(o,s){o>=e&&(n.push({user:s,time:o}),t.delete(s))}),n.filter(Boolean).sort(Pi)},get size(){return t.size}}}function ji(e,t,n,o){var s="readMark"+e[t],i=o&&o[s];return i&&i.participants.length===n.length?i:wo("readMark",(r={participants:n,time:e.time,sender:e.sender},r[t]=s,r));var r}function Pi(e,t){return e.time-t.time}function Li(e,t,n){if(!e)return[];if(!n)return Array.from(e.values());var o=[];return e.forEach(function(e){var s=e[t];o.push(s in n?Io(n[s],e):e)}),o}function Ni(e){return Array.isArray(e.participants)?e.participants.reduce(function(e,t){return e.set(t.user,t.time)},new Map):new Map}function Ri(e,t,n,o){return e.map(function(e){return Io(e,{selected:!(!n||!n.has(e[t])&&!n.has(e.id)),highlighted:o&&(o===e[t]||o===e.id)})})}function zi(e,t){return e.map(function(e){return"CHANNEL"===e.type?So(e,"sender",{id:-t.id,name:t.title||t.placeholder}):e})}function Hi(e,t){for(var n=e.length-1,o=void 0;n>=0;n--){if(!(o=e[n]).unread){console.log("unread: read message found at %d of %d",n,e.length);break}if(Ao(o)){console.log("unread: own message found at %d of %d",n,e.length);break}if(!n||!e[n-1].unread)return o[t]}return""}function Fi(e){var t=navigator.userAgent;if(!t.includes("Firefox")||!t.includes("Mac OS"))return function(){};var n=null,o=null,s=0,i=function(e){var t=e.currentTarget,i=t.scrollTop,r=Date.now();n&&r-n>150&&(n=null),o===i?s++:s=0,n||s>2?(n=r,t.scrollTop=i+e.deltaY):o=i};return e.addEventListener("wheel",i),function(){return e.removeEventListener("wheel",i)}}function Ui(){return window.getSelection?window.getSelection():null}function qi(e){for(var t,n=e;n;){if(t=n.nodeName.toLowerCase(),lu.has(t))return n;if("ok-message-list"===t)break;n=n.parentElement}return n}function $i(e,t){var n,o,s=qi(e.anchorNode),i=qi(e.focusNode);if(!s||!i)return null;var r=s.getAttribute("message"),a=i.getAttribute("message"),c=t.indexOf(r),l=t.indexOf(a);return c>l?(o=!0,n=t.slice(l,c+1)):(o=!1,n=t.slice(c,l+1)),{reversed:o,messages:n.filter(function(e){return!e.isDelimiter&&e.text&&e.text.trim().length>0})}}function Gi(e){return e<10?"0"+e:String(e)}function Bi(e){var t=new Date(e);return Gi(t.getDate())+"."+Gi(t.getMonth()+1)+"."+t.getFullYear()+" "+Gi(t.getHours())+":"+Gi(t.getMinutes())}function Vi(e,t,n){var o=t.length-1;return t.map(function(t,s){var i=t.text;return 0===s?i=t.text.substr(n?e.focusOffset:e.anchorOffset):s===o&&(i=t.text.substr(0,n?e.anchorOffset:e.focusOffset)),"["+Bi(t.time)+"] "+t.sender.name+": "+i.trim()}).join("\n")}function Wi(e,t){e.preventDefault(),e.clipboardData?e.clipboardData.setData("text/plain",t):window.clipboardData&&window.clipboardData.setData("Text",t)}function Ki(e){if(!e)return null;var t=e.getRangeAt(0),n=e.getRangeAt(e.rangeCount-1);return{focusNode:t.startContainer,focusOffset:t.startOffset,anchorNode:n.endContainer,anchorOffset:n.endOffset}}function Yi(){return document[hu]}function Zi(e){return!e.isDelimiter}function Ji(e,t){return e&&e.some(function(e){return e===t||e.uid===t.uid})}function Qi(e,t){if(e&&e.search.result){var n=Oo(t||[]),o=Xi(e.search.result,n);return o=er(e,o),o=gi(o,"id",n,"message.time")}return[]}function Xi(e,t){return e?e.map(function(e){return"id"in e||(e=So(e,"id",e.message.id)),e.id in t?Io(t[e.id],e):e}):[]}function er(e,t){return t.map(function(t){return"CHANNEL"===t.message.type&&t.chat!==t?fu({},t,{chat:e}):t})}function tr(e){var t={};return Object.keys(e).forEach(function(n){t[e[n]]=n}),t}function nr(e){return e.split("").map(function(e){return mu[e]||e}).join("")}function or(){return[{title:null,list:Au},{title:null,list:Tu},{title:null,list:Su},{title:null,list:Iu},{title:null,list:Ou}]}function sr(e){if(Eu.has(e)&&(e=Eu.get(e)),1===e.length)return xu+"-"+e.codePointAt(0).toString(16);if(2===e.length){var t=e.codePointAt(0);return(t===Du||t>=Mu&&t<=ju)&&e.codePointAt(1)===Pu?xu+"-00"+t.toString(16):xu+"-"+t.toString(16)}for(var n=xu,o=0,s=e.length;o<s;o+=2)n+="-"+e.codePointAt(o).toString(16);return n}function ir(e,t){for(var n=e.scrollTop,o=n+e.clientHeight+150,s=[],i=0,r=t.length;i<r;i++){var a=t[i],c=a.offsetTop,l=c+a.clientHeight;if(c<o&&l>n)s.push(a);else if(c>o)break}return s}function rr(e){return 0===e.indexOf("chat-")}function ar(e){return parseInt(e.replace(/^\w+-/,""),10)}function cr(e){return"CHANNEL"===e.type?e.owner.current||e.admins&&e.admins.some(function(e){return e.current}):e.participants.some(function(e){return e.user.current})}function lr(e){return e?e instanceof Map?Array.from(e.values()):Array.isArray(e)?e:[e]:[]}function ur(e,t){return zu.test(t.name.charAt(0))?zu.test(e.name.charAt(0))?e.name>t.name?1:e.name<t.name?-1:0:1:-1}function pr(e){return e.id}function hr(e){return Hu({},e,{name:e.names[0].name})}function dr(e){var t=e.participants;return Array.isArray(t)&&t.some(function(e){return e.user.current})}function fr(e){return!dr(e)}function gr(e){return e>="\ud800"&&e<="\udbff"}function _r(e){if(e&&e.length>0){var t=e.replace(/[^A-Za-zА-Яа-я0-9 ]+/gm,"");t&&t.trim().length>0&&(e=t);var n=[];return e.trim().split(/\s+/).slice(0,2).forEach(function(e){var t=e.charAt(0);n.push(gr(t)?e.substring(0,2):e.substring(0,1))}),n.join("")}return""}function mr(e){return 1+(Math.abs(e)>>>8)%16}function vr(e){return e<10?"0"+e:e.toString()}function yr(e){var t=new Date(e),n=t.getHours(),o=t.getMinutes();return vr(n)+":"+vr(o)}function kr(e,t){return Bu.has(t)?Bu.get(t)(e):Gu(e)}function br(e){var t=Math.floor(e/Fu),n=Math.floor(t/$u),o=Math.floor(t%$u/qu),s=Math.floor(t%Uu);return""+(0!==n?n+":":"")+vr(o)+":"+vr(s)}function wr(e,t){return Wu.has(t)?Wu.get(t)(e):Vu(e)}function Cr(e,t){t=Object.assign({},Ku,t);var n=e.naturalWidth||e.videoWidth,o=e.naturalHeight||e.videoHeight,s={};if(t.width&&t.height){var i=t.width/n,r=t.height/o,a="cover"===t.fit?Math.max(i,r):Math.min(i,r);s.dw=Math.ceil(n*a),s.dh=Math.ceil(o*a),s.width=t.width,s.height=t.height}else t.width?(s.width=s.dw=t.width,s.height=s.dh=Math.ceil(o*(t.width/n))):t.height?(s.height=s.dh=t.height,s.width=s.dw=Math.ceil(n*(t.height/o))):(s.width=s.dw=n,s.height=s.dh=o);return s.dx=Math.round((s.width-s.dw)/2),s.dy=Math.round((s.height-s.dh)/2),s}function Er(e,t){return new Promise(function(n,o){var s=new Image;s.onload=function(){var e=Cr(s,t),o=document.createElement("canvas"),i=o.getContext("2d");o.width=e.width,o.height=e.height,i.drawImage(s,e.dx,e.dy,e.dw,e.dh),s.onload=s.onerror=null,URL.revokeObjectURL(s.src),o.toBlob?o.toBlob(function(t){return n({width:e.width,height:e.height,url:URL.createObjectURL(t)})}):n({width:e.width,height:e.height,url:o.toDataURL()})},s.onerror=o,s.src=URL.createObjectURL(e)})}function Ar(e){return{id:e.id,caption:e.name,url:e.avatarUrl}}function Tr(e){return e?e instanceof Map?Array.from(e.values()):Array.isArray(e)?e:[e]:[]}function Sr(e,t){return Xu.test(t.name.charAt(0))?Xu.test(e.name.charAt(0))?e.name>t.name?1:e.name<t.name?-1:0:1:-1}function Ir(e){var t="";return e.format&e.formats.BOLD&&(t+="bold "),e.format&e.formats.ITALIC&&(t+="italic "),e.format&e.formats.CODE&&(t+="code "),e.format&e.formats.HIGHLIGHTED&&(t+="highlighted"),t?t.trim():null}function Or(){return{validate:function(e,t,n){var o=e.slice(t);return n.re.tamtam||(n.re.tamtam=new RegExp("^([a-zA-Z][a-zA-Z0-9_-]{3,63})")),n.re.tamtam.test(o)?o.match(n.re.tamtam)[0].length:0},normalize:function(e){e.url="https://tt.me/"+e.url.replace(/^@/,"")}}}function xr(e,t){void 0===t&&(t=Date.now()),e=Dr(e);var n=(t=Dr(t))-e;if(n<ip){var o=Math.ceil(n/op);return 1===o?"минуту назад":o+" "+fo(o,lp)+" назад"}if(n<rp)return"час назад";if(n<ap)return"полтора часа назад";if(n<cp){var s=Math.ceil(n/sp);return s+" "+fo(s,up)+" назад"}var i=new Date(e),r=new Date(t),a="в "+Mr(i.getHours())+":"+Mr(i.getMinutes());if(!jr(i,r))if(Pr(i,r))a="вчера "+a;else{var c=i.getFullYear()!==r.getFullYear()?" "+i.getFullYear():"";a=i.getDate()+" "+pp[i.getMonth()]+c+" "+a}return a}function Dr(e){return e instanceof Date?e.getTime():Number(e)}function Mr(e){return e<10?"0"+e:String(e)}function jr(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function Pr(e,t){var n=new Date(t);return n.setDate(n.getDate()-1),jr(e,n)}function Lr(e,t){t=Nr(t);for(var n=e.firstChild,o=0,s=t.length,i=void 0;o<s;o++)i=t[o],n?Rr(n,i)?n=Hr(n,i).nextSibling:e.insertBefore(zr(i),n):e.appendChild(zr(i));for(;n&&n.parentNode;)e.removeChild(n.nextSibling||n)}function Nr(e){for(var t,n,o=[],s=0,i=new Set(["STRING","NEW_LINE"]);s<e.length;)if(n=e[s++],t=n.clone(),t.className=n.className,o.push(t),i.has(t.type))for(;s<e.length&&i.has(e[s].type)&&e[s].className===t.className;)t.end=e[s++].end;return o}function Rr(e,t){return t.type===t.types.EMOJI?"IMG"===e.nodeName:t.className?"SPAN"===e.nodeName:e.nodeType===e.TEXT_NODE}function zr(e){var t;return e.type===e.types.EMOJI?(t=document.createElement("img")).src=dp:t=e.className?document.createElement("span"):document.createTextNode(e.value),Hr(t,e)}function Hr(e,t){return 1===e.nodeType&&Fr(e,"className",t.className),t.type===t.types.EMOJI?Fr(e,"alt",t.value):Fr(e,"textContent",t.value),e}function Fr(e,t,n){return e[t]!==n&&(e[t]=n),e}function Ur(e){var t=window.getSelection();if(!e.contains(t.anchorNode)||!e.contains(t.focusNode))return null;var n=Br(e,t.anchorNode,t.anchorOffset);return{anchor:n,focus:t.isCollapsed?n:Br(e,t.focusNode,t.focusOffset)}}function qr(e,t,n){var o=window.getSelection(),s=document.createRange();Vr(e,t,s,"setStart"),null!=n&&t!==n?Vr(e,n,s,"setEnd"):s.collapse(!0),o.removeAllRanges(),o.addRange(s)}function $r(e){return"IMG"===e.nodeName?e.alt:e.textContent}function Gr(e){return $r(e).length}function Br(e,t,n){var o,s=0;for(t.nodeType===t.TEXT_NODE?(s+=n,o=t.parentNode===e?t.previousSibling:t.parentNode.previousSibling):o=e.childNodes[n-1]||e.lastChild;o;)s+=Gr(o),o=o.previousSibling;return s}function Vr(e,t,n,o){if(t&&e.firstChild){for(var s=0,i=0,r=e.childNodes.length,a=void 0,c=void 0;s<r;s++){if(c=e.childNodes[s],a=Gr(c),i+a===t)return void(c.nodeType===c.TEXT_NODE?n[o](c,a):n[o](e,s+1));if(i+a>t)return c.nodeType===c.ELEMENT_NODE&&(c=c.firstChild),void n[o](c,t-i);i+=a}n[o](e,e.childNodes.length)}else n[o](e,0)}function Wr(e){return fetch(e.src).then(function(e){var t=e.headers.get("Content-Type");return e.blob().then(function(e){return new Blob([e],{type:t})})})}function Kr(e){var t=[],n=e.items;if(n&&n.length)for(var o=0;o<n.length;o++)"file"===n[o].kind&&t.push(n[o].getAsFile());return t.filter(Boolean)}function Yr(e){return"DIALOG"===e.type?e.participants.find(function(e){return!e.user.current}).user.avatarUrl:e.iconUrl}function Zr(e){return"contact"===e.itemType?{id:e.id,itemId:e.itemId,caption:e.name,url:e.avatarUrl}:{id:e.id,itemId:e.itemId,caption:e.title||e.placeholder,url:Yr(e)}}function Jr(e,t){return ri(e).map(function(e){return mp({},e,{itemId:t+"-"+e.id,itemType:t})})}function Qr(e){return e.getAttribute(vp)}function Xr(e){return e.classList.contains("active")}function ea(e){return e.EXTERNAL+"?autoplay=1"}function ta(e,t,n,o){return n*((e=e/o-1)*e*e+1)+t}function na(e,t,n,o,s,i){void 0===i&&(i=0);var r,a,c,l;"number"==typeof i?r=a=c=l=i:(r=i.leftTop||0,a=i.rightTop||0,c=i.rightBottom||0,l=i.leftBottom||0),e.moveTo(t+r,n),e.lineTo(t+o-a,n),e.quadraticCurveTo(t+o,n,t+o,n+a),e.lineTo(t+o,n+s-c),e.quadraticCurveTo(t+o,n+s,t+o-c,n+s),e.lineTo(t+l,n+s),e.quadraticCurveTo(t,n+s,t,n+s-l),e.lineTo(t,n+r),e.quadraticCurveTo(t,n,t+r,n)}var oa,sa="object"==typeof global&&global&&global.Object===Object&&global,ia="object"==typeof self&&self&&self.Object===Object&&self,ra=(sa||ia||Function("return this")()).Symbol,aa=Object.prototype,ca=aa.hasOwnProperty,la=aa.toString,ua=ra?ra.toStringTag:void 0,pa=Object.prototype.toString,ha="[object Null]",da="[object Undefined]",fa=ra?ra.toStringTag:void 0,ga=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object),_a="[object Object]",ma=Function.prototype,va=Object.prototype,ya=ma.toString,ka=va.hasOwnProperty,ba=ya.call(Object),wa=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}(oa="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),Ca={INIT:"@@redux/INIT"},Ea=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};"string"==typeof c.name&&"isCrushed"!==c.name&&function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build.");var Aa="*",Ta=function(e){e||(e=[]),this._hash=null,this._key=Array.isArray(e)?e:e.split("."),this.length=this._key.length};Ta.prototype.item=function(e){return e<0&&(e=this.length+e),this._key[e]},Ta.prototype.toString=function(){return null===this._hash&&(this._hash=this._key.join(".")),this._hash},Ta.prototype.valueOf=function(){return this._key},Ta.prototype.slice=function(e,t){return new this.constructor(this._key.slice(e,t))},Ta.prototype.concat=function(){for(var e=arguments,t=this,n=this._key.slice(),o=0,s=arguments.length,i=void 0;o<s;o++)(i=e[o])instanceof t.constructor?n=n.concat(i._key):Array.isArray(i)?n=n.concat(i):n.push(i);return new this.constructor(n)},Ta.prototype.push=function(e){var t=this._key.slice();return t.push(e),new this.constructor(t)},Ta.prototype.equal=function(e){return _(this._key,e._key)};var Sa=function(){this._nodes=null,this._keys=null,this._value=null,this.hasValue=!1,this.hasNodes=!1},Ia={value:{},empty:{},size:{}};Ia.value.set=function(e){this._value=e,this.hasValue=!0},Ia.value.get=function(){return this._value},Ia.empty.get=function(){return!this.hasValue&&!this.hasNodes},Ia.size.get=function(){return this._nodes?this._nodes.size:0},Sa.prototype.keys=function(){return this._keys},Sa.prototype.set=function(e,t){for(var n=this,o=0,s=e.length;o<s;o++)n=n.addNode(e.item(o));n.value=t},Sa.prototype.get=function(e,t){var n=this.find(e,t);return n&&n.value},Sa.prototype.delete=function(e,t){if(!e||!e.length)return!1;for(var n=this,o=0,s=e.length-1;o<s;o++)if(!(n=n.getNode(e.item(o))))return!1;var i=e.item(e.length-1),r=n.getNode(i);return!!r&&(r.clearValue(),r.hasNodes&&!t||n.deleteNode(i),!0)},Sa.prototype.clearValue=function(){this.value=null,this.hasValue=!1},Sa.prototype.find=function(e,t){for(var n=this,o=0,s=e.length;o<s;o++)if(!(n=n.getNode(e.item(o))||t&&n.getNode("*")))return null;return n},Sa.prototype.addNode=function(e){this._nodes||(this._nodes=new Map,this._keys=[],this.hasNodes=!0);var t=this._nodes.get(e);return t||(t=new this.constructor,this._keys.push(e),this._nodes.set(e,t)),t},Sa.prototype.getNode=function(e){return this._nodes&&this._nodes.get(e)},Sa.prototype.deleteNode=function(e){if(this._nodes){var t=this._nodes.delete(e);if(t){var n=this._keys.indexOf(e);-1!==n&&this._keys.splice(n,1),this._nodes.size||(this._nodes=null,this._keys=null,this.hasNodes=!1)}return t}return!1},Sa.prototype.walk=function(e,t){"function"==typeof e&&(t=e,e=new Ta);for(var n,o,s,i,r=[{key:e,node:this}];n=r.pop();)if(n.node.hasNodes)for(var a=0,c=(o=n.node.keys()).length,l=void 0;a<c&&(l=o[a],s=n.key.push(l),i=n.node.getNode(l),!1!==t(i,s,l,n.node));a++)r.push({key:s,node:i})},Object.defineProperties(Sa.prototype,Ia);var Oa=function(){this._links=new Sa,this._depLinks=new Sa};Oa.prototype.save=function(e,t){var n=this._depLinks.get(t);if(n&&!n.equal(e)){var o=this._links.get(n);o&&o.delete(t)}var s,i=this._links.find(e);i&&i.hasValue?s=i.value:(s=new Sa,this._links.set(e,s)),s.set(t,!0),this._depLinks.set(t,e)},Oa.prototype.getDeps=function(e){var t=this._links.find(e),n=[];return t&&(t.hasValue&&n.push([new Ta,m(t.value)]),t.walk(function(e,t){e.hasValue&&n.push([t,m(e.value)])})),n},Oa.prototype.getOwnDeps=function(e){var t=this._links.find(e);return t&&t.hasValue?m(t.value):[]};var xa=function(){this._stack=[]};xa.prototype.next=function(){return this._stack.shift()},xa.prototype.add=function(e,t,n,o,s){if(o!==s){var i=null!==n?t.push(n):t;this._stack.push({node:e,key:i,value:o,prevValue:s})}},xa.prototype.addMultiple=function(e,t,n,o){Array.isArray(n)?this._addMultipleFromArray(e,t,n,o):this._addMultipleFromObject(e,t,n,o)},xa.prototype._addMultipleFromArray=function(e,t,n,o){for(var s=this,i=0,r=n.length;i<r;i++)s.add(e,t,i,n[i],p(o,i))},xa.prototype._addMultipleFromObject=function(e,t,n,o){for(var s=this,i=g(n),r=0,a=i.length,c=void 0;r<a;r++)c=i[r],s.add(e,t,c,p(n,c),p(o,c))};var Da=function(e,t){e=e instanceof Ta?e:new Ta(e);var n=new Map;if(e.length){n.set(new Ta,t);for(var o=0,s=e.length,i=void 0;o<s&&(i={key:e.item(o),target:new Map},n.forEach(v,i),(n=i.target).size);o++);}return n},Ma={},ja=function(e,t){this._original=e,this._value=e,this._links=new Sa,this._refs=t||new Oa,this._updatePaths=new Map},Pa={updated:{},value:{},original:{},refs:{}};Pa.updated.get=function(){return this._original!==this._value},Pa.value.get=function(){return this._value},Pa.original.get=function(){return this._original},Pa.refs.get=function(){return this._refs},ja.prototype.key=function(e){return e instanceof Ta?e:new Ta(e)},ja.prototype.has=function(e){return this.get(e,Ma)!==Ma},ja.prototype.get=function(e,t){return h(this._value,this.key(e),t)},ja.prototype.set=function(e,t,n){var o=this;if(e=this.key(e),t=this.applyLinks(e,t,n?null:this.get(e)),this._set(e,t)){for(var s,i=function(e,t){for(var n=0,s=e.length;n<s;n++)o.has(e[n])&&o._set(e[n],t)},r=this._refs.getDeps(e),a=0,c=r.length;a<c;a++)(s=h(t,r[a][0],Ma))!==Ma&&i(r[a][1],s);for(var l=this._value,a=0,c=e.length-1;a<c;a++)l=p(l,e.item(a)),i(o._refs.getOwnDeps(e.slice(0,a+1)),l)}return this},ja.prototype._set=function(e,t){if(t===this.get(e))return!1;var n=e.slice(0,-1),o=e.item(-1);return d(this._createIntermediate(n),o,t),!0},ja.prototype.delete=function(e){if(e=this.key(e),this.has(e)){var t=e.slice(0,-1),n=e.item(-1);f(this._createIntermediate(t),n)}return this},ja.prototype.assign=function(e,t){var n=this;e=this.key(e);var o=this.get(e,Ma);return o===Ma||null==o||"object"!=typeof o?this.set(e,t):g(t).forEach(function(o){return n.set(e.concat(o),p(t,o))}),this},ja.prototype.save=function(){this._original=this._value,this._updatePaths.clear()},ja.prototype.link=function(e,t){var n=this;e=this.key(e),this._links.set(e,t),Da(e,this.value).forEach(function(e,t){return n.set(t,e,!0)})},ja.prototype.applyLinks=function(e,t,n){e=this.key(e);var o=this._links.find(e,!0);if(o){var s=this._collectLinkUpdateTree(o,e,t,n);if(s.hasValue)t=s.value;else if(s.hasNodes)for(var i,r,a,c=[{node:s,key:null,value:t=l(t)}];i=c.shift();)if(i.node.hasValue)d(i.value,i.key,i.node.value);else if(i.node.hasNodes){r=i.node.keys(),null!==i.key?(a=l(p(i.value,i.key)),d(i.value,i.key,a)):a=i.value;for(var u=0,h=r.length,f=void 0;u<h;u++)f=r[u],c.push({node:i.node.getNode(f),key:f,value:a})}}return t},ja.prototype.applyAllLinks=function(){this._value=this.applyLinks(new Ta,this._value)},ja.prototype._linkKey=function(e,t,n){var o=n(t,e,this);return o?(this._refs.save(o,e),this.get(o,t)):t},ja.prototype._collectLinkUpdateTree=function(e,t,n,o){var s,i,r,a=this,c=new Sa,l=new xa;for(l.add(e,new Ta,null,n,o);s=l.next();)if(s.node.hasValue&&(r=a._linkKey(t.concat(s.key),s.value,s.node.value))!==s.value&&c.set(s.key,r),s.node.hasNodes)for(var h=0,d=(i=s.node.keys()).length,f=void 0;h<d;h++)(f=i[h])===Aa&&null!=s.value?l.addMultiple(s.node.getNode(f),s.key,s.value,s.prevValue):u(s.value,f)&&l.add(s.node.getNode(f),s.key,f,p(s.value,f),p(s.prevValue,f));return c},ja.prototype._createIntermediate=function(e){this.updated||(this._value=l(this._value));for(var t=this._updatePaths,n=this._value,o=0,s=e.length,i=void 0,r=void 0;o<s;o++)r=p(n,i=e.item(o)),t.has(i)||(t.set(i,new Map),d(n,i,r=null!=r?l(r):{})),t=t.get(i),n=r;return n},Object.defineProperties(ja.prototype,Pa);var La={SET_ONLINE:"WebSocket transport connected to server",SET_OFFLINE:"WebSocket transport disconnected from server",LOGIN:"Session authorized (login)",LOGOUT:"Logout"},Na={UPDATE:"Update single contact",UPDATE_LIST:"Updates list of contacts",RESTORE:"Restore contacts list",UPDATE_PRESENCE:"Update contacts presence",BLOCK:"Block contact",UNBLOCK:"Unblock contact",UPDATE_BLACK_LIST:"Update contact black list"},Ra={UPDATE:"Update search data",APPEND:"Append search results",RESET:"Reset search",SELECT:"Select search result item",SET_LOADING_STATE:'Set search state as "loading"',SET_IDLE_STATE:'Set search state as "idle"'},za={idle:"idle",loading:"loading"},Ha="chats",Fa={dontDisturbUntil:0},Ua={STORE:"Store chats",UPDATE:"Update chat",UPDATE_MESSAGES:"Update chat messages",UPDATE_SINGLE_MESSAGE:"Update message in chat",RESET_MESSAGES:"Reset chat messages",RESET_FOCUSED_MESSAGE:"Reset focused chat message",SEARCH_MESSAGES:"Search chat messages",ADD_MESSAGE:"Add new chat message",EDIT_MESSAGE:"Edit chat message",REMOVE_MESSAGE:"Remove chat message",RESTORE:"Restore chats",SELECT:"Select chat",PEEK_CHAT:"Peek chat",RESET_SELECTED:"Reset selected chat",SET_LOADING_STATE:'Set chat state as "loading"',SET_IDLE_STATE:'Set chat state as "idle"',SET_ERROR:"Set chat error",UPDATE_READ_MARK:"Update chat participant read mark",UPDATE_POSTING:"Update chat posting message",COMMIT_POSTING:"Commit chat posting message",CONFIRM_POSTING:"Confirm chat posting message",SET_POSTING_MESSAGE_ERROR:"Set optimistic posting message error",REMOVE_MESSAGES:"Remove chat messages",SET_MESSAGE_NOT_EDITABLE:"Set chat message not editable",ADD_TYPING_PARTICIPANT:"Add typing participant in chat",REMOVE_TYPING_PARTICIPANT:"Remove typing participant from chat",CLEAR_HISTORY:"Clear chat history",REMOVE:"Remove chat",LEAVE:"Leave chat",REMOVE_ALL:"Update all chats",SET_TITLE:"Set chat title",SET_ICON:"Set chat icon",SET_MEDIA_LOADING_STATE:"Set media loading state",UPDATE_MEDIA:"Update chat media",ADD_MEDIA_ITEMS:"Add chat media items",REMOVE_PARTICIPANT:"Remove participant from chat",REMOVE_CHANNEL_ADMIN:"Remove channel admin",ADD_PARTICIPANTS:"Add participants to chat",ADD_CHANNEL_ADMINS:"Add channel admins",UPDATE_MESSAGE_STATS:"Update chat message stats",UPDATE_CHAT_MEMBERS_LOAD_STATE:"Update chat members load state",ADD_CHAT_MEMBERS:"Add chat members",SET_VIDEO_URL_DATA:"Set chat message video url data",SHOW_CHAT_JOIN_CONFIRM:"Show chat join confirm",JOIN:"Join chat",RESET_JOIN_CHAT:"Reset chat join",SET_NEXT_LINK:"Set next link",SET_CREATED_CHANNEL:"Set created channel"},qa={idle:"idle",loading:"loading"},$a={SET_LOADING_STATE:'Set state of auth section as "loading"',SET_IDLE_STATE:'Set state of auth section as "idle"',SET_ERROR:"Set auth error",RESTORE:"Restore auth state",OK_PROFILE_SUGGEST:"Suggest OK user profile",SET_VERIFICATION:"Set auth verification data",UPDATE_PHONE:"Set phone",SET_PROFILE:"Set profile to confirm",SAVE_LOGIN_TOKEN:"Save auto-login token",SAVE_TOKENS:"Save tokens",SET_CONFIRMATION:"Set auth confirmation data",LOGIN:"Set current user as logged in",LOGOUT:"Set current user as logged out",RESET:"Reset auth state",CHANGE_RECOVERY_DATA:"Change recovery data",START_CREATING_NEW_PROFILE:"Start creating new profile"},Ga={idle:"idle",loading:"loading"},Ba={unauthorized:"unauthorized",verify:"verify",confirm:"confirm",create:"create",authorized:"authorized"},Va={ADD:"Add chat upload file",ADD_LIST:"Add chat upload file list",REMOVE:"Remove chat upload file",START:"Notify chat file upload started",PROGRESS:"Update chat upload file progress",COMPLETE:"Complete chat file upload",ERROR:"Set error to chat upload"},Wa={idle:"idle",loading:"loading",completed:"completed",error:"error"},Ka={UPDATE:"Update configuration",RESTORE:"Restore configuration"},Ya={RESTORE:"Restore stickers",STORE_SECTIONS:"Store stickers sections",UPDATE_LIST:"Update stickers",UPDATE_SUGGESTION:"Update emoji stickers suggestion",UPDATE_RECENT_EMOJI:"Update recently used emoji",UPDATE_RECENT_STICKERS:"Update recently used stickers"},Za="stickers",Ja={ENTER:"Enter new chat mode",EXIT:"Exit new chat mode",ADD_USER:"Add user to new chat",REMOVE_USER:"Remove user from new chat",SET_TITLE:"Set title of new chat",SET_ICON:"Set icon of new chat"},Qa="newChat",Xa={UPDATE_CHATS:"Update onboarding chats"},ec="onboarding",tc=[function(e,t){switch(t.type){case La.SET_ONLINE:return y(e,!0);case La.SET_OFFLINE:return y(e,!1)}return e},function(e,t){switch(t.type){case La.LOGIN:case Ka.UPDATE:return Mt(e,t.config);case Ka.RESTORE:return Dt(e)}return e},function(e,t){switch(t.type){case La.LOGIN:return W(e,t.chats,t.chatMarker,t.messages);case Ua.STORE:return K(e,t.chats,t.marker);case Ua.UPDATE:return Y(e,t.chat);case Ua.UPDATE_MESSAGES:return Z(e,t.chatId,t.messages,t.focus);case Ua.RESET_MESSAGES:return Q(e,t.chatId);case Ua.RESET_FOCUSED_MESSAGE:return ee(e,t.chatId);case Ua.ADD_MESSAGE:return te(e,t.chatId,t.message);case Ua.EDIT_MESSAGE:return ne(e,t.chatId,t.messageId,t.text);case Ua.REMOVE_MESSAGE:return he(e,t.chatId,t.message);case Ua.RESTORE:return ae(e);case Ua.SET_LOADING_STATE:return pe(e,t.chatId,qa.loading);case Ua.SET_IDLE_STATE:return pe(e,t.chatId,qa.idle);case Ua.SET_ERROR:return Be(e,t.chatId,t.error);case Ua.UPDATE_READ_MARK:return ye(e,t.chatId,t.userId,t.mark,t.unread);case Ua.SELECT:return le(e,t.chatId,t.focusedTime);case Ua.PEEK_CHAT:return ue(e,t.chat);case Ua.RESET_SELECTED:return Qe(e);case Ua.UPDATE_POSTING:return M(e,t.chatId,t.data);case Ua.COMMIT_POSTING:return de(e,t.chatId,t.message);case Ua.CONFIRM_POSTING:return fe(e,t.chatId,t.message);case Ua.SET_POSTING_MESSAGE_ERROR:return _e(e,t.chatId,t.messageId,t.error);case Ua.REMOVE_MESSAGES:return me(e,t.chatId,t.messageUIDs);case Ua.SET_MESSAGE_NOT_EDITABLE:return ve(e,t.chatId,t.messageUID);case Ua.ADD_TYPING_PARTICIPANT:return ke(e,t.chatId,t.userId);case Ua.REMOVE_TYPING_PARTICIPANT:return be(e,t.chatId,t.userId);case Ua.CLEAR_HISTORY:return we(e,t.chatId,t.userId);case Ua.REMOVE:return Ee(e,t.chatId);case Ua.LEAVE:return Te(e,t.chatId);case Ua.REMOVE_ALL:return Ae(e,t.chatId);case Ua.SET_TITLE:return Se(e,t.chatId,t.title);case Ua.SET_ICON:return Oe(e,t.chatId,t.url,t.fullUrl);case Ua.SET_VIDEO_URL_DATA:return De(e,t.chatId,t.messageUid,t.videoId,t.urlData);case Ua.SET_MEDIA_LOADING_STATE:return Me(e,t.chatId,qa.loading);case Ua.UPDATE_MEDIA:return je(e,t.chatId,t.media);case Ua.ADD_MEDIA_ITEMS:return Pe(e,t.chatId,t.items,t.forward);case Ua.REMOVE_PARTICIPANT:return Le(e,t.chatId,t.userId);case Ua.REMOVE_CHANNEL_ADMIN:return Ne(e,t.chatId,t.userId);case Ua.ADD_PARTICIPANTS:return Re(e,t.chatId,t.userIds);case Ua.ADD_CHANNEL_ADMINS:return ze(e,t.chatId,t.userIds);case Ua.UPDATE_MESSAGE_STATS:return He(e,t.chatId,t.stats);case Ua.UPDATE_CHAT_MEMBERS_LOAD_STATE:return Fe(e,t.chatId,t.loadState);case Ua.ADD_CHAT_MEMBERS:return Ue(e,t.chatId,t.members,t.marker);case Ua.SHOW_CHAT_JOIN_CONFIRM:return qe(e,t.chat);case Ua.RESET_JOIN_CHAT:return $e(e);case Ua.SET_NEXT_LINK:return Xe(e,t.chatId,t.data);case Ua.SET_CREATED_CHANNEL:return et(e,t.chatId);case Na.BLOCK:return Ce(e,t.contactId);case Ra.SELECT:return Ze(e,t.key,t.result)}return e},function(e,t){switch(t.type){case Va.ADD_LIST:return Et(e,t.chatId,t.files);case Va.ADD:return At(e,t.chatId,t.file,t.fileType);case Va.REMOVE:return Tt(e,t.chatId,t.file);case Va.START:return St(e,t.chatId,t.file,{status:Wa.loading,promise:t.promise});case Va.PROGRESS:return St(e,t.chatId,t.file,{progress:t.progress});case Va.COMPLETE:return It(e,t.chatId,t.file,t.payload);case Va.ERROR:return St(e,t.chatId,t.file,{error:t.error})}return e},function(e,t){switch(t.type){case $a.SET_LOADING_STATE:return lt(e,Ga.loading);case $a.SET_IDLE_STATE:return lt(e,Ga.idle);case $a.SET_ERROR:return ut(e,t.error,t.resetLoadState);case $a.RESTORE:return pt(e);case $a.OK_PROFILE_SUGGEST:return ht(e,t.data);case $a.SET_VERIFICATION:return dt(e,t.data);case $a.SAVE_TOKENS:return vt(e,t.tokens);case $a.SET_CONFIRMATION:return yt(e,t.profile);case $a.SAVE_LOGIN_TOKEN:return mt(e,t.token);case $a.RESET:return kt(e);case $a.LOGIN:return ft(e,t.profile,t.token);case La.LOGOUT:case $a.LOGOUT:return gt(e);case $a.UPDATE_PHONE:return Ct(e,t.data);case $a.CHANGE_RECOVERY_DATA:return bt(e,t.data);case $a.START_CREATING_NEW_PROFILE:return wt(e)}return e},function(e,t){switch(t.type){case Ra.UPDATE:return H(e,t.key,t.data);case Ra.APPEND:return F(e,t.key,t.data);case Ra.RESET:return H(e,t.key);case Ra.SET_IDLE_STATE:return H(e,t.key,{loadState:za.idle});case Ra.SET_LOADING_STATE:return H(e,t.key,{loadState:za.loading});case Ua.COMMIT_POSTING:case Ua.REMOVE:case Ua.LEAVE:case Ua.JOIN:return U(e)}return e},function(e,t){switch(t.type){case Ya.RESTORE:return Pt(e);case Ya.STORE_SECTIONS:return Rt(e,t.sections,t.sectionsOrder);case Ya.UPDATE_LIST:return Nt(e,t.stickers);case Ya.UPDATE_SUGGESTION:return zt(e,t.query,t.suggestion);case Ya.UPDATE_RECENT_EMOJI:return Ht(e,t.data);case Ya.UPDATE_RECENT_STICKERS:return Ft(e,t.data)}return e},function(e,t){switch(t.type){case Ja.ENTER:return Ut(e);case Ja.EXIT:return qt(e);case Ja.ADD_USER:return $t(e,t.userId);case Ja.REMOVE_USER:return Gt(e,t.userId);case Ja.SET_TITLE:return Bt(e,{title:t.title});case Ja.SET_ICON:return Bt(e,{icon:t.icon})}return e},function(e,t){switch(t.type){case La.LOGIN:case Ua.RESET_SELECTED:case Ua.REMOVE:case Ua.LEAVE:case Ua.REMOVE_ALL:return Kt(e);case Xa.UPDATE_CHATS:return Yt(e,t.chats)}return e},function(e,t){switch(t.type){case La.LOGIN:return w(e,t.contacts,t.presence);case Na.UPDATE:return C(e,t.contact);case Na.UPDATE_LIST:return w(e,t.list,t.presence);case Na.RESTORE:return E(e);case Na.UPDATE_PRESENCE:return A(e,t.userId,t.presence);case Na.BLOCK:return T(e,t.contactId);case Na.UNBLOCK:return S(e,t.contactId);case Na.UPDATE_BLACK_LIST:return I(e,t.contacts)}return e}],nc=function(e,t){return tc.reduceRight(function(e,n){return n(e,t)},e)},oc=["owner","participants.*.user","members.items.*","typingParticipants.*","admins.*","media.items.*.message.sender","search.result.*.message.sender"],sc=["sender","attaches.*.user","attaches.*.users.*","link.message.sender"],ic=function(e){var t=["chats.*.lastMessage","chats.*.search.result.*.message","chats.*.messages.*.link.message","chats.*.posting.link"],n=["search.result.*.chat","onboarding.chats.*","createdChannel"],o=["assets.stickerSections.*.result.*","assets.stickerSearch.result.*","assets.stickerSuggestions.*"];return["auth.profile","newChat.contacts.*","newChat.invited.*","onboarding.contacts.*","blackList.*"].concat(tn("chats.*"),tn("search.result.*.chat"),tn("peekChat")).forEach(function(t){return e.link(t,Zt)}),t.forEach(function(t){return e.link(t,Qt)}),n.forEach(function(t){return e.link(t,Xt)}),e.link("chats.*.settings",en),e.link("peekChat.settings",en),o.forEach(function(t){return e.link(t,Jt)}),e},rc=function(e,t){"function"==typeof e&&(t=e,e=null);var n={},o=sn(),s="undefined"!=typeof __REDUX_DEVTOOLS_EXTENSION_COMPOSE__?__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:r,c=i(on(t||nc,n),Object.assign({interactive:!0,state:"initial",auth:{},chats:new Map,contacts:new Map,blackList:new Map,assets:new Map,stickers:new Map,onboarding:{chats:[],contacts:[]},config:{notificationsEnabled:!1,background:0,alternativeKeyboardBehaviour:!1}},e),s(a(o)));return c.loophole=n,c},ac={PING:1,LOG:5,SESSION_INIT:6,PROFILE:16,AUTH_REQUEST:17,AUTH:18,LOGIN:19,LOGOUT:20,CONFIG:22,AUTH_CONFIRM:23,ASSETS_GET:26,ASSETS_UPDATE:27,ASSETS_GET_BY_IDS:28,CONTACT_INFO:32,CONTACT_UPDATE:34,CONTACT_PRESENCE:35,CONTACT_LIST:36,CHAT_INFO:48,CHAT_HISTORY:49,CHAT_MARK:50,CHAT_MEDIA:51,CHAT_DELETE:52,CHAT_LIST:53,CHAT_CLEAR:54,CHAT_UPDATE:55,CHAT_CHECK_LINK:56,CHAT_JOIN:57,CHAT_LEAVE:58,CHAT_MEMBERS:59,CHANNEL_SEARCH:60,MSG_SEND:64,MSG_TYPING:65,MSG_DELETE:66,MSG_EDIT:67,CHAT_SEARCH:68,MSG_SHARE_PREVIEW:70,MSG_SEARCH_TOUCH:72,MSG_SEARCH:73,MSG_GET_STAT:74,PHOTO_UPLOAD:80,VIDEO_UPLOAD:82,VIDEO_PLAY:83,NOTIF_MESSAGE:128,NOTIF_TYPING:129,NOTIF_MARK:130,NOTIF_CONTACT:131,NOTIF_PRESENCE:132,NOTIF_CONFIG:134,NOTIF_CHAT:135},cc=function(e,t){this._store=e,this._api=t};cc.prototype.issueUrl=function(e){switch(e){case"PROFILE":return this._requestPhotoUrl(!0);case"PHOTO":return this._requestPhotoUrl(!1);case"VIDEO":case"AUDIO":return this._requestMediaUrl(e)}throw new Error("Неизвестный тип ресурса: "+e)},cc.prototype.upload=function(e,t,n){return new Promise(function(o,s){var i=new FormData;i.append("image",t,t.name);var r=new XMLHttpRequest;r.responseType="json",r.open("POST",e,!0),r.upload&&n&&(r.upload.onprogress=function(e){return n(e.loaded,e.total)}),r.onload=function(){return o(r.response)},r.onerror=function(e){return s(e)},r.send(i)})},cc.prototype._requestPhotoUrl=function(e){return this._api.request(ac.PHOTO_UPLOAD,{count:1,profile:!!e})},cc.prototype._requestMediaUrl=function(e){return this._api.request(ac.VIDEO_UPLOAD,{count:1,audio:"audio"===e}).then(function(e){return e.info[0]})};var lc={OKWEB:"OKWEB",AUTH:"AUTH",CONFIRM:"CONFIRM",NEW:"NEW",RECOVERY:"RECOVERY",PASSWORD:"PASSWORD",LOGIN:"LOGIN"},uc=function(e,t,n,o,s){this._store=e,this._api=t,this._session=n,this._stats=o,this.device=s,this._file=new cc(e,t),this._store.dispatch({type:$a.RESTORE}),this._checkOkProfile()};uc.prototype.authorize=function(e){var t=e.login,n=e.password,o=e.token,s=e.hash,i=e.code,r=e.recovery;return o?this._login(o):i?(this._stats.action("ACTION_AUTH_MANUALLY_CODE"),this._confirmCode(i)):t&&n?(this._stats.action("ACTION_AUTH_ENTER_VIA_OK"),this._authConfirm(lc.PASSWORD,t,{password:n})):s?(this._stats.action("ACTION_AUTH_ENTER_VIA_NATIVE_OK"),this._authConfirm(lc.OKWEB,s)):r?this._confirmRecovery(r):void 0},uc.prototype.logout=function(){return this._store.dispatch({type:$a.LOGOUT}),Promise.all([this._api.request(ac.LOGOUT),this._checkOkProfile()])},uc.prototype.updatePhone=function(e){this._store.dispatch({type:$a.UPDATE_PHONE,data:e})},uc.prototype.requestCode=function(){var e=this,t=this._store.getState().auth.phone;return t?(this._store.dispatch({type:$a.SET_ERROR}),this._store.dispatch({type:$a.SET_VERIFICATION}),this._stats.action("ACTION_AUTH_GET_CODE"),this._request(ac.AUTH_REQUEST,{phone:t.clean}).then(function(t){e._store.dispatch({type:$a.SET_VERIFICATION,data:t})})):Promise.reject()},uc.prototype.confirmProfile=function(){var e=this._store.getState().auth.tokens;return this._stats.action("AUTH_OK_PROFILE_CONFIRM"),this._authConfirm(lc.CONFIRM,e[lc.CONFIRM])},uc.prototype.reset=function(){this._store.dispatch({type:$a.RESET})},uc.prototype.resetError=function(e){this._store.dispatch({type:$a.SET_ERROR,error:e})},uc.prototype.startCreatingNewProfile=function(){this._stats.action("AUTH_OK_PROFILE_REJECT"),this._store.dispatch({type:$a.START_CREATING_NEW_PROFILE})},uc.prototype.confirmCreatingNewProfile=function(e,t){var n=this,o=this._store.getState().auth.tokens[lc.NEW];o&&this._authConfirm(lc.NEW,o,{name:e}).then(function(){return n.updatePhoto(t)})},uc.prototype.updateName=function(e){var t=this;return this._api.request(ac.PROFILE,{name:e}).then(function(e){return t._updateProfile(e.profile)})},uc.prototype.updatePhoto=function(e){var t=this;return this._file.issueUrl("PROFILE").then(function(n){return t._file.upload(n.url,e).then(function(e){var n=e.photos[Object.keys(e.photos)[0]].token;return t._api.request(ac.PROFILE,{photoToken:n}).then(function(e){return t._updateProfile(e.profile)})})})},uc.prototype._confirmCode=function(e){var t=this,n=this._store.getState().auth.verification.verifyToken;return this._request(ac.AUTH,{token:n,verifyCode:e}).then(function(e){var n=e.tokenTypes;return t._store.dispatch({type:$a.SAVE_TOKENS,tokens:n}),n.AUTH?t._authConfirm(lc.AUTH,n.AUTH):n.CONFIRM?(t._store.dispatch({type:$a.SET_CONFIRMATION,profile:e.profile}),Promise.resolve()):n.NEW?(t._store.dispatch({type:$a.START_CREATING_NEW_PROFILE}),Promise.resolve()):Promise.reject(new Error("Невозможно подтвердить авторизацию, отсутствует поддержваемый токен в "+Object.keys(e.tokenTypes).join(", ")))})},uc.prototype._confirmRecovery=function(e){return"ok"!==e.result?(this.reset(),Promise.reject()):(this._store.dispatch({type:$a.CHANGE_RECOVERY_DATA,data:e}),this._authConfirm(lc.RECOVERY,e.token))},uc.prototype._checkOkProfile=function(){var e=this;this._store.getState().auth.state!==Ba.authorized&&(this._store.dispatch({type:$a.SET_LOADING_STATE}),un(fetch("https://ok.ru/web-api/tamtam",{credentials:"include"}),1e3).then(function(e){return e.ok?e.json():Promise.reject()}).then(function(t){e._store.dispatch({type:$a.OK_PROFILE_SUGGEST,data:t}),e._store.dispatch({type:$a.SET_IDLE_STATE})}).catch(function(){return e._store.dispatch({type:$a.SET_IDLE_STATE})}))},uc.prototype._authConfirm=function(e,t,n){var o=this;return this._request(ac.AUTH_CONFIRM,Object.assign({},{token:t,tokenType:e,deviceType:this.device.type,deviceId:this.device.id},n)).then(function(e){switch(e.tokenType||lc.LOGIN){case lc.RECOVERY:return o._requestRecovery(e.token);case lc.LOGIN:return o._login(e.token)}})},uc.prototype._requestRecovery=function(e){this._store.dispatch({type:$a.CHANGE_RECOVERY_DATA,data:{url:e}})},uc.prototype._login=function(e){return this._loading(this._session.authorize(e))},uc.prototype._request=function(e,t){return this._loading(this._api.request(e,t))},uc.prototype._loading=function(e){var t=this;return this._store.dispatch({type:$a.SET_LOADING_STATE}),e.then(function(e){return t._store.dispatch({type:$a.SET_IDLE_STATE}),e},function(e){return t._stats.action("AUTH_ERROR",e.error||e.code),t._store.dispatch({type:$a.SET_ERROR,resetLoadState:!0,error:e}),Promise.reject(e)})},uc.prototype._updateProfile=function(e){this._store.dispatch({type:Na.UPDATE,contact:e})};var pc=function(e,t){this._store=e,this._saveEvent=t};pc.prototype.error=function(e,t){this._log("ERROR",e,t)},pc.prototype.warn=function(e,t){this._log("WARN",e,t)},pc.prototype.info=function(e,t){this._log("INFO",e,t)},pc.prototype.debug=function(e,t){this._log("DEBUG",e,t)},pc.prototype._log=function(e,t,n){if(!t)throw new Error('Missing required "msg" argument');var o=this._getUserId();this._saveEvent({type:"LOG",event:e,params:{msg:t,details:n,userId:o}})},pc.prototype._getUserId=function(){var e=this._store.getState();if(e&&e.auth)return e.auth.profile?e.auth.profile.id:0};var hc=function(e,t){this._api=t,this._log=new pc(e,this._saveEvent.bind(this)),this._queue=[],this._opcodeNames=function(){var e={};return Object.keys(ac).forEach(function(t){e[ac[t]]=t}),e}(),this._startFlushTimeout()},dc={log:{}};hc.prototype.net=function(e,t,n){var o=this._opcodeNames[e];this._saveEvent({type:"NET",event:o,params:{respTime:t,tamTime:n}})},hc.prototype.screen=function(e){this._saveEvent({type:"SCREEN",event:e})},hc.prototype.action=function(e,t){this._saveEvent({type:"ACTION",event:e,params:{value:t}})},dc.log.get=function(){return this._log},hc.prototype._saveEvent=function(e){e.time=Date.now(),this._queue.push(e)},hc.prototype._startFlushTimeout=function(){setTimeout(this._flush.bind(this),15e3)},hc.prototype._flush=function(){var e=this,t=this._queue.slice();t.length>1&&this._api.request(ac.LOG,{events:t}).then(function(){console.log("log events sent",t),e._queue=e._queue.slice(t.length)}).catch(function(e){console.error("error while sending stats",t,e)}).then(function(){e._startFlushTimeout()})},Object.defineProperties(hc.prototype,dc);var fc=function(e,t,n){this._store=e,this._api=t,this._chats=n};fc.prototype.show=function(e,t){var n=this._chats.getChat(e);return n?this._showFromMedia(e,n.media,t)?this._fetchMoreMedia(e):this._showFromLocalMessages(e,n.messages,t):Promise.reject(new Error("Отсутствует чат с ID "+e))},fc.prototype._showFromMedia=function(e,t,n){if(t&&t.items&&t.items.has(n)){var o=t.items,s=gn(o,n),i=s.previous,r=s.next;return this._store.dispatch({type:Ua.UPDATE_MEDIA,chatId:e,media:{selected:n,previous:i,next:r,items:o,hasPrev:t.hasPrev,hasNext:t.hasNext}}),!0}return!1},fc.prototype._showFromLocalMessages=function(e,t,n){var o=fn(Array.from(t.values()));if(o){var s=gn(o,n),i=s.previous,r=s.next;return this._store.dispatch({type:Ua.UPDATE_MEDIA,chatId:e,media:{selected:n,previous:i,next:r,items:o,hasPrev:!0,hasNext:!0}}),!0}return!1},fc.prototype._fetchMoreMedia=function(e){var t=this,n=this._chats.getChat(e).media;if(!n.hasPrev||!n.hasNext)return Promise.resolve();var o=Array.from(n.items.keys()),s=n.selected,i=o.indexOf(s),r=o.length-i,a=[];return i<10&&n.hasPrev&&a.push(this._requestMedia(e,s,0,100).then(function(n){var o=dn(n);t._store.dispatch({type:Ua.ADD_MEDIA_ITEMS,chatId:e,items:o,forward:!1})})),r<10&&n.hasNext&&a.push(this._requestMedia(e,s,100,0).then(function(n){var o=dn(n);t._store.dispatch({type:Ua.ADD_MEDIA_ITEMS,chatId:e,items:o,forward:!0})})),Promise.all(a)},fc.prototype._requestMedia=function(e,t,n,o){this._store.dispatch({type:Ua.SET_MEDIA_LOADING_STATE,chatId:e});var s=t.split("-")[0];return this._api.request(51,{chatId:e,messageId:s,attachTypes:["PHOTO"],forward:n,backward:o})};var gc=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){function t(){}function n(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(){this._events=new t,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,i="~";Object.create&&(t.prototype=Object.create(null),(new t).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,t,n=this,o=[];if(0===this._eventsCount)return o;for(t in e=n._events)s.call(e,t)&&o.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},o.prototype.listeners=function(e,t){var n=i?i+e:e,o=this._events[n];if(t)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var s=0,r=o.length,a=new Array(r);s<r;s++)a[s]=o[s].fn;return a},o.prototype.emit=function(e,t,n,o,s,r){var a=arguments,c=this,l=i?i+e:e;if(!this._events[l])return!1;var u,p,h=this._events[l],d=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),d){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,o),!0;case 5:return h.fn.call(h.context,t,n,o,s),!0;case 6:return h.fn.call(h.context,t,n,o,s,r),!0}for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=a[p];h.fn.apply(h.context,u)}else{var f,g=h.length;for(p=0;p<g;p++)switch(h[p].once&&c.removeListener(e,h[p].fn,void 0,!0),d){case 1:h[p].fn.call(h[p].context);break;case 2:h[p].fn.call(h[p].context,t);break;case 3:h[p].fn.call(h[p].context,t,n);break;case 4:h[p].fn.call(h[p].context,t,n,o);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=a[f];h[p].fn.apply(h[p].context,u)}}return!0},o.prototype.on=function(e,t,o){var s=new n(t,o||this),r=i?i+e:e;return this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],s]:this._events[r].push(s):(this._events[r]=s,this._eventsCount++),this},o.prototype.once=function(e,t,o){var s=new n(t,o||this,!0),r=i?i+e:e;return this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],s]:this._events[r].push(s):(this._events[r]=s,this._eventsCount++),this},o.prototype.removeListener=function(e,n,o,s){var r=i?i+e:e;if(!this._events[r])return this;if(!n)return 0==--this._eventsCount?this._events=new t:delete this._events[r],this;var a=this._events[r];if(a.fn)a.fn!==n||s&&!a.once||o&&a.context!==o||(0==--this._eventsCount?this._events=new t:delete this._events[r]);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==n||s&&!a[c].once||o&&a[c].context!==o)&&l.push(a[c]);l.length?this._events[r]=1===l.length?l[0]:l:0==--this._eventsCount?this._events=new t:delete this._events[r]}return this},o.prototype.removeAllListeners=function(e){var n;return e?(n=i?i+e:e,this._events[n]&&(0==--this._eventsCount?this._events=new t:delete this._events[n])):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=i,o.EventEmitter=o,e.exports=o}),_c={maxItems:100,request:function(e,t,n,o){return Promise.reject(new Error("Метод не реализован"))},normalize:function(e){return e.trim().toLowerCase()}},mc=function(e){function t(t,n,o,s){e.call(this),this._store=t,this._api=n,this._key=o,"function"==typeof s&&(s={request:s}),this.options=Object.assign({},_c,s),this._safeSearchRequest=rn(this._safeSearchRequest.bind(this),250,{leading:!1,trailing:!0}),this.reset()}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={key:{}};return n.key.get=function(){return"function"==typeof this._key?this._key(this):this._key},t.prototype.getSection=function(){var e=this.key;return e&&new ja(this._store.getState()).get(e)},t.prototype.query=function(e){var t=this.options.normalize(e||"");if(!t)return this.reset(),Promise.resolve();var n=this.getSection();return n&&n.normalizedQuery===t?Promise.resolve(n):(this._dispatch({type:Ra.UPDATE,data:{query:e,normalizedQuery:t,marker:void 0}}),this._safeSearchRequest())},t.prototype.loadNext=function(){var e=this,t=this.getSection();return t&&t.normalizedQuery&&t.marker&&t.loadState!==za.loading?(this._dispatch({type:Ra.SET_LOADING_STATE}),this.options.request(this._api,t.normalizedQuery,t).then(function(n){var o=e.getSection();return o&&o.normalizedQuery===t.normalizedQuery&&e.append(n),n})):Promise.resolve(null)},t.prototype.reset=function(){this.getSection()&&(this._dispatch({type:Ra.RESET}),this.emit("reset"))},t.prototype.update=function(e){this._dispatch({type:Ra.UPDATE,data:Object.assign({},e,{loadState:za.idle,loaded:!0})}),this.emit("update",e)},t.prototype.append=function(e){this._dispatch({type:Ra.APPEND,data:Object.assign({},e,{loadState:za.idle})}),this.emit("append",e)},t.prototype.dispose=function(){this.reset(),this.removeAllListeners()},t.prototype._safeSearchRequest=function(){var e=this,t=this.getSection()||{};return t.normalizedQuery?(this._dispatch({type:Ra.SET_LOADING_STATE}),this.options.request(this._api,t.normalizedQuery,t).then(function(n){var o=e.getSection();return o&&(o.normalizedQuery?o.normalizedQuery===t.normalizedQuery&&e.update(n):e._dispatch({type:Ra.SET_IDLE_STATE})),n}).catch(function(t){console.warn(t),e._dispatch({type:Ra.SET_IDLE_STATE})})):Promise.resolve(t)},t.prototype._dispatch=function(e){this._store.dispatch(Object.assign({key:this.key},e))},Object.defineProperties(t.prototype,n),t}(gc),vc=function(e){function t(t,n,o,s,i){var r=this;e.call(this,t,n,o,Object.assign({},{request:function(e,t,n){return r._search(e,s,t,n)}},i)),this._searchCache=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._search=function(e,t,n,o){var s=this;return e.request(t,{query:n,marker:o.marker,count:this.options.maxItems}).then(function(e){return s.getSection()?s.loadChats(e.result).then(function(t){return Object.assign({},e,{result:t})}):e})},t.prototype.loadChats=function(e){var t=this;this._searchCache||(this._searchCache=new Map(this._store.getState().chats));var n=[],o=e.reduce(function(e,o){return o.chat||t._searchCache.has(o.chatId)||e.push(o.chatId),o.chat&&"number"==typeof o.chat.owner&&(n.push(o.chat.owner),o.chat.lastMessage&&n.push(o.chat.lastMessage.sender)),e},[]);return this.options.load(o,n).then(function(n){return n.forEach(function(e){return t._searchCache.set(e.id,e)}),e.map(function(e){return e.chat||(e=Object.assign({},e,{chat:t._searchCache.get(e.chatId)})),e.chat?e:(console.warn("Отсуствует информация о чате",e.chatId),null)}).filter(Boolean)})},t.prototype.reset=function(){this._searchCache=null,e.prototype.reset.call(this)},t.prototype.select=function(e){this._dispatch({type:Ra.SELECT,result:e})},t}(mc),yc=function(e){function t(t,n,o,s){var i=this;e.call(this,t,n,null,Object.assign({},{request:function(e,t,n){return e.request(ac.MSG_SEARCH,{chatId:i.chatId,query:t,count:100,marker:n.marker}).then(function(e){e.result.forEach(function(e){return e.chatId=i.chatId});var t=cn(e.result.map(function(e){return An(e.message)}));return o.fetchMissing(t).then(function(){return e})})}},s))}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={chatId:{},key:{}};return n.chatId.get=function(){return this._key},n.key.get=function(){var e=this._store.getState();return e.peekChat&&e.peekChat.id===this.chatId?["peekChat","search"]:e.chats instanceof Map&&e.chats.has(this.chatId)?["chats",this.chatId,"search"]:void 0},t.prototype.query=function(t,n){return this._key=t,e.prototype.query.call(this,n)},t.prototype.append=function(t){var n=new Set,o=this.getSection();o.result&&o.result.forEach(function(e){return n.add(e.message.id)}),t=Object.assign({},t,{result:t.result.filter(function(e){return!n.has(e.message.id)&&(n.add(e.message.id),!0)})}),e.prototype.append.call(this,t)},t.prototype.loadNext=function(t){return this._key=t,e.prototype.loadNext.call(this)},t.prototype.reset=function(t){return this._key=t,e.prototype.reset.call(this)},Object.defineProperties(t.prototype,n),t}(mc),kc={image:"PHOTO",video:"VIDEO",audio:"AUDIO"},bc={PHOTO:"photoToken",VIDEO:"videoId",AUDIO:"audioId"},wc=function(e,t,n,o){this._store=e,this._api=t,this._chat=n,this._stats=o,this._file=new cc(e,t),this._sendingMessages=new Map};wc.prototype.update=function(e,t){this._store.dispatch({type:Ua.UPDATE_POSTING,chatId:e,data:"string"==typeof t?{text:t}:t})},wc.prototype.reset=function(e){this.update(e,null)},wc.prototype.replyMessage=function(e,t){this.update(e,{reply:t})},wc.prototype.editMessage=function(e,t){this.update(e,{edit:t})},wc.prototype.addFile=function(e,t,n){var o=this;Array.isArray(t)||(t=[t]),(t=t.map(function(e){var t=e&&vn(e);return t?(o._stats.action("ATTACH_"+t),{file:e,type:t}):null}).filter(Boolean)).length&&(this._store.dispatch({type:Va.ADD_LIST,chatId:e,files:t}),n&&this._upload(e))},wc.prototype.removeFile=function(e,t){this._store.dispatch({type:Va.REMOVE,chatId:e,file:t}),this._sendPendingMessages(e)},wc.prototype.commit=function(e,t,n){if(!t){var o=this._chat.getChat(e);t=o&&o.posting}if(!t)return console.warn("У чата %d отсутствует отправляемое сообщение",e);if((t.text||"").trim()&&"EDIT"===t.type){if(t.link&&t.link.id)return this._editMessage(e,t);this._store.dispatch({type:Ua.REMOVE_MESSAGE,chatId:e,message:t.link}),delete(t=Object.assign({},t,{type:"NEW"})).link}return this._createMessage(e,t,n)},wc.prototype.sendSticker=function(e,t){var n=this._store.getState(),o=n.stickers.get(t),s=Date.now(),i=this._chat.getChat(e),r=i&&i.posting,a={cid:s,text:""};return r&&"EDIT"!==r.type&&r.link&&(a.link={type:r.type,message:r.link,messageId:r.link.id}),this._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:Object.assign({},a,{type:wn(this._chat.getChat(e)),attaches:[Object.assign({},o,{_type:"STICKER"})],sender:n.auth.profile.id,time:Date.now()})}),this._store.dispatch({type:Ua.UPDATE_POSTING,chatId:e}),this._post(e,s,ac.MSG_SEND,{chatId:e,message:Object.assign({},a,{attaches:[{_type:"STICKER",stickerId:t}]})})},wc.prototype.selectShare=function(e,t){return this.update(e,{shares:{selected:t}})},wc.prototype.removeShares=function(e){return this.update(e,{shares:{disabled:!0}})},wc.prototype.updateSharePreview=function(e,t,n,o){var s=this,i=this._chat.getChat(e).posting;if(i){var r=i.shares;if(!r||!r.disabled){var a=r?Cn(r.attachments):new Map;if(n&&o)a.has(n)&&(a.set(n,o.attachments[0]||null),this.update(e,{shares:{attachments:a}}));else{var c=[];t.forEach(function(e){a.has(e)||(a.set(e,null),c.push(e))}),this.update(e,{shares:{links:t,attachments:a}}),c.length&&c.forEach(function(n){return s._api.request(ac.MSG_SHARE_PREVIEW,{text:n}).then(function(o){return s.updateSharePreview(e,t,n,o)}).catch(function(e){return console.warn(e)})})}}}},wc.prototype._upload=function(e){var t=this,n=kn(this._chat.getChat(e)),o=n.filter(function(e){return e.status===Wa.loading}),s=n.filter(function(e){return e.status===Wa.idle});console.log("files to upload: %o, loading: %o, pending: %o",n,o,s);for(var i=!1,r=Math.max(0,3-o.length);r--&&s.length;)t._uploadFile(e,s.shift().file),i=!0;return i},wc.prototype._uploadFile=function(e,t){var n=this,o=yn(this._chat.getChat(e),t);if(!o)return Promise.reject(new Error("Отствтует запись в модели для указанного файла"));if(o.promise)return o.promise;var s=function(o,s){return n._store.dispatch(Object.assign({},{type:o,chatId:e,file:t},s))},i=function(e,t){return s(Va.PROGRESS,{progress:{loaded:e,total:t}})},r=this._file.issueUrl(o._type).then(function(e){return n._file.upload(e.url,t,i).then(function(t){return s(Va.COMPLETE,{payload:{token:"PHOTO"===o._type?t.photos[Object.keys(t.photos)[0]].token:e.videoId}}),t})}).then(function(t){return n._sendPendingMessages(e),t}).catch(function(e){return s(Va.ERROR,{error:e}),Promise.reject(e)});return s(Va.START,{promise:r}),r},wc.prototype._sendPendingMessages=function(e){var t=this;this._upload(e),bn(this._chat.getChat(e)).forEach(function(n){t._sendingMessages.has(n.cid)||n.attaches&&n.attaches.some(function(e){return e.file&&e.status!==Wa.completed})||t._sendMessage(e,n)})},wc.prototype._sendMessage=function(e,t){var n=this;if(!t.posting)return Promise.reject(new Error("Отуствует поле posting у сообщения"),t);var o=Object.assign({},t.posting,{chatId:e,message:{cid:t.cid,text:t.text||"",detectShare:!!t.posting.detectShare}});delete o.detectShare,t.attaches&&t.attaches.length&&(o.message.attaches=t.attaches.map(function(e){return e.file?(t={_type:e._type},t[bc[e._type]]=e.token,t):e;var t})),t.link&&t.link.message&&t.link.message.id&&(o.message.link={type:t.link.type,messageId:t.link.message.id}),console.log("send message",o);var s=this._post(e,t.cid,ac.MSG_SEND,o).then(function(e){return n._sendingMessages.delete(t.cid),e}).catch(function(e){return n._sendingMessages.delete(t.cid),Promise.reject(e)});return this._sendingMessages.set(t.cid,s),s},wc.prototype._editMessage=function(e,t){var n=t.link.id,o=t.text.trim();return this._store.dispatch({type:Ua.EDIT_MESSAGE,chatId:e,messageId:n,text:o}),this._post(e,n,ac.MSG_EDIT,{chatId:e,messageId:n,text:o})},wc.prototype._createMessage=function(e,t,n){void 0===n&&(n=!1);var o=(t.text||"").trim();if(o||t.upload&&t.upload.size){var s=this._chat.getChat(e);this._stats.action(s.type+"_MSG_POST");var i=mn(t.shares);i&&i.url&&-1!==i.url.indexOf(o.toLowerCase())&&(o="");var r={cid:t.cid||Date.now(),text:o,attaches:_n(t),sender:this._store.getState().auth.profile.id,time:Date.now(),type:wn(s),posting:{notify:!n,type:wn(s),detectShare:!(t.shares&&t.shares.attachments)}};t.link&&(r.link={type:t.type,message:t.link}),console.log("commit posting",r),this._store.dispatch({type:Ua.COMMIT_POSTING,chatId:e,message:r}),this._sendPendingMessages(e)}},wc.prototype._post=function(e,t,n,o){var s=this;return this._api.request(n,o).then(function(n){return console.log("message confirm",o,n),s._store.dispatch({type:Ua.CONFIRM_POSTING,chatId:e,messageId:t,payload:o,message:n.message}),n}).catch(function(n){console.log("got posting error",n),s._store.dispatch({type:Ua.SET_POSTING_MESSAGE_ERROR,chatId:e,messageId:t,payload:o,error:n})})};var Cc=15,Ec=function(e,t,n,o){var s=this;this._store=e,this._api=t,this._contacts=n,this._stats=o,this._file=new cc(e,t),this._media=new fc(e,t,this),this._posting=new wc(e,t,this,o),this._search=this.createSearchService("search",ac.CHAT_SEARCH,{maxItems:30}),this._search.on("reset",function(){return s.setSearchContext(null)}),this._messageSearch=new yc(e,t,n),this._chatFetch=new Map,this._notifyTyping=rn(function(e){return s._api.send(ac.MSG_TYPING,{chatId:e})},1e3,{leading:!0}),this._typingParticipants=new Map,this._store.dispatch({type:Ua.RESTORE}),this._api.on(ac.NOTIF_MESSAGE,this._handleIncomingMessage.bind(this)),this._api.on(ac.NOTIF_MARK,this._updateReadMark.bind(this)),this._api.on(ac.NOTIF_TYPING,this._addTypingParticipant.bind(this)),this._api.on(ac.NOTIF_CHAT,this._updateChatInfo.bind(this))};Ec.prototype.save=function(e,t){var n=this;return this.fetchChatContacts(e).then(function(){return n._store.dispatch({type:Ua.STORE,chats:e,marker:t}),e})},Ec.prototype.fetchMissing=function(e){var t=this._store.getState().chats,n=(e=Array.isArray(e)?e.filter(ln):[e]).filter(function(e){return!t.has(e)});return n.length?this.fetch(n):Promise.resolve([])},Ec.prototype.fetch=function(e){var t=this,n=Array.isArray(e);return this.load(n?e:[e],!0).then(function(e){return t.save(e)}).then(function(e){return!n&&e?e[0]:e})},Ec.prototype.fetchChatContacts=function(e){var t=Array.isArray(e)?cn(e.map(En)):En(e);return this._contacts.fetchMissing(t)},Ec.prototype.load=function(e,t){var n=this;if(null==e)return Promise.resolve();var o=Array.isArray(e);if(o||(e=[e]),!e||!e.length)return Promise.resolve([]);e=e.filter(ln);for(var s=[],i=0;i<e.length;)s.push(n._api.request(ac.CHAT_INFO,{chatIds:e.slice(i,i+100)})),i+=100;return Promise.all(s).then(function(e){var o=e.reduce(function(e,t){return e.concat(t.chats)},[]);return t?n.fetchChatContacts(o).then(function(){return o}):o}).then(function(e){return o?e:e[0]})},Ec.prototype.openChannel=function(e,t,n){var o=this,s=this._getChannel(e,t);s?this.select(s.id,n):this._api.request(ac.CHAT_INFO,{link:e}).then(function(e){var t=e.chat;return o.fetchChatContacts(t).then(function(){return t})}).then(function(e){o._canAccessChat(e)?(o.peek(e),"loading"===e.loadState||e.messages&&e.messages.size||o.fetchMessages(e.id,{focus:n})):o._store.dispatch({type:Ua.SHOW_CHAT_JOIN_CONFIRM,chat:e})})},Ec.prototype.openDialog=function(e){var t=this;this._stats.action("PROFILE_OPEN_DIALOG"),this.createDialog(e).then(function(e){return t.select(e.id)})},Ec.prototype.createDialog=function(e,t){var n=this,o=this._store.getState().auth.profile.id,s=an(o,e),i=this.getChat(s);return i?Promise.resolve(i):this.load(s,!0).then(function(e){return e?(t&&!e.lastEventTime&&(e=Object.assign({},e,{lastEventTime:Date.now()})),e):Promise.reject(new Error("Отсутствует чат с ID "+s))}).catch(function(){return On(s,o,"DIALOG",[e,o])}).then(function(e){return t?n.save([e]):n.peek(e)}).then(function(){return n.getChat(s)})},Ec.prototype.createMultichat=function(e,t){return this._createChat({userIds:e},t)},Ec.prototype.createChannel=function(e,t){var n=this;return this._createChat({title:e,chatType:"CHANNEL"},{icon:t}).then(function(e){n._stats.action("ACTION_CHANNEL_CREATE"),n.setCreatedChannel(e.id),n.select(e.id)})},Ec.prototype.createMultiChatFromDialog=function(e,t){var n=this,o=this.getChat(e).participants.find(function(e){return!e.user.current}).user.id;return this.createMultichat([o].concat(t)).then(function(e){return n.select(e.id)})},Ec.prototype.setCreatedChannel=function(e){this._store.dispatch({type:Ua.SET_CREATED_CHANNEL,chatId:e})},Ec.prototype.select=function(e,t){var n=this.getChat(e);if(n){if(this._store.dispatch({type:Ua.SELECT,chatId:e,focusedTime:t}),"loading"!==n.loadState)if(n.messages&&n.messages.size){if(t){var o=Dn(n.messages,t);o&&(o.focus=!0,this.fetchMessages(e,o))}}else{var s={focus:!!t||null},i=t||Mn(n);i&&Object.assign(s,{from:i,backward:Cc,forward:Cc}),this.fetchMessages(e,s)}this._checkEditableMessages(e)}},Ec.prototype.peek=function(e){var t=this;return"number"==typeof e?this.load(e,!0).then(function(e){return t.peek(e)}):e?(this._store.dispatch({type:Ua.PEEK_CHAT,chat:e}),Promise.resolve(e)):Promise.reject(new Error("Не указан чат для просмотра"))},Ec.prototype.resetSelectedChat=function(){this._store.dispatch({type:Ua.RESET_SELECTED})},Ec.prototype.searchTouch=function(e){this._api.send(ac.MSG_SEARCH_TOUCH,null!=e&&{chatId:e})},Ec.prototype.search=function(e){return Promise.all([this._search.query(e),this._searchContext?this._searchContext.query(e):Promise.resolve()])},Ec.prototype.searchMessages=function(e,t){var n=this.getChat(e);return n?(t||"").trim()?this._messageSearch.query(e,t):(this.resetMessageSearch(e),n.messages?Promise.resolve():this.fetchMessages(e)):Promise.reject(new Error("В модели отсутствует чат с ID "+e))},Ec.prototype.setSearchContext=function(e){if(e){if("PUBLIC_CHATS"===e){this._searchContext=this.createSearchService("search.context",ac.CHANNEL_SEARCH);var t=this.getChatSearchResult();t&&t.query&&this._searchContext.query(t.query)}}else this._searchContext&&(this._searchContext.dispose(),this._searchContext=null)},Ec.prototype.getChatSearchResult=function(){return this._search.getSection()},Ec.prototype.loadMoreSearchResults=function(){return this._loadMoreSearchResults(this._search)},Ec.prototype.loadMoreSearchContextResults=function(){return this._loadMoreSearchResults(this._searchContext)},Ec.prototype.loadMoreMessageSearchResults=function(e){return this._messageSearch.loadNext(e)},Ec.prototype.selectSearchResult=function(e){return this._selectSearchResult(e,this._search)},Ec.prototype.selectSearchContextResult=function(e){return this._selectSearchResult(e,this._searchContext)},Ec.prototype.selectMessageSearchResult=function(e){var t=e.chatId,n=e.message;if(this.getChat(t))return this.select(t,n.time)},Ec.prototype._loadMoreSearchResults=function(e){return e?e.loadNext():Promise.reject(new Error("Отсутствует сервис поиска"))},Ec.prototype._selectSearchResult=function(e,t){var n=this;t&&this.fetchChatContacts(e.chat).then(function(){t.select(e);var o=e.chatId||e.chat&&e.chat.id,s=n.getChat(o);"MESSAGES"===e.section?n.searchMessages(o,t.getSection().query):s&&!s.messages&&n.fetchMessages(s.id)})},Ec.prototype.resetSearch=function(){this._search.reset()},Ec.prototype.resetMessageSearch=function(e){if(this.getChat(e))return this._messageSearch.reset(e)},Ec.prototype.sendSticker=function(e,t){return this._stats.action("sticker_sent"),this._posting.sendSticker(e,t)},Ec.prototype.updateReadMark=function(e,t){var n=this,o=this.getChat(e),s=this._store.getState().auth.profile.id,i=this._isUserChat(o);if(!i&&o.unreadCount>0)return this._updateReadMark({chatId:e,mark:t,unread:0}),Promise.resolve();if(i&&t>xn(o,s)){var r={chatId:e,mark:t};return this._updateReadMark(r),this._api.request(ac.CHAT_MARK,r).then(function(t){n._updateReadMark({chatId:e,mark:t.mark,unread:t.unread||0})})}return Promise.resolve()},Ec.prototype.loadMoreChats=function(e){var t=this,n=this._store.getState().chatMarker;return null==n||n?(this._chatFetch.has(n)||this._chatFetch.set(n,this._api.request(ac.CHAT_LIST,{marker:n,count:e||50}).then(function(e){return t._chatFetch.delete(n),t.save(e.chats,e.marker),e}).catch(function(e){return t._chatFetch.delete(n),Promise.reject(e)})),this._chatFetch.get(n)):(console.info("No more chats for current user"),Promise.resolve([]))},Ec.prototype.updateSharePreview=function(e,t,n){return this._posting.updateSharePreview(e,t,n)},Ec.prototype.selectShare=function(e,t){return this._posting.selectShare(e,t)},Ec.prototype.removeShares=function(e){return this._posting.removeShares(e)},Ec.prototype.posting=function(e,t){e&&this._notifyTyping(e),this._posting.update(e,t)},Ec.prototype.resetPosting=function(e){this._posting.reset(e)},Ec.prototype.commitPosting=function(e,t,n){return this._posting.commit(e,t,n)},Ec.prototype.replyMessage=function(e,t){return this._posting.replyMessage(e,t)},Ec.prototype.editLastMessage=function(e){var t=this.getChat(e),n=t&&!t.posting&&In(t);if(n)return this.editMessage(e,n.uid)},Ec.prototype.editMessage=function(e,t){return this._posting.editMessage(e,t)},Ec.prototype.removeMessages=function(e,t){Array.isArray(t)||(t=[t]);var n=this.getChat(e);if(n){var o=t.map(function(e){var t=n.messages.get(e);return t?t.id:null}).filter(function(e){return null!=e});this._store.dispatch({type:Ua.REMOVE_MESSAGES,chatId:e,messageUIDs:t}),o.length&&this._api.request(ac.MSG_DELETE,{chatId:e,messageIds:o})}},Ec.prototype.resetFocusedMessage=function(e){this._store.dispatch({type:Ua.RESET_FOCUSED_MESSAGE,chatId:e})},Ec.prototype.fetchMessages=function(e,t){var n=this,o=null;return"number"==typeof(t=Object.assign({},t)).focus?o=t.focus:!0===t.focus&&(o=t.from),delete t.focus,this.loadMessages(e,t).then(function(e){if(e){var t=cn(e.map(An));return n._contacts.fetchMissing(t).then(function(){return e})}}).then(function(t){return n._store.dispatch({type:Ua.UPDATE_MESSAGES,chatId:e,messages:t,focus:o})})},Ec.prototype.loadMessages=function(e,t){var n=this.getChat(e);if("CHANNEL"===n.type&&"CLOSED"===n.status)return Promise.resolve([n.lastMessage]);var o=Object.assign({chatId:e,from:Date.now()},t);return o.direction?o[o.direction]=o.amount||30:null==o.forward&&null==o.backward&&(o.backward=o.amount||30),console.info("request messages",o),this._request(e,ac.CHAT_HISTORY,o).then(function(e){return e.messages})},Ec.prototype.showMedia=function(e,t){return this._media.show(e,t)},Ec.prototype.addFile=function(e,t,n){return this._posting.addFile(e,t,n)},Ec.prototype.removeFile=function(e,t){this._posting.removeFile(e,t)},Ec.prototype.join=function(e){var t=this;return this._store.dispatch({type:Ua.JOIN}),this._api.request(ac.CHAT_JOIN,{link:e}).then(function(n){var o=n.chat;return"CHANNEL"===o.type?t._stats.action("ACTION_CHANNEL_SUBSCRIBE"):t._stats.action(e.includes("/join/")?"ACTION_CHAT_JOIN_PRIVATE_LINK":"ACTION_CHAT_JOIN_PUBLIC_LINK"),t.save([o]).then(function(){return t.select(o.id)})})},Ec.prototype.resetJoin=function(){this._store.dispatch({type:Ua.RESET_JOIN_CHAT})},Ec.prototype.clear=function(e){return this._store.dispatch({type:Ua.CLEAR_HISTORY,chatId:e}),this._api.request(ac.CHAT_CLEAR,{chatId:e,lastEventTime:Date.now()})},Ec.prototype.remove=function(e){var t=this,n=this.getChat(e);if(n)return"DIALOG"===n.type?(this._store.dispatch({type:Ua.REMOVE,chatId:e}),this._api.request(ac.CHAT_DELETE,{chatId:e,lastEventTime:Date.now()})):this._api.request(ac.CHAT_LEAVE,{chatId:e}).then(function(o){o.message?t._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:o.message}):t._store.dispatch({type:Ua.LEAVE,chatId:e}),"CHANNEL"===n.type?t._stats.action(n.owner.current?"ACTION_CHANNEL_DELETE":"ACTION_CHANNEL_UNSUBSCRIBE"):t._stats.action("PROFILE_CHAT_LEAVE"),t._store.dispatch({type:Ua.REMOVE,chatId:e})})},Ec.prototype.setTitle=function(e,t){var n=this;this._store.dispatch({type:Ua.SET_TITLE,chatId:e,title:t});var o=Sn(e,"title",{title:t});return this._api.request(ac.MSG_SEND,o).then(function(t){return n._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:t.message}),t})},Ec.prototype.setIcon=function(e,t){var n=this,o=URL.createObjectURL(t);this._store.dispatch({type:Ua.SET_ICON,chatId:e,url:o,fullUrl:o});var s=this._file.issueUrl("PHOTO").then(function(e){return n._file.upload(e.url,t)});return"CHANNEL"===this.getChat(e).type?s.then(function(t){var o=t.photos[Object.keys(t.photos)[0]].token;return n._api.request(ac.CHAT_UPDATE,{chatId:e,photoToken:o})}).then(function(e){return n.save([e.chat])}):s.then(function(t){var o=t.photos[Object.keys(t.photos)[0]].token,s=Sn(e,"icon",{photoToken:o});return n._api.request(ac.MSG_SEND,s)}).then(function(t){return n._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:t.message}),URL.revokeObjectURL(o),t})},Ec.prototype.revokeLink=function(e){return this._updateChat(e,{revokePrivateLink:!0})},Ec.prototype.checkLink=function(e,t){var n=this;if(t)return this._api.request(ac.CHAT_CHECK_LINK,{link:t}).then(function(){return n._store.dispatch({type:Ua.SET_NEXT_LINK,chatId:e,data:{link:t}})}).catch(function(t){return n._store.dispatch({type:Ua.SET_NEXT_LINK,chatId:e,data:{error:t.message}})});this._store.dispatch({type:Ua.SET_NEXT_LINK,chatId:e})},Ec.prototype.updateChat=function(e,t,n,o,s,i,r){var a=this,c=void 0===r?void 0:{SIGN_ADMIN:r};return this._updateChat(e,{theme:t,description:n,access:s,link:i,options:c}).then(function(){o&&a.setIcon(e,o)})},Ec.prototype.removeParticipant=function(e,t){var n=this,o=this.getChat(e);if("CHANNEL"!==o.type){var s=Sn(e,"remove",{userId:t});return this._api.request(ac.MSG_SEND,s).then(function(t){return n._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:t.message}),t})}return o.admins.find(function(e){return e.id===t})?(this._store.dispatch({type:Ua.REMOVE_CHANNEL_ADMIN,chatId:e,userId:t}),this._updateChat(e,{removeAdmins:[t]})):(this._store.dispatch({type:Ua.REMOVE_PARTICIPANT,chatId:e,userId:t}),this._updateChat(e,{removeMembers:[t]}))},Ec.prototype.addParticipants=function(e,t,n){var o=this,s=this.getChat(e);if(this._store.dispatch({type:Ua.ADD_PARTICIPANTS,chatId:e,userIds:t}),"CHANNEL"!==s.type){var i=Sn(e,"add",{userIds:t,showHistory:n});return this._api.request(ac.MSG_SEND,i).then(function(t){return o._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e,message:t.message}),t})}this._updateChat(e,{addMembers:t})},Ec.prototype.addChannelAdmin=function(e,t){return this._store.dispatch({type:Ua.ADD_CHANNEL_ADMINS,chatId:e,userIds:t}),this._updateChat(e,{addAdmins:t})},Ec.prototype.forwardMessages=function(e,t,n,o){var s=this,i=[],r=this._mergeChatIds(e,t),a=1===r.length;return r.forEach(function(e){o.forEach(function(t,o){var r=s._api.request(ac.MSG_SEND,{chatId:e,message:{cid:Date.now()+o,text:"",link:{type:"FORWARD",chatId:n,messageId:t}}});i.push(r)})}),Promise.all(i).then(function(e){var t=e.map(function(e){return e.chatId});s.fetchMissing(t).then(function(){e.forEach(function(e){s._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e.chatId,message:e.message}),a&&s.select(e.chatId)})})})},Ec.prototype.updateMessagesStats=function(e,t){var n=this,o=this.getChat(e);if(this._isUserChat(o)){var s=t.map(function(e){var t=o.messages.get(e);return t&&t.id}).filter(Boolean);this._api.request(ac.MSG_GET_STAT,{chatId:e,messageIds:s}).then(function(t){n._store.dispatch({type:Ua.UPDATE_MESSAGE_STATS,chatId:e,stats:t.stats})})}},Ec.prototype.loadChatMembers=function(e){var t=this,n=this.getChat(e);n&&(this._store.dispatch({type:Ua.UPDATE_CHAT_MEMBERS_LOAD_STATE,chatId:e,loadState:"loading"}),this._api.request(ac.CHAT_MEMBERS,{chatId:e,type:"MEMBER",count:100,marker:n.members?n.members.marker:0}).then(function(n){t._store.dispatch(Object.assign({},{type:Ua.ADD_CHAT_MEMBERS,chatId:e},n))}))},Ec.prototype.destroy=function(){this._api.off(ac.NOTIF_MESSAGE,this._handleIncomingMessage),this._api.off(ac.NOTIF_MARK,this._handleReadMark),this._handleIncomingMessage=this._handleReadMark=null},Ec.prototype.isPeekChat=function(e){var t=this._store.getState().peekChat;return t&&t.id===e||!1},Ec.prototype.getChat=function(e){var t=this._store.getState(),n=t.chats.get(e);return!n&&t.peekChat&&t.peekChat.id===e&&(n=t.peekChat),n},Ec.prototype.createSearchService=function(e,t,n){var o=this;return new vc(this._store,this._api,e,t,Object.assign({},{load:function(e,t){return o.load(e,!0).then(function(e){return t&&t.length?o._contacts.fetchMissing(t).then(function(){return e}):e})}},n))},Ec.prototype._createChat=function(e,t){var n=this,o=Sn(void 0,"new",e);return this._api.request(ac.MSG_SEND,o).then(function(e){var t=Object.assign({},e.chat),o=e.message;return t.lastMessage&&t.lastEventTime||(t.lastMessage=o,t.lastEventTime=o.time),t.messages||(t.messages=[o]),console.log("saving new chat",t),n.save([t]),t}).then(function(e){var o=n.fetch(e.id);return t&&t.title&&(o=o.then(function(){return n.setTitle(e.id,t.title)})),t&&t.icon&&(o=o.then(function(){return n.setIcon(e.id,t.icon)})),Promise.race([o.then(function(){return e}),new Promise(function(t){return setTimeout(function(){return t(e)},500)})])})},Ec.prototype._request=function(e,t,n){var o=this;return this._store.dispatch({type:Ua.SET_LOADING_STATE,chatId:e}),this._api.request(t,n).then(function(t){return o._store.dispatch({type:Ua.SET_IDLE_STATE,chatId:e}),t}).catch(function(t){return o._store.dispatch({type:Ua.SET_IDLE_STATE,chatId:e}),o._store.dispatch({type:Ua.SET_ERROR,chatId:e,error:t}),Promise.reject(t)})},Ec.prototype._handleIncomingMessage=function(e){var t=this;if(this.getChat(e.chatId)){var n=An(e.message);return this._contacts.fetchMissing(n).then(function(){var n=t.getChat(e.chatId);"REMOVED"===e.message.status&&n.lastMessage&&n.lastMessage.id===e.message.id?n.messages&&(n.messages.has(n.lastMessage.uid)||n.messages.has(n.lastMessage.id))?t._store.dispatch({type:Ua.REMOVE_MESSAGE,chatId:e.chatId,message:e.message}):t.fetch(e.chatId):t._store.dispatch({type:Ua.ADD_MESSAGE,chatId:e.chatId,message:e.message})})}this.fetch(e.chatId)},Ec.prototype._updateReadMark=function(e){this._store.dispatch(Object.assign({},{type:Ua.UPDATE_READ_MARK},e))},Ec.prototype._addTypingParticipant=function(e){var t=this,n=e.chatId+":"+e.userId;this._typingParticipants.has(n)&&clearTimeout(this._typingParticipants.get(n)),this._store.dispatch(Object.assign({},{type:Ua.ADD_TYPING_PARTICIPANT},e)),this._typingParticipants.set(n,setTimeout(function(){t._store.dispatch(Object.assign({},{type:Ua.REMOVE_TYPING_PARTICIPANT},e))},5e3))},Ec.prototype._updateChatInfo=function(e){this._store.dispatch(Object.assign({},{type:Ua.UPDATE},e))},Ec.prototype._checkEditableMessages=function(e){var t=this;clearTimeout(this._checkEditableMessagesTimeoutId),this._checkEditableMessagesTimeoutId=setTimeout(function(){var n=t.getChat(e);if(n&&n.messages){var o=1e3*(t._store.getState().config.server["edit-timeout"]-15),s=Date.now();Array.from(n.messages.values()).forEach(function(n){n.sender&&n.sender.current&&n.editable&&s-n.time>o&&t._store.dispatch({type:Ua.SET_MESSAGE_NOT_EDITABLE,chatId:e,messageUID:n.uid})}),t._checkEditableMessages(e)}},15e3)},Ec.prototype._updateChat=function(e,t){var n=this;return this._api.request(ac.CHAT_UPDATE,Object.assign({},{chatId:e},t)).then(function(e){return n._store.dispatch(Object.assign({},{type:Ua.UPDATE},e)),e})},Ec.prototype._mergeChatIds=function(e,t){if(t&&t.length){var n=this._store.getState().auth.profile.id;return e.concat(t.map(function(e){return an(n,e)}))}return e},Ec.prototype._getChannel=function(e,t){if(t)return this.getChat(t);var n=this._store.getState();return n.peekChat&&n.peekChat.link===e?n.peekChat:Array.from(n.chats.values()).find(function(t){return t.link===e})},Ec.prototype._canAccessChat=function(e){return this._isUserChat(e)||"PUBLIC"===e.access},Ec.prototype._isUserChat=function(e){var t=this._store.getState().auth.profile.id;return Array.isArray(e.participants)?e.participants.some(function(e){return e.user.current}):Object.keys(e.participants).find(function(e){return e===t})};var Ac=function(e,t){this._store=e,this._api=t};Ac.prototype.getVideoUrlData=function(e,t,n){var o=this;return this._api.request(ac.VIDEO_PLAY,{videoId:n}).then(function(s){return o._store.dispatch({type:Ua.SET_VIDEO_URL_DATA,urlData:s,chatId:e,messageUid:t,videoId:n})})};var Tc=function(e,t){var n=this;this._store=e,this._api=t,this._store.dispatch({type:Na.RESTORE}),this._api.on(ac.NOTIF_CONTACT,function(e){var t="BLOCKED"!==e.contact.status&&"REMOVED"!==e.contact.status;n._store.dispatch(Object.assign({},{type:Na.UPDATE},e,{contact:Object.assign({},e.contact,{own:t})}))}),this._api.on(ac.NOTIF_PRESENCE,function(e){n._store.dispatch(Object.assign({},{type:Na.UPDATE_PRESENCE},e))})};Tc.prototype.save=function(e,t){this._store.dispatch({type:Na.UPDATE_LIST,list:e,presence:t})},Tc.prototype.fetch=function(e){var t=this;return this.load(e).then(function(e){return t.save(e),e})},Tc.prototype.load=function(e){var t=this;e=Array.isArray(e)?e.filter(ln):[e];for(var n=[],o=0;o<e.length;)n.push(t._api.request(ac.CONTACT_INFO,{contactIds:e.slice(o,o+100)})),o+=100;return Promise.all(n).then(function(t){var n=t.reduce(function(e,t){return e.concat(t.contacts)},[]),o=new Set(n.map(function(e){return e.id}));return e.forEach(function(e){o.has(e)||(o.add(e),n.push({id:e,updateTime:Date.now(),names:[{type:"DELETED",name:"Deleted user #"+e}],deleted:!0}))}),n})},Tc.prototype.fetchMissing=function(e){var t=this._store.getState().contacts,n=e.filter(ln).filter(function(e){return!t.has(e)});return n.length?this.fetch(n):Promise.resolve([])},Tc.prototype.update=function(e,t){switch(t){case"BLOCK":this._store.dispatch({type:Na.BLOCK,contactId:e});break;case"UNBLOCK":this._store.dispatch({type:Na.UNBLOCK,contactId:e})}return this._api.request(ac.CONTACT_UPDATE,{contactId:e,action:t})},Tc.prototype.unblockUser=function(e){var t=this;this.update(e,"UNBLOCK").then(function(){return t.fetchBlackList()})},Tc.prototype.fetchBlackList=function(){var e=this;this._api.request(ac.CONTACT_LIST,{status:"BLOCKED"}).then(function(t){return e._store.dispatch({type:Na.UPDATE_BLACK_LIST,contacts:t.contacts})})};var Sc=function(e,t){var n=this;this._store=e,this._api=t,this._store.dispatch({type:Ka.RESTORE}),this._api.on(ac.NOTIF_CONFIG,function(e){return n.save(e&&e.config)})};Sc.prototype.save=function(e){this._store.dispatch({type:Ka.UPDATE,config:e})},Sc.prototype.setUserSettings=function(e){var t=this,n={user:e};this.save(n),this._api.request(ac.CONFIG,{settings:n}).then(function(e){return t.save(e)}).catch(function(e){return console.error("error",e)})},Sc.prototype.setChatSettings=function(e,t){var n,o=this,s={chats:(n={},n[e]=t,n)};this.save(s),this._api.request(ac.CONFIG,{settings:s}).then(function(e){return o.save(e)}).catch(function(e){return console.error("error",e)})};var Ic=function(e,t,n){this._store=e,this._chat=n,this._lastChatIds=this._store.getState().onboarding.chats.map(function(e){return e.id}).slice().sort(),this._search=n.createSearchService("onboarding.search",ac.CHANNEL_SEARCH,{maxItems:10}),t.on(ac.NOTIF_CONFIG,this.update.bind(this))};Ic.prototype.update=function(){var e=this,t=this._store.getState().config.server["promo-channels"],n=t.slice().sort();hn(this._lastChatIds,n)||this._chat.load(t,!0).then(function(t){e._lastChatIds=n,e._store.dispatch({type:Xa.UPDATE_CHATS,chats:t})})},Ic.prototype.search=function(e){this._search.query(e)},Ic.prototype.loadMoreSearchResults=function(){this._search.loadNext()};var Oc=function(e){function t(t,n,o,s){e.call(this,t,n,"assets.stickerSearch",Object.assign({},{request:function(e,t,n){return e.request(ac.ASSETS_GET,{type:"STICKER",from:n.marker,count:100,query:t}).then(function(e){return o.fetchMissing(e.stickers).then(function(){return e})}).then(function(e){return Object.assign({},e,{result:e.stickers})})}},s))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(mc),xc=function(e,t){this._store=e,this._api=t,this._stickerSearch=new Oc(e,t,this),this._store.dispatch({type:Ya.RESTORE}),this.sync=0,this.fillSuggestions=rn(this.fillSuggestions.bind(this),250,{leading:!1,trailing:!0})};xc.prototype.updateList=function(e){this._store.dispatch({type:Ya.UPDATE_LIST,stickers:e})},xc.prototype.fetch=function(e){var t=this;e=e.filter(ln);for(var n=[],o=0;o<e.length;)n.push(t._api.request(ac.ASSETS_GET_BY_IDS,{type:"STICKER",ids:e.slice(o,o+100)})),o+=100;return Promise.all(n).then(function(e){var n=e.reduce(function(e,t){return e.concat(t.stickers)},[]);return t.updateList(n),n})},xc.prototype.fetchMissing=function(e){var t=this._store.getState().stickers,n=e.filter(ln).filter(function(e){return!t.has(e)});return n.length?this.fetch(n):Promise.resolve([])},xc.prototype.update=function(){var e=this;this._api.request(ac.ASSETS_UPDATE,{sync:this.sync}).then(function(t){e.sync=t.sync;var n=new Map;e.markedBranch=null;var o=t.sections.reduce(function(t,o){return"STICKERS"===o.type?(o.marker&&(e.markedBranch=o.id),n.set(o.id,Object.assign({},o,{result:o.stickers})),t.concat(o.stickers)):t},[]);return e.fetchMissing(o).then(function(){e._store.dispatch({type:Ya.STORE_SECTIONS,sectionsOrder:t.stickersOrder,sections:n})})})},xc.prototype.loadNext=function(){var e=this;if(this.markedBranch){var t="assets.stickerSections."+this.markedBranch,n=new ja(this._store.getState()).get(t);if(n&&n.marker&&n.loadState!==za.loading)return this._store.dispatch({key:t,type:Ra.SET_LOADING_STATE}),this._api.request(ac.ASSETS_GET,{type:"STICKER",from:n.marker}).then(function(n){return e._store.dispatch({key:t,type:Ra.APPEND,data:Object.assign({},n,{result:n.stickers,loadState:za.idle})}),n}).then(function(t){return e.fetchMissing(t.stickers).then(function(){return t})})}return Promise.resolve(null)},xc.prototype.search=function(e){this._stickerSearch.query(e)},xc.prototype.searchMore=function(){this._stickerSearch.loadNext()},xc.prototype.resetSearch=function(){this._stickerSearch.reset()},xc.prototype.suggest=function(e){this.fillSuggestions(e)},xc.prototype.fillSuggestions=function(e){var t=this._store.getState().assets,n=t.get("stickerSuggestions");if(!n||!n.has(e)){var o=t.get("stickerSections"),s=this._store.getState().config.server["stickers-suggestion"],i=new Map,r=function(e,t){i.size<2&&e.tags&&-1!==e.tags.indexOf(t)&&i.set(e.id,e)};s.forEach(function(t){o.has(t)&&i.size<2&&o.get(t).stickers.forEach(function(t){return r(t,e)})}),i.size<2?this._loadSuggestions(e,new Map(i)):this._store.dispatch({type:Ya.UPDATE_SUGGESTION,query:e,suggestion:i})}},xc.prototype._loadSuggestions=function(e,t){var n=this;this._api.request(ac.ASSETS_GET,{type:"STICKER",from:0,count:2,query:e}).then(function(e){return n.fetchMissing(e.stickers).then(function(){return e})}).then(function(o){var s=n._store.getState().stickers;return o.stickers.forEach(function(e){t.size<2&&t.set(e,s.get(e))}),n._store.dispatch({type:Ya.UPDATE_SUGGESTION,query:e,suggestion:t}),o})},xc.prototype.updateRecentStickers=function(e){var t=new ja(this._store.getState()).get("assets.stickerSections.RECENT.result");this._store.dispatch({type:Ya.UPDATE_RECENT_STICKERS,data:[e].concat(t.filter(function(t){return t.id!==e}))})},xc.prototype.updateRecentEmoji=function(e){e=Array.isArray(e)?e:[e];var t=this._store.getState().assets.get("recentEmoji"),n=new Set(e.concat(t?Array.from(t):[]));this._store.dispatch({type:Ya.UPDATE_RECENT_EMOJI,data:n})};var Dc=function(e,t,n){this._store=e,this._api=t,this._chat=n};Dc.prototype.enter=function(){this._store.dispatch({type:Ja.ENTER})},Dc.prototype.exit=function(){this._store.dispatch({type:Ja.EXIT})},Dc.prototype.submit=function(){var e=this,t=this._store.getState().newChat;if(!t)return Promise.reject(new Error("Отсутствует новый чат"));if(!t.invited.size)return Promise.reject(new Error("У нового чата отсутствуют участники"));var n=Array.from(t.invited.keys());return(1===n.length?this._chat.createDialog(n[0],!0):this._chat.createMultichat(n,{title:t.title,icon:t.icon})).then(function(n){return e._chat.select(n.id),e.exit(),t.posting?e._chat.commitPosting(n.id,t.posting).then(function(){return n}):n})},Dc.prototype.addUser=function(e){this._store.dispatch({type:Ja.ADD_USER,userId:e})},Dc.prototype.removeUser=function(e){this._store.dispatch({type:Ja.REMOVE_USER,userId:e})},Dc.prototype.setTitle=function(e){this._store.dispatch({type:Ja.SET_TITLE,title:e})},Dc.prototype.setIcon=function(e){this._store.dispatch({type:Ja.SET_ICON,icon:e})};var Mc=function(e){function t(t,n,o){var s=this;e.call(this),this._store=t,this._stream=n,this.userAgent=o,n.on("disconnect",function(){return s.deauthorize()}),n.on("connect",function(){console.log("socket connected, authorize session"),n.request(ac.SESSION_INIT,{userAgent:s.userAgent}).then(function(){var e=t.getState();if(console.log("restore session from state",e),e.auth&&e.auth.token)return console.log("auth by token",e.auth.token),s.authorize(e.auth.token);console.log("No token, assume unauthorized"),s.deauthorize()})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.authorize=function(e){var t=this,n=Object.assign({token:e,userAgent:this.userAgent},this.getSyncData());return console.log("authorize connection with",n),this._stream.request(ac.LOGIN,n).then(function(n){return n.token||(n.token=e),t._store.dispatch(Object.assign({},{type:$a.LOGIN},n)),t.emit("authorize",n),n}).catch(function(e){return t.emit("error",e),t.deauthorize(e),Promise.reject(e)})},t.prototype.deauthorize=function(e){this.emit("deauthorize",e)},t.prototype.getSyncData=function(){var e=this._store.getState(),t=0,n=0,o=0;return e.chats.forEach(function(e){t<e.lastEventTime&&(t=e.lastEventTime),Array.isArray(e.participants)&&e.participants.forEach(function(e){t<e.time&&(t=e.time)})}),e.contacts.forEach(function(e){e.current||(n<e.updateTime&&(n=e.updateTime),e.presence&&e.presence.seen&&o<e.presence.seen&&(o=e.presence.seen))}),{chatsSync:t,contactsSync:n,presenceSync:o,configHash:e.config.hash}},t}(gc),jc=function(e){function t(t,n){var o=this;e.call(this),this.url=t,this.maxAttempts=n||5,this._ws=null,this._closing=!1,this._reconnectAttempt=0;var s=function(){return o._open(t).then(i,r)},i=function(e){o.emit("open"),o._onConnect(e)},r=function(e){o._shouldReconnect(e)?o._waitForReconnect().then(s,r):o.emit("close",e)};console.log("open initial socket connection"),s()}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={readyState:{},connected:{}};return n.readyState.get=function(){return this._ws&&this._ws.readyState},n.connected.get=function(){return this.readyState===WebSocket.OPEN},t.prototype.send=function(e){this._ws&&this._ws.send(e)},t.prototype.close=function(e,t){this._closing=!0,this._ws&&this._ws.close(e,t)},t.prototype.reopen=function(){this._ws&&this._ws.close()},t.prototype._open=function(e){return new Promise(function(t,n){var o=new WebSocket(e),s=function(){o.removeEventListener("open",i),o.removeEventListener("close",r)},i=function(){s(),t(o)},r=function(e){s(),n(e)};o.addEventListener("open",i),o.addEventListener("close",r)})},t.prototype._setupReconnect=function(){var e=this,t=function(){return e._open(e.url).then(n,o)},n=function(t){return e._onConnect(t)},o=function(n){console.log("try to reconnect socket",n),e._ws&&(e._ws=null,e.emit("disconnect")),e._shouldReconnect(n)?e._waitForReconnect().then(t,o):e.emit("close",n)};this._ws.addEventListener("close",o)},t.prototype._waitForReconnect=function(){var e=this;return new Promise(function(t,n){if(!1===window.navigator.onLine){var o=function(){return window.removeEventListener("online",s)},s=function(){return t(o())};console.log("reconnect when online"),window.addEventListener("online",s)}else{var i=1e3*(Math.pow(2,Math.min(e._reconnectAttempt++,e.maxAttempts))+Math.random());console.log("reconnect by timer, attempt %d, delay: %d",e._reconnectAttempt,0|i),setTimeout(t,0|i)}})},t.prototype._shouldReconnect=function(e){return!this._closing},t.prototype._onConnect=function(e){var t=this;this._ws=e,e.addEventListener("message",function(e){return t.emit("message",e)}),this._reconnectAttempt=0,this._setupReconnect(),this.emit("connect")},Object.defineProperties(t.prototype,n),t}(gc),Pc=function(e,t){var n=this;this.id=++this.constructor.globalId,this.command=e,this.data=t,this._status=null,this.promise=new Promise(function(e,t){n.completed?n._status.success?e(n._status.value):t(n._status.value):(n._resolve=e,n._reject=t)})},Lc={completed:{},requestTime:{}};Lc.completed.get=function(){return!!this._status},Lc.requestTime.get=function(){return Date.now()-this._startTime},Pc.prototype.saveStartTime=function(){this._startTime=Date.now()},Pc.prototype.payload=function(e){var t={ver:10,cmd:e,seq:this.id,opcode:this.command};return null!=this.data&&(t.payload=this.data),JSON.stringify(t)},Pc.prototype.resolve=function(e){return this.completed||(this._status={success:!0,value:e},this._resolve&&this._resolve(e)),this},Pc.prototype.reject=function(e){return this.completed||(this._status={success:!1,value:e},this._reject&&this._reject(e)),this},Object.defineProperties(Pc.prototype,Lc),Pc.globalId=0;var Nc=function(e){function t(t){e.call(this),this._socket=t,this._pending=new Map,this._stalled=null,this._queue=[],this._paused=!1,this._onConnect=this._onConnect.bind(this),this._onDisconnect=this._onDisconnect.bind(this),this._onMessage=this._onMessage.bind(this),this._socket.on("connect",this._onConnect),this._socket.on("disconnect",this._onDisconnect),this._socket.on("message",this._onMessage)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={paused:{},flowing:{},connected:{}};return n.paused.get=function(){return this._paused},n.flowing.get=function(){return!this.paused&&this._socket.connected},n.connected.get=function(){return this._socket.connected},t.prototype.pause=function(){this._paused||(this._paused=!0,this.emit("pause"))},t.prototype.resume=function(){this._paused&&(this._paused=!1,this.flowing&&this._resume(),this.emit("resume"))},t.prototype.request=function(e,t){var n=new Pc(e,t);return this.flowing?this._send(n):this._queue.push(n),n.promise},t.prototype.send=function(e,t){this.flowing&&this._send(new Pc(e,t).resolve())},t.prototype.clear=function(e,t){var n=pn(e||"ECANCEL",t),o=function(e){return e.reject(n)};this._pending.forEach(o),this._queue.forEach(o),this._stalled&&(this._stalled.forEach(o),this._stalled=null)},t.prototype.reopen=function(){this._socket.reopen()},t.prototype.end=function(e,t){this.clear(e,t),this._socket.off("connect",this._onConnect),this._socket.off("disconnect",this._onDisconnect),this._socket.off("message",this._onMessage),this._pending=this._queue=this._stalled=this._socket=null,this.emit("end")},t.prototype._onConnect=function(){this.emit("connect"),this.flowing&&this._resume()},t.prototype._onDisconnect=function(){this.emit("disconnect"),this._pending.size&&(this._stalled=this._pending,this._pending=new Map)},t.prototype._onMessage=function(e){var t=JSON.parse(e.data),n=t.payload,o=this._pending.get(t.seq);!o&&this._stalled&&(o=this._stalled.get(t.seq)),o?(this._pending.delete(t.seq),this._stalled&&this._stalled.delete(t.seq),1===t.cmd?o.resolve(n):3===t.cmd&&o.reject(pn(n.error,n.message)),this.emit("request-end",o.command,o.requestTime,t.duration)):0!==t.cmd&&2!==t.cmd||this.emit(t.opcode,t.payload,t.seq),this.emit("message",t)},t.prototype._resume=function(){var e=this;this._stalled&&(this._stalled.forEach(function(t){return e._send(t,2)}),this._stalled=null);var t=this._queue;this._queue=[],t.forEach(function(t){return e._send(t)})},t.prototype._send=function(e,t){return null==t&&(t=0),this._pending.has(e.id)||(this._pending.set(e.id,e),e.saveStartTime(),this._socket.send(e.payload(t))),e.promise},Object.defineProperties(t.prototype,n),t}(gc),Rc=1,zc=3e4,Hc=1500,Fc=function(e){return Object.assign({},e,{config:Nn(e.config),online:void 0,auth:Rn(e.auth),chats:Bn(e.chats,zn).filter(Boolean),contacts:Bn(e.contacts,Hn),blackList:void 0,newChat:void 0,peekChat:void 0,assets:Ln(e.assets),stickers:void 0,createdChannel:void 0,onboarding:Object.assign({},e.onboarding,{search:void 0})})},Uc={deviceType:"WEB",appVersion:"1.0.0",osVersion:"",locale:"ru",deviceName:"",screen:"1024x768 2.0x",headerUserAgent:null},qc="WEB:1",$c="0.4.88",Gc=function(){return{osVersion:to(),deviceName:eo(),headerUserAgent:navigator.userAgent}},Bc=500,Vc=new Map(Object.entries({"confirm-cancel-button":"Отменить",and:"и","created-chat":[{name:"gender",values:["","создал","создала"]}," чат"],"created-channel":"Канал создан",added:{name:"gender",values:["","добавил","добавила"]},joinByLink:[{name:"gender",values:["","присоединился","присоединилась"]}," к чату"],"and-more-people":["и еще ",{name:"number"}," ",{name:"number",func:"plural",values:["человека","человек","человек"]}],back:"Назад","black-list":"Чёрный список","black-list-empty":"Чёрный список пуст","browser-notifications-permissions-required":"Необходимо дать права на браузерные уведомления","changed-chat-icon":[{name:"gender",values:["","изменил","изменила"]}," иконку чата"],"changed-chat-title":[{name:"gender",values:["","изменил","изменила"]}," название чата"],"code-sent-to-number":"Код отправлен на номер",confirm:"Подтвердить","created-new-chat":[{name:"gender",values:["","создал","создала"]}," новый чат"],deleted:{name:"gender",values:["","удалил","удалила"]},"display-browser-notifications":"Показывать браузерные уведомления",draft:"Черновик:","empty-list":"Список пуст","enter-code":"Введите код","enter-phone":"Введите номер телефона","flood-error":"Вход временно невозможен","forgotten-pwd":"Забыли пароль?","got-you-at-okru":"Мы нашли вас на OK.RU",joined:[{name:"gender",values:["","присоединился","присоединилась"]}," к ТамТам"],"left-chat":[{name:"gender",values:["","покинул","покинула"]}," чат"],"live-stickers":"Живые стикеры",login:"Логин","login-as-name":["Войти как ",{name:"name"}],"login-via-ok":"Войти через ОК","message-count":[{name:"count"}," ",{name:"count",func:"plural",values:["сообщение","сообщения","сообщений"]}],"message-removed":"Сообщение удалено","new-messages-count":[{name:"count"}," ",{name:"count",func:"plural",values:["новое сообщение","новых сообщения","новых сообщений"]}],"new-messages-in-tamtam":"Новые сообщения в ТамТам","not-found":"Ничего не найдено","not-me":"Это не я",notifications:"Уведомления","obsolete-code":"Код устарел",online:"в сети","was-online":[{name:"gender",values:["","был","была"]}," "],"was-online-recently":"недавно",password:"Пароль",photo:"фото",privacy:"Приватность","repeat-send-code-after":"Повторно отправить код можно через","request-code-again":"Запросить код ещё раз",settings:"Настройки","show-my-online-status":"Показывать мой статус «в сети»",smiles:"Смайлики",sticker:"стикер",recent:"Недавние","search-stickers":"Поиск по стикерам","text-typing":"Набор текста",typing:"набирает текст","unknown-error":"Неизвестная ошибка","unread-chats-count":[{name:"count"}," ",{name:"count",func:"plural",values:["непрочитанный чат","непрочитанных чата","непрочитанных чатов"]}],block:"Заблокировать",unblock:"Разблокировать","user-blocked":"Пользователь заблокирован или удалён","welcome-auth-phone":"Для входа мы отправим проверочный код на ваш номер","wrong-code":"Неправильный код","wrong-login-pwd":"Неверный логин или пароль","wrong-phone":"Неверный телефон","temporary-problems":"Действие временно не возможно, попробуйте позже","phone-number-blocked":"Номер телефона заблокирован","phone-number-wrong-format":"Проверьте номер телефона","get-sms-code":"Получить смс код","is-number-ok":"Верно ли указан номер телефона?","action-continue":"Продолжить","action-change":"Изменить",alerts:"Уведомления","alerts-enabled":"включены","alerts-disabled":"выключены","alerts-disabled-for-hours":["выключены на ",{name:"count"}," ",{name:"count",func:"plural",values:["час","часа","часов"]}],"alerts-disabled-for-minutes":["выключены на ",{name:"count"}," ",{name:"count",func:"plural",values:["минуту","минуты","минут"]}],"alerts-on":"Включить уведомления","alerts-off":"Выключить уведомления","alerts-off-period":{name:"hours",values:{1:"на 1 час",2:"на 2 часа",24:"на 1 день","-1":"пока я не включу"}},"subscribers-count":[{name:"count"}," ",{name:"count",func:"plural",values:["участник","участника","участников"]}],"empty-chat-participants-label":"тут только вы","online-participants":[{name:"online"}," из ",{name:"total"}," в сети"],"edit-channel":"Настройки канала","clear-chat-history":"Очистить историю",more:"Еще","delete-chat":"Удалить чат",video:"видео",audio:"голосовое сообщение",you:"Ты","popular-queries":"Популярные запросы","error-message.censored":"Сообщение не прошло проверку цензором","error-message.length.violation":"Превышена максимальная длина сообщения","error-privacy.restricted":"Вы не можете писать людям, которых нет у Вас в контактах","error-proto.ver":"Версия протокола не поддерживается","error-proto.cmd":"Некорректное значение команды","error-proto.opcode":"Неизвестная команда","error-proto.state":"Команда недопустима в текущем состоянии сесии","error-proto.payload":"Некорректный формат отправленных данных","error-service.unavailable":"Сервис временно недоступен. Повторите попытку позже.","error-service.timeout":"Превышено время ожидания. Повторите попытку позже.","error-internal":"Внутренняя ошибка сервера. Подробности в атрибуте message.","dnd-description":"Отпустите, чтобы добавить фото или видео","join-chat":{name:"type",values:{CHAT:"Присоединиться",CHANNEL:"Подписаться"}},"leave-chat":["Выйти из ",{name:"type",values:{CHAT:"чата",CHANNEL:"канала"}}],"welcome-message":"Пожалуйста, выберите чат",search:"Поиск","forward-messages":["Переслать ",{name:"count"}," ",{name:"count",func:"plural",values:["сообщение","сообщения","сообщений"]}],"user-picker-label":"Добавить:","user-picker-placeholder":"Начните печатать","forward-picker-label":"Кому:","forward-picker-placeholder":"Начните печатать","contact-picker-placeholder":"Поиск по контактам","remove-participant-confirm-header":"Удаление участника чата","remove-participant-confirm-body":[{name:"user"}," будет ",{name:"gender",values:["","удален","удалена"]}," из чата. Вы уверены?"],"remove-participant-confirm-button":"Удалить","onboarding-title":"ТамТам","write-to-friends":"Написать друзьям","show-all-contacts":"Все","find-channels":"Найдите то, что вам понравится:","empty-chats-list":"Чатов пока еще нет","unblock-user-confirm-header":"Разблокировать","unblock-user-confirm-body":["Вы уверены, что хотите разблокировать ",{name:"user"},"?"],"unblock-user-confirm-button":"Да","unblock-user-cancel-button":"Нет","join-chat-confirm-header":"Подтверждение","join-chat-confirm-body":["Присоединиться к приватному ",{name:"type",values:{CHAT:"чату",CHANNEL:"каналу"}}," ",{name:"name"},"?"],"join-chat-confirm-button":"Присоединиться","leave-chat-confirm-header":["Выйти из ",{name:"type",values:{CHAT:"чата",CHANNEL:"канала"}}],"leave-chat-confirm-body":["Вы хотите выйти из этого ",{name:"type",values:{CHAT:"чата",CHANNEL:"канала"}},"?"],"leave-chat-confirm-button":"Выйти"})),Wc=function(e){var t=e.settings;if(!t)return!0;var n=t.dontDisturbUntil;return 0===n||-1!==n&&n<Date.now()},Kc={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"x","ц":"c","ч":"ch","ш":"sh","щ":"sсh","ъ":"","ы":"y","ь":"'","э":"e","ю":"u","я":"ya"},Yc=Object.assign({},Kc,_o(Kc)),Zc={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"Х","]":"ъ","}":"Ъ","|":"/","`":"ё","~":"Ё",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"Ж","'":"э",'"':"Э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"Б",".":"ю",">":"Ю","/":".","?":",","@":'"',"#":"№",$:";","^":":","&":"?"},Jc=Object.assign({},Zc,_o(Zc)),Qc=function(e){if(!e)return e;var t=[];return e.split("").forEach(function(e){t.push(Jc[e])}),t.join("")},Xc=function(e){this.original="",this.update(e)},el={isEmpty:{},highlights:{}};el.isEmpty.get=function(){return!this.normalized},el.highlights.get=function(){return this._highlights},Xc.prototype.update=function(e){return void 0===e&&(e=""),this.original!==e&&(this.original=e,this.normalized=go(this.original),this.transliterated=mo(this.original),this.mapped=Qc(this.normalized),this.transliteratedMapped=mo(this.mapped),this._highlights=this.isEmpty?null:[this.normalized,this.transliterated,this.mapped,this.transliteratedMapped],!0)},Xc.prototype.matches=function(e){return!!this.isEmpty||((e=go(e)).includes(this.normalized)||e.includes(this.transliterated)||e.includes(this.mapped)||e.includes(this.transliteratedMapped))},Object.defineProperties(Xc.prototype,el);var tl=function(e,t){this.wrappers=e.map(function(e){var n=t(e);return n=Array.isArray(n)?n.map(function(e){return go(e)}):[go(n)],{item:e,fields:n}})};tl.prototype.search=function(e){var t=new Xc(e);return this.wrappers.map(function(e){return e.fields.some(function(e){return t.matches(e)})&&e.item}).filter(Boolean)};var nl=function(e,t,n,o){this.size=n,this.component=o,this.chats=e instanceof Map?Array.from(e.values()):e,this.contacts=t instanceof Map?Array.from(t.values()):t,this._updateItem=this._updateItem.bind(this),this._createItem=this._createItem.bind(this),this._filterContacts(),this._wrapDataWithType(),this.chatsSearcher=new tl(this.chats,function(e){return e.value.title||e.value.placeholder}),this.contactsSearcher=new tl(this.contacts,function(e){return e.value.names.map(function(e){return e.name})})};nl.prototype.getItems=function(e){return e&&0!==e.length?this.chatsSearcher.search(e).concat(this.contactsSearcher.search(e)):this.chats},nl.prototype.getListOptions=function(){return{create:this._createItem,update:this._updateItem,getId:this._getItemId,avgHeight:62,alignBottom:!1,batchSize:35}},nl.prototype.getToken=function(e){return"contact"===e.type?{itemId:e.id,id:e.value.id,caption:e.value.name,url:e.value.avatarUrl}:{itemId:e.id,id:e.value.id,caption:e.value.title||e.value.placeholder,url:vo(e.value)}},nl.prototype.getClosestElementId=function(e){var t=e.target.closest("ok-chat-picker-list-item");if(t)return"chat-"+t.getAttribute("chat").id;var n=e.target.closest("ok-user-picker-list-item");return n?"contact-"+n.getAttribute("user").id:null},nl.prototype._getItemId=function(e){return e.item.id},nl.prototype._updateItem=function(e,t){var n=t.firstChild;"contact"===e.item.type?n.setAttribute("user",e.item.value):n.setAttribute("chat",e.item.value),n.setAttribute("highlights",e.highlights),n.setAttribute("selected",e.selected),n.setAttribute("disabled",e.disabled),n.setAttribute("avatar-size",this.size),n.classList.toggle("active",e.active),n.render&&n.render(!0)},nl.prototype._createItem=function(e,t){t.appendChild(this._createElement(e)),this._updateItem(e,t),this.component&&this.component.scopeStyle(t)},nl.prototype._createElement=function(e){return"contact"===e.item.type?document.createElement("ok-user-picker-list-item"):document.createElement("ok-chat-picker-list-item")},nl.prototype._filterContacts=function(){var e=new Set;this.chats.forEach(function(t){"DIALOG"===t.type&&t.participants.forEach(function(t){return e.add(t.user.id)})});var t=[];this.contacts.forEach(function(n){e.has(n.id)||t.push(n)}),this.contacts=t},nl.prototype._wrapDataWithType=function(){this.chats=this.chats.map(function(e){return{id:"chat-"+e.id,type:"chat",value:e}}),this.contacts=this.contacts.map(function(e){return{id:"contact-"+e.id,type:"contact",value:e}})};var ol=function(e){var t=this,n=document.querySelector('meta[role="app-icon"]');this.favicon=document.head.querySelector("link[rel*=icon]"),this.originalTitle=document.title,this.originalFavicon=this.favicon.href,this.unreadFavicon=this.favicon.getAttribute("data-unread-url"),this._sound=document.createElement("audio"),this._sound.src=document.querySelector('link[role="notification-sound"]').href,this.component=e,this._messageMarks=null,this._config={},this.unreadChats=0,this.unreadMessages=0,this._notificationIcon=n&&n.getAttribute("content"),this._windowFocused=!0,window.addEventListener("focus",function(){return t._windowFocused=!0}),window.addEventListener("blur",function(){return t._windowFocused=!1})};ol.prototype.emit=function(e,t){this.component.emit(e,t)},ol.prototype.update=function(e){var t=this;if(!e)return this._messageMarks=null,this._config={},void(this.unreadChats=this.unreadMessages=0);this._config=e.config,this._messageMarks?Do(e.chats,this._messageMarks).forEach(function(n){t.showNewMessageNotification(n,e.chats.get(n.chatId)),t.emit("new-message",n)}):this._messageMarks=Mo(e.chats),this.updateUnreadChats(ho(e.chats)),this.updateUnreadMessages(po(e.chats))},ol.prototype.showNewMessageNotification=function(e,t){this._windowFocused||Co(e)||!Wc(t)||this.showNotification(e.chatTitle,{messageId:e.uid,chatId:e.chatId,icon:vo(t)||this._notificationIcon||"",body:xo(e,t)})},ol.prototype.showNotification=function(e,t){var n=this;this._config.notificationsEnabled&&(new Notification(e,Object.assign({},t,{silent:!0})).addEventListener("click",function(){return n.emit("notification-clicked",{title:e,options:t})}),this._sound.play())},ol.prototype.updateUnreadChats=function(e){e!==this.unreadChats&&(this.unreadChats=e,this.updateTitle(e),this.emit("unread-chats-count-update",e))},ol.prototype.updateUnreadMessages=function(e){e!==this.unreadMessages&&(this.unreadMessages=e,this.emit("unread-messages-count-update",e))},ol.prototype.updateTitle=function(e){e?(document.title=ro("unread-chats-count",{count:e}),this.favicon.href=this.unreadFavicon):(document.title=this.originalTitle,this.favicon.href=this.originalFavicon)};var sl=function(e,t){var n=this;t=Object.assign({},{url:"/version.json",timeout:3e5},t),this.component=e,this._timer=null,this._disposed=!1,this.version=null;var o=function(){fetch(jo(t.url)).then(function(e){return e.json()}).then(function(t){n.version&&!yo(n.version,t)&&e.emit("new-version-available",t),n.version=t}).catch(function(e){return console.warn("Error while checking for new app version:",e)}).then(function(){clearTimeout(n._timer),n._disposed||(n._timer=setTimeout(o,t.timeout))})};o()};sl.prototype.dispose=function(){this._disposed=!0,clearTimeout(this._timer)};var il,rl,al=!0,cl=!0;void 0!==document.hidden?(il="hidden",rl="visibilitychange"):void 0!==document.msHidden?(il="msHidden",rl="msvisibilitychange"):void 0!==document.webkitHidden&&(il="webkitHidden",rl="webkitvisibilitychange"),void 0!==document[il]&&document.addEventListener(rl,function(){al=!document[il]},!1),window.addEventListener("focus",function(){return cl=!0}),window.addEventListener("blur",function(){return cl=!1});var ll,ul=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-messenger",function(e){var t={url:{type:"string",value:"/websocket"}},n=function(){var e={class:"__8hbis1"};return function(t){t.variable("model",t.get(["state","model"])),"authorized"!=t.get("$model","auth","state")?(t.open(0,"ok-auth",{model:t.get("$model","auth"),class:"__8hbis1"}),t.close()):(t.open(1,"ok-messenger-page",{model:t.get("$model"),"requires-update":t.get(["state","requires-update"]),class:"__8hbis1"}),t.close()),t.open(2,"slot",e),t.close(),t.get(["state","confirmParams"])&&(t.open(3,"ok-confirm",{header:t.get(["state","confirmParams"],"header"),body:t.get(["state","confirmParams"],"body"),buttons:t.get(["state","confirmParams"],"buttons"),class:"__8hbis1"}),t.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},version:{},app:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"8hbis1"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"log-screen":function(e,t){t.app.stats.screen(e.detail)},"log-action":function(e,t){var n=e.detail;"object"!=typeof n?t.app.stats.action(n):t.app.stats.action(n.name,n.value)},authorize:function(e,t){console.log("authorize",e.detail),t.app.authorize(e.detail)},logout:function(e,t){t.app.auth.logout(e.detail)},"update-auth-phone":function(e,t){t.app.auth.updatePhone(e.detail)},"update-profile-name":function(e,t){t.app.auth.updateName(e.detail.name)},"update-profile-photo":function(e,t){t.app.auth.updatePhoto(e.detail.icon)},"request-auth-code":function(e,t){t.app.auth.requestCode()},"confirm-auth-profile":function(e,t){t.app.auth.confirmProfile()},"reset-auth":function(e,t){t.app.auth.reset()},"auth-start-new-profile":function(e,t){t.app.auth.startCreatingNewProfile()},"auth-confirm-new-profile":function(e,t){var n=e.detail,o=n.name,s=n.photo;t.app.auth.confirmCreatingNewProfile(o,s)},"reset-auth-error":function(e,t){t.app.auth.resetError(e.detail)},"fetch-messages":function(e,t){t.app.chat.fetchMessages(e.detail.chatId,e.detail.options)},"select-chat":function(e,t){t.selectChat(e.detail.chatId,e.detail.messagesTime)},"reset-selected-chat":function(e,t){t.app.chat.resetSelectedChat()},"reset-focused-message":function(e,t){t.app.chat.resetFocusedMessage(e.detail)},"new-chat-enter":function(e,t){e.defaultPrevented||t.app.newChat.enter()},"new-chat-exit":function(e,t){e.defaultPrevented||t.app.newChat.exit()},"new-chat-submit":function(e,t){e.defaultPrevented||t.app.newChat.submit()},"new-chat-add-user":function(e,t){t.app.newChat.addUser(e.detail.userId)},"new-chat-remove-user":function(e,t){t.app.newChat.removeUser(e.detail.userId)},"new-chat-set-title":function(e,t){t.app.newChat.setTitle(e.detail.title)},"new-chat-set-icon":function(e,t){t.app.newChat.setIcon(e.detail.icon)},"new-channel-create":function(e,t){t.app.chat.createChannel(e.detail.name,e.detail.icon)},"reset-created-channel":function(e,t){t.app.chat.setCreatedChannel()},"update-posting-message":function(e,t){var n=e.detail,o=n.chatId,s=n.text;t.app.chat.posting(o,s)},"update-share-preview":function(e,t){var n=e.detail,o=n.chatId,s=n.links;t.app.chat.updateSharePreview(o,s)},"update-recent-emoji":function(e,t){t.app.stickers.updateRecentEmoji(e.detail)},"commit-posting-message":function(e,t){if(!e.defaultPrevented){console.log("commit!");var n=e.detail,o=n.chatId,s=n.posting,i=n.notifyDisabled;t.app.chat.commitPosting(o,s,i)}},"attach-files":function(e,t){t.attachFiles(e.detail.chatId,e.detail.files,e.detail.autoUpload)},"remove-attach":function(e,t){var n=e.detail;t.app.chat.removeFile(n.chatId,n.file)},"select-share-preview":function(e,t){var n=e.detail;t.app.chat.selectShare(n.chatId,n.selected)},"remove-share-preview":function(e,t){var n=e.detail.chatId;t.app.chat.removeShares(n)},"send-sticker":function(e,t){var n=e.detail;t.app.chat.sendSticker(n.chatId,n.id),t.app.stickers.updateRecentStickers(n.id)},"reply-message":function(e,t){t.app.chat.replyMessage(e.detail.chatId,e.detail.messageId)},"reset-posting":function(e,t){t.app.chat.resetPosting(e.detail.chatId)},"edit-last-message":function(e,t){t.app.chat.editLastMessage(e.detail.chatId)},"edit-message":function(e,t){t.app.chat.editMessage(e.detail.chatId,e.detail.messageId)},"remove-messages":function(e,t){t.app.chat.removeMessages(e.detail.chatId,e.detail.messageUIDs)},"update-read-mark":function(e,t){t.app.chat.updateReadMark(e.detail.chatId,e.detail.mark)},"load-more-chats":function(e,t){t.app.chat.loadMoreChats()},"update-user-settings":function(e,t){t.app.config.setUserSettings(e.detail)},"select-background":function(e,t){t.app.config.save({background:e.detail.background})},"update-keyboard-behaviour":function(e,t){t.app.config.save({alternativeKeyboardBehaviour:e.detail.alternativeKeyboardBehaviour})},"update-chat-settings":function(e,t){t.app.config.setChatSettings(e.detail.chatId,e.detail.settings)},"join-chat":function(e,t){t.app.chat.join(e.detail)},"reset-join-chat":function(e,t){t.app.chat.resetJoin(e.detail)},"clear-chat":function(e,t){t.app.chat.clear(e.detail.chatId)},"remove-chat":function(e,t){t.app.chat.remove(e.detail.chatId)},"update-chat-title":function(e,t){t.app.chat.setTitle(e.detail.chatId,e.detail.title)},"update-chat-icon":function(e,t){t.app.chat.setIcon(e.detail.chatId,e.detail.icon)},"revoke-link":function(e,t){t.app.chat.revokeLink(e.detail)},"check-chat-link":function(e,t){t.app.chat.checkLink(e.detail.chatId,e.detail.link)},"update-chat":function(e,t){var n=e.detail,o=n.chatId,s=n.theme,i=n.description,r=n.icon,a=n.access,c=n.link,l=n.signAdmin;t.app.chat.updateChat(o,s,i,r,a,c,l)},"update-contact":function(e,t){t.app.contacts.update(e.detail.contactId,e.detail.action)},"unblock-user":function(e,t){t.app.contacts.unblockUser(e.detail)},"show-confirm":function(e,t){t.state.set("confirmParams",e.detail)},"close-confirm":function(e,t){t.state.delete("confirmParams")},"show-media":function(e,t){t.app.chat.showMedia(e.detail.chatId,e.detail.mediaId)},"get-video-url-data":function(e,t){t.app.message.getVideoUrlData(e.detail.chatId,e.detail.messageUid,e.detail.videoId)},"chat-search-touch":function(e,t){t.app.chat.searchTouch(e.detail&&e.detail.chatId)},"chat-search":function(e,t){t.app.chat.search(e.detail.query)},"chat-search-set-context":function(e,t){t.app.chat.setSearchContext(e.detail.type)},"chat-search-reset-context":function(e,t){t.app.chat.setSearchContext()},"chat-search-more":function(e,t){t.app.chat.loadMoreSearchResults()},"chat-search-context-more":function(e,t){t.app.chat.loadMoreSearchContextResults()},"chat-search-reset":function(e,t){t.app.chat.resetSearch()},"chat-search-select-result":function(e,t){t.app.chat.selectSearchResult(e.detail)},"chat-search-select-context-result":function(e,t){t.app.chat.selectSearchContextResult(e.detail)},"message-search":function(e,t){t.app.chat.searchMessages(e.detail.chatId,e.detail.query)},"message-search-more":function(e,t){t.app.chat.loadMoreMessageSearchResults(e.detail.chatId)},"message-search-select-result":function(e,t){t.app.chat.selectMessageSearchResult(e.detail)},"message-search-reset":function(e,t){t.app.chat.resetMessageSearch(e.detail.chatId)},"remove-participant":function(e,t){t.app.chat.removeParticipant(e.detail.chatId,e.detail.userId)},"add-participants":function(e,t){t.app.chat.addParticipants(e.detail.chatId,e.detail.userIds,e.detail.showHistory)},"add-channel-admins":function(e,t){t.app.chat.addChannelAdmin(e.detail.chatId,e.detail.userIds)},"create-chat-from-dialog":function(e,t){t.app.chat.createMultiChatFromDialog(e.detail.chatId,e.detail.userIds)},"open-dialog":function(e,t){t.app.chat.openDialog(e.detail.userId)},"open-channel":function(e,t){t.app.chat.openChannel(e.detail.link,e.detail.chatId,e.detail.time)},"forward-messages":function(e,t){var n=e.detail,o=n.toChatIds,s=n.toContactIds,i=n.fromChatId,r=n.messageIds;t.app.chat.forwardMessages(o,s,i,r)},"update-messages-stats":function(e,t){var n=e.detail,o=n.chatId,s=n.messageUids;t.app.chat.updateMessagesStats(o,s)},"load-chat-members":function(e,t){t.app.chat.loadChatMembers(e.detail.chatId)},"get-black-list":function(e,t){t.app.contacts.fetchBlackList()},"stickers-load-next":function(e,t){t.app.stickers.loadNext()},"sticker-search":function(e,t){t.app.stickers.search(e.detail.query)},"sticker-search-more":function(e,t){t.app.stickers.searchMore()},"sticker-search-reset":function(e,t){t.app.stickers.resetSearch()},"suggest-emoji-stickers":function(e,t){t.app.stickers.suggest(e.detail)},"onboarding-search":function(e,t){t.app.onboarding.search(e.detail)},"onboarding-search-load-more":function(e,t){t.app.onboarding.loadMoreSearchResults()},"apply-update":function(e,t){t.applyUpdate(e.detail)}}},o.prototype.init=function(){var e=this;this.notifier=new ol(this),this.updater=new sl(this),this.on("notification-clicked",function(t){var n=t.detail;n.options&&n.options.chatId&&(window.focus(),e.selectChat(n.options.chatId))}),this.on("set-notifications-allowance",function(t){e.setNotificationsAllowance(t.detail.notificationsEnabled)}),this.on("new-version-available",function(){return e.requiresUpdate("browser")})},s.version.get=function(){return"0.1.31"},o.prototype.connectedCallback=function(){var t=this;if(e.prototype.connectedCallback.call(this),!ll){ll=Yn($o(this.getAttribute("url")),Bo(),{userAgent:ul({},Gc(),{appVersion:this.version})});var n=Uo();n&&(n.chatId?ll.chat.select(n.chatId):ll.chat.openChannel(n.link))}var o=Xn(function(){var e=ll.serialize();e.chats&&(e.chats=e.chats.map(function(e){return ul({},e,{selected:!1})})),e.version=$c,localStorage.setItem("state",JSON.stringify(e))},1e3),s=function(){var e=ll.getState();t.state.set("model",e),t.notifier.update(e),o()},i=Vo(ll),r=ll.subscribe(s);this._dispose=function(){i(),r(),i=r=null},s(),window.onpopstate=function(e){if(e.state){var t=e.state,n=t.chatId,o=t.link;ll.getState().chats.get(n)?ll.chat.select(n):ll.chat.openChannel(o,n)}else ll.chat.resetSelectedChat()},window.onerror=function(e,n,o,s,i){var r=s?"column: "+s:"";return r+=i?"\nerror: "+i+" \n "+i.stack:"",t.app.stats.log.error(e,r),!1}},o.prototype.disconnectedCallback=function(){this._dispose&&(this._dispose(),this._dispose=null)},s.app.get=function(){return ll},o.prototype.getApp=function(){return this.app},o.prototype.setNotificationsAllowance=function(e){this.app.config.save({notificationsEnabled:e})},o.prototype.selectChat=function(e,t){this.app.chat.select(e,t)},o.prototype.requiresUpdate=function(e){var t=this.state.get("requires-update")||[];-1===t.indexOf(e)&&this.state.set("requires-update",t.concat(e)),"browser"!==e||qo()||Wo(this.app.getState().chats)||this.applyUpdate([e])},o.prototype.applyUpdate=function(e){console.log("apply update for context",e),e&&-1!==e.indexOf("browser")&&location.reload()},o.prototype.attachFiles=function(e,t,n){var o=this;Promise.all(t.map(no)).catch(function(e){return console.warn(e),[]}).then(function(s){var i=t.map(function(e,t){return Object.assign(e,s[t])});o.app.chat.addFile(e,i,n)})},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-auth",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"footer __2yd4my"},t={class:"footer_lk __2yd4my"},n={icon:"ok-logo",size:"medium","on-click":"loginWithPassword",class:"__2yd4my"},o={key:"login-via-ok",class:"__2yd4my"};return function(s){s.variable("type",s.get(["state","type"])),s.open(0,"ok-auth-header",{model:s.get("@model"),type:s.get("$type"),class:"__2yd4my"}),s.close(),"OKWEB"==s.get("$type")?(s.open(1,"ok-auth-okweb",{model:s.get("@model"),class:"__2yd4my"}),s.close()):"PASSWORD"==s.get("$type")?(s.open(2,"ok-auth-password",{model:s.get("@model"),class:"__2yd4my"}),s.close()):"PHONE"==s.get("$type")?(s.open(3,"ok-auth-phone",{model:s.get("@model"),class:"__2yd4my"}),s.close()):"CODE"==s.get("$type")?(s.open(4,"ok-auth-code",{model:s.get("@model"),class:"__2yd4my"}),s.close()):"CONFIRM"==s.get("$type")?(s.open(5,"ok-auth-confirm",{model:s.get("@model"),class:"__2yd4my"}),s.close()):"NEW"==s.get("$type")&&(s.open(6,"ok-auth-new",{model:s.get("@model"),photo:s.get(["state","photo"]),class:"__2yd4my"}),s.close()),s.get("@model","recovery","url")&&(s.open(7,"ok-auth-recovery",{url:s.get("@model","recovery","url"),class:"__2yd4my"}),s.close()),"PHONE"!=s.get("$type")&&"CODE"!=s.get("$type")||(s.open(8,"div",e),s.open(9,"span",t),s.open(10,"ok-tico",n),s.open(11,"ok-l10n",o),s.close(),s.close(),s.close(),s.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2yd4my"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"change-auth-type":function(e,t){e.stopPropagation(),t.setType(e.detail)},"reset-auth":function(e,t){e.detail&&t.setType("PHONE")},"update-photo":function(e,t){t.state.set("photo",e.detail.photo)}}},o.prototype.init=function(){this.setType("OKWEB")},o.prototype.attributeChangedCallback=function(e,t){"model"===e&&("OKWEB"!==this.state.get("type")||"idle"!==t.loadState||t.okProfile||this.setType("PHONE"),t.verification&&this.setType("CODE"),"confirm"===t.state&&this.setType("CONFIRM"),"create"===t.state&&this.setType("NEW"))},o.prototype.loginWithPassword=function(e,t){t.setType("PASSWORD")},o.prototype.setType=function(e){this.emit("reset-auth-error"),this.state.set("type",e);var t=this._getScreenName();t&&this.emit("log-screen",t)},o.prototype._getScreenName=function(){switch(this.state.get("type")){case"OKWEB":return"AUTH_OK_PROFILE";case"PASSWORD":return"AUTH_OK_LOGIN";case"PHONE":return"AUTH_PHONE";case"CODE":return"AUTH_CODE";case"CONFIRM":return"AUTH_CONFIRM";case"NEW":return"AUTH_NEW_PROFILE";default:return null}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)});var pl=[],hl=function(e){var t=pl[pl.length-1];if(t){if(t.keyHandler&&t.keyHandler.call(null,e),e.defaultPrevented)return;27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),t.closeFn(),pl.pop(),pl.length||Jo())}},dl=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},fl=/(?:tt.me|tamtam.chat)\/([a-z]+[a-z0-9-_]*)/i;defineComponent("ok-messenger-page",function(e){function t(e,t){var n=e&&Array.from(e.values());if(!n||!n.length)return"";if("CHAT"!==t)return"набирает текст";if(1===n.length)return n[0].name+" набирает текст";if(2===n.length)return n[0].name+" и "+n[1].name+" набирают текст";var o=n.length-2,s=Ko(o,["человек","человека","человек"]);return n[0].name+", "+n[1].name+" и ещё "+o+" "+s+" набирают текст"}var n={model:{type:"json",value:null},"requires-update":{type:"json",value:null}},o=function(){var e={class:"redirect __gjgm1n","on-click":"openTamTamChat"},t={class:"messenger_side __gjgm1n"},n={class:"chats-panel __gjgm1n"},o={class:"chats-panel_top __gjgm1n"},s={class:"chats-panel_top-normal __gjgm1n"},i={type:"settings",shape:"circle","on-click":"openDrawer",class:"__gjgm1n"},r={icon:"burger",size:"medium",class:"__gjgm1n"},a={class:"expanded __gjgm1n"},c={type:"add",shape:"circle",role:"secondary",size:"big","on-click":"onToggleNewChat",class:"__gjgm1n"},l={icon:"plus",size:"medium",class:"__gjgm1n"},u={class:"__gjgm1n"},p={class:"requires-update __gjgm1n","on-click":"onApplyUpdate"},h={class:"requires-update-icon __gjgm1n",title:"Обновить приложение"},d={icon:"reload",size:"medium",class:"__gjgm1n"},f={class:"requires-update-label __gjgm1n"},g={class:"chats-panel_content __gjgm1n"},_={class:"messenger_main __gjgm1n"},m={class:"new-chat_controls __gjgm1n",slot:"posting-form"},v={"on-click":"onExitModalMode",role:"secondary",class:"__gjgm1n"},y={controls:"true",class:"__gjgm1n"},k={slot:"controls",class:"__gjgm1n"},b={shape:"circle","on-click":"toggleSearch",class:"__gjgm1n"},w={shape:"circle","on-click":"openChatInfo",class:"__gjgm1n"},C={icon:"info",size:"medium",class:"__gjgm1n"},E={size:"small","on-click":"openChatInfo",class:"__gjgm1n"},A={slot:"title",class:"__gjgm1n"},T={class:"content __gjgm1n"},S={class:"footer __gjgm1n"},I={class:"dnd-overlay_tx __gjgm1n"},O={icon:"dnd",class:"__gjgm1n"},x={key:"dnd-description",class:"__gjgm1n"};return function(D){D.variable("modal",D.get(["state","modal-mode"])),D.open(0,"ok-drawer",{profile:D.get("@model","auth","profile"),active:"drawer"==D.get("$modal"),"on-close":"onExitModalMode",class:"__gjgm1n"}),D.close(),D.get(["state","test-env"])&&(D.open(1,"span",e),D.setText("Это тестовая среда. Уходите на web.tamtam.chat"),D.close()),D.open(2,"div",t),D.open(3,"div",n),D.open(4,"div",o),D.open(5,"div",s),D.open(6,"ok-button",i),D.open(7,"ok-icon",r),D.close(),D.close(),D.open(8,"div",a),D.open(9,"ok-search-input",{class:"chats-panel_search-input __gjgm1n",value:D.get("@model","search","query"),"on-focusin":"onSearchInputFocus","on-input":"onChatSearch",loading:"loading"==D.get("@model","search","loadState")}),D.close(),D.open(10,"ok-button",c),D.open(11,"ok-icon",l),D.close(),D.close(),D.close(),D.close(),D.close(),D.open(12,"div",{class:"chats-panel_notification __gjgm1n"}),(D.get("@requires-update")||D.get(["state","offline"]))&&(D.addClass("__expanded"),D.get(["state","offline"])?(D.open(13,"ok-connecting-indicator",u),D.close()):D.get("@requires-update")&&(D.open(14,"div",p),D.open(15,"div",h),D.open(16,"ok-icon",d),D.close(),D.close(),D.open(17,"span",f),D.setText("Нажмите, чтобы обновить приложение"),D.close(),D.close())),D.close(),D.open(18,"div",g),D.get("@model","search","loaded")&&(D.open(19,"div",{class:"search-result __gjgm1n"}),D.get("@model","search","context")&&D.addClass("__has-context"),D.open(20,"ok-search-results",{search:D.get("@model","search"),chats:D.get("@model","chats"),class:"__gjgm1n"}),D.close(),D.open(21,"ok-search-context-results",{search:D.get("@model","search","context"),class:"__gjgm1n"}),D.close(),D.close()),D.open(22,"ok-chats-list",{items:D.get("@model","chats"),loaded:D.get("@model","chatsLoaded"),selected:D.get("@model","peekChat","id")||D.get("@model","chats",function(e){return e.get("selected")},"id"),class:"__gjgm1n"}),D.close(),D.close(),D.close(),D.open(23,"div",{class:"overlay __gjgm1n","on-click":"onExitModalMode"}),D.get("$modal")&&"chat-info"!=D.get("$modal")&&D.addClass("__enabled"),D.close(),D.close(),D.open(24,"div",_),D.variable("chat",D.get(["state","curr-chat"])),D.variable("isActiveChat","ACTIVE"==D.get("$chat","status")),D.variable("chatSearch",D.get(["state","chat-search"])),D.open(25,"ok-new-chat",{model:D.get("@model","newChat"),active:"new-chat"==D.get("$modal"),"on-close":"onExitModalMode",class:"__gjgm1n"}),D.open(26,"div",m),D.open(27,"ok-button",{"on-click":"onSubmitNewChat",disabled:!D.get(["count",D.get("@model","newChat","invited")]),role:"primary",class:"__gjgm1n"}),D.setText("Создать чат"),D.close(),D.open(28,"ok-button",v),D.setText("Отменить"),D.close(),D.close(),D.close(),D.open(29,"ok-new-channel",{active:"new-channel"==D.get("$modal"),chat:D.get("@model","createdChannel"),"on-close":"onExitModalMode",class:"__gjgm1n"}),D.close(),D.open(30,"div",{class:"chat-info __gjgm1n"}),D.get("$isActiveChat")&&"chat-info"==D.get("$modal")&&(D.addClass("__enabled"),D.open(31,"ok-chat-info",{chat:D.get("$chat"),contacts:D.get("@model","contacts"),active:"true","on-close":"onExitModalMode",class:"__gjgm1n"}),D.close()),D.close(),D.get(["state","curr-chat"])?(D.variable("isChannel","CHANNEL"==D.get("$chat","type")),D.variable("isChannelVisitor",D.get("$isChannel")&&!D.get("$chat","owner","current")&&!D.get("$chat","admins",function(e){return e.get("current")})),D.variable("isPostingEnabled",D.get("$isActiveChat")&&D.get("$chat","participants","*","user",function(e){return e.get("current")})&&!D.get("$isChannelVisitor")),D.variable("chat",D.get(["state","curr-chat"])),D.open(32,"div",{class:"chat __gjgm1n","on-dragover":null,"on-dragenter":null,"on-dragleave":null,"on-dragend":null,"on-drop":null}),D.get("$isPostingEnabled")&&(D.attr("on-dragover","onChatDragEnter"),D.attr("on-dragenter","onChatDragEnter"),D.attr("on-dragleave","onChatDragEnd"),D.attr("on-dragend","onChatDragEnd"),D.attr("on-drop","onChatDrop")),D.open(33,"ok-toolbar",y),D.open(34,"div",k),D.open(35,"ok-button",b),D.open(36,"ok-icon",{icon:"search",size:"medium",class:"__gjgm1n"}),D.get("$chatSearch")&&D.addClass("__active"),D.close(),D.close(),D.get("$isActiveChat")&&(D.open(37,"ok-button",w),D.open(38,"ok-icon",C),D.close(),D.close()),D.close(),D.open(39,"ok-chat-item-container",E),D.variable("participants",D.get("$chat","participants","*","user")),D.variable("opponent",D.get("$chat","participants","*","user",function(e){return!e.get("current")},0)),"DIALOG"==D.get("$chat","type")?(D.open(40,"ok-user-card",{slot:"image",size:"small",user:D.get("$opponent"),class:"__gjgm1n"}),D.close()):(D.open(41,"ok-avatar",{slot:"image",url:D.get("$chat","iconUrl"),id:D.get("$chat","id"),caption:D.get("$chat","title")||D.get("$chat","placeholder"),size:"small",class:"__gjgm1n"}),D.close()),D.open(42,"span",A),D.open(43,"ok-chat-title",u),D.setText(D.get("$chat","title")||D.get("$chat","placeholder")),D.close(),D.close(),D.open(44,"ok-chat-meta",{chat:D.get("$chat"),class:"__gjgm1n"}),D.close(),D.close(),D.close(),D.variable("selectedIds",D.get(["state","selected-messages"])),D.variable("selected",D.get("$chat","messages","*",function(e){return e.get("$selectedIds")&&e.get("$selectedIds",["has",e.get("uid")])})),D.open(45,"ok-chat-messages-controls",{messages:D.get("$selected"),"posting-enabled":D.get("$isPostingEnabled"),class:"__gjgm1n"}),D.get(["count",D.get("$selected")])>0&&D.addClass("__active"),D.close(),D.open(46,"ok-search-input",{class:"chat_search-input __gjgm1n",value:D.get("$chat","search","query"),placeholder:"Поиск по сообщениям","on-input":"onSearchMessages",loading:"loading"==D.get("$chat","search","loadState"),focused:null}),(D.get("$chatSearch")||D.get("$chat","search"))&&D.addClass("__active"),D.get("$chatSearch")&&D.attr("focused","true"),D.close(),D.open(47,"div",T),D.get("$chat","search")?(D.open(48,"ok-message-search-results",{chat:D.get("$chat"),class:"__gjgm1n"}),D.close()):D.get(["count",D.get("$chat","messages")])>0&&(D.open(49,"ok-message-list",{chat:D.get("$chat"),selected:D.get("$selectedIds"),highlighted:D.get(["state","highlighted-message"]),"multi-mode":D.get(["count",D.get("$selected")])>0,"show-rm-limits":D.get("@model","config","server","show-rm-limits"),class:"__gjgm1n"}),D.close(),D.open(50,"div",{class:"typing __gjgm1n"}),D.get("$chat","typingParticipants")||D.addClass("__paused"),D.get(["state","typing-label"])&&(D.open(51,"ok-typing-indicator",{"hide-text":D.get(["state","hide-typing-text"]),paused:!D.get("$chat","typingParticipants"),class:"__gjgm1n"}),D.setText(D.get(["state","typing-label"])),D.close()),D.close()),D.close(),D.get("$chat","search")||(D.get("$isPostingEnabled")?(D.open(53,"div",S),D.open(54,"ok-posting-form",{"chat-id":D.get("$chat","id"),data:D.get("$chat","posting"),"show-notify-control":D.get("$isChannel"),"auto-focus":!D.get("$chatSearch"),assets:D.get("@model","assets"),"alternative-behaviour":D.get("@model","config","alternativeKeyboardBehaviour"),"popular-queries":D.get("@model","config","server","stickers-suggestion-keywords"),class:"__gjgm1n"}),D.close(),D.close(),D.open(55,"div",{class:"dnd-overlay __gjgm1n"}),D.get(["state","dnd-process"])&&D.addClass("__enabled"),D.open(56,"div",I),D.open(57,"ok-icon",O),D.close(),D.open(58,"ok-l10n",x),D.close(),D.close(),D.close()):(D.open(52,"ok-chat-actions",{chat:D.get("$chat"),class:"__gjgm1n"}),D.close())),D.close()):(D.open(59,"ok-onboarding",{model:D.get("@model","onboarding"),class:"__gjgm1n"}),D.close()),D.variable("forward",D.get(["state","forward-messages"])),D.open(60,"ok-forward-form",{chats:D.get("@model","chats"),contacts:D.get("@model","contacts"),"messages-ids":D.get("$forward","messageIds"),"chat-id":D.get("$forward","chatId"),"on-close":"onExitModalMode",active:"forward-messages"==D.get("$modal"),class:"__gjgm1n"}),D.close(),D.variable("own-contacts",D.get("@model","contacts","*",function(e){return e.get("own")&&!e.get("current")})),D.open(61,"ok-contacts",{contacts:D.get("$own-contacts"),"on-close":"onExitModalMode",active:"view-contacts"==D.get("$modal"),class:"__gjgm1n"}),D.close(),D.open(62,"ok-settings",{config:D.get("@model","config"),profile:D.get("@model","auth","profile"),"black-list":D.get("@model","blackList"),"on-close":"onExitModalMode",active:"view-settings"==D.get("$modal"),class:"__gjgm1n"}),D.get(["state","blink-modal"])&&D.addClass("__blink"),D.close(),D.get(["state","toast"])&&(D.open(63,"ok-toast",{text:D.get(["state","toast"]),align:"bottom",class:"__gjgm1n"}),D.close()),D.close(),D.get(["state","media-request"])&&D.get(["state","chat-media"])&&(D.open(64,"ok-media-layer",{chat:D.get(["state","chat-media"]),class:"__gjgm1n"}),D.close()),D.get(["state","chat-read-participants"])&&(D.open(65,"ok-chat-read-participants",{participants:D.get(["state","chat-read-participants"]),total:D.get(["state","curr-chat"],"participants"),class:"__gjgm1n"}),D.close())}}();return function(e){function s(t){return t=e.call(this,t)}e&&(s.__proto__=e),(s.prototype=Object.create(e&&e.prototype)).constructor=s;var i={__production:{},hash:{},modelDefinition:{},template:{}},r={events:{}};return i.__production.get=function(){return!0},i.hash.get=function(){return"gjgm1n"},i.modelDefinition.get=function(){return n},i.template.get=function(){return o},s.prototype.init=function(){var e=this;this.addEventListener("click",function(t){var n=t.target;if("A"===n.tagName){var o=n.href.match(fl);o&&(t.preventDefault(),e.emit("open-channel",{link:o.input}))}}),this._offlineTimer=null,this._wasOnline=!1,this.state.set("test-env",-1!==window.location.host.indexOf("msg.ok.ru"))},s.prototype.attributeChangedCallback=function(e,n){var o=this;if("model"===e&&n){var s=n.peekChat||this._getCurrentChat(n.chats),i=this.state.get("curr-chat");this.state.set("curr-chat",s),!i||s&&i.id===s.id||this.resetState(),s?Qo(this,function(){o.state.get("chat-search")||o.state.get("selected-messages")?o.resetState():o.emit("reset-selected-chat")}):Xo(this),n.online?this._setOnline():this._setOffline(),(s&&s.id)!==(i&&i.id)&&(Fo(s),s&&this.emit("log-screen",s.type)),s&&s.typingParticipants&&this.state.set("typing-label",t(s.typingParticipants,s.type));var r=this.state.get("media-request");if(r){var a=this._getChat(n,r.chatId);a?this.state.set("chat-media",a):console.warn("Отсутствует чат по ID "+r.chatId)}if(n.joinChat&&n.joinChat.chat){var c=n.joinChat.chat;this.emit("show-confirm",{header:ro("join-chat-confirm-header"),body:ro("join-chat-confirm-body",{type:c.type,name:c.title}),buttons:[{label:ro("join-chat-confirm-button"),action:function(){return o.emit("join-chat",c.link)}},ro("confirm-cancel-button")]}),this.emit("reset-join-chat")}}},r.events.get=function(){return{"open-dialog":function(e,t){t.resetState()},"select-chat":function(e,t){var n=this.state.get("curr-chat");n&&n.id!==e.detail.chatId&&t.resetState()},"select-background":function(e,t){t.blinkSettings()},"new-chat-enter":function(e,t){e.stopPropagation(),t.enterNewChat()},"new-chat-submit":function(e,t){e.stopPropagation(),t.submitNewChat()},"new-channel-enter":function(e,t){e.stopPropagation(),t.closeChatSearch(),t.enterModalMode("new-channel"),t.emit("log-screen","CHANNEL_CREATE")},"commit-posting-message":function(e,t){t.resetSelectedMessages()},"send-sticker":function(e,t){t.resetSelectedMessages()},"forward-messages-enter":function(e,t){e.stopPropagation(),t.enterModalMode("forward-messages"),t.state.set("forward-messages",{chatId:t.state.get("curr-chat").id,messageIds:e.detail})},"forward-messages":function(e,t){t.resetSelectedMessages(),t.exitModalMode()},"contacts-enter":function(e,t){t.closeChatSearch(),t.enterModalMode("view-contacts"),t.emit("log-screen","CONTACTS")},"settings-enter":function(e,t){t.closeChatSearch(),t.enterModalMode("view-settings"),t.emit("log-screen","SETTINGS")},"homepage-enter":function(e,t){Fo(),t.resetState(),t.emit("reset-selected-chat")},"show-media":function(e,t){e.stopPropagation();var n={chatId:t.state.get("curr-chat").id,mediaId:e.detail.mediaId};t.emit("show-media",n),t.state.set("media-request",n)},"get-video-url-data":function(e,t){e.stopPropagation(),t.emit("get-video-url-data",dl({},e.detail,{chatId:t.state.get("curr-chat").id}))},"close-media":function(e,t){t.state.delete("media-request"),t.state.delete("chat-media")},"open-chat-read-participants-for-message":function(e,t){var n=e.detail,o=t.state.get("curr-chat"),s=o.messages.get(n);if(s){var i=o.participants.filter(function(e){return e.time>=s.time});t.state.set("chat-read-participants",i)}},"open-chat-read-participants":function(e,t){t.state.set("chat-read-participants",e.detail)},"close-chat-read-participants":function(e,t){t.state.delete("chat-read-participants")},"message-list-display":function(e,t){t.handleDisplayedMessages(e.detail)},"reply-message":function(e,t){e.stopPropagation(),t.resetSelectedMessages(),t.replyMessage(e.detail)},"edit-message":function(e,t){e.stopPropagation(),t.resetSelectedMessages(),t.editMessage(e.detail)},"remove-messages":function(e,t){e.stopPropagation(),t.removeMessages(e.detail)},"message-search-more":function(e,t){e.stopPropagation();var n=t.state.get("curr-chat").id;t.emit("message-search-more",{chatId:n})},"message-search-select-result":function(e,t){var n=e.detail;t.resetSearchMessages(n.chatId),t.highlightMessage(e.detail.message.time,e.detail.message.id)},"highlight-message":function(e,t){e.stopPropagation(),t.highlightMessage(e.detail.messageTime,e.detail.messageId)},"highlight-message-end":function(e,t){e.stopPropagation(),t.resetHighlightMessage()},"select-message":function(e,t){e.stopPropagation(),t.selectMessage(e.detail.messageUid)},"unselect-message":function(e,t){e.stopPropagation(),t.unselectMessage(e.detail.messageUid)},"reset-selected-messages":function(e,t){e.stopPropagation(),t.resetSelectedMessages()},"show-toast":function(e,t){t.state.set("toast",e.detail)},"close-toast":function(e,t){t.state.delete("toast")},"remove-participant":function(e,t){e.stopPropagation(),t.emit("remove-participant",{chatId:t.state.get("curr-chat").id,userId:e.detail})},"hide-typing-text":function(e,t){e.stopPropagation(),t.state.set("hide-typing-text",e.detail)},dragenter:function(e){e.stopPropagation(),e.preventDefault()},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){e.stopPropagation(),e.preventDefault()}}},s.prototype.resetState=function(){this.exitModalMode(),this.closeChatSearch(),this.resetSelectedMessages()},s.prototype.openTamTamChat=function(){window.location.href="https://web.tamtam.chat/?c=b2a6b5"},s.prototype.onExitModalMode=function(e,t){t.exitModalMode()},s.prototype.exitModalMode=function(){var e=this;"new-chat"===this.state.get("modal-mode")?this.exitNewChat().then(function(){return e.state.delete("modal-mode")}).catch(function(){}):this.state.delete("modal-mode")},s.prototype.enterModalMode=function(e){this.state.set("modal-mode",e)},s.prototype._blinkModalOn=function(){clearTimeout(this._blinkTimeout),this.state.set("blink-modal",Date.now())},s.prototype._blinkModalOff=function(){var e=this;this._blinkTimeout=setTimeout(function(){return e.state.delete("blink-modal")},Math.max(0,500-(Date.now()-this.state.get("blink-modal"))))},s.prototype.blinkSettings=function(){var e=this;this._blinkModalOn();var t=function(){document.removeEventListener("mouseup",t),e._blinkModalOff()};document.addEventListener("mouseup",t)},s.prototype.onToggleNewChat=function(e,t){t.toggleNewChat()},s.prototype.toggleNewChat=function(){"new-chat"===this.state.get("modal-mode")?this.exitModalMode():this.enterNewChat()},s.prototype.enterNewChat=function(){this.closeChatSearch(),this.enterModalMode("new-chat"),this.emit("new-chat-enter"),this.emit("log-screen","CHAT_CREATE")},s.prototype.exitNewChat=function(){var e=this;return new Promise(function(t,n){e.hasInvitedNewChatMembers()?e.emit("show-confirm",{header:"Создание чата",body:"Вы добавили пользователей, но еще не создали чат. Уверены, что хотите выйти?",buttons:[{label:"Выйти",action:t},{label:"Отменить",action:n}]}):t()}).then(function(){return e.emit("new-chat-exit")})},s.prototype.onSubmitNewChat=function(e,t){t.submitNewChat()},s.prototype.submitNewChat=function(){this.hasInvitedNewChatMembers()&&(this.state.delete("modal-mode"),this.emit("new-chat-submit"))},s.prototype.hasInvitedNewChatMembers=function(){var e=this.getAttribute("model"),t=e&&e.newChat&&e.newChat.invited;return t&&(t.size||t.length)},s.prototype.onSearchInputFocus=function(e,t){t.emit("chat-search-touch")},s.prototype.onChatSearch=function(e,t){t.emit("chat-search",{query:this.value})},s.prototype.onChatDragEnter=function(e,t){e.stopPropagation(),e.preventDefault(),t.state.set("dnd-process",!0)},s.prototype.onChatDragEnd=function(e,t){e.stopPropagation(),e.preventDefault(),t.state.set("dnd-process",!1)},s.prototype.onChatDrop=function(e,t){e.stopPropagation(),e.preventDefault(),t.state.set("dnd-process",!1);var n=t.componentView.querySelector("ok-posting-form"),o=e.dataTransfer.files;if(n&&o&&o.length){for(var s=[],i=0;i<o.length;i++)s.push(o[i]);n.attachFiles(s)}},s.prototype.selectMessage=function(e){var t,n=this.state.get("selected-messages");(t=n?new Set(n):new Set).add(e),this._setSelectedMessages(t)},s.prototype.unselectMessage=function(e){var t=this.state.get("selected-messages");t&&t.delete(e)&&this._setSelectedMessages(new Set(t))},s.prototype.resetSelectedMessages=function(){this.state.delete("selected-messages")},s.prototype.highlightMessage=function(e,t){var n=this.state.get("curr-chat");this.emit("select-chat",{chatId:n.id,messagesTime:e}),this.state.set("highlighted-message",t)},s.prototype.resetHighlightMessage=function(){var e=this.state.get("curr-chat");this.emit("reset-focused-message",e.id),this.state.delete("highlighted-message")},s.prototype.handleDisplayedMessages=function(e){var t=this;this._markAsReadTimer&&clearTimeout(this._markAsReadTimer),this._markAsReadTimer=setTimeout(function(){e.items.forEach(function(e){return t.markAsRead(e.item.data)})},1e3)},s.prototype.markAsRead=function(e){e.wasRead||e.isDelimiter||this.emit("message-was-read",{chatId:this.model.get("chat").data.id,message:e})},s.prototype.replyMessage=function(e){this.emit("reply-message",{chatId:this.state.get("curr-chat").id,messageId:e})},s.prototype.editMessage=function(e){this.emit("edit-message",{chatId:this.state.get("curr-chat").id,messageId:e})},s.prototype.removeMessages=function(e){var t=this;e.forEach(function(e){return t.unselectMessage(e)}),this.emit("remove-messages",{chatId:this.state.get("curr-chat").id,messageUIDs:e})},s.prototype.openDrawer=function(e,t){t.enterModalMode("drawer"),t.emit("log-screen","DRAWER")},s.prototype.openChatInfo=function(e,t){t.enterModalMode("chat-info");var n=t.state.get("curr-chat");n&&t.emit("log-screen",n.type+"_PROFILE")},s.prototype.toggleSearch=function(e,t){var n=t.state.get("curr-chat"),o=n?n.id:null;if(t.state.get("chat-search"))t.resetSearchMessages(o);else{t.state.set("chat-search",!0);var s=t.componentView.querySelector(".chat_search-input");s&&s.focus(),t.emit("chat-search-touch",{chatId:o})}},s.prototype.closeChatSearch=function(){this.state.delete("chat-search")},s.prototype.onSearchMessages=function(e,t){var n=t.state.get("curr-chat").id,o=e.target.value;t.searchMessages(n,o)},s.prototype.searchMessages=function(e,t){this.emit("message-search",{chatId:e,query:t})},s.prototype.resetSearchMessages=function(e){this.state.get("chat-search")&&this.closeChatSearch(),this.emit("message-search-reset",{chatId:e})},s.prototype.applyUpdate=function(){this.emit("apply-update",this.getAttribute("requires-update"))},s.prototype.onApplyUpdate=function(e,t){t.applyUpdate()},s.prototype._setOnline=function(){clearTimeout(this._offlineTimer),this._offlineTimer=null,this._wasOnline=!0,this.state.set("offline",!1)},s.prototype._setOffline=function(){var e=this;if(!this._offlineTimer){var t=this._wasOnline?5e3:1500;this._offlineTimer=setTimeout(function(){return e.state.set("offline",!0)},t)}},s.prototype._setSelectedMessages=function(e){this.state.set("selected-messages",e)},s.prototype._getCurrentChat=function(e){var t=null;return e&&e.forEach(function(e){!t&&e.selected&&(t=e)}),t},s.prototype._getChat=function(e,t){return e.peekChat&&e.peekChat.id===t?e.peekChat:e.chats&&e.chats.get(t)},Object.defineProperties(s.prototype,i),Object.defineProperties(s,r),s}(e)}),defineComponent("ok-reconnect",function(e){var t={online:{type:"boolean",value:!0}},n=function(){var e={class:"reconnect_cnt __8f7o3t"},t={class:"__8f7o3t"},n={class:"progress __8f7o3t"},o={class:"progress_i __8f7o3t"};return function(s){s.open(0,"div",{class:"reconnect_w __8f7o3t"}),s.get("@online")||s.addClass("__show"),s.open(1,"div",e),s.open(2,"slot",t),s.close(),s.open(3,"div",n),s.open(4,"span",o),s.close(),s.close(),s.close(),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"8f7o3t"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var gl=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-confirm",function(e){var t={header:{type:"string",value:""},body:{type:"string",value:""},buttons:{type:"json",value:null}},n=function(){var e={class:"__5v629i"},t={slot:"header",class:"__5v629i"},n={slot:"body",class:"__5v629i"},o={slot:"buttons",class:"__5v629i"},s=function(e){e.open(0,"ok-button",{role:e.get("self","role"),shape:"square","on-click":"performAction","data-idx":e.get("self","idx"),class:"__5v629i"}),e.setText(e.get("self","label")),e.close()};return function(i){i.open(0,"ok-layer",e),i.open(1,"div",t),i.setText(i.get("@header")),i.close(),i.open(2,"div",n),i.setText(i.get("@body")),i.close(),i.open(3,"div",o),i.iterate(4,i.get(["state","buttons"]),s),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"5v629i"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),document.body.addEventListener("keyup",this)},o.prototype.disconnectedCallback=function(){document.body.removeEventListener("keyup",this),e.prototype.disconnectedCallback.call(this)},o.prototype.attributeChangedCallback=function(e,t){if("buttons"===e){var n=[];t.forEach(function(e,t){var o;(o="string"==typeof e?{idx:t,label:e}:gl({idx:t},e)).role||(o.role=t>0?"secondary":"primary"),n.push(o)}),this.state.set("buttons",n)}},o.prototype.close=function(e,t){t.emitClose()},o.prototype.performAction=function(e,t){var n=parseInt(this.getAttribute("data-idx"),10)||0,o=t.state.get("buttons")[n];console.log("performAction",n,o),o.action&&o.action(),t.emitClose()},o.prototype.handleEvent=function(e){13===e.keyCode&&this.doConfirm()},o.prototype.doConfirm=function(){var e=this.getAttribute("buttons")[0];e.action&&e.action(),this.emitClose()},o.prototype.emitClose=function(){this.emit("close-confirm")},i.events.get=function(){return{"close-layer":function(e,t){t.emitClose()}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)});defineComponent("ok-toast",function(e){var t={text:{type:"string",value:""},align:{type:"string",value:"top"},fixed:{type:"boolean",value:!1},delay:{type:"boolean",value:!1}},n=function(e){e.addText(0,e.get("@text"))};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3vj3g3"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.didRender=function(){var e=this.getAttribute("delay")?7e3:2e3;clearTimeout(this._timeout),this._timeout=setTimeout(this._hideToast.bind(this),e)},o.prototype._hideToast=function(){var e=this;this.classList.add("__closing"),this.addEventListener("animationend",function(){return e.emit("close-toast")})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-header",function(e){var t={type:{type:"string",value:"PHONE"},model:{type:"json",value:null}},n=function(){var e={class:"layers __awiy4w"},t={class:"layer __1 __awiy4w"},n={class:"smile __1 __awiy4w"},o={class:"smile __6 __awiy4w"},s={class:"smile __ok __8 __awiy4w"},i={class:"layer __2 __awiy4w"},r={class:"smile __2 __awiy4w"},a={class:"smile __4 __awiy4w"},c={class:"smile __ok __10 __awiy4w"},l={class:"layer __3 __awiy4w"},u={class:"smile __3 __awiy4w"},p={class:"smile __7 __awiy4w"},h={class:"layer __4 __awiy4w"},d={class:"smile __0 __awiy4w"},f={class:"smile __5 __awiy4w"},g={class:"smile __ok __9 __awiy4w"},_={class:"logo-container __awiy4w"},m={class:"ok-logo __awiy4w"},v={class:"tamtam-logo-shape __awiy4w",width:"68",height:"74",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 68 74"},y={stroke:"none",d:"M27.55,66.484 L17.62,73.182 C16.612,73.864 15.792,73.426 15.79,72.214 L15.77,61.521 C6.846,55.521 0.965,45.281 0.94,33.661 C0.902,15.11 15.802,0.04 34.23,0 C52.65,-0.034 67.62,14.97 67.658,33.52 C67.695,52.07 52.785,67.133 34.368,67.173 C32.032,67.177 29.752,66.94 27.551,66.483 L27.55,66.484 Z M49.551,34.609 L19.061,34.669 C19.081,43.139 25.921,49.978 34.341,49.989 C42.761,50 49.571,43.1399982 49.561,34.6699982 L49.551,34.609 Z",class:"__awiy4w"},k={class:"tamtam-logo-caption __awiy4w",width:"124",height:"27",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 124 27"},b={d:"M7.91,25.96 C7.66,25.96 7.457,25.756 7.457,25.51 L7.457,5.51 L0.63,5.51 C0.38,5.51 0.178,5.31 0.178,5.06 L0.178,0.65 C0.178,0.4 0.38,0.2 0.63,0.2 L20.504,0.2 C20.754,0.2 20.956,0.4 20.956,0.65 L20.956,5.06 C20.956,5.31 20.753,5.51 20.504,5.51 L13.678,5.51 L13.678,25.51 C13.678,25.76 13.475,25.96 13.226,25.96 L7.906,25.96 L7.91,25.96 Z M30.325,18.065 C29.671,18.065 29.009,18.095 28.341,18.155 C27.671,18.215 27.071,18.331 26.561,18.498 C26.041,18.668 25.601,18.918 25.261,19.248 C24.921,19.578 24.751,19.995 24.751,20.538 C24.751,20.881 24.831,21.174 24.991,21.411 C25.151,21.661 25.351,21.851 25.591,22.001 C25.841,22.151 26.111,22.251 26.431,22.311 C26.751,22.381 27.051,22.411 27.351,22.411 C28.561,22.411 29.491,22.071 30.141,21.411 C30.781,20.751 31.111,19.841 31.111,18.701 L31.111,18.081 L30.341,18.081 L30.325,18.065 Z M25.849,26.395 C25.119,26.395 24.369,26.299 23.589,26.103 C22.809,25.913 22.099,25.593 21.459,25.163 C20.809,24.723 20.279,24.133 19.869,23.413 C19.459,22.686 19.249,21.783 19.249,20.723 C19.249,19.399 19.599,18.365 20.319,17.556 C21.029,16.756 21.959,16.133 23.079,15.696 C24.209,15.263 25.479,14.97 26.849,14.826 C28.209,14.681 29.569,14.606 30.889,14.606 L30.889,14.316 C30.889,13.409 30.579,12.762 29.939,12.331 C29.309,11.911 28.529,11.701 27.609,11.701 C26.769,11.701 25.939,11.891 25.149,12.251 C24.499,12.551 23.929,12.901 23.449,13.291 C23.359,13.361 23.259,13.391 23.169,13.391 C23.039,13.391 22.919,13.351 22.829,13.251 L20.411,10.671 C20.323,10.581 20.281,10.461 20.291,10.341 C20.294,10.221 20.351,10.111 20.443,10.021 C21.425,9.161 22.563,8.501 23.826,8.051 C25.236,7.541 26.698,7.291 28.171,7.291 C29.691,7.291 30.991,7.484 32.045,7.858 C33.095,8.228 33.955,8.818 34.605,9.608 C35.259,10.388 35.745,11.394 36.045,12.588 C36.345,13.782 36.495,15.218 36.495,16.865 L36.495,25.545 C36.495,25.793 36.295,25.995 36.045,25.995 L31.5,25.995 C31.25,25.995 31.05,25.791 31.05,25.543 L31.05,24.071 C30.62,24.771 29.86,25.371 28.846,25.821 C27.906,26.231 26.886,26.441 25.806,26.441 L25.849,26.395 Z M56.259,25.959 C56.009,25.959 55.809,25.749 55.809,25.509 L55.809,16.099 L50.949,22.679 C50.869,22.789 50.729,22.859 50.589,22.859 C50.449,22.859 50.309,22.789 50.229,22.679 L45.369,16.159 L45.369,25.499 C45.369,25.749 45.159,25.949 44.919,25.949 L39.859,25.949 C39.609,25.949 39.399,25.739 39.399,25.499 L39.399,8.279 C39.399,8.029 39.599,7.829 39.849,7.829 L44.429,7.829 C44.569,7.829 44.689,7.889 44.779,7.989 L50.649,15.139 L56.419,7.999 C56.499,7.889 56.629,7.829 56.769,7.829 L61.339,7.829 C61.589,7.829 61.789,8.029 61.789,8.279 L61.789,25.499 C61.789,25.739 61.579,25.949 61.339,25.949 L56.269,25.949 L56.259,25.959 Z M69.529,25.959 C69.279,25.959 69.079,25.749 69.079,25.509 L69.079,5.509 L62.259,5.509 C62.009,5.509 61.809,5.309 61.809,5.059 L61.809,0.649 C61.809,0.399 62.009,0.199 62.259,0.199 L82.129,0.199 C82.379,0.199 82.579,0.399 82.579,0.649 L82.579,5.059 C82.579,5.309 82.369,5.509 82.119,5.509 L75.3,5.509 L75.3,25.509 C75.3,25.749 75.1,25.959 74.85,25.959 L69.53,25.959 L69.529,25.959 Z M91.949,18.059 C91.289,18.059 90.629,18.089 89.969,18.149 C89.299,18.209 88.699,18.319 88.189,18.489 C87.669,18.659 87.229,18.909 86.889,19.239 C86.549,19.569 86.379,19.979 86.379,20.529 C86.379,20.869 86.459,21.159 86.609,21.399 C86.769,21.639 86.969,21.839 87.209,21.979 C87.449,22.119 87.729,22.229 88.039,22.279 C88.359,22.339 88.659,22.369 88.949,22.369 C90.159,22.369 91.099,22.029 91.739,21.369 C92.379,20.709 92.699,19.789 92.699,18.659 L92.699,18.039 L91.929,18.039 L91.949,18.059 Z M87.469,26.389 C86.749,26.389 85.989,26.289 85.209,26.089 C84.429,25.899 83.719,25.579 83.079,25.149 C82.429,24.709 81.899,24.119 81.489,23.399 C81.079,22.669 80.869,21.769 80.869,20.709 C80.869,19.389 81.219,18.349 81.939,17.539 C82.649,16.739 83.579,16.109 84.699,15.679 C85.829,15.239 87.093,14.949 88.469,14.809 C89.829,14.659 91.189,14.589 92.499,14.589 L92.499,14.299 C92.499,13.389 92.189,12.739 91.554,12.309 C90.924,11.879 90.144,11.669 89.224,11.669 C88.384,11.669 87.564,11.849 86.77,12.209 C86.13,12.509 85.55,12.859 85.07,13.249 C84.988,13.319 84.89,13.349 84.79,13.349 C84.665,13.349 84.55,13.301 84.46,13.205 L82.044,10.619 C81.959,10.529 81.918,10.407 81.924,10.289 C81.931,10.163 81.984,10.049 82.079,9.969 C83.069,9.107 84.199,8.443 85.469,7.989 C86.879,7.479 88.341,7.219 89.813,7.219 C91.333,7.219 92.633,7.415 93.686,7.789 C94.736,8.159 95.596,8.749 96.25,9.539 C96.9,10.319 97.38,11.324 97.68,12.519 C97.98,13.712 98.13,15.149 98.13,16.795 L98.13,25.475 C98.13,25.725 97.93,25.928 97.68,25.928 L93.12,25.928 C92.87,25.928 92.67,25.72 92.67,25.472 L92.67,24.002 C92.247,24.692 91.486,25.302 90.47,25.742 C89.538,26.158 88.516,26.362 87.43,26.362 L87.469,26.389 Z M117.889,25.949 C117.639,25.949 117.429,25.739 117.429,25.499 L117.429,16.099 L112.569,22.679 C112.479,22.789 112.349,22.859 112.199,22.859 C112.049,22.859 111.919,22.789 111.839,22.679 L106.979,16.159 L106.979,25.489 C106.979,25.729 106.771,25.939 106.529,25.939 L101.459,25.939 C101.209,25.939 101.009,25.729 101.009,25.489 L101.009,8.269 C101.009,8.019 101.209,7.819 101.459,7.819 L106.033,7.819 C106.169,7.819 106.298,7.879 106.383,7.979 L112.253,15.129 L118.013,7.979 C118.093,7.869 118.223,7.809 118.363,7.809 L122.933,7.809 C123.183,7.809 123.383,8.009 123.383,8.259 L123.383,25.479 C123.383,25.729 123.183,25.929 122.933,25.929 L117.873,25.929 L117.889,25.949 Z",class:"__awiy4w"};return function(w){w.open(0,"div",e),w.open(1,"div",t),w.open(2,"div",n),w.close(),w.open(3,"div",o),w.close(),w.open(4,"div",s),w.close(),w.close(),w.open(5,"div",i),w.open(6,"div",r),w.close(),w.open(7,"div",a),w.close(),w.open(8,"div",c),w.close(),w.close(),w.open(9,"div",l),w.open(10,"div",u),w.close(),w.open(11,"div",p),w.close(),w.close(),w.open(12,"div",h),w.open(13,"div",d),w.close(),w.open(14,"div",f),w.close(),w.open(15,"div",g),w.close(),w.close(),w.close(),w.open(16,"div",_),w.open(17,"div",m),w.close(),w.open(18,"div",{class:"tamtam-logo __awiy4w"}),"OKWEB"!=w.get("@type")&&"CONFIRM"!=w.get("@type")&&"NEW"!=w.get("@type")||w.addClass("__hor"),w.open(19,"svg",v),w.open(20,"path",y),w.close(),w.close(),w.open(21,"svg",k),w.open(22,"path",b),w.close(),w.close(),w.close(),w.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"awiy4w"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this._onMouseMove=this._onMouseMove.bind(this),this._layers=null,this._posX=0,this._posY=0},o.prototype.connectedCallback=function(){document.addEventListener("mousemove",this._onMouseMove)},o.prototype.disconnectedCallback=function(){document.removeEventListener("mousemove",this._onMouseMove)},o.prototype.didRender=function(){this._layers=Array.from(this.componentView.querySelectorAll(".layer")),this._alignLayers()},o.prototype._onMouseMove=function(e){this._posX=e.pageX/window.innerWidth-.5,this._posY=e.pageY/window.innerHeight-.5,this._alignLayers()},o.prototype._alignLayers=function(){var e=this;if(this._layers){var t=this.offsetWidth,n=this.offsetHeight,o=this._layers.map(function(e){return{width:e.offsetWidth,height:e.offsetHeight}});this._layers.forEach(function(s,i){var r=t-o[i].width,a=n-o[i].height;s.style.transform="translate("+r*e._posX+"px, "+a*e._posY+"px)"})}},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-okweb",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__9kas5b"},t={class:"form-text-block __9kas5b"},n={class:"form-text-block __secondary __9kas5b"},o={key:"got-you-at-okru",class:"__9kas5b"},s={role:"primary",shape:"square","on-click":"login",class:"__9kas5b"},i={class:"sl __9kas5b","on-click":"loginWithPhone"},r={key:"not-me",class:"__9kas5b"};return function(a){"loading"==a.get("@model","loadState")?(a.open(0,"ok-spinner",e),a.close()):a.get("@model","okProfile")&&(a.variable("p",a.get("@model","okProfile")),a.open(1,"ok-auth-avatar",{model:a.get("$p"),type:"OKWEB",class:"__9kas5b"}),a.close(),a.open(2,"ok-form",e),a.open(3,"div",t),a.setText(a.get("$p","name")),a.close(),a.open(4,"div",n),a.open(5,"ok-l10n",o),a.close(),a.close(),a.open(6,"ok-button",s),a.open(7,"ok-l10n",{key:"login-as-name","data-name":a.get("$p","name"),class:"__9kas5b"}),a.close(),a.close(),a.open(8,"div",e),a.open(9,"span",i),a.open(10,"ok-l10n",r),a.close(),a.close(),a.close(),a.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9kas5b"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.loginWithPhone=function(e,t){t.emit("change-auth-type","PHONE")},o.prototype.login=function(e,t){t.emit("authorize",{hash:t.getAttribute("model").okProfile.hash})},Object.defineProperties(o.prototype,s),o}(e)});defineComponent("ok-auth-password",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__eighga"},t={class:"form-error __eighga"},n={slot:"error",class:"__eighga"},o={key:"wrong-login-pwd",class:"__eighga"},s={key:"user-blocked",class:"__eighga"},i={key:"flood-error",class:"__eighga"},r={key:"unknown-error",class:"__eighga"},a={slot:"spinner",size:"small",class:"__eighga"},c={class:"sl __eighga",href:"https://ok.ru/password/recovery",target:"_blank"},l={key:"forgotten-pwd",class:"__eighga"},u={key:"login-via-ok",class:"__eighga"},p={class:"sl link __eighga","on-click":"loginWithPhone"},h={key:"back",class:"__eighga"};return function(d){d.open(0,"ok-form",e),d.open(1,"div",t),d.get("@model","lastError")&&(d.open(2,"ok-form-error",n),"verify.token"==d.get("@model","lastError")||"login.token"==d.get("@model","lastError")?(d.open(3,"ok-l10n",o),d.close()):"login.blocked"==d.get("@model","lastError")?(d.open(4,"ok-l10n",s),d.close()):"login.flood"==d.get("@model","lastError")?(d.open(5,"ok-l10n",i),d.close()):(d.open(6,"ok-l10n",r),d.close()),d.close()),d.close(),d.open(7,"ok-form-field",e),d.open(8,"ok-input",{class:"__secondary __eighga",slot:"field",name:"login",align:"center",value:d.get(["state","login"]),placeholder:d.get(["state","l10n"])("login"),"on-input":"onLoginInput","on-keyup":"onFormSubmit",autofocus:"true"}),d.get("@model","lastError")&&d.addClass("__error"),d.close(),d.close(),d.open(9,"ok-form-field",e),d.open(10,"ok-input",{class:"__secondary __eighga",slot:"field",name:"phone",type:"password",align:"center",value:d.get(["state","password"]),placeholder:d.get(["state","l10n"])("password"),"on-input":"onPasswordInput","on-keydown":"onFormSubmit"}),d.get("@model","lastError")&&d.addClass("__error"),d.close(),"loading"==d.get("@model","loadState")&&(d.open(11,"ok-spinner",a),d.close()),d.close(),d.open(12,"a",c),d.open(13,"ok-l10n",l),d.close(),d.close(),d.open(14,"div",e),d.open(15,"ok-button",{role:"primary",shape:"square","on-click":"login",class:"__eighga",disabled:null}),d.get(["state","enabled"])||d.attr("disabled","disabled"),d.open(16,"ok-l10n",u),d.close(),d.close(),d.close(),d.open(17,"div",e),d.open(18,"span",p),d.open(19,"ok-l10n",h),d.close(),d.close(),d.close(),d.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"eighga"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("enabled",!1),this.state.set("l10n",ro)},o.prototype.loginWithPhone=function(e,t){t.emit("change-auth-type","PHONE")},o.prototype.login=function(e,t){t.emit("authorize",{login:t.state.get("login"),password:t.state.get("password")})},o.prototype.onLoginInput=function(e,t){t.state.set("login",e.target.value),t.checkEnabled()},o.prototype.onPasswordInput=function(e,t){t.state.set("password",e.target.value),t.checkEnabled()},o.prototype.onFormSubmit=function(e,t){13===e.keyCode&&t.state.get("enabled")&&t.login(e,t)},o.prototype.checkEnabled=function(){var e=this.state.get("login"),t=this.state.get("password");this.state.set("enabled",es(e)&&es(t))},Object.defineProperties(o.prototype,s),o}(e)});var _l=[[{country:"Россия",code:"+7"},{country:"Узбекистан",code:"+998"},{country:"Армения",code:"+374"},{country:"Грузия",code:"+995"},{country:"Азербайджан",code:"+994"},{country:"Беларусь",code:"+375"},{country:"Казахстан",code:"+7"},{country:"Таджикистан",code:"+992"},{country:"Кыргызстан",code:"+996"},{country:"Германия",code:"+49"},{country:"Украина",code:"+380"}],[{country:"Абхазия",code:"+7"},{country:"Австралия",code:"+61"},{country:"Австрия",code:"+43"},{country:"Азербайджан",code:"+994"},{country:"Албания",code:"+355"},{country:"Алжир",code:"+213"},{country:"Ангола",code:"+244"},{country:"Ангуилья",code:"+1264"},{country:"Андорра",code:"+376"},{country:"Антигуа и Барбуда",code:"+1268"},{country:"Антильские острова",code:"+599"},{country:"Аргентина",code:"+54"},{country:"Армения",code:"+374"},{country:"Афганистан",code:"+93"},{country:"Багамские острова",code:"+1242"},{country:"Бангладеш",code:"+880"},{country:"Барбадос",code:"+1246"},{country:"Бахрейн",code:"+973"},{country:"Беларусь",code:"+375"},{country:"Белиз",code:"+501"},{country:"Бельгия",code:"+32"},{country:"Бенин",code:"+229"},{country:"Бермуды",code:"+1441"},{country:"Болгария",code:"+359"},{country:"Боливия",code:"+591"},{country:"Босния/Герцеговина",code:"+387"},{country:"Ботсвана",code:"+267"},{country:"Бразилия",code:"+55"},{country:"Британские Виргинские о-ва",code:"+1284"},{country:"Бруней",code:"+673"},{country:"Буркина Фасо",code:"+226"},{country:"Бурунди",code:"+257"},{country:"Бутан",code:"+975"},{country:"Вануату",code:"+678"},{country:"Ватикан",code:"+379"},{country:"Великобритания",code:"+44"},{country:"Венгрия",code:"+36"},{country:"Венесуэла",code:"+58"},{country:"Вьетнам",code:"+84"},{country:"Габон",code:"+241"},{country:"Гаити",code:"+509"},{country:"Гайана",code:"+592"},{country:"Гамбия",code:"+220"},{country:"Гана",code:"+233"},{country:"Гваделупа",code:"+590"},{country:"Гватемала",code:"+502"},{country:"Гвинея",code:"+224"},{country:"Гвинея-Бисау",code:"+245"},{country:"Германия",code:"+49"},{country:"Гернси остров",code:"+441481"},{country:"Гибралтар",code:"+350"},{country:"Гондурас",code:"+504"},{country:"Гонконг",code:"+852"},{country:"Государство Палестина",code:"+970"},{country:"Гренада",code:"+1473"},{country:"Гренландия",code:"+299"},{country:"Греция",code:"+30"},{country:"Грузия",code:"+995"},{country:"ДР Конго",code:"+243"},{country:"Дания",code:"+45"},{country:"Джерси остров",code:"+447"},{country:"Джибути",code:"+253"},{country:"Доминиканская Республика",code:"+18"},{country:"Египет",code:"+20"},{country:"Замбия",code:"+260"},{country:"Западная Сахара",code:"+212"},{country:"Зимбабве",code:"+263"},{country:"Израиль",code:"+972"},{country:"Индия",code:"+91"},{country:"Индонезия",code:"+62"},{country:"Иордания",code:"+962"},{country:"Ирак",code:"+964"},{country:"Иран",code:"+98"},{country:"Ирландия",code:"+353"},{country:"Исландия",code:"+354"},{country:"Испания",code:"+34"},{country:"Италия",code:"+39"},{country:"Йемен",code:"+967"},{country:"Кабо-Верде",code:"+238"},{country:"Казахстан",code:"+7"},{country:"Камбоджа",code:"+855"},{country:"Камерун",code:"+237"},{country:"Канада",code:"+1"},{country:"Катар",code:"+974"},{country:"Кения",code:"+254"},{country:"Кипр",code:"+357"},{country:"Китай",code:"+86"},{country:"Колумбия",code:"+57"},{country:"Коста-Рика",code:"+506"},{country:"Кот-д'Ивуар",code:"+225"},{country:"Куба",code:"+53"},{country:"Кувейт",code:"+965"},{country:"Кука острова",code:"+682"},{country:"Кыргызстан",code:"+996"},{country:"Лаос",code:"+856"},{country:"Латвия",code:"+371"},{country:"Лесото",code:"+266"},{country:"Либерия",code:"+231"},{country:"Ливан",code:"+961"},{country:"Ливия",code:"+218"},{country:"Литва",code:"+370"},{country:"Лихтенштейн",code:"+423"},{country:"Люксембург",code:"+352"},{country:"Маврикий",code:"+230"},{country:"Мавритания",code:"+222"},{country:"Мадагаскар",code:"+261"},{country:"Македония",code:"+389"},{country:"Малайзия",code:"+60"},{country:"Мали",code:"+223"},{country:"Мальдивские острова",code:"+960"},{country:"Мальта",code:"+356"},{country:"Марокко",code:"+212"},{country:"Мексика",code:"+52"},{country:"Мозамбик",code:"+258"},{country:"Молдова",code:"+373"},{country:"Монако",code:"+377"},{country:"Монголия",code:"+976"},{country:"Мьянма (Бирма)",code:"+95"},{country:"Мэн остров",code:"+441624"},{country:"Намибия",code:"+264"},{country:"Непал",code:"+977"},{country:"Нигер",code:"+227"},{country:"Нигерия",code:"+234"},{country:"Нидерланды (Голландия)",code:"+31"},{country:"Никарагуа",code:"+505"},{country:"Новая Зеландия",code:"+64"},{country:"Новая Каледония",code:"+687"},{country:"Норвегия",code:"+47"},{country:"О.А.Э.",code:"+971"},{country:"Оман",code:"+968"},{country:"Пакистан",code:"+92"},{country:"Палау",code:"+441624"},{country:"Панама",code:"+507"},{country:"Папуа Новая Гвинея",code:"+675"},{country:"Парагвай",code:"+595"},{country:"Перу",code:"+51"},{country:"Питкэрн остров",code:"+64"},{country:"Польша",code:"+48"},{country:"Португалия",code:"+351"},{country:"Пуэрто Рико",code:"+1787"},{country:"Республика Конго",code:"+242"},{country:"Реюньон",code:"+262"},{country:"Россия",code:"+7"},{country:"Руанда",code:"+250"},{country:"Румыния",code:"+40"},{country:"США",code:"+1"},{country:"Сальвадор",code:"+503"},{country:"Самоа",code:"+685"},{country:"Сан-Марино",code:"+378"},{country:"Сан-Томе и Принсипи",code:"+239"},{country:"Саудовская Аравия",code:"+966"},{country:"Свазиленд",code:"+268"},{country:"Святая Люсия",code:"+1758"},{country:"Северная Корея",code:"+850"},{country:"Сейшеллы",code:"+248"},{country:"Сен-Пьер и Микелон",code:"+508"},{country:"Сенегал",code:"+221"},{country:"Сент Китс и Невис",code:"+1869"},{country:"Сент-Винсент и Гренадины",code:"+1784"},{country:"Сербия",code:"+381"},{country:"Сингапур",code:"+65"},{country:"Сирия",code:"+963"},{country:"Словакия",code:"+421"},{country:"Словения",code:"+386"},{country:"Соломоновы острова",code:"+677"},{country:"Сомали",code:"+252"},{country:"Судан",code:"+249"},{country:"Суринам",code:"+597"},{country:"Сьерра-Леоне",code:"+232"},{country:"Таджикистан",code:"+992"},{country:"Таиланд",code:"+66"},{country:"Тайвань",code:"+886"},{country:"Танзания",code:"+255"},{country:"Теркс и Кейкос",code:"+1649"},{country:"Того",code:"+228"},{country:"Токелау острова",code:"+690"},{country:"Тонга",code:"+676"},{country:"Тринидад и Тобаго",code:"+1868"},{country:"Тувалу",code:"+688"},{country:"Тунис",code:"+216"},{country:"Туркменистан",code:"+993"},{country:"Турция",code:"+90"},{country:"Уганда",code:"+256"},{country:"Узбекистан",code:"+998"},{country:"Украина",code:"+380"},{country:"Уоллис и Футуна о-ва",code:"+681"},{country:"Уругвай",code:"+598"},{country:"Фарерские острова",code:"+298"},{country:"Фиджи",code:"+679"},{country:"Филиппины",code:"+63"},{country:"Финляндия",code:"+358"},{country:"Франция",code:"+33"},{country:"Французская Полинезия",code:"+689"},{country:"Хорватия",code:"+385"},{country:"Чад",code:"+235"},{country:"Черногория",code:"+382"},{country:"Чехия",code:"+420"},{country:"Чили",code:"+56"},{country:"Швейцария",code:"+41"},{country:"Швеция",code:"+46"},{country:"Шри-Ланка",code:"+94"},{country:"Эквадор",code:"+593"},{country:"Экваториальная Гвинея",code:"+240"},{country:"Эритрея",code:"+291"},{country:"Эстония",code:"+372"},{country:"Эфиопия",code:"+251"},{country:"ЮАР",code:"+27"},{country:"Южная Корея",code:"+82"},{country:"Южная Осетия",code:"+7"},{country:"Ямайка",code:"+1876"},{country:"Япония",code:"+81"}]],ml=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-auth-phone",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__9jwqgx"},t={class:"form-text-block __9jwqgx"},n={key:"welcome-auth-phone",class:"__9jwqgx"},o={class:"form-error __9jwqgx"},s={slot:"error",class:"__9jwqgx"},i={key:"wrong-phone",class:"__9jwqgx"},r={key:"temporary-problems",class:"__9jwqgx"},a={key:"phone-number-blocked",class:"__9jwqgx"},c={key:"phone-number-wrong-format",class:"__9jwqgx"},l={key:"unknown-error",class:"__9jwqgx"},u={class:"phone __9jwqgx"},p={slot:"field",class:"__9jwqgx"},h={class:"phone-field __9jwqgx"},d={slot:"spinner",size:"small",class:"__9jwqgx"},f={class:"countries __9jwqgx",slot:"field"},g={name:"country","on-change":"onChangeCountry",class:"__9jwqgx"},_={icon:"arrow-down",size:"small",class:"__9jwqgx"},m={key:"get-sms-code",class:"__9jwqgx"},v=function(e){e.open(0,"option",{value:e.get("$index")+":"+e.get(["position"]),class:"__9jwqgx",selected:null}),e.get("$selected-group")==e.get("$index")&&e.get("$selected-index")==e.get(["position"])&&e.attr("selected","selected"),e.addText(1,e.get("country")),e.close()},y=function(t){t.variable("group",t.get("self")),t.variable("index",t.get(["position"])),t.open(0,"optgroup",e),t.iterate(1,t.get("$group"),v),t.close()};return function(v){v.open(0,"ok-form",e),v.open(1,"div",t),v.open(2,"ok-l10n",n),v.close(),v.close(),v.open(3,"div",o),v.get("@model","lastError")&&(v.open(4,"ok-form-error",s),"phone.wrong"==v.get("@model","lastError")?(v.open(5,"ok-l10n",i),v.close()):"code.limit"==v.get("@model","lastError")?(v.open(6,"ok-l10n",r),v.close()):"auth.blocked"==v.get("@model","lastError")?(v.open(7,"ok-l10n",a),v.close()):"error.phone.wrong.format"==v.get("@model","lastError")?(v.open(8,"ok-l10n",c),v.close()):(v.open(9,"ok-l10n",l),v.close()),v.close()),v.close(),v.open(10,"ok-form-field",u),v.open(11,"div",p),v.open(12,"div",h),v.open(13,"ok-input",{class:"__prefix __9jwqgx",name:"code",value:v.get("@model","phone","code")||v.get(["state","default-country"],"code"),"on-input":"onPhoneInput","on-keyup":"onFormSubmit"}),v.close(),v.open(14,"ok-input",{class:"__secondary __9jwqgx",name:"phone",align:"left",placeholder:v.get(["state","l10n"])("enter-phone"),value:v.get("@model","phone","phone"),"on-input":"onPhoneInput","on-keyup":"onFormSubmit",autofocus:"true"}),v.get("@model","lastError")&&v.addClass("__error"),v.close(),v.close(),v.close(),"loading"==v.get("@model","loadState")&&(v.open(15,"ok-spinner",d),v.close()),v.close(),v.open(16,"ok-form-field",u),v.open(17,"div",f),v.open(18,"select",g),v.variable("selected-group",v.get("@model","phone","groupIndex")),v.variable("selected-index",v.get("@model","phone","countryIndex")),v.iterate(19,v.get(["state","country-codes"]),y),v.close(),v.open(20,"ok-icon",_),v.close(),v.close(),v.close(),v.open(21,"ok-button",{role:"primary",shape:"square","on-click":"onFormSubmit",class:"__9jwqgx",disabled:null}),v.get("@model","phone","valid")||v.attr("disabled","disabled"),v.open(22,"ok-l10n",m),v.close(),v.close(),v.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},countryCodes:{},inputPhone:{},selectCountry:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9jwqgx"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("l10n",ro),this.state.set("country-codes",this.countryCodes);var e=this.countryCodes[0];if(e){var t=e[0];t&&this.state.set("default-country",ml({},t))}},s.countryCodes.get=function(){return _l},o.prototype.updatePhone=function(){var e=this.getAttribute("model"),t=Object.assign({},e&&e.phone);t.phone=this.inputPhone.value;var n=this.selectCountry.value.split(":").map(function(e){return parseInt(e,10)}),o=n[0],s=n[1];if(o in this.countryCodes){var i=this.countryCodes[o];s in i&&Object.assign(t,ml({},i[s],{groupIndex:o,countryIndex:s}))}this.emit("update-auth-phone",t)},s.inputPhone.get=function(){return this.componentView.querySelector('ok-input[name="phone"]')},s.selectCountry.get=function(){return this.componentView.querySelector('select[name="country"]')},o.prototype.onChangeCountry=function(e,t){t.updatePhone()},o.prototype.onPhoneInput=function(e,t){t.updatePhone()},o.prototype.onFormSubmit=function(e,t){var n=this;if("keyup"!==e.type||13===e.keyCode){var o=t.getAttribute("model").phone;if(!o.valid)return;t.emit("show-confirm",{header:o.display,body:ro("is-number-ok"),buttons:[{label:ro("action-continue"),action:function(){return n.emit("request-auth-code")}},ro("action-change")]})}},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-code",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__83i9oi"},t={class:"form-text-block __83i9oi"},n={key:"code-sent-to-number",class:"__83i9oi"},o={class:"phone __83i9oi"},s={class:"form-error __83i9oi"},i={slot:"error",class:"__83i9oi"},r={key:"wrong-code",class:"__83i9oi"},a={key:"obsolete-code",class:"__83i9oi"},c={key:"unknown-error",class:"__83i9oi"},l={slot:"spinner",size:"small",class:"__83i9oi"},u={class:"form-text-block __small __83i9oi"},p={class:"sl __83i9oi","on-click":"requestCode"},h={key:"request-code-again",class:"__83i9oi"},d={key:"repeat-send-code-after",class:"__83i9oi"},f={key:"confirm",class:"__83i9oi"},g={class:"sl link __83i9oi","on-click":"loginWithPhone"},_={key:"back",class:"__83i9oi"};return function(m){m.open(0,"ok-form",e),m.open(1,"div",t),m.open(2,"ok-l10n",n),m.close(),m.open(3,"div",o),m.setText(m.get("@model","phone","display")),m.close(),m.close(),m.open(4,"div",s),m.get("@model","lastError")&&(m.open(5,"ok-form-error",i),"verify.code.wrong"==m.get("@model","lastError")?(m.open(6,"ok-l10n",r),m.close()):"verify.code.expired"==m.get("@model","lastError")?(m.open(7,"ok-l10n",a),m.close()):(m.open(8,"ok-l10n",c),m.close()),m.close()),m.close(),m.open(9,"ok-form-field",e),m.open(10,"ok-input",{slot:"field",name:"code",value:m.get(["state","code"]),placeholder:m.get(["state","l10n"])("enter-code"),class:"__secondary __83i9oi",align:"center","on-input":"onCodeInput",autofocus:"true"}),m.get("@model","lastError")&&m.addClass("__error"),m.close(),"loading"==m.get("@model","loadState")&&(m.open(11,"ok-spinner",l),m.close()),m.close(),m.open(12,"div",u),m.get(["state","now"])>=m.get("@model","verification","nextAttempt")?(m.open(13,"span",p),m.open(14,"ok-l10n",h),m.close(),m.close()):(m.open(15,"ok-l10n",d),m.close(),m.addText(16," "),m.open(17,"ok-duration",{duration:m.get("@model","verification","nextAttempt")-m.get(["state","now"]),class:"__83i9oi"}),m.close()),m.close(),m.open(18,"ok-button",{role:"primary",shape:"square","on-click":"onFormSubmit",class:"__83i9oi",disabled:null}),m.get(["state","valid-code"])||m.attr("disabled","disabled"),m.open(19,"ok-l10n",f),m.close(),m.close(),m.open(20,"div",e),m.open(21,"span",g),m.open(22,"ok-l10n",_),m.close(),m.close(),m.close(),m.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"83i9oi"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("l10n",ro)},o.prototype.connectedCallback=function(){var t=this,n=function(){t.state.set("now",Date.now()),t._timer=setTimeout(n,1e3)};n(),e.prototype.connectedCallback.call(this)},o.prototype.disconnectedCallback=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),e.prototype.disconnectedCallback.call(this)},o.prototype.onCodeInput=function(e,t){var n=e.target.value;t.setCode(n)&&t.emit("authorize",{code:n})},o.prototype.loginWithPhone=function(e,t){t.emit("reset-auth",!0)},o.prototype.requestCode=function(e,t){var n=t.getAttribute("model").phone;t.emit("request-auth-code",n)},o.prototype.onFormSubmit=function(e,t){var n=t.state.get("code");t.emit("authorize",{code:n})},o.prototype.setCode=function(e){var t=this.getAttribute("model").verification,n=e&&e.length===t.codeLength;return this.state.set("code",e),this.state.set("valid-code",n),n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-confirm",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__cm4wyd"},t={class:"form-text-block __cm4wyd"},n={role:"primary",shape:"square","on-click":"confirm",class:"__cm4wyd"},o={class:"sl link __cm4wyd","on-click":"cancel"},s={key:"not-me",class:"__cm4wyd"};return function(i){i.variable("p",i.get("@model","profile")),i.open(0,"ok-auth-avatar",{model:i.get("$p"),type:"CONFIRM",class:"__cm4wyd"}),i.close(),i.open(1,"ok-form",e),i.open(2,"div",t),i.setText(i.get("$p","name")),i.close(),i.open(3,"ok-button",n),i.open(4,"ok-l10n",{key:"login-as-name","data-name":i.get("$p","name"),class:"__cm4wyd"}),i.close(),i.close(),i.open(5,"div",e),i.open(6,"span",o),i.open(7,"ok-l10n",s),i.close(),i.close(),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cm4wyd"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.confirm=function(e,t){t.emit("confirm-auth-profile")},o.prototype.cancel=function(e,t){var n=t.getAttribute("model");if(n.tokens.NEW){var o="Номер "+n.phone.display+" может использоваться только с одним профилем. \n            Создание нового сделает невозможным восстановление доступа к старому профилю";t.emit("show-confirm",{body:o,buttons:[{label:"Продолжить",action:function(){return t.emit("auth-start-new-profile")}},"Отменить"]})}else t.emit("reset-auth",!0)},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-recovery",function(e){var t={url:{type:"string",value:""}},n=function(){var e={class:"__ef536e"},t={slot:"center",class:"__ef536e"};return function(n){n.open(0,"ok-layer",e),n.open(1,"div",t),n.open(2,"iframe",{src:n.get(["state","url"]),frameborder:"0",class:"__ef536e"}),n.close(),n.close(),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ef536e"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"close-layer":function(e,t){t.emit("reset-auth",!1)}}},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),window.addEventListener("message",this)},o.prototype.disconnectedCallback=function(){window.removeEventListener("message",this),e.prototype.disconnectedCallback.call(this)},o.prototype.attributeChangedCallback=function(e,t){"url"===e&&t&&t.length>0&&this.state.set("url",t+"&redirectUrl="+location.origin+"/recovery.html")},o.prototype.handleEvent=function(e){this.emit("authorize",{recovery:e.data})},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-auth-new",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__6vq8fl"},t={for:"photo",class:"photo __6vq8fl"},n={class:"stub __6vq8fl"},o={type:"file",name:"photo",id:"photo","on-change":"onPhotoChange",class:"__6vq8fl"},s={class:"form-text-block __6vq8fl"},i={class:"form-error __6vq8fl"},r={slot:"error",class:"__6vq8fl"},a={slot:"spinner",size:"small",class:"__6vq8fl"},c={class:"sl link __6vq8fl","on-click":"onCancel"};return function(l){l.open(0,"ok-form",e),l.open(1,"label",t),l.get(["state","photo"])&&(l.open(2,"ok-preview-image",{width:"120",height:"120",fit:"cover",file:l.get(["state","photo"]),class:"__6vq8fl"}),l.close()),l.get(["state","photo"])||(l.open(3,"div",n),l.close()),l.open(4,"input",o),l.close(),l.close(),l.open(5,"div",s),l.setText("Укажите имя и загрузите фото. Это поможет друзьям узнать вас"),l.close(),l.open(6,"div",i),l.get("@model","lastError")&&(l.open(7,"ok-form-error",r),l.setText(l.get("@model","lastError")),l.close()),l.close(),l.open(8,"ok-form-field",e),l.open(9,"ok-input",{class:"__secondary __6vq8fl",slot:"field",name:"name",placeholder:"Имя и фамилия",align:"center",value:l.get(["state","name"]),"on-input":"onNameInput","on-keyup":"onFormSubmit",autofocus:"true"}),l.get("@model","lastError")&&l.addClass("__error"),l.close(),"loading"==l.get("@model","loadState")&&(l.open(10,"ok-spinner",a),l.close()),l.close(),l.open(11,"ok-button",{role:"primary",shape:"square","on-click":"onFormSubmit",class:"__6vq8fl",disabled:null}),l.get(["state","valid-name"])||l.attr("disabled","disabled"),l.addText(12,"Готово"),l.close(),l.open(13,"div",e),l.open(14,"span",c),l.setText("Назад"),l.close(),l.close(),l.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"6vq8fl"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.onPhotoChange=function(e,t){var n=e.target.files&&e.target.files[0];n&&/^image\//.test(n.type)&&t.state.set("photo",n)},o.prototype.onNameInput=function(e,t){var n=e.target.value;t.state.set("name",n),t.state.set("valid-name",n.length>0)},o.prototype.onFormSubmit=function(e,t){"keyup"===e.type&&13!==e.keyCode||t.emit("auth-confirm-new-profile",{name:t.state.get("name"),photo:t.state.get("photo")})},o.prototype.onCancel=function(e,t){t.emit("reset-auth",!0)},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-tico",function(e){var t={icon:{type:"string",value:""},size:{type:"string",value:""},spaced:{type:"boolean",value:!1},position:{type:"string",value:"left"}},n=function(){var e={class:"tico_tx __2yve0n"},t={class:"__2yve0n"};return function(n){"right"==n.get("@position")&&(n.open(0,"span",e),n.open(1,"slot",t),n.close(),n.close()),n.open(2,"ok-icon",{icon:n.get("@icon"),size:n.get("@size"),class:"__2yve0n"}),n.close(),"left"==n.get("@position")&&(n.open(3,"span",e),n.open(4,"slot",t),n.close(),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2yve0n"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-l10n",function(e){var t={key:{type:"string",value:""}},n=function(e){e.addText(0,e.get(["state","text"]))};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2n1rur"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.willRender=function(){var e=this.getAttribute("key");if(e){var t=Array.from(this.attributes).reduce(function(e,t){return/^data-/.test(t.name)&&(e[t.name.slice(5)]=t.value),e},{});this.state.set("text",ro(e,t))}else this.state.delete("text")},Object.defineProperties(o.prototype,s),o}(e)});var vl=function(e){function t(t){return(t=e.call(this,t))._init(),t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(){var t=this;e.prototype._init.call(this),this.model.subscribe("active",function(e){e?Qo(t,function(){return t.doClose()}):Xo(t)})},t.prototype.close=function(e,t){t.doClose()},t.prototype.doClose=function(){this.emit("close")},t}(defineComponent.BaseComponent);defineComponent("ok-drawer",function(){var e={profile:{type:"json",value:null},active:{type:"boolean",value:!1}},t=function(){var e={class:"overlay __4s2l59","on-click":"close"},t={class:"content __4s2l59"},n={class:"header __4s2l59"},o={shape:"circle","on-click":"close",class:"__4s2l59"},s={icon:"arrow-back",size:"medium",class:"__4s2l59"},i={class:"smile __1 __4s2l59"},r={class:"smile __2 __4s2l59"},a={class:"smile __3 __4s2l59"},c={class:"smile __4 __4s2l59"},l={class:"smile __5 __4s2l59"},u={class:"header_avatar __4s2l59"},p={class:"header_name __4s2l59"},h={class:"__4s2l59"},d={"on-click":"createNewChat",class:"__4s2l59"},f={icon:"plus",size:"medium",spaced:"true",class:"__4s2l59"},g={delimiter:"true","on-click":"createNewChannel",class:"__4s2l59"},_={icon:"channel",size:"medium",spaced:"true",class:"__4s2l59"},m={"on-click":"viewHomepage",class:"__4s2l59"},v={icon:"home",size:"medium",spaced:"true",class:"__4s2l59"},y={"on-click":"viewContacts",class:"__4s2l59"},k={icon:"contacts",size:"medium",spaced:"true",class:"__4s2l59"},b={"on-click":"viewSettings",delimiter:"true",class:"__4s2l59"},w={icon:"settings",size:"medium",spaced:"true",class:"__4s2l59"},C={"on-click":"logOut",class:"__4s2l59"},E={icon:"leave",size:"medium",spaced:"true",class:"__4s2l59"},A={class:"tt-logo __4s2l59"},T={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 38",class:"__4s2l59"},S={fill:"#ddd","fill-rule":"evenodd",class:"__4s2l59"},I={d:"M13.58 33.67L8.68 37c-.5.35-.9.14-.9-.47V31.2C3.35 28.2.45 23.06.44 17.26.43 8 7.78.47 16.88.45c9.1 0 16.48 7.48 16.5 16.75.02 9.27-7.34 16.8-16.43 16.8-1.16 0-2.28-.1-3.37-.33m10.86-15.93l-15.05.03c0 4.24 3.37 7.66 7.53 7.66s7.52-3.45 7.5-7.7M42.74 23.93c-.12 0-.22-.1-.22-.22v-9.98h-3.37c-.12 0-.22-.1-.22-.23v-2.2c0-.14.1-.24.22-.24h9.8c.13 0 .23.1.23.23v2.2c0 .12-.1.22-.22.22H45.6v10c0 .1-.1.2-.23.2h-2.63zM53.8 20c-.32 0-.64 0-.97.04-.33.03-.63.08-.88.17-.26.1-.47.22-.64.38-.16.17-.24.37-.24.65 0 .17.04.3.12.43.07.12.17.22.3.3.1.07.25.12.4.15.16.04.3.05.45.05.6 0 1.06-.17 1.38-.5.32-.33.48-.78.48-1.35V20h-.37zm-2.2 4.15c-.36 0-.73-.05-1.12-.14-.38-.1-.73-.25-1.05-.46-.32-.22-.58-.52-.78-.88-.2-.36-.3-.8-.3-1.34 0-.66.17-1.18.53-1.58.35-.4.8-.72 1.36-.93.56-.2 1.18-.36 1.86-.43.67-.07 1.35-.1 2-.1v-.15c0-.46-.16-.78-.47-1-.3-.2-.7-.3-1.15-.3-.42 0-.82.08-1.22.26-.3.15-.6.32-.84.52-.04.03-.1.05-.13.05-.08 0-.13-.02-.18-.07l-1.2-1.3c-.03-.04-.05-.1-.05-.16s.03-.12.08-.16c.48-.43 1.05-.76 1.67-1 .7-.24 1.42-.37 2.14-.37.75 0 1.4.08 1.92.27.52.2.94.48 1.26.88.33.4.57.9.7 1.48.16.6.24 1.32.24 2.14v4.34c0 .13-.1.23-.22.23H54.4c-.12 0-.22-.1-.22-.22v-.73c-.2.35-.58.65-1.08.87-.46.2-.97.3-1.5.3zM66.6 23.93c-.1 0-.2-.1-.2-.22V19L64 22.3c-.05.05-.12.1-.2.1-.06 0-.13-.05-.17-.1l-2.4-3.26v4.67c0 .13-.1.23-.22.23h-2.5c-.1 0-.2-.1-.2-.22v-8.6c0-.12.1-.22.2-.22h2.27c.07 0 .13.03.17.08l2.9 3.58 2.84-3.57c.04-.06.1-.1.17-.1h2.26c.14 0 .24.1.24.24v8.6c0 .13-.1.23-.23.23h-2.5zM73.17 23.93c-.13 0-.23-.1-.23-.22v-9.98h-3.37c-.12 0-.22-.1-.22-.23v-2.2c0-.14.1-.24.22-.24h9.82c.1 0 .2.1.2.23v2.2c0 .12-.1.22-.2.22H76v10c0 .1-.1.2-.23.2h-2.63zM84.23 20c-.32 0-.65 0-.98.04-.33.03-.62.08-.88.17-.25.1-.47.22-.64.38-.16.17-.25.37-.25.65 0 .17.04.3.12.43.08.12.18.22.3.3.12.07.25.12.4.15.17.04.32.05.46.05.6 0 1.06-.17 1.37-.5.32-.33.48-.78.48-1.35V20h-.37zm-2.2 4.15c-.36 0-.74-.05-1.12-.14-.37-.1-.73-.25-1.04-.46-.32-.22-.58-.52-.78-.88-.2-.36-.3-.8-.3-1.34 0-.66.16-1.18.52-1.58.35-.4.8-.72 1.37-.93.55-.2 1.18-.36 1.86-.43.67-.07 1.34-.1 2-.1v-.15c0-.46-.16-.78-.48-1-.3-.2-.7-.3-1.15-.3-.4 0-.82.08-1.2.26-.33.15-.6.32-.85.52-.04.03-.1.05-.14.05-.05 0-.1-.02-.15-.07l-1.2-1.3c-.04-.04-.06-.1-.05-.16 0-.06.03-.12.07-.16.5-.43 1.05-.76 1.67-1 .7-.24 1.42-.37 2.15-.37.74 0 1.38.08 1.9.27.52.2.95.48 1.27.88.32.4.56.9.7 1.48.16.6.23 1.32.23 2.14v4.34c0 .13-.1.23-.22.23h-2.25c-.12 0-.22-.1-.22-.22v-.73c-.2.35-.58.65-1.08.87-.46.2-.96.3-1.5.3zM97.04 23.93c-.13 0-.23-.1-.23-.22V19l-2.4 3.3c-.03.05-.1.1-.16.1-.08 0-.14-.05-.18-.1l-2.4-3.26v4.67c0 .13-.1.23-.22.23h-2.5c-.13 0-.23-.1-.23-.22v-8.6c0-.12.1-.22.24-.22h2.25c.06 0 .12.03.17.08l2.9 3.58 2.84-3.57c.05-.06.1-.1.18-.1h2.26c.12 0 .22.1.22.24v8.6c0 .13-.1.23-.22.23h-2.5z",class:"__4s2l59"};return function(O){O.open(0,"div",e),O.close(),O.open(1,"div",t),O.open(2,"div",n),O.open(3,"ok-button",o),O.open(4,"ok-icon",s),O.close(),O.close(),O.open(5,"div",i),O.close(),O.open(6,"div",r),O.close(),O.open(7,"div",a),O.close(),O.open(8,"div",c),O.close(),O.open(9,"div",l),O.close(),O.open(10,"div",u),O.open(11,"ok-user-card",{user:O.get("@profile"),size:"big","show-status":"false",class:"__4s2l59"}),O.close(),O.close(),O.open(12,"div",p),O.setText(O.get("@profile","name")),O.close(),O.close(),O.open(13,"ok-menu",h),O.open(14,"ok-menu-item",d),O.open(15,"ok-tico",f),O.setText("Создать чат"),O.close(),O.close(),O.open(16,"ok-menu-item",g),O.open(17,"ok-tico",_),O.setText("Создать канал"),O.close(),O.close(),O.open(18,"ok-menu-item",m),O.open(19,"ok-tico",v),O.setText("На главную"),O.close(),O.close(),O.open(20,"ok-menu-item",y),O.open(21,"ok-tico",k),O.setText("Контакты"),O.close(),O.close(),O.open(22,"ok-menu-item",b),O.open(23,"ok-tico",w),O.setText("Настройки"),O.close(),O.close(),O.open(24,"ok-menu-item",C),O.open(25,"ok-tico",E),O.setText("Выйти"),O.close(),O.close(),O.close(),O.open(26,"div",A),O.open(27,"svg",T),O.open(28,"g",S),O.open(29,"path",I),O.close(),O.close(),O.close(),O.close(),O.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4s2l59"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.createNewChat=function(e,t){t.emit("new-chat-enter")},o.prototype.createNewChannel=function(e,t){t.emit("new-channel-enter")},o.prototype.viewContacts=function(e,t){t.emit("contacts-enter")},o.prototype.viewSettings=function(e,t){t.emit("settings-enter")},o.prototype.viewHomepage=function(e,t){t.emit("homepage-enter")},o.prototype.logOut=function(e,t){t.emit("show-confirm",{header:"Выход",body:"Нам было хорошо вместе. Жаль, что так быстро уходишь",buttons:[{label:"Выйти",action:function(){return t.emit("logout")}},"Остаться"]})},o.prototype.closeDrawer=function(e,t){t.emit("close")},Object.defineProperties(o.prototype,s),o}(vl)});var yl=function(e,t){void 0===t&&(t={}),this.options=t,this.update(e)};yl.prototype.update=function(e){var t=this,n=new Map(this.items),o=ts(e).filter(function(e){return(!t.options.skipCurrent||!e.current)&&!(t.options.own&&!e.own)}).sort(ns).reduce(function(e,t){return n.set(t.id,t),e.set(t.id,t)},new Map);n.forEach(function(e,t){o.has(t)||n.delete(t)}),this.items=n},defineComponent("ok-new-chat",function(){var e={model:{type:"json",value:null},active:{type:"boolean",value:!1}},t=function(){var e={class:"__6rwkrj"},t={class:"back __6rwkrj",shape:"square","on-click":"close"},n={icon:"back",size:"medium",class:"__6rwkrj"},o={class:"title __6rwkrj"},s={name:"posting-form",class:"__6rwkrj"};return function(i){i.open(0,"ok-toolbar",e),i.open(1,"ok-button",t),i.open(2,"ok-tico",n),i.setText("Назад"),i.close(),i.close(),i.open(3,"div",o),i.setText("Создать новый чат"),i.close(),i.close(),i.get("@active")&&(i.open(4,"ok-user-picker",{users:i.get(["state","contacts"]),selected:i.get("@model","invited","*","id"),class:"__6rwkrj"}),i.close()),i.open(5,"slot",s),i.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"6rwkrj"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.attributeChangedCallback=function(e,t){"model"===e&&t&&(this._sortedContacts?this._sortedContacts.update(t.contacts):this._sortedContacts=new yl(t.contacts,{own:!0,skipCurrent:!0}),this.state.set("contacts",this._sortedContacts.items)),"active"!==e||t||delete this._sortedContacts},i.events.get=function(){return{"select-item":function(e,t){t.emit("new-chat-add-user",{userId:Number(e.detail)})},"unselect-item":function(e,t){t.emit("new-chat-remove-user",{userId:parseInt(e.detail,10)})},"commit-posting-message":function(e,t){e.preventDefault(),t.submit()},input:function(e,t){var n=e.target;"OK-INPUT"===n.tagName&&"title"===n.getAttribute("name")&&t.emit("new-chat-set-title",{title:e.target.value})}}},o.prototype.submit=function(){this.emit("new-chat-submit")},o.prototype.onIconChange=function(e,t){var n=e.target.files&&e.target.files[0];n&&/^image\//.test(n.type)&&t.emit("new-chat-set-icon",{icon:n})},o.prototype.onSubmit=function(e,t){t.submit()},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(vl)}),defineComponent("ok-new-channel",function(){var e={chat:{type:"json",value:null},active:{type:"boolean",value:!1}},t=function(){var e={class:"__avfm8o"},t={class:"back __avfm8o",shape:"square","on-click":"close"},n={icon:"back",size:"medium",class:"__avfm8o"},o={class:"title __avfm8o"},s={for:"photo",class:"stub __avfm8o"},i={icon:"photo",class:"__avfm8o"},r={type:"file",name:"photo",id:"photo","on-change":"onIconChange",class:"__avfm8o"},a={class:"buttons __avfm8o"},c={shape:"square",role:"secondary","on-click":"close",class:"__avfm8o"};return function(l){l.open(0,"ok-toolbar",e),l.open(1,"ok-button",t),l.open(2,"ok-tico",n),l.setText("Назад"),l.close(),l.close(),l.open(3,"div",o),l.setText("Новый канал"),l.close(),l.close(),l.open(4,"label",s),l.get(["state","icon"])?(l.open(5,"ok-preview-image",{width:"96",height:"96",fit:"cover",file:l.get(["state","icon"]),class:"__avfm8o"}),l.close()):(l.open(6,"ok-icon",i),l.close()),l.open(7,"input",r),l.close(),l.close(),l.open(8,"ok-input",{class:"__secondary __avfm8o",value:l.get(["state","name"]),placeholder:"Название канала",align:"center","on-input":"onNameInput","on-keyup":"onFormSubmit"}),l.close(),l.open(9,"div",a),l.open(10,"ok-button",{shape:"square",role:"primary","on-click":"onFormSubmit",class:"__avfm8o",disabled:null}),l.get(["state","valid-name"])||l.attr("disabled","disabled"),l.addText(11,"Создать канал"),l.close(),l.open(12,"ok-button",c),l.setText("Отменить"),l.close(),l.close(),l.get("@active")&&(l.open(13,"div",{class:"modal __avfm8o"}),l.get(["state","settings-opened"])&&l.addClass("__enabled"),l.get("@chat")&&(l.open(14,"ok-channel-settings",{chat:l.get("@chat"),"form-disabled":"false",class:"__avfm8o"}),l.close()),l.close())}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"avfm8o"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},i.events.get=function(){return{"change-active-state":function(e,t){t.doClose()}}},o.prototype.attributeChangedCallback=function(e,t){"active"===e&&t&&this.shadowDOM.querySelector("ok-input").focus(),"chat"===e&&t&&this.state.set("settings-opened",!0)},o.prototype.onIconChange=function(e,t){var n=e.target.files&&e.target.files[0];n&&/^image\//.test(n.type)&&t.state.set("icon",n)},o.prototype.onNameInput=function(e,t){var n=e.target.value;t.state.set("name",n),t.state.set("valid-name",n.length>0)},o.prototype.onFormSubmit=function(e,t){"keyup"===e.type&&13!==e.keyCode||t.emit("new-channel-create",{name:t.state.get("name"),icon:t.state.get("icon")})},o.prototype.doClose=function(){this.state.set("name",""),this.state.delete("icon"),this.emit("reset-created-channel"),n.prototype.doClose.call(this)},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(vl)}),defineComponent("ok-contacts",function(){var e={contacts:{type:"json",value:null},"avatar-size":{type:"string",value:"normal"},active:{type:"boolean",value:!1}},t=function(){var e={class:"__73hrhj"},t={class:"back __73hrhj",shape:"square","on-click":"close"},n={icon:"back",size:"medium",class:"__73hrhj"},o={key:"back",class:"__73hrhj"};return function(s){s.open(0,"ok-toolbar",e),s.open(1,"ok-button",t),s.open(2,"ok-tico",n),s.open(3,"ok-l10n",o),s.close(),s.close(),s.close(),s.addText(4,"Контакты"),s.close(),s.get("@active")&&(s.open(5,"ok-contact-picker",{items:s.get("@contacts"),"avatar-size":s.get("@avatar-size"),"header-placeholder":s.get(["state","l10n"])("contact-picker-placeholder"),class:"__73hrhj"}),s.close())}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"73hrhj"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){this.state.set("l10n",ro)},i.events.get=function(){return{"select-item":function(e,t){e.stopPropagation(),t.emit("open-dialog",{userId:e.detail}),t.emit("close")}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(vl)});var kl=[0,2,3,4,5,7,8,9,10,11,12,13];defineComponent("ok-settings",function(){var e={config:{type:"json",value:null},profile:{type:"json",value:null},"black-list":{type:"json",value:null},active:{type:"boolean",value:!1}},t=function(){var e={class:"__78ol15"},t={class:"back __78ol15",shape:"square","on-click":"close"},n={icon:"back",size:"medium",class:"__78ol15"},o={key:"back",class:"__78ol15"},s={key:"settings",class:"__78ol15"},i={class:"header __78ol15"},r={class:"header_inner __78ol15"},a={class:"header_avatar __78ol15"},c={for:"icon",class:"stub __78ol15"},l={shape:"circle",class:"__78ol15"},u={icon:"photo-solid",size:"medium",class:"__78ol15"},p={type:"file",name:"icon",id:"icon","on-change":"onIconChange",class:"__78ol15"},h={class:"header_info __78ol15"},d={class:"header_name __78ol15"},f={icon:"edit",size:"medium","on-click":"editUsername",class:"__78ol15"},g={class:"settings __78ol15"},_={class:"block __78ol15"},m={class:"inner __nb __78ol15"},v={class:"h4 __1st __78ol15"},y={key:"notifications",class:"__78ol15"},k={key:"display-browser-notifications",class:"__78ol15"},b={size:"small",icon:"info",class:"warning sub-item __78ol15","on-click":"onInstructToGrantPermission"},w={key:"browser-notifications-permissions-required",class:"__78ol15"},C={class:"h4 __78ol15"},E={key:"text-typing",class:"__78ol15"},A={key:"privacy",class:"__78ol15"},T={key:"show-my-online-status",class:"__78ol15"},S={class:"tico __78ol15","on-click":"onToggleBlackList"},I={icon:"arrow-down",size:"medium",class:"__78ol15"},O={class:"tico_tx __78ol15"},x={key:"black-list",class:"__78ol15"},D={class:"black-list __78ol15"},M={class:"empty-list __78ol15"},j={size:"medium",icon:"block",spaced:"true",class:"__78ol15"},P={key:"black-list-empty",class:"__78ol15"},L={src:"/sounds/new-message-15.mp3",type:"audio/mp3",class:"__78ol15"},N={src:"/sounds/new-message-15.wav",type:"audio/wav",class:"__78ol15"};return function(R){R.open(0,"ok-toolbar",e),R.open(1,"ok-button",t),R.open(2,"ok-tico",n),R.open(3,"ok-l10n",o),R.close(),R.close(),R.close(),R.open(4,"ok-l10n",s),R.close(),R.close(),R.open(5,"div",i),R.open(6,"div",r),R.open(7,"div",a),R.open(8,"ok-user-card",{user:R.get("@profile"),size:"big","show-status":"false",class:"__78ol15"}),R.close(),R.open(9,"label",c),R.open(10,"ok-button",l),R.open(11,"ok-icon",u),R.close(),R.close(),R.open(12,"input",p),R.close(),R.close(),R.close(),R.open(13,"div",h),R.get(["state","edit-username"])?(R.open(14,"ok-input",{value:R.get("@profile","name"),autofocus:"true",class:"input_edit-username __secondary __78ol15","on-focusout":"onUsernameFocusOut","on-keydown":"onUsernameKeydown"}),R.close()):(R.open(15,"div",d),R.addText(16,R.get("@profile","name")),R.open(17,"ok-icon",f),R.close(),R.close()),R.close(),R.close(),R.close(),R.open(18,"div",{class:"body __78ol15"}),R.get(["state","activate-black-list"])&&R.addClass("__activate-black-list"),R.open(19,"div",g),R.open(20,"div",_),R.open(21,"div",m),R.open(22,"ok-menu",e),R.open(23,"h4",v),R.open(24,"ok-l10n",y),R.close(),R.close(),R.open(25,"ok-menu-item",e),R.open(26,"ok-check",{size:"medium",checked:R.get("@config","notificationsEnabled"),"on-click":"onToggleNotificationAllowance",class:"__78ol15"}),R.open(27,"ok-l10n",k),R.close(),R.close(),R.close(),R.get("@config","notificationsEnabled")&&"granted"!=R.get(["state","notification-permission"])&&(R.open(28,"ok-tico",b),R.open(29,"ok-l10n",w),R.close(),R.close()),R.open(30,"h4",C),R.open(31,"ok-l10n",E),R.close(),R.close(),R.open(32,"ok-menu-item",e),R.open(33,"ok-radio",{name:"typing",value:"false",checked:!R.get("@config","alternativeKeyboardBehaviour"),"on-click":"onSetKeyboardBehaviour",class:"__78ol15"}),R.addText(34,"Отправлять сообщение по "),R.open(35,"strong",e),R.setText("Enter"),R.close(),R.addText(36,", на новую строку "),R.open(37,"strong",e),R.setText("Shift/Ctrl/Alt + Enter"),R.close(),R.close(),R.close(),R.open(38,"ok-menu-item",e),R.open(39,"ok-radio",{name:"typing",value:"true",checked:R.get("@config","alternativeKeyboardBehaviour"),"on-click":"onSetKeyboardBehaviour",class:"__78ol15"}),R.addText(40,"Отправлять сообщение по "),R.open(41,"strong",e),R.setText("Shift/Ctrl/Alt + Enter"),R.close(),R.addText(42,", на новую строку "),R.open(43,"strong",e),R.setText("Enter"),R.close(),R.close(),R.close(),R.open(44,"h4",C),R.open(45,"ok-l10n",A),R.close(),R.close(),R.open(46,"ok-menu-item",e),R.open(47,"ok-check",{size:"medium",value:"HIDDEN","on-click":"onTogglePrivateSetting",checked:!R.get("@config","user","HIDDEN"),class:"__78ol15"}),R.open(48,"ok-l10n",T),R.close(),R.close(),R.close(),R.get(["count",R.get("@black-list")])>0?(R.open(49,"ok-menu-item",e),R.open(50,"div",S),R.open(51,"ok-icon",I),R.close(),R.open(52,"div",O),R.open(53,"ok-l10n",x),R.close(),R.close(),R.close(),R.open(54,"div",D),R.open(55,"ok-black-list",{users:R.get("@black-list"),class:"__78ol15"}),R.close(),R.close(),R.close()):(R.open(56,"ok-menu-item",M),R.open(57,"ok-tico",j),R.open(58,"ok-l10n",P),R.close(),R.close(),R.close()),R.close(),R.close(),R.close(),R.close(),R.close(),R.open(59,"audio",e),R.open(60,"source",L),R.close(),R.open(61,"source",N),R.close(),R.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},audio:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"78ol15"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){this.state.set("backgrounds",kl)},o.prototype.attributeChangedCallback=function(e,t,n){"active"===e&&t&&(this.hideBlackList(),this.emit("get-black-list"),this.emit("log-screen","SETTINGS_BLACKLIST")),"profile"===e&&t&&n&&this.state.set("edit-username",!1)},o.prototype.willRender=function(){return this.state.set("notification-permission",Notification.permission),n.prototype.willRender.call(this)},o.prototype.onToggleNotificationAllowance=function(e,t){var n=t.getAttribute("config")||{};t.emit("set-notifications-allowance",{notificationsEnabled:!n.notificationsEnabled})},o.prototype.onInstructToGrantPermission=function(e,t){t.emit("show-confirm",{header:"Как разрешить браузерные обновления",body:"1. Нажмите на иконку замка 🔒 рядом с адресной строкой вашего браузера\n2. В пункте «Уведомления» 🔔 выберите опцию «Всегда доверять»\n3. Нажмите на кнопку «Включить»",buttons:[{label:"Ok",action:function(){return t.state.set("notification-permission",Notification.permission)}}]})},o.prototype.onToggleNotificationSetting=function(e,t){var n=t.getAttribute("config");n&&n.notificationsEnabled&&t.toggleUserSetting(this.getAttribute("value"))},o.prototype.onTogglePrivateSetting=function(e,t){t.getAttribute("config")&&t.toggleUserSetting(this.getAttribute("value"))},o.prototype.onIconChange=function(e,t){var n=e.target.files&&e.target.files[0];n&&/^image\//.test(n.type)&&(t.state.set("icon",n),t.emit("update-profile-photo",{icon:n}))},o.prototype.toggleUserSetting=function(e){var t=e,n=!this.getAttribute("config").user[t];this.emit("update-user-settings",(o={},o[t]=n,o));var o},o.prototype.onSelectBackground=function(e,t,n){n.emit("select-background",{background:e})},o.prototype.onSetKeyboardBehaviour=function(e,t){var n=this.getAttribute("value");t.emit("update-keyboard-behaviour",{alternativeKeyboardBehaviour:"true"===n})},o.prototype.onToggleBlackList=function(e,t){t.state.get("activate-black-list")?t.hideBlackList():t.showBlackList()},o.prototype.showBlackList=function(){this.state.set("activate-black-list",!0)},o.prototype.hideBlackList=function(){this.state.delete("activate-black-list")},s.audio.get=function(){return this.componentView.querySelector("audio")},o.prototype.editUsername=function(e,t){t.state.set("edit-username",!0)},o.prototype.onUsernameKeydown=function(e,t){13===e.keyCode&&t.setUsername(this.value)},o.prototype.onUsernameFocusOut=function(e,t){t.setUsername(this.value)},o.prototype.setUsername=function(e){this.componentView.querySelector(".input_edit-username").setAttribute("disabled","disabled"),this.emit("update-profile-name",{name:e})},o.prototype.logOut=function(e,t){t.emit("show-confirm",{header:"Выход",body:"Нам было хорошо вместе. Жаль, что так быстро уходишь",buttons:[{label:"Выйти",action:function(){return t.emit("logout")}},"Остаться"]})},Object.defineProperties(o.prototype,s),o}(vl)}),defineComponent("ok-spinner",function(e){var t={size:{type:"string",value:"default"},"view-type":{type:"string",value:"default"}},n=function(e){};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"5zt7uv"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-icon",function(e){var t={icon:{value:""},size:{type:"string",value:""}},n=function(){var e={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:"__2xclv5"},t={class:"svg-fill __2xclv5",d:"M13.7 4l-4 4 4 4c.4.5.4 1.2 0 1.7-.5.4-1.2.4-1.7 0l-4-4-4 4c-.5.4-1.2.4-1.7 0-.4-.5-.4-1.2 0-1.7l4-4-4-4c-.4-.5-.4-1.2 0-1.7.5-.4 1.2-.4 1.7 0l4 4 4-4c.5-.4 1.2-.4 1.7 0 .4.5.4 1.2 0 1.7z"},n={width:"16",height:"16",version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:"__2xclv5"},o={class:"svg-fill __2xclv5",d:"M8 11.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zm0-5c.83 0 1.5.67 1.5 1.5S8.83 9.5 8 9.5 6.5 8.83 6.5 8 7.17 6.5 8 6.5zm0-5c.83 0 1.5.67 1.5 1.5S8.83 4.5 8 4.5 6.5 3.83 6.5 3 7.17 1.5 8 1.5z"},s={class:"svg-fill __2xclv5"},i={d:"M15 11c-1.2-.8-2.5-1.8-3-2v2a2 2 0 0 1-2 2H3a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3h7a2 2 0 0 1 2 2v2c.5-.2 1.8-1.2 3-2 .5-.6 1-.4 1 .5v6c0 1-.6 1-1 .6z",class:"__2xclv5"},r={class:"svg-fill __2xclv5",d:"M7.87 9.47v2.58c0 .5-.8.5-1.12.2L2.23 8.24c-.3-.28-.3-.73 0-1l4.52-4.04c.3-.3 1.12-.3 1.12.22v2.4c2.63.3 5.98 1.62 6.34 6.1.07.52-.68.78-1 0-.9-2.25-3.38-2.46-5.33-2.45z"},a={width:"17",height:"14",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 17 14",class:"__2xclv5"},c={class:"svg-fill __2xclv5",stroke:"none","stroke-width":"1","fill-rule":"evenodd"},l={d:"M15,14 L10.813,14 C10.9308458,13.6796141 10.992747,13.3413564 10.996,13 L10.996,12 C10.996,11.979 10.987,11.961 10.987,11.94 C11.0209225,11.2876032 10.9483042,10.6340383 10.772,10.005 C10.6509445,9.66542201 10.4880211,9.34226269 10.287,9.043 C10.64,9.014 11.033,8.992 11.497,8.992 C12.3837398,8.9781928 13.2693323,9.06135332 14.138,9.24 C14.945511,9.35280426 15.6225741,9.90680005 15.893,10.676 C15.9592684,11.0964294 15.9927027,11.5213801 15.993,11.947 C15.993,11.965 16.003,11.979 16.003,11.997 L16.003,12.997 C16.0038,13.2632566 15.898384,13.5188386 15.7101113,13.7071113 C15.5218386,13.895384 15.2662566,14.0008 15,14 Z M11.491,7 C10.124,7 9.305,6.086 9.049,4.272 C8.826,2.695 9.272,0.999 11.491,0.999 C13.737,0.999 14.191,2.699 13.933,4.272 C13.644,6.072 12.82,7 11.491,7 Z M9,13 C9,13.5522847 8.55228475,14 8,14 L1,14 C0.44771525,14 3.18867247e-16,13.5522847 3.18867247e-16,13 L3.18867247e-16,12 L3.18867247e-16,11.981 C-0.00111384388,11.544897 0.0387277238,11.109653 0.119,10.681 C0.369512657,9.91647294 1.0347944,9.36226567 1.832,9.254 C2.70954499,9.07319208 3.60410191,8.98802812 4.5,9 C5.38674202,8.9861368 6.2723406,9.06929789 7.141,9.248 C7.94851096,9.36080426 8.62557406,9.91480005 8.896,10.684 C8.96227989,11.1047639 8.99571417,11.5300479 8.996,11.956 C8.996,11.973 9.006,11.988 9.006,12.005 L9.006,13.005 L9,13 Z M4.491,7 C3.124,7 2.305,6.086 2.049,4.272 C1.827,2.695 2.272,0.999 4.491,0.999 C6.737,0.999 7.191,2.699 6.933,4.272 C6.644,6.072 5.82,7 4.491,7 Z",class:"__2xclv5"},u={width:"16",height:"16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16",class:"__2xclv5"},p={d:"M5.5092,7.9956 C4.1472,7.9956 3.3312,7.0826 3.0752,5.2696 C2.8532,3.6956 3.2972,1.9996 5.5092,1.9996 C7.7472,1.9996 8.1952,3.7016 7.9432,5.2696 C7.6542,7.0646 6.8342,7.9956 5.5092,7.9956 M10.8692,12.0966 C10.9692,12.4036 10.9932,13.9136 10.9942,13.9676 C10.9942,13.9786 11.0002,13.9866 11.0002,13.9976 C11.0002,14.5496 10.5522,14.9976 10.0002,14.9976 L1.0002,14.9976 C0.4472,14.9976 0.0002,14.5496 0.0002,13.9976 C0.0002,13.9906 0.0042,13.9846 0.0042,13.9776 L0.0002,13.9776 C0.0002,13.9776 0.0102,12.5596 0.1502,12.0966 C0.4032,11.3196 0.9652,10.5966 2.2442,10.3126 C2.8322,10.1826 3.9012,9.9906 5.4962,9.9906 C7.0912,9.9906 8.2042,10.1766 8.7242,10.3006 C10.0592,10.6356 10.5902,11.3006 10.8692,12.0966 M15.0002,7.9976 L14.0002,7.9976 L14.0002,8.9976 C14.0002,9.5496 13.5522,9.9976 13.0002,9.9976 C12.4472,9.9976 12.0002,9.5496 12.0002,8.9976 L12.0002,7.9976 L11.0002,7.9976 C10.4472,7.9976 10.0002,7.5496 10.0002,6.9976 C10.0002,6.4446 10.4472,5.9976 11.0002,5.9976 L12.0002,5.9976 L12.0002,4.9976 C12.0002,4.4446 12.4472,3.9976 13.0002,3.9976 C13.5522,3.9976 14.0002,4.4446 14.0002,4.9976 L14.0002,5.9976 L15.0002,5.9976 C15.5522,5.9976 16.0002,6.4446 16.0002,6.9976 C16.0002,7.5496 15.5522,7.9976 15.0002,7.9976",class:"__2xclv5"},h={d:"M8,3.9647 C7.411,3.9647 6.933,4.4417 6.933,5.0307 C6.933,5.6207 7.411,6.0977 8,6.0977 C8.589,6.0977 9.067,5.6207 9.067,5.0307 C9.067,4.4417 8.589,3.9647 8,3.9647 M8,13.9997 C4.686,13.9997 2,11.3137 2,7.9997 C2,4.6867 4.686,1.9997 8,1.9997 C11.314,1.9997 14,4.6867 14,7.9997 C14,11.3137 11.314,13.9997 8,13.9997 M8,-0.0003 C3.582,-0.0003 0,3.5817 0,7.9997 C0,12.4187 3.582,15.9997 8,15.9997 C12.418,15.9997 16,12.4187 16,7.9997 C16,3.5817 12.418,-0.0003 8,-0.0003 M8,7.9997 C7.448,7.9997 7,8.4477 7,8.9997 L7,11.0227 C7,11.5747 7.448,12.0227 8,12.0227 C8.552,12.0227 9,11.5747 9,11.0227 L9,8.9997 C9,8.4477 8.552,7.9997 8,7.9997",class:"__2xclv5"},d={d:"M13.48 4.99l-6.82 6.85-2.49-2.5 6.78-6.8c.69-.69 1.24-.32 2.02.46.82.83 1.11 1.39.51 1.99zM2.85 10.66l2.48 2.48c-.18.05-2.81.77-3.08.82-.2.04-.24-.04-.21-.2.1-.37.8-3.08.8-3.08z",class:"__2xclv5"},f={d:"M15 7.846c-1.54 2.93-4.102 4.846-7 4.846-2.898 0-5.46-1.916-7-4.846C2.54 4.916 5.102 3 8 3c2.898 0 5.46 1.917 7 4.846zm-10.5 0c0 1.947 1.567 3.525 3.5 3.525s3.5-1.577 3.5-3.524C11.5 5.9 9.933 4.322 8 4.322S4.5 5.9 4.5 7.846zm5.688 0c0 1.217-.98 2.203-2.188 2.203-1.208 0-2.188-.987-2.188-2.204 0-1.216.98-2.203 2.188-2.203 1.208 0 2.188.987 2.188 2.203z",class:"__2xclv5"},g={width:"10",height:"10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 10 10",class:"__2xclv5"},_={d:"M4.49 8.01C1.75 8.01.01 5.41.01 4.49S1.75.97 4.49.97s4.482 2.6 4.482 3.52c0 .97-1.74 3.52-4.48 3.52zm.01-6.07a2.54 2.54 0 1 1-2.556 2.54A2.55 2.55 0 0 1 4.5 1.94zm-.016 1.18a1.345 1.345 0 1 1-1.36 1.35 1.36 1.36 0 0 1 1.36-1.35z",class:"__2xclv5"},m={width:"12",height:"12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 12 12",class:"__2xclv5"},v={x:"0",y:"0",width:"12",height:"12",class:"__2xclv5"},y={d:"M6.75,0.270777097 C6.606,0.174584287 6.388,0.178248775 6.25,0.270777097 L1.25321841,3.62788196 C1.11336974,3.72183977 1,3.93171285 1,4.09481112 L1,5.50194646 L1.536,5.1417978 L6.5,1.8071137 L11.464,5.1417978 L12,5.50194646 L12,4.09481112 C12,3.93089107 11.8903463,3.7243364 11.7467816,3.62788196 L6.75,0.270777097 Z",class:"__2xclv5"},k={d:"M6.75,0.0707770945 C6.606,-0.0254157161 6.388,-0.0217512281 6.25,0.0707770945 L1.25321841,3.42788196 C1.11336974,3.52183977 1,3.73171284 1,3.89481111 L1,5.30194646 L1.536,4.9417978 L6.5,1.6071137 L11.464,4.9417978 L12,5.30194646 L12,3.89481111 C12,3.73089107 11.8903463,3.5243364 11.7467816,3.42788196 L6.75,0.0707770945 Z",class:"__2xclv5"},b={d:"M1.20810809,4.45004991 C1.07768262,4.62980745 1,4.85025883 1,5.08846599 L1,10.8972827 C1,11.4924385 1.49022014,11.9928743 2.09493732,11.9928743 L10.9050627,11.9928743 C11.4987692,11.9928743 12,11.5023612 12,10.8972827 L12,5.08846599 C12,4.85227153 11.9227908,4.63099538 11.791857,4.44999695 C11.7627565,4.47822977 11.7306202,4.50525815 11.6954578,4.53083082 L7.23969017,7.77138908 C6.83117057,8.06849425 6.16389531,8.0649058 5.76030983,7.77138908 L1.30454222,4.53083082 C1.26932867,4.50522097 1.23718713,4.47821288 1.20810809,4.45004991 Z",class:"__2xclv5"},w={width:"32",height:"32",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32",class:"__2xclv5"},C={class:"svg-fill __2xclv5",stroke:"none",fill:"#000",d:"M16,18.0059 C14.894,18.0059 13.997,17.1099 13.997,16.0029 C13.997,14.8969 14.894,13.9999 16,13.9999 C17.106,13.9999 18.004,14.8969 18.004,16.0029 C18.004,17.1099 17.106,18.0059 16,18.0059 M16,12.0039 C13.791,12.0039 12,13.7939 12,16.0039 C12,18.2129 13.791,20.0039 16,20.0039 C18.209,20.0039 20,18.2129 20,16.0039 C20,13.7939 18.209,12.0039 16,12.0039 M21,21.9999 L11,21.9999 C9.343,21.9999 8,20.6569 8,18.9999 L8,15.7779 L8,14.9999 L8,13.1109 C8,12.1289 8.705,11.4299 9.778,11.3329 C9.778,11.3329 10.707,11.2569 11.849,11.1679 C12.169,10.6529 12.519,10.0969 12.791,9.6789 C13.074,9.2439 13.457,8.9999 14.034,8.9999 L17.912,8.9999 C18.529,8.9999 18.895,9.2959 19.215,9.7369 C19.403,9.9979 19.776,10.5909 20.131,11.1659 C21.283,11.2559 22.223,11.3329 22.223,11.3329 C23.26,11.4329 24,12.1289 24,13.1109 L24,14.9999 L24,15.7779 L24,18.9999 C24,20.6569 22.656,21.9999 21,21.9999"},E={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M12.38 13H3.62C2.19 13 1 11.86 1 10.46V5.48c0-.82.7-1.5 1.56-1.5l1.8-.14.83-1.26c.22-.37.63-.6 1.08-.58h3.4c.46 0 .9.24 1.13.63.17.22.5.72.8 1.2l1.84.15c.85 0 1.55.68 1.56 1.5v4.98c0 1.4-1.18 2.54-2.63 2.54zM8 4.55c-1.92 0-3.5 1.52-3.5 3.38 0 1.85 1.58 3.38 3.5 3.38s3.5-1.52 3.5-3.37c0-1.86-1.58-3.38-3.5-3.38zm0 5.07c-.96 0-1.75-.77-1.75-1.7 0-.92.8-1.68 1.75-1.68.96 0 1.75.76 1.75 1.7 0 .92-.8 1.7-1.75 1.7V9.6z"},A={width:"20",height:"20",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",class:"__2xclv5"},T={class:"svg-fill __2xclv5",stroke:"none",fill:"#000",d:"M15.82,7.95666667 L9.95333333,15.2 C9.925,15.235 9.885,15.2516667 9.855,15.2833333 C9.84166667,15.2966667 9.83666667,15.3133333 9.82333333,15.3266667 C9.795,15.355 9.75666667,15.365 9.72666667,15.39 C9.61833333,15.4766667 9.51,15.5533333 9.38666667,15.605 C9.33333333,15.6283333 9.28,15.64 9.225,15.6566667 C9.10333333,15.6916667 8.985,15.7166667 8.85833333,15.72 C8.79166667,15.7216667 8.72833333,15.71 8.66166667,15.7033333 C8.54833333,15.69 8.44166667,15.6733333 8.33,15.6333 C8.25333333,15.6033333 8.18166667,15.5583333 8.10666667,15.515 C8.04666667,15.48 7.97833333,15.465 7.92166667,15.4183333 C7.895,15.3966667 7.88333333,15.3666667 7.85833333,15.3433333 C7.835,15.3216667 7.80333333,15.3133333 7.78,15.2883333 L4.31166667,11.6216667 C3.75666667,11.0466667 3.775,10.1316667 4.35,9.57833333 C4.925,9.025 5.84,9.04166667 6.39333333,9.61666667 L8.74333333,12.1016667 L13.57,6.14333333 C14.07,5.52166667 14.98,5.42333333 15.6016667,5.925 C16.223,6.425 16.3216667,7.335 15.82,7.956"},S={width:"9",height:"36",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 9 36",class:"__2xclv5"},I={class:"svg-fill __2xclv5",d:"M7.29289322,18.7071068 L7.29289322,17.2928932 L0.292893219,34.2928932 C-0.0976310729,34.6834175 -0.0976310729,35.3165825 0.292893219,35.7071068 C0.683417511,36.0976311 1.31658249,36.0976311 1.70710678,35.7071068 L8.70710678,18.7071068 C9,18 9,18 8.70710678,17.2928932 L1.70710678,0.292893219 C1.31658249,-0.0976310729 0.683417511,-0.0976310729 0.292893219,0.292893219 C-0.0976310729,0.683417511 -0.0976310729,1.31658249 0.292893219,1.70710678 L7.29289322,18.7071068 Z"},O={class:"svg-fill __2xclv5",d:"M0.292893219,17.2928932 C-9.71445147e-17,18 -1.44328993e-15,18 0.292893219,18.7071068 L7.29289322,35.7071068 C7.68341751,36.0976311 8.31658249,36.0976311 8.70710678,35.7071068 C9.09763107,35.3165825 9.09763107,34.6834175 8.70710678,34.2928932 L1.70710678,17.2928932 L1.70710678,18.7071068 L8.70710678,1.70710678 C9.09763107,1.31658249 9.09763107,0.683417511 8.70710678,0.292893219 C8.31658249,-0.0976310729 7.68341751,-0.0976310729 7.29289322,0.292893219 L0.292893219,17.2928932 Z"},x={width:"9",height:"16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 9 16",class:"__2xclv5"},D={class:"svg-fill __2xclv5",d:"M0.292893219,7.29289322 C-0.0976310729,7.68341751 -0.0976310729,8.31658249 0.292893219,8.70710678 L7.29289322,15.7071068 C7.68341751,16.0976311 8.31658249,16.0976311 8.70710678,15.7071068 C9.09763107,15.3165825 9.09763107,14.6834175 8.70710678,14.2928932 L1.70710678,7.29289322 L1.70710678,8.70710678 L8.70710678,1.70710678 C9.09763107,1.31658249 9.09763107,0.683417511 8.70710678,0.292893219 C8.31658249,-0.0976310729 7.68341751,-0.0976310729 7.29289322,0.292893219 L0.292893219,7.29289322 Z"},M={fill:"none","fill-rule":"evenodd",class:"svg-fill __2xclv5"},j={d:"M4.43 7.24l4.28-4.4c.3-.3.3-.8.05-1.1l-.16-.16c-.3-.3-.8-.32-1.1-.02h-.03L1 8.16l6.44 6.6c.3.3.8.3 1.1 0h.02l.16-.17c.3-.3.3-.8 0-1.1l-4.3-4.46h9.8c.43 0 .78-.35.78-.78V8c0-.42-.35-.76-.78-.76h-9.8z",class:"__2xclv5"},P={class:"svg-fill __2xclv5","fill-rule":"evenodd"},L={d:"M3 6h7v4H3c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1z",class:"__2xclv5"},N={d:"M13.37 7.5L8.85 3.15c-.2-.2-.52-.2-.7 0-.1.1-.15.23-.15.36v8.7c0 .3.22.5.5.5.13 0 .25-.03.35-.12l4.52-4.35c.2-.2.2-.5.02-.7-.03 0-.03-.02-.04-.02z",class:"__2xclv5"},R={width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:"__2xclv5"},z={d:"M948.781,1611h-9.562a1.02,1.02,0,1,1,0-2h3.417a1.452,1.452,0,0,1,2.759,0h3.386A1.02,1.02,0,1,1,948.781,1611Zm-0.422,9.27a1.74,1.74,0,0,1-1.726,1.73h-5.269a1.706,1.706,0,0,1-1.75-1.73l-0.685-7.98h10.115Z",transform:"translate(-936 -1607)",class:"__2xclv5"},H={class:"svg-fill __2xclv5",d:"M12.814 7.82a3.6 3.6 0 0 1-.282.23l.01.01-.85.848-1.723 1.714a.086.086 0 0 0 0-.016l-.926.916c-.034.04-.05.087-.087.124a2.574 2.574 0 0 1-.21.17l-.175.173-.02-.02a2.514 2.514 0 0 1-3.134-.33 2.48 2.48 0 0 1-.328-3.13l-.038-.038 2.85-2.822a.03.03 0 0 1 0-.007A1 1 0 0 1 9.31 5.64a.984.984 0 0 1-.006 1.4s-.006 0-.008.006l-.763.754c.008 0 .014.012.02.017L6.83 9.537l-.352.354.7.694.78-.775 1.3-1.3.034-.034 2.087-2.083a.067.067 0 0 0 .02-.012c.005-.005.006-.014.013-.02l.012-.013a1.98 1.98 0 0 0-.028-2.78 2.012 2.012 0 0 0-2.834 0c-.014.013-.018.033-.032.047L4.36 7.766l.025.024a3.465 3.465 0 1 0 4.577 5.18 3.317 3.317 0 0 0 .267-.318l.05.05 2.624-2.615c0 .017 0 .034.006.05l.178-.175c.016-.02.023-.046.043-.066a1 1 0 0 1 1.408-.006.984.984 0 0 1-.007 1.4h-.006l.01.01-2.823 2.8-.067-.07c-.1.114-.186.23-.293.338a5.5 5.5 0 0 1-7.746 0 5.422 5.422 0 0 1 0-7.7c.11-.11.233-.192.35-.29l-.014-.013 3.96-3.91a3.643 3.643 0 0 1 .23-.284 4.035 4.035 0 0 1 5.682-.006 3.978 3.978 0 0 1 .002 5.658z"},F={class:"svg-fill __2xclv5",d:"M10 16H6a6 6 0 0 1-6-6V6a6 6 0 0 1 6-6h4a6 6 0 0 1 6 6v4a6 6 0 0 1-6 6zm4-10a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v4a4 4 0 0 0 4 4h4a4 4 0 0 0 4-4V6zm-4 1a1 1 0 1 1 1-1 1 1 0 0 1-1 1zM6 7a1 1 0 1 1 1-1 1 1 0 0 1-1 1zm4.46 2l.52 1.32A3.48 3.48 0 0 1 5 10.3L5.58 9h4.9z","data-name":"Rounded Rectangle 24"},U={class:"svg-fill __2xclv5",d:"M2.56 10.26c.07-.55.58-1.04 1.12-1.1L11 8.38c.56-.06.56-.16 0-.22l-7.3-.78c-.55-.06-1.05-.55-1.12-1.1l-.54-4.02c-.15-1.1.52-1.57 1.5-1.04l11.38 6.1c.97.52 1 1.37 0 1.9l-11.38 6.1c-.97.52-1.65.06-1.5-1.04l.54-4.02z"},q={class:"svg-fill __2xclv5",d:"M2 10c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2zm6 0c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2zm6 0c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2z"},$={width:"12",height:"15",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 12 15",class:"__2xclv5"},G={fill:"none","fill-rule":"evenodd",stroke:"none","stroke-width":"1",class:"__2xclv5"},B={d:"M-2-1h16v16H-2z",class:"__2xclv5"},V={d:"M0 14c0-.552.456-1 1.002-1h9.996c.553 0 1.002.444 1.002 1 0 .552-.456 1-1.002 1H1.002C.45 15 0 14.556 0 14zM5 .996C5 .446 5.444 0 6 0c.552 0 1 .456 1 .996v8.012c0 .55-.444.996-1 .996-.552 0-1-.456-1-.996V.996z",class:"svg-fill __2xclv5"},W={d:"M9.793 5.293l-4.5 4.5h1.414l-4.5-4.5c-.39-.39-1.024-.39-1.414 0-.39.39-.39 1.024 0 1.414l4.5 4.5c.39.39 1.024.39 1.414 0l4.5-4.5c.39-.39.39-1.024 0-1.414-.39-.39-1.024-.39-1.414 0z",class:"svg-fill __2xclv5","fill-rule":"nonzero"},K={width:"14",height:"14",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 14 14",class:"__2xclv5"},Y={class:"svg-fill __2xclv5",fill:"none","fill-rule":"evenodd","stroke-width":"1"},Z={d:"M5.506 12C3.846 12 2.5 10.654 2.5 9c0-1.655 1.345-3 3-3h7c.552 0 1-.448 1-1s-.448-1-1-1h-7c-2.76 0-5 2.24-5 5s2.243 5 5.006 5h3.278c.552 0 1-.448 1-1s-.448-1-1-1H5.506z",class:"__2xclv5"},J={d:"M8.353 2.207l3.535 3.536V4.328L8.353 7.864c-.39.39-.39 1.024 0 1.414.39.39 1.024.39 1.414 0l3.536-3.535c.39-.39.39-1.024 0-1.415L9.767.793c-.39-.39-1.024-.39-1.414 0-.39.39-.39 1.024 0 1.414z",class:"__2xclv5"},Q={width:"14",height:"10",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 14 10",class:"__2xclv5"},X={d:"M12.43 3.137L8.3 6.517c-.37.306-.847.458-1.323.458-.477 0-.953-.152-1.324-.457l-4.158-3.38c-.283-.233-.325-.65-.093-.935.234-.283.65-.325.934-.092l4.158 3.382c.253.207.713.207.966 0l4.13-3.38c.284-.234.702-.192.934.09.232.285.19.703-.093.935M12.447 0H1.53C.685 0 0 .685 0 1.53v6.94C0 9.317.685 10 1.53 10h10.916c.845 0 1.53-.684 1.53-1.53V1.53c0-.845-.685-1.53-1.53-1.53",class:"__2xclv5"},ee={d:"M14.78 12.57c-.3.57-.9.93-1.54.93H9.5c-.02.83-.68 1.5-1.5 1.5s-1.48-.67-1.5-1.5H2.76c-.65 0-1.24-.36-1.55-.93-.3-.57-.25-1.27.1-1.82L2.76 8.4l.43-2.86V5.4C3.48 2.95 5.6 1 8.03 1c2.4 0 4.52 1.94 4.8 4.35 0 .03.02.05.03.08l.4 2.98 1.47 2.37c.35.55.37 1.25.06 1.82zm-3.23-3.54l-.45-3.37c-.16-1.63-1.65-2.9-3.1-2.9-1.47 0-2.95 1.27-3.07 2.88v.04l-.5 3.34-1.68 2.67h10.5L11.55 9z",class:"__2xclv5"},te={d:"M11.54 8.8l-.44-3.2C10.96 4 9.47 2.76 8 2.76c-.64 0-1.28.25-1.8.65L4.94 2.2C5.8 1.44 6.84 1 8 1c2.42 0 4.55 1.92 4.83 4.3 0 .03.02.05.03.08l.4 2.95 1.47 2.32c.3.46.34 1.03.16 1.53L11.5 8.8zM3.82 3.52l1.3 1.3v.02l6.7 6.75 1.72 1.7.2.2c.34.35.37.9.03 1.22-.35.35-.88.32-1.22-.02l-1.35-1.36H9.5c0 .83-.67 1.5-1.5 1.5-.82 0-1.48-.67-1.5-1.5H2.76c-.65 0-1.24-.35-1.55-.92-.3-.56-.24-1.26.1-1.8L2.8 8.3l.4-2.82v-.15h.03V5.3L1.28 3.38C.94 3.03.9 2.5 1.25 2.15c.35-.34.88-.32 1.22.03L3.8 3.53h.02zM2.75 11.6h6.7l-4.7-4.73-.32 2.1-1.68 2.62z",class:"__2xclv5"},ne={d:"M7.5 13.2c.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3-.7 0-1.3-.58-1.3-1.3 0-.72.6-1.3 1.3-1.3zM3.02 4c.23-2.25 2.35-4 4.46-4 2.1 0 4.24 1.75 4.5 4H12l.6 5.1 1.7.97c.38.16.7.52.7.93 0 .56-.57 1-1.12 1H1.13C.58 12 0 11.57 0 11c0-.44.36-.8.8-.95l1.6-.95L3 4h.02z",class:"__2xclv5"},oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16",class:"__2xclv5"},se={d:"M7.5 13.2c.7 0 1.3.6 1.3 1.3 0 .7-.6 1.3-1.3 1.3-.7 0-1.3-.6-1.3-1.3 0-.7.6-1.3 1.3-1.3zm6.5-1.5l.3.2c.3.2.3 1 0 1.3-.4.4-1 .4-1.5 0L11.5 12H1c-.4 0-1-.4-1-1 0-.4.4-.8.8-1l1.6-1L3 4v-.5L1.4 1.8C1 1.4 1 .8 1.4.3c.3-.3 1-.3 1.3 0L14 11.7zM5.6.5c.6-.3 1.2-.5 2-.5 2 0 4 1.7 4.4 4l.4 3.3L5.6.5z",class:"__2xclv5"},ie={d:"M14.53 14.55a1.03 1.03 0 0 1-1.6.13l-3.66-3.65A6 6 0 1 1 11 9.3l3.7 3.65a1.04 1.04 0 0 1-.17 1.6zm-5.7-11.4a4 4 0 1 0 0 5.67 4 4 0 0 0 0-5.66z",class:"__2xclv5"},re={d:"M14.7 11.7a1 1 0 0 1-1.3 0L8 6.3l-5.4 5.4a1 1 0 0 1-1.3 0 1 1 0 0 1 0-1.3l6-6a1 1 0 0 1 1.4 0l6 6a1 1 0 0 1 0 1.3z",class:"__2xclv5"},ae={d:"M14.7 6.6l-6 6a1 1 0 0 1-1.4 0l-6-6a1 1 0 0 1 0-1.3 1 1 0 0 1 1.3 0L8 10.7l5.4-5.4a1 1 0 0 1 1.3 0 1 1 0 0 1 0 1.3z",class:"__2xclv5"},ce={d:"M5.3 2.3l-.07.08c-.36.38-.36.98 0 1.36L9.2 8l-3.97 4.26c-.36.38-.36.98 0 1.36l.06.07c.35.38.96.4 1.35.04 0-.02.03-.04.04-.05L12 8 6.7 2.3c-.37-.38-.98-.4-1.36-.04l-.05.05z",class:"__2xclv5"},le={fill:"#FF8C2B","fill-rule":"evenodd",d:"M4 11.87S2.62 13.47 2 14c-.3.25-.75.2-.75.2-.25 0-.5-.1-.7-.28-.38-.38-.38-1 0-1.4l1.8-1.77c-.66-.18-1.3-.45-1.87-.82-.5-.32-.67-1-.35-1.5.32-.5 1-.66 1.5-.34 1.53.92 3.5.92 5 0 .52-.36 1.2-.2 1.5.3.33.5.18 1.2-.33 1.5-.65.4-1.36.7-2.1.87l1.74 1.73c.4.4.4 1 0 1.4-.38.4-1 .4-1.38 0L4 11.87zM.36 3.77C.36 1.77 2 .15 4 .15S7.64 1.78 7.64 3.8C7.64 5.8 6 7.42 4 7.42S.36 5.8.36 3.78M4 2.28c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5",class:"__2xclv5"},ue={d:"M4.7 9C4 9 3.4 8.6 3 8c-.8-.4-1-1-1-2s.3-1.6 1-2c.4-.7 1.2-1 2-1h5v6H7l1 4.2v.5l-.6.3h-.8c-.3 0-.5-.2-.6-.4L4.4 9h.3zM11 3h.2l1.5-1.4c.3-.2.7 0 1 0 .2.2.3.4.3 1v6.8c0 .6 0 1-.5 1-.2.2-.5 0-.8 0L11.2 9H11V3z",class:"__2xclv5"},pe={d:"M9 7V3c0-.3 0-.5-.3-.7C8.5 2 8.3 2 8 2c-.3 0-.5 0-.7.3-.2.2-.3.4-.3.7v4H3c-.3 0-.5 0-.7.3-.2.2-.3.4-.3.7 0 .3 0 .5.3.7.2.2.4.3.7.3h4v4c0 .3 0 .5.3.7.2.2.4.3.7.3.3 0 .5 0 .7-.3.2-.2.3-.4.3-.7V9h4c.3 0 .5 0 .7-.3.2-.2.3-.4.3-.7 0-.3 0-.5-.3-.7-.2-.2-.4-.3-.7-.3H9z",class:"__2xclv5"},he={transform:"translate(0 2)",class:"svg-fill __2xclv5"},de={width:"13",height:"2",x:"3",rx:"1",class:"__2xclv5"},fe={width:"13",height:"2",x:"3",y:"5",rx:"1",class:"__2xclv5"},ge={width:"13",height:"2",x:"3",y:"10",rx:"1",class:"__2xclv5"},_e={width:"2",height:"2",rx:"1",class:"__2xclv5"},me={width:"2",height:"2",y:"5",rx:"1",class:"__2xclv5"},ve={width:"2",height:"2",y:"10",rx:"1",class:"__2xclv5"},ye={fill:"#697CFF",class:"__2xclv5"},ke={d:"M14 7.2v5c0 1-1 2-2 2H4c-1 0-2-1-2-2v-8c0-1 1-2 2-2h5v-2H4C1.8.2 0 2 0 4.2v8c0 2.2 1.8 4 4 4h8c2.2 0 4-1.8 4-4v-5h-2z",class:"__2xclv5"},be={d:"M6 7.2L8.8 10l-3 .8c-.3 0-.6-.2-.5-.5l1-3zm1.3-1l5.7-6c.6-.6 1.4-.4 2.2.4.8 1 1 1.7.4 2.3L10 8.5 7.2 6z",class:"__2xclv5"},we={d:"M1.72 14s0-1.43.16-1.9c.27-.77.86-1.5 2.2-1.77C4.7 10.2 5.82 10 7.5 10s2.85.2 3.4.3c1.4.35 1.96 1 2.25 1.8.1.27.12 1.43.13 1.8v.1c0 .56-.44 1-1 1H2.73c-.55 0-1-.44-1-1zm5.8-12c2.22 0 2.68 1.7 2.42 3.3C9.64 7.08 8.84 8 7.5 8c-1.34 0-2.16-.9-2.4-2.7C4.86 3.7 5.3 2 7.5 2z",class:"__2xclv5"},Ce={d:"M4.75 2.73c.4-.24.84-.42 1.3-.54L6.2.4c.05-.2.26-.4.5-.4h1.57c.26 0 .48.2.5.46L8.9 2.2c.47.1.9.3 1.32.53l1.33-1.1c.2-.18.5-.17.68.02.3.3.78.8 1.1 1.1.18.18.2.48.03.68-.3.35-.76.9-1.12 1.3.24.42.42.86.55 1.33l1.7.15c.2.1.4.3.4.5v1.6c0 .3-.2.5-.5.5l-1.6.2c-.1.55-.3 1.05-.54 1.5l.97 1.17c.17.2.16.5-.03.68l-1.1 1.1c-.16.2-.46.2-.66.04l-1.12-.98c-.48.25-1 .43-1.5.53-.07.52-.1 1.16-.16 1.6-.03.23-.24.43-.5.43H6.7c-.27 0-.5-.2-.5-.48-.05-.44-.1-1.13-.15-1.7-.47-.1-.92-.3-1.33-.53l-1.3 1.06c-.2.18-.5.17-.7-.02l-1.1-1.1c-.17-.16-.18-.46-.02-.66l1.1-1.3c-.23-.4-.4-.85-.54-1.32-.56-.1-1.26-.15-1.7-.2-.26 0-.46-.23-.46-.5V6.7c0-.27.2-.5.46-.5.45-.05 1.16-.1 1.7-.15.14-.47.33-.9.56-1.3-.35-.44-.8-1-1.1-1.34-.17-.2-.16-.4.03-.6l1.1-1.1c.18-.2.48-.2.68 0l1.32 1.1zM7.48 5c-1.38 0-2.5 1.12-2.5 2.5S6.1 10 7.48 10s2.5-1.12 2.5-2.5S8.86 5 7.48 5z",class:"__2xclv5"},Ee={d:"M11 14H3c-.5 0-1-.4-1-1V3c0-.5.5-1 1-1h8c.6 0 1 .5 1 1v1H4v8h8v1c0 .6-.4 1-1 1zm1.7-7l-.7-.6c-.3-.4-.3-1 0-1.4.4-.3 1-.3 1.4 0l2.3 2.3c.4.4.4 1 0 1.4L13.4 11c-.4.3-1 .3-1.4 0-.3-.4-.3-1 0-1.4l.7-.6H7c-.5 0-1-.4-1-1 0-.5.5-1 1-1h5.7z",class:"__2xclv5"},Ae={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M13 9c.2-.3.4-.6.4-1l-.4-.7-6.4-5c-.3-.3-.7-.3-1 0-.4 0-.6.4-.6.8v10c0 .4.2.7.6 1 .3 0 .7 0 1-.2l6.4-5z"},Te={d:"M3 7V4.5c0-.16 0-.3.02-.46.04-.37.13-.74.25-1.1.24-.63.63-1.22 1.13-1.7.44-.42.97-.76 1.55-.97.28-.1.57-.17.87-.22L7.27 0h.35c.15 0 .3.02.45.04.33.04.66.12.98.23.68.25 1.3.67 1.78 1.2.37.4.66.87.86 1.38.1.3.2.63.24.97.03.18.04.37.05.56V7h1v5.45c0 2.5-2.46 3.55-5.5 3.55S2 14.94 2 12.46V7h1zm2 0h5V4.43c0-.35-.1-.7-.25-1-.14-.3-.33-.57-.57-.78-.22-.2-.48-.37-.76-.48-.25-.1-.52-.15-.8-.17-.26 0-.54.02-.8.1-.73.2-1.33.74-1.62 1.43-.13.3-.2.6-.2.9V7zm2.47 2.02H7.4c-.46 0-.84.34-.84.74 0 .05 0 .1.02.15l.22 2.65c.07.28.35.48.67.48.33 0 .6-.2.68-.48l.22-2.63.02-.14c0-.4-.4-.74-.86-.74h-.08z",class:"__2xclv5"},Se={d:"M13 12.25v.2c0 2.5-2.46 3.55-5.5 3.55S2 14.94 2 12.46V7h1V4.5c0-.16 0-.3.02-.46.04-.33.1-.67.22-.98.15-.45.37-.88.65-1.25C4.4 1.16 5.06.64 5.83.3c.3-.1.64-.2.97-.25.16-.02.3-.04.46-.04h.34c.46.03.9.1 1.33.24.47.16.92.4 1.32.7.6.47 1.08 1.1 1.4 1.8.1.27.2.57.26.87.05.14.07.27.08.4 0 .13 0 .25-.05.37-.04.1-.1.22-.18.32-.07.07-.15.14-.24.2-.27.17-.64.2-.94.05-.1-.04-.18-.1-.26-.17-.15-.13-.25-.3-.3-.5-.03-.1-.04-.22-.06-.33-.07-.27-.17-.53-.32-.77-.33-.52-.84-.9-1.43-1.08-.3-.1-.6-.12-.9-.1-.25.03-.5.08-.73.17-.28.1-.54.28-.76.48-.23.2-.42.48-.56.77-.16.32-.24.66-.25 1V7h8v5.25zM7.46 9h.08c.46 0 .84.34.84.74l-.03.15-.22 2.6c-.07.3-.35.5-.68.5-.32 0-.6-.2-.67-.5l-.22-2.6-.02-.17c0-.4.38-.74.84-.74h.07z",class:"__2xclv5"},Ie={class:"svg-fill __2xclv5",d:"M1.72 14s0-1.43.16-1.9c.27-.77.86-1.5 2.2-1.77C4.7 10.2 5.82 10 7.5 10s2.85.2 3.4.3c1.4.35 1.96 1 2.25 1.8.1.27.12 1.43.13 1.8v.1c0 .56-.44 1-1 1H2.73c-.55 0-1-.44-1-1zm5.8-12c2.22 0 2.68 1.7 2.42 3.3C9.64 7.08 8.84 8 7.5 8c-1.34 0-2.16-.9-2.4-2.7C4.86 3.7 5.3 2 7.5 2z"},Oe={d:"M10.95 12.36l-1.4-1.4-1.43 1.4c-.57.57-1.32.88-2.12.88s-1.56-.3-2.12-.88C2.7 11.2 2.7 9.3 3.88 8.12l1.4-1.4-1.4-1.43-1.42 1.4C.5 8.65.5 11.82 2.46 13.8c.98.97 2.26 1.46 3.54 1.46 1.28 0 2.56-.5 3.53-1.46l1.42-1.42zm2.83-2.82c1.95-1.96 1.95-5.12 0-7.08C12.8 1.5 11.52 1 10.24 1c-1.28 0-2.56.5-3.53 1.46L5.3 3.88l1.4 1.4 1.42-1.4C8.7 3.3 9.44 3 10.24 3s1.56.3 2.12.88c.57.57.88 1.32.88 2.12s-.3 1.55-.88 2.12l-1.4 1.42 1.4 1.4 1.42-1.4z",class:"__2xclv5"},xe={d:"M10.95 5.3c.4.38.4 1.02 0 1.4L6.7 10.96c-.38.4-1.02.4-1.4 0-.4-.4-.4-1.02 0-1.4L9.53 5.3c.4-.4 1.03-.4 1.42 0",class:"__2xclv5"},De={d:"M8 15.5c-1.3.3-2 .3-2 .3s-2.6-1.7-1.6-7L7 7l.2.3c1.2 1 4.2 2 6.8 2.7-1.2 2.6-3 4-4.5 5-.7-.8-1.8-2-3-4 0 0 .5 2.6 1.4 4.5zM3.6 6.8L1 2c0-.7 0-1.5 1-2 .7-.2 1.5 0 1.8.8L6 5.4 3.8 6.8z",class:"__2xclv5"},Me={"fill-opacity":".8",d:"M8 0c.8 0 1.5.7 1.5 1.5S8.8 3 8 3s-1.5-.7-1.5-1.5S7.2 0 8 0z",class:"__2xclv5"},je={"fill-opacity":".4",d:"M8 13c.8 0 1.5.7 1.5 1.5S8.8 16 8 16s-1.5-.7-1.5-1.5S7.2 13 8 13z",class:"__2xclv5"},Pe={d:"M16 8c0 .8-.7 1.5-1.5 1.5S13 8.8 13 8s.7-1.5 1.5-1.5S16 7.2 16 8z",class:"__2xclv5"},Le={"fill-opacity":".6",d:"M3 8c0 .8-.7 1.5-1.5 1.5S0 8.8 0 8s.7-1.5 1.5-1.5S3 7.2 3 8z",class:"__2xclv5"},Ne={"fill-opacity":".9",d:"M13.7 2.3c.5.6.5 1.6 0 2.2-.6.5-1.6.5-2.2 0-.5-.6-.5-1.6 0-2.2.6-.5 1.6-.5 2.2 0z",class:"__2xclv5"},Re={"fill-opacity":".5",d:"M4.5 11.5c.5.6.5 1.6 0 2.2-.6.5-1.6.5-2.2 0-.5-.6-.5-1.6 0-2.2.6-.5 1.6-.5 2.2 0z",class:"__2xclv5"},ze={"fill-opacity":".3",d:"M13.7 13.7c-.6.5-1.6.5-2.2 0-.5-.6-.5-1.6 0-2.2.6-.5 1.6-.5 2.2 0 .5.6.5 1.6 0 2.2z",class:"__2xclv5"},He={"fill-opacity":".7",d:"M4.5 4.5C4 5 3 5 2.3 4.5c-.5-.6-.5-1.6 0-2.2.6-.5 1.6-.5 2.2 0C5 3 5 4 4.5 4.5z",class:"__2xclv5"},Fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",class:"__2xclv5"},Ue={d:"M5.5 0c3 0 5.5 2.5 5.5 5.5S8.5 11 5.5 11 0 8.5 0 5.5 2.5 0 5.5 0zm0 7.8c.5 0 .8.2.8.7 0 .5-.3.8-.8.7-.5 0-.8-.2-.8-.7 0-.5.3-.8.8-.7zM6.3 3c0-.7-.3-1-.8-1s-.8.3-.8 1v3.6h1.5L6.4 3z",class:"__2xclv5"},qe={d:"M5.5 0c3 0 5.5 2.5 5.5 5.5S8.5 11 5.5 11 0 8.5 0 5.5 2.5 0 5.5 0zm.2 2.2h-.4c-.3 0-.5.2-.5.5v3c0 .3.2.5.5.5L7 8h.7l.3-.3c.2-.2.2-.6 0-.8L6.2 5.2V2.7c0-.3-.2-.5-.5-.5z",class:"__2xclv5"},$e={d:"M11.8 6.1c0-.7-.6-1.3-1.3-1.3-.7 0-1.3.6-1.3 1.3 0 .7.6 1.3 1.3 1.3.7 0 1.3-.6 1.3-1.3zm-5 0c0-.7-.6-1.3-1.3-1.3-.7 0-1.3.6-1.3 1.3 0 .7.6 1.3 1.3 1.3.7 0 1.3-.6 1.3-1.3zM8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z",class:"__2xclv5"},Ge={d:"M5.28 9.4L4 10.4c.92 1.22 2.48 2.08 4 2.08s3.08-.86 4-2.08l-1.2-1c-.6.8-1.78 1.3-2.8 1.3-1 0-2.1-.5-2.72-1.3z",class:"__2xclv5"},Be={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M11 10.8c.58-.85 1.04-1.92 1.04-3.2 0-.3-.04-.57-.08-.86.76-.28 1.57-.44 2.17-.5-.15 1.17-.55 2.86-1.44 3.76-.5.5-1.12.7-1.7.8zM4.03 6.73c-.04.28-.08.57-.08.86 0 1.28.46 2.35 1.05 3.2-.58-.1-1.2-.3-1.7-.8-.88-.9-1.28-2.6-1.43-3.77.6.07 1.4.22 2.17.5zm6.22.86c0 1.86-1.5 3.16-2.26 3.7-.75-.54-2.26-1.84-2.26-3.7S7.14 3.7 8 2.63c.95 1.2 2.26 3.22 2.26 4.97zm4.82-3.23c-.08 0-1.86.04-3.6.65C10.55 2.67 8.74.77 8.64.66L8 0l-.64.66c-.1.1-1.9 2-2.84 4.36-1.74-.6-3.52-.65-3.6-.65L0 4.35l.02.92c0 .16.08 4.02 2.04 6 1.1 1.08 2.46 1.34 3.55 1.34.42 0 .8-.02 1.08-.07l.43.3v2.67h1.8v-2.66c.1-.1.26-.2.42-.3.3.04.66.07 1.07.07 1.08 0 2.45-.25 3.54-1.34 1.96-1.97 2.04-5.83 2.04-6l.02-.9h-.92z"},Ve={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M10 14H6s-.1 2 2 2 2-2 2-2zm4-6c0-5.5-5-6-5-6V1s0-1-1-1-1 1-1 1v1s-5 .5-5 6.5V11L.5 12v1h15v-1L14 11V8zM4 11V8s0-4 4-4 4 4 4 4v3H4z"},We={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M5 8s0-5 4.5-5 4.52 5 4.52 5H5zm4.5-7C16 1 16 8 16 8v5c0 1-1 1-1 1h-1s0-2.5-2.5-2.5S9 14 9 14H7s0-2.5-2.5-2.5S2 14 2 14H1s-1 0-1-1v-3c0-2 2-2 2-2h1s0-7 6.5-7zm-5 14.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5S6 13.17 6 14s-.67 1.5-1.5 1.5zm7 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"},Ke={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M2.22 16C1 16 0 15.02 0 13.82V2.18C0 .98 1 0 2.22 0h11.56C15 0 16 .98 16 2.18v11.64c0 1.2-1 2.18-2.22 2.18H2.22zM9 13h2v-2H9v2zM4 9h2V3H4v6zm0 4h2v-2H4v2zM9.95 3c-.88 0-1.6.22-2.14.67-.54.45-.8 1.1-.8 1.94v.05h1.82c0-.38.12-.66.33-.85.22-.2.5-.3.8-.3.38 0 .68.12.88.35.2.23.3.54.3.95 0 .36-.08.7-.26 1-.18.28-.42.56-.72.8-.5.42-.86.77-1.03 1.05-.17.3-.26.74-.26 1.35h1.85c0-.36.05-.65.13-.86.08-.2.25-.4.5-.62.48-.32.88-.72 1.2-1.2.3-.47.47-.98.47-1.54 0-.86-.27-1.53-.8-2.03-.55-.5-1.3-.75-2.25-.75z"},Ye={class:"svg-fill __2xclv5",d:"M10.93 12.62c-1.03.72-2.3 1.1-3.65 1-3.05-.25-5.3-2.92-5-5.97.3-3.06 3-5.33 6.06-5.1 1.67.14 3.1 1 4 2.24l.05-.86c.02-.4.37-.7.78-.65.4.03.7.4.67.8l-.2 2.93c0 .18-.1.33-.2.45l-.05.04c-.14.12-.33.2-.53.16l-2.92-.3c-.4-.05-.7-.4-.68-.8.03-.42.38-.7.78-.67l1.36.15C10.8 4.9 9.6 4.1 8.2 4 5.92 3.8 3.9 5.5 3.7 7.75c-.22 2.26 1.44 4.24 3.7 4.42.98.07 1.9-.2 2.67-.7l.05-.04c.33-.28.8-.25 1.06.05.25.3.2.77-.13 1.04l-.12.08zm1.24-6.5l.07.02v-.07l-.07.06z"},Ze={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",class:"__2xclv5"},Je={transform:"translate(2, 3)",class:"svg-stroke __2xclv5",fill:"none","stroke-width":"2"},Qe={points:"0 0.727272727 0 5.09090909 4.36363636 5.09090909",class:"__2xclv5"},Xe={points:"16 12.3636364 16 8 11.6363636 8",class:"__2xclv5"},et={d:"M14.1745455,4.36363636 C13.4248134,2.24495393 11.640533,0.659067814 9.44851875,0.16309692 C7.25650453,-0.332873974 4.96331575,0.33043326 3.37454545,1.92 L0,5.09090909 M16,8 L12.6254545,11.1709091 C11.0366842,12.7604758 8.74349547,13.4237831 6.55148125,12.9278122 C4.35946703,12.4318413 2.57518664,10.8459552 1.82545455,8.72727273",class:"__2xclv5"},tt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",class:"__2xclv5"},nt={fill:"none","fill-rule":"evenodd",stroke:"#5C5C69","stroke-width":"2",class:"__2xclv5"},ot={cx:"32",cy:"32",r:"31",class:"__2xclv5"},st={d:"M21 44.2h22M32 19.24V38.2m-11-9.37L32 18l11 10.83","stroke-linecap":"round","stroke-linejoin":"round",class:"__2xclv5"},it={class:"svg-fill __2xclv5","fill-rule":"evenodd",d:"M0 8c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8-8-3.58-8-8zm2 0c0 3.3 2.7 6 6 6s6-2.7 6-6-2.7-6-6-6-6 2.7-6 6zm3.33 2.32l2.12-2.45V4H9v4.55l-2.6 2.88-1.07-1.1z"},rt={fill:"none","fill-rule":"evenodd",class:"__2xclv5"},at={class:"svg-fill __2xclv5",d:"M6 5.58v4.83c0 .36.3.6.68.6.14 0 .3-.02.4-.1l3.52-2.2c.46-.27.55-.8.2-1.15-.03-.06-.1-.12-.2-.17L7.1 5.1c-.3-.18-.72-.12-.95.13-.08.1-.13.22-.13.35z"},ct={class:"svg-stroke __2xclv5","stroke-width":"2",d:"M6.9 14.9C3.56 14.4 1 11.5 1 8c0-3.86 3.14-7 7-7 3.64 0 6.64 2.8 6.97 6.34.03.56 0 1.03-.33 1.45L9.1 14.3c-.44.4-1.03.7-2.2.6z","stroke-linecap":"round","stroke-linejoin":"round"},lt={class:"svg-fill __2xclv5",d:"M14.27 8.54l-5.7 5.7c.08-.32.24-1.05.26-1.88.02-.9.5-1.7 1.22-2.4.7-.7 1.47-1.17 2.4-1.22.94-.05 1.4-.1 1.82-.2z"},ut={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",class:"__2xclv5"},pt={d:"M12 21v7h8v-7c0-2.2-1.8-4-4-4s-4 1.8-4 4zm-9.15-5.85L13.88 4.12c1.17-1.17 3.07-1.17 4.24 0l11.03 11.03c.2.2.2.5 0 .7-.1.1-.22.15-.36.15H27v10c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V16H3.2c-.27 0-.5-.22-.5-.5 0-.13.06-.26.15-.35z",class:"__2xclv5"};return function(ht){"clear"==ht.get("@icon")?(ht.open(0,"svg",e),ht.open(1,"path",t),ht.close(),ht.close()):"menu"==ht.get("@icon")?(ht.open(2,"svg",n),ht.open(3,"path",o),ht.close(),ht.close()):"video"==ht.get("@icon")?(ht.open(4,"svg",e),ht.open(5,"g",s),ht.open(6,"path",i),ht.close(),ht.close(),ht.close()):"reply"==ht.get("@icon")?(ht.open(7,"svg",n),ht.open(8,"path",r),ht.close(),ht.close()):"chat"==ht.get("@icon")?(ht.open(9,"svg",a),ht.open(10,"g",c),ht.open(11,"path",l),ht.close(),ht.close(),ht.close()):"add"==ht.get("@icon")?(ht.open(12,"svg",u),ht.open(13,"g",c),ht.open(14,"path",p),ht.close(),ht.close(),ht.close()):"info"==ht.get("@icon")?(ht.open(15,"svg",u),ht.open(16,"g",c),ht.open(17,"path",h),ht.close(),ht.close(),ht.close()):"edit"==ht.get("@icon")?(ht.open(18,"svg",u),ht.open(19,"g",c),ht.open(20,"path",d),ht.close(),ht.close(),ht.close()):"looked"==ht.get("@icon")?(ht.open(21,"svg",u),ht.open(22,"g",c),ht.open(23,"path",f),ht.close(),ht.close(),ht.close()):"looked-nano"==ht.get("@icon")?(ht.open(24,"svg",g),ht.open(25,"g",c),ht.open(26,"path",_),ht.close(),ht.close(),ht.close()):"read"==ht.get("@icon")?(ht.open(27,"svg",m),ht.open(28,"g",c),ht.open(29,"rect",v),ht.close(),ht.open(30,"path",y),ht.close(),ht.open(31,"path",k),ht.close(),ht.open(32,"path",b),ht.close(),ht.close(),ht.close()):"photo"==ht.get("@icon")?(ht.open(33,"svg",w),ht.open(34,"path",C),ht.close(),ht.close()):"photo-solid"==ht.get("@icon")?(ht.open(35,"svg",e),ht.open(36,"path",E),ht.close(),ht.close()):"check"==ht.get("@icon")?(ht.open(37,"svg",A),ht.open(38,"path",T),ht.close(),ht.close()):"arrow-next"==ht.get("@icon")?(ht.open(39,"svg",S),ht.open(40,"g",c),ht.open(41,"path",I),ht.close(),ht.close(),ht.close()):"arrow-prev"==ht.get("@icon")?(ht.open(42,"svg",S),ht.open(43,"g",c),ht.open(44,"path",O),ht.close(),ht.close(),ht.close()):"back"==ht.get("@icon")?(ht.open(45,"svg",x),ht.open(46,"g",c),ht.open(47,"path",D),ht.close(),ht.close(),ht.close()):"arrow-back"==ht.get("@icon")?(ht.open(48,"svg",e),ht.open(49,"g",M),ht.open(50,"path",j),ht.close(),ht.close(),ht.close()):"share"==ht.get("@icon")?(ht.open(51,"svg",e),ht.open(52,"g",P),ht.open(53,"path",L),ht.close(),ht.open(54,"path",N),ht.close(),ht.close(),ht.close()):"delete"==ht.get("@icon")?(ht.open(55,"svg",R),ht.open(56,"g",s),ht.open(57,"path",z),ht.close(),ht.close(),ht.close()):"attach"==ht.get("@icon")?(ht.open(58,"svg",R),ht.open(59,"g",s),ht.open(60,"path",H),ht.close(),ht.close(),ht.close()):"smiles"==ht.get("@icon")?(ht.open(61,"svg",R),ht.open(62,"g",s),ht.open(63,"path",F),ht.close(),ht.close(),ht.close()):"send"==ht.get("@icon")?(ht.open(64,"svg",R),ht.open(65,"path",U),ht.close(),ht.close()):"settings-g"==ht.get("@icon")?(ht.open(66,"svg",u),ht.open(67,"g",c),ht.open(68,"path",q),ht.close(),ht.close(),ht.close()):"photo-save"==ht.get("@icon")?(ht.open(69,"svg",$),ht.open(70,"g",G),ht.open(71,"path",B),ht.close(),ht.open(72,"path",V),ht.close(),ht.open(73,"path",W),ht.close(),ht.close(),ht.close()):"share"==ht.get("@icon")?(ht.open(74,"svg",K),ht.open(75,"g",Y),ht.open(76,"path",Z),ht.close(),ht.open(77,"path",J),ht.close(),ht.close(),ht.close()):"togo"==ht.get("@icon")?(ht.open(78,"svg",Q),ht.open(79,"g",Y),ht.open(80,"path",X),ht.close(),ht.close(),ht.close()):"alert-on"==ht.get("@icon")?(ht.open(81,"svg",e),ht.open(82,"g",s),ht.open(83,"path",ee),ht.close(),ht.close(),ht.close()):"alert-off"==ht.get("@icon")?(ht.open(84,"svg",e),ht.open(85,"g",s),ht.open(86,"path",te),ht.close(),ht.close(),ht.close()):"alert-solid-on"==ht.get("@icon")?(ht.open(87,"svg",e),ht.open(88,"g",s),ht.open(89,"path",ne),ht.close(),ht.close(),ht.close()):"alert-solid-off"==ht.get("@icon")?(ht.open(90,"svg",oe),ht.open(91,"g",s),ht.open(92,"path",se),ht.close(),ht.close(),ht.close()):"search"==ht.get("@icon")?(ht.open(93,"svg",R),ht.open(94,"g",s),ht.open(95,"path",ie),ht.close(),ht.close(),ht.close()):"arrow-up"==ht.get("@icon")?(ht.open(96,"svg",R),ht.open(97,"g",s),ht.open(98,"path",re),ht.close(),ht.close(),ht.close()):"arrow-down"==ht.get("@icon")?(ht.open(99,"svg",R),ht.open(100,"g",s),ht.open(101,"path",ae),ht.close(),ht.close(),ht.close()):"arrow-right"==ht.get("@icon")?(ht.open(102,"svg",R),ht.open(103,"g",s),ht.open(104,"path",ce),ht.close(),ht.close(),ht.close()):"ok-logo"==ht.get("@icon")?(ht.open(105,"svg",R),ht.open(106,"path",le),ht.close(),ht.close()):"channel"==ht.get("@icon")?(ht.open(107,"svg",e),ht.open(108,"g",s),ht.open(109,"path",ue),ht.close(),ht.close(),ht.close()):"plus"==ht.get("@icon")?(ht.open(110,"svg",R),ht.open(111,"g",s),ht.open(112,"path",pe),ht.close(),ht.close(),ht.close()):"burger"==ht.get("@icon")?(ht.open(113,"svg",R),ht.open(114,"g",he),ht.open(115,"rect",de),ht.close(),ht.open(116,"rect",fe),ht.close(),ht.open(117,"rect",ge),ht.close(),ht.open(118,"rect",_e),ht.close(),ht.open(119,"rect",me),ht.close(),ht.open(120,"rect",ve),ht.close(),ht.close(),ht.close()):"new-chat"==ht.get("@icon")?(ht.open(121,"svg",e),ht.open(122,"g",ye),ht.open(123,"path",ke),ht.close(),ht.open(124,"path",be),ht.close(),ht.close(),ht.close()):"contacts"==ht.get("@icon")?(ht.open(125,"svg",e),ht.open(126,"g",s),ht.open(127,"path",we),ht.close(),ht.close(),ht.close()):"settings"==ht.get("@icon")?(ht.open(128,"svg",e),ht.open(129,"g",s),ht.open(130,"path",Ce),ht.close(),ht.close(),ht.close()):"leave"==ht.get("@icon")?(ht.open(131,"svg",e),ht.open(132,"g",s),ht.open(133,"path",Ee),ht.close(),ht.close(),ht.close()):"play"==ht.get("@icon")?(ht.open(134,"svg",e),ht.open(135,"path",Ae),ht.close(),ht.close()):"close"==ht.get("@icon")?(ht.open(136,"svg",e),ht.open(137,"path",t),ht.close(),ht.close()):"block"==ht.get("@icon")?(ht.open(138,"svg",e),ht.open(139,"g",s),ht.open(140,"path",Te),ht.close(),ht.close(),ht.close()):"unblock"==ht.get("@icon")?(ht.open(141,"svg",e),ht.open(142,"g",P),ht.open(143,"path",Se),ht.close(),ht.close(),ht.close()):"profile"==ht.get("@icon")?(ht.open(144,"svg",e),ht.open(145,"path",Ie),ht.close(),ht.close()):"link"==ht.get("@icon")?(ht.open(146,"svg",e),ht.open(147,"g",P),ht.open(148,"path",Oe),ht.close(),ht.open(149,"path",xe),ht.close(),ht.close(),ht.close()):"clean"==ht.get("@icon")?(ht.open(150,"svg",e),ht.open(151,"g",s),ht.open(152,"path",De),ht.close(),ht.close(),ht.close()):"progress"==ht.get("@icon")?(ht.open(153,"svg",e),ht.open(154,"g",P),ht.open(155,"path",Me),ht.close(),ht.open(156,"path",je),ht.close(),ht.open(157,"path",Pe),ht.close(),ht.open(158,"path",Le),ht.close(),ht.open(159,"path",Ne),ht.close(),ht.open(160,"path",Re),ht.close(),ht.open(161,"path",ze),ht.close(),ht.open(162,"path",He),ht.close(),ht.close(),ht.close()):"error"==ht.get("@icon")?(ht.open(163,"svg",Fe),ht.open(164,"g",P),ht.open(165,"path",Ue),ht.close(),ht.close(),ht.close()):"wait"==ht.get("@icon")?(ht.open(166,"svg",Fe),ht.open(167,"g",P),ht.open(168,"path",qe),ht.close(),ht.close(),ht.close()):"emoji-set-0"==ht.get("@icon")?(ht.open(169,"svg",e),ht.open(170,"g",P),ht.open(171,"path",$e),ht.close(),ht.open(172,"path",Ge),ht.close(),ht.close(),ht.close()):"emoji-set-1"==ht.get("@icon")?(ht.open(173,"svg",e),ht.open(174,"path",Be),ht.close(),ht.close()):"emoji-set-2"==ht.get("@icon")?(ht.open(175,"svg",e),ht.open(176,"path",Ve),ht.close(),ht.close()):"emoji-set-3"==ht.get("@icon")?(ht.open(177,"svg",e),ht.open(178,"path",We),ht.close(),ht.close()):"emoji-set-4"==ht.get("@icon")?(ht.open(179,"svg",e),ht.open(180,"path",Ke),ht.close(),ht.close()):"refresh"==ht.get("@icon")?(ht.open(181,"svg",e),ht.open(182,"path",Ye),ht.close(),ht.close()):"reload"==ht.get("@icon")?(ht.open(183,"svg",Ze),ht.open(184,"g",Je),ht.open(185,"polyline",Qe),ht.close(),ht.open(186,"polyline",Xe),ht.close(),ht.open(187,"path",et),ht.close(),ht.close(),ht.close()):"dnd"==ht.get("@icon")?(ht.open(188,"svg",tt),ht.open(189,"g",nt),ht.open(190,"circle",ot),ht.close(),ht.open(191,"path",st),ht.close(),ht.close(),ht.close()):"recent"==ht.get("@icon")?(ht.open(192,"svg",e),ht.open(193,"path",it),ht.close(),ht.close()):"live-stickers"==ht.get("@icon")?(ht.open(194,"svg",e),ht.open(195,"g",rt),ht.open(196,"path",at),ht.close(),ht.open(197,"path",ct),ht.close(),ht.open(198,"path",lt),ht.close(),ht.close(),ht.close()):"smiles2"==ht.get("@icon")?(ht.open(199,"svg",e),ht.open(200,"g",P),ht.open(201,"path",$e),ht.close(),ht.open(202,"path",Ge),ht.close(),ht.close(),ht.close()):"home"==ht.get("@icon")&&(ht.open(203,"svg",ut),ht.open(204,"g",s),ht.open(205,"path",pt),ht.close(),ht.close(),ht.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2xclv5"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-button",function(e){var t={"view-type":{type:"string",value:""},role:{type:"string",value:""},size:{type:"string",value:""},shape:{type:"string",value:""},type:{type:"string",value:""},disabled:{type:"boolean",value:!1},title:{type:"string",value:""}},n=function(){var e={class:"__4vfe04"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4vfe04"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var bl={itemHeight:100,initialItems:30,maxDisplayItems:50,offscreenArea:300,maxAnimatedScroll:3e3,alignBottom:!1,onUpdate:null,key:"id",reconcile:"replace",paddingTop:0,paddingBottom:0,scrollEasing:function(e,t,n,o){return(e/=o/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},scrollDuration:function(e){var t=Math.min(500,Math.max(300,3*Math.abs(e)));return Math.floor(t)}},wl=function(e){this.options=Object.assign({},bl,e),this._items=null,this._model=null,this._from=-1,this._to=-1,this._heights={},this._animationId=null},Cl={model:{},isEmpty:{},items:{},range:{}};Cl.model.get=function(){return this._model||(this._model=this._calculateModel()),this._model},Cl.isEmpty.get=function(){return-1===this._from&&-1===this._to},Cl.items.get=function(){return this._items},Cl.range.get=function(){return{from:this._from,to:this._to}},Cl.range.set=function(e){null==e?(this._from=this._to=-1,this._model=null):e.from===this._from&&e.to===this._to||(this._from=e.from,this._to=e.to,this._model=null)},wl.prototype.update=function(e,t,n){if((e=e||[]).length){!this.isEmpty&&this._reconcile(e,t)||(this.options.alignBottom?(this._to=e.length-1,this._from=Math.max(0,this._to-this.options.initialItems)):(this._from=0,this._to=Math.min(this.options.initialItems,e.length)));var o=n?e.indexOf(n):-1;-1!==o&&(this.range=this.adjustRange(this.range,e,o))}else this.range=null;this._items=e,this._markAsDirty()},wl.prototype.reset=function(){this.range=null,this._model=null},wl.prototype.itemHeight=function(e,t){var n=this.options.key,o=e&&"object"==typeof e?e[n]:e;return null!=t&&(this._heights[o]=t),o in this._heights?this._heights[o]:this.options.itemHeight},wl.prototype.itemPos=function(e,t){var n=this;if(t=t||this._items){var o=t.indexOf(e);if(-1!==o){for(var s=0;o--;)s+=n.itemHeight(t[o]);return s+this.options.paddingTop}}return-1},wl.prototype.listHeight=function(e){var t=(e=e||this._items)[e.length-1];return this.itemPos(t,e)+this.itemHeight(t)+this.options.paddingBottom},wl.prototype.visibleItems=function(e){var t=this;if(!this._items)return[];for(var n=e.scrollTop,o=n+e.clientHeight,s=[],i=this.options.paddingTop,r=0,a=this._items.length,c=void 0,l=void 0;r<a;r++){if(c=t._items[r],l=t.itemHeight(c),i<o&&i+l>n)s.push(c);else if(i>o)break;i+=l}return s},wl.prototype.inViewport=function(e,t){var n=this.itemPos(e),o=n+this.itemHeight(e),s=t.scrollTop;return n<=s+t.offsetHeight&&o>=s},wl.prototype.scrollPos=function(e,t,n){var o=t.clientHeight,s=t.scrollHeight-o,i=this._items[this._items.length-1]===e?this.options.paddingBottom:0,r=this.itemPos(e)-i-(o-this.itemHeight(e))*(n||0);return Math.max(Math.min(Math.round(r),s),0)},wl.prototype.handleScroll=function(e,t){this._items&&e&&this.fill(e,t)},wl.prototype.fill=function(e,t,n){"number"==typeof t&&(n=t,t=null);var o=this.getRangeForViewport(e,t,n);(o.from<this._from||o.to>this._to)&&(this.range=o,this._markAsDirty())},wl.prototype.getRangeForViewport=function(e,t,n){void 0===n&&(n=0);var o=e.scrollTop-n,s=this.options.offscreenArea,i=Math.max(0,o-s),r=o+e.clientHeight+s;return this._findItemsForArea(i,r,t)},wl.prototype.scrollTo=function(e,t,n,o){if(-1!==this.items.indexOf(e)){"boolean"==typeof n&&(o=n,n=0);var s=t.scrollTop,i=this.scrollPos(e,t,n),r=i-s;this.stopAnimatedScroll(),o||null==o&&Math.abs(r)<=this.options.maxAnimatedScroll?this.animateScroll(t,s,i):r&&(t.scrollTop=i)}},wl.prototype.animateScroll=function(e,t,n){var o=this,s=n-t,i=this.options.scrollDuration(s),r=this.options.scrollEasing,a=Date.now(),c=t;this._animationId=a;var l=function(){if(o._animationId===a){var n=Math.min(Date.now()-a,i),u=Math.round(r(n,t,s,i));e.scrollTop+=u-c,c=u,n<i&&requestAnimationFrame(l)}};this._stopAnimation=!1,requestAnimationFrame(l)},wl.prototype.stopAnimatedScroll=function(){this._animationId=null},wl.prototype.getAnchor=function(e,t){var n=this,o=this._items,s=this.options.key;if(o)for(var i=e.scrollTop,r=this.options.paddingTop,a=0,c=o.length,l=void 0,u=void 0;a<c;a++){if(l=o[a],u=n.itemHeight(l),l[s]in n._heights&&r+u>i&&(!t||t(l)))return{item:l,offset:r,height:u,scrollTop:i};r+=n.itemHeight(l)}return null},wl.prototype.restoreAnchor=function(e,t){var n=this.itemPos(e.item),o=this.options.key;-1===n&&(n=this.itemPos(this._items.find(function(t){return t[o]===e.item[o]}))),-1!==n&&n!==e.offset&&(t.scrollTop=e.scrollTop+n-e.offset)},wl.prototype.adjustRange=function(e,t,n){var o=ss(t,n,this.options.initialItems),s=this.options.maxDisplayItems,i=Math.min(e.from,o.from),r=Math.max(e.to,o.to);if(r-i>s){var a=(n-i)/(r-i);i=Math.max(0,n-Math.ceil(a*s)),r=Math.min(Math.max(i+s,n),t.length-1)}return{from:i,to:r}},wl.prototype.readRects=function(e,t){for(var n=this,o=e.querySelectorAll("["+t+"]"),s=0,i=o.length,r=void 0;s<i;s++)r=o[s],n.itemHeight(r.getAttribute(t),r.offsetHeight)},wl.prototype._markAsDirty=function(){this._model=null,this._notify()},wl.prototype._notify=function(){"function"==typeof this.options.onUpdate&&this.options.onUpdate(this.model)},wl.prototype._reconcile=function(e,t){return"prepend"===this.options.reconcile?this._reconcilePrepend(e,t):this._reconcileReplace(e,t)},wl.prototype._reconcilePrepend=function(e){var t=this.options.key,n=e[this._from];if(!n)return!1;if(n[t]===this._items[this._from][t])return this._to===this._items.length-1&&(this.range=this.adjustRange(this.range,e,this._to)),!0;var o=os(e,this._items.slice(this._from,this._to+1),t);if(-1===o)return!1;var s=this._to-this._from;return this._to=Math.min(e.length-1,o+s),this._from=Math.max(0,this._to-s),!0},wl.prototype._reconcileReplace=function(e,t){if(e&&e.length){if(this._to>=e.length){var n=this._to-this._from;this._to=e.length-1,this._from=Math.max(0,this._to-n)}return t&&this.fill(t,e),!0}return!1},wl.prototype._calculateModel=function(){var e,t=this,n=this._items,o=this._from,s=this._to,i=0,r=0,a=0;if(n&&n.length){var c=this.itemPos(n[this._from]);r=c,i=this.listHeight(),e=n.slice(o,s+1).map(function(e){var n=t.itemHeight(e),o={top:c,height:n,value:e};return c+=n,o}),a=i-c}else e=[];return{before:r,after:a,height:i,from:o,to:s,items:e}},wl.prototype._findItemsForArea=function(e,t,n){for(var o=this,s=null,i=null,r=0,a=(n=n||this._items).length,c=0,l=void 0;r<a&&c<=t;r++)l=o.itemHeight(n[r]),c<=t&&c+l>=e&&(null===s&&(s=r),i=r),c+=l;return{from:s,to:i}},Object.defineProperties(wl.prototype,Cl),defineComponent("ok-chats-list",function(e){var t={items:{type:"json",value:null},selected:{type:"string",value:""},loaded:{type:"boolean",value:!1}},n=function(){var e={class:"empty __9hoo3o"},t={key:"empty-chats-list",class:"__9hoo3o"},n=function(e){e.open(0,"ok-chats-list-item",{chat:e.get("value"),selected:e.get("value","selected"),class:"__9hoo3o"}),e.close()},o=function(e){return e.get("value","id")};return function(s){s.variable("list",s.get(["state","scroll-list"])),s.open(0,"div",{style:"height: "+(s.get("$list","before")||0)+"px;",class:"__9hoo3o"}),s.close(),s.get("@loaded")&&!s.get(["count",s.get("$list","items")])?(s.open(1,"div",e),s.open(2,"ok-l10n",t),s.close(),s.close()):s.iterate(3,s.get("$list","items"),n,o),s.open(4,"div",{style:"height: "+(s.get("$list","after")||0)+"px",class:"__9hoo3o"}),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9hoo3o"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._list=new wl({itemHeight:64,onUpdate:function(t){return e.state.set("scroll-list",t)}}),this._prevSelected=null,this._prevLastMessage=null,this.addEventListener("scroll",function(t){return e.handleScroll(t)},{passive:!0})},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.emit("log-screen","CHATS")},o.prototype.attributeChangedCallback=function(e,t){if("items"===e){var n=Array.from(t instanceof Map?t.values():t||[]).filter(is).sort(as);this.state.set("items",n),this._list.update(n,this),this._loadRequested=!1}},o.prototype.didRender=function(){var e=this.getAttribute("selected"),t=this.state.get("items").find(cs);if(t)if(e!==this._prevSelected)this.scrollToItem(t),this._prevSelected=e,this._prevLastMessage=t.lastMessage&&t.lastMessage.id;else if(ls(t)){var n=t.lastMessage.id;n!==this._prevLastMessage&&(this.scrollToItem(t),this._prevLastMessage=n)}},o.prototype.handleScroll=function(){if(this._list.handleScroll(this),!this._loadRequested){this.scrollHeight-this.scrollTop-this.offsetHeight<200&&(this._loadRequested=!0,this.emit("load-more-chats"))}},o.prototype.scrollToItem=function(e){var t=this;this.clientHeight?this._scrollToItem(e):requestAnimationFrame(function(){return t._scrollToItem(e)})},o.prototype._scrollToItem=function(e){e&&!this._list.inViewport(e,this)&&this._list.scrollTo(e,this,.3)},Object.defineProperties(o.prototype,s),o}(e)});var El=function(e,t,n){null==n&&"string"==typeof e&&(n=e.length),this.string=e,this.pos=this.start=t||0,this.end=n};El.prototype.eof=function(){return this.pos>=this.end},El.prototype.limit=function(e,t){return new this.constructor(this.string,e,t)},El.prototype.peek=function(){return this.string.charCodeAt(this.pos)},El.prototype.next=function(){if(this.pos<this.string.length)return this.string.charCodeAt(this.pos++)},El.prototype.eat=function(e){var t=this.peek(),n="function"==typeof e?e(t):t===e;return n&&this.next(),n},El.prototype.eatWhile=function(e){for(var t=this.pos;!this.eof()&&this.eat(e););return this.pos!==t},El.prototype.backUp=function(e){this.pos-=e||1},El.prototype.current=function(){return this.substring(this.start,this.pos)},El.prototype.substring=function(e,t){return this.string.slice(e,t)},El.prototype.error=function(e){var t=new Error(e+" at char "+(this.pos+1));return t.originalMessage=e,t.pos=this.pos,t.string=this.string,t};var Al={STRING:"STRING",FORMATTING:"FORMATTING",PUNCTUATION:"PUNCTUATION",WHITESPACE:"WHITESPACE",NEW_LINE:"NEW_LINE",LINK:"LINK",EMOJI:"EMOJI",USER_STICKER:"USER_STICKER"},Tl={NONE:0,BOLD:1,ITALIC:2,CODE:4,HIGHLIGHTED:8},Sl=function(e,t,n){void 0===n&&(n=null),this.type=e,this.stream=t,this._start=t.start,this._end=t.pos,this.format=Tl.NONE,this.opts=Object.assign({},n)},Il={start:{},end:{},value:{},formats:{},types:{}};Sl.prototype.clone=function(){var e=new Sl(this.type,this.stream,this.opts);return e.start=this._start,e.end=this._end,e.format=this.format,e},Il.start.get=function(){return this._start},Il.start.set=function(e){this._start=e,this._value=null},Il.end.get=function(){return this._end},Il.end.set=function(e){this._end=e,this._value=null},Il.value.get=function(){return this._value||(this._value=this.stream.substring(this.start,this.end)),this._value},Il.formats.get=function(){return Tl},Il.types.get=function(){return Al},Object.defineProperties(Sl.prototype,Il);var Ol={ASTERISK:42,UNDERSCORE:95,BACKTICK:96,EXCLAMATION:33,QUOTATION:34,APOSTROPHE:39,LEFT_PRNTHS:40,RIGHT_PRNTHS:41,COMMA:44,PERIOD:46,COLON:58,SEMICOLON:59,QUESTION:63,LEFT_BRACKET:91,RIGHT_BRACKET:93,LEFT_BRACE:123,RIGHT_BRACE:125,DASH:45,EN_DASH:8211,EM_DASH:8212,TAB:9,SPACE:32,NBSP:160,NEW_LINE:10,RETURN:13,LINE_FEED:12,USER_STICKER_BEGIN:[35,117],USER_STICKER_END:[115,35]},xl=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Dl=/[\0-\x1F\x7F-\x9F]/,Ml=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,jl=/[!-#%-\*,-/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,Pl=function(e){var t={};t.src_Any=xl.source,t.src_Cc=Dl.source,t.src_Z=Ml.source,t.src_P=jl.source,t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|"),t.src_ZCc=[t.src_Z,t.src_Cc].join("|");return t.src_pseudo_letter="(?:(?![><｜]|"+t.src_ZPCc+")"+t.src_Any+")",t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?",t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",t.src_host_terminator="(?=$|[><｜]|"+t.src_ZPCc+")(?!-|_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))",t.src_path="(?:[/?#](?:(?!"+t.src_ZCc+"|[><｜]|[()[\\]{}.,\"'?!\\-]).|\\[(?:(?!"+t.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+t.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+t.src_ZCc+'|["]).)+\\"|\\\'(?:(?!'+t.src_ZCc+"|[']).)+\\'|\\'(?="+t.src_pseudo_letter+"|[-]).|\\.{2,3}[a-zA-Z0-9%/]|\\.(?!"+t.src_ZCc+"|[.]).|"+(e&&e["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+"\\,(?!"+t.src_ZCc+").|\\!(?!"+t.src_ZCc+"|[!]).|\\?(?!"+t.src_ZCc+"|[?]).)+|\\/)?",t.src_email_name='[\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]+',t.src_xn="xn--[a-z0-9\\-]{1,59}",t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63})",t.src_domain="(?:"+t.src_xn+"|(?:"+t.src_pseudo_letter+")|(?:"+t.src_pseudo_letter+"(?:-(?!-)|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+"))",t.src_host="(?:(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+"))",t.tpl_host_fuzzy="(?:"+t.src_ip4+"|(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%)))",t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))",t.src_host_strict=t.src_host+t.src_host_terminator,t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator,t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator,t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))",t.tpl_email_fuzzy="(^|[><｜]|\\(|"+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")",t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+t.src_ZPCc+"))((?![$+<=>^`|｜])"+t.tpl_host_port_fuzzy_strict+t.src_path+")",t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+t.src_ZPCc+"))((?![$+<=>^`|｜])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")",t},Ll={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1},Nl={"http:":{validate:function(e,t,n){var o=e.slice(t);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(o)?o.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(e,t,n){var o=e.slice(t);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(o)?t>=3&&":"===e[t-3]?0:t>=3&&"/"===e[t-3]?0:o.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(e,t,n){var o=e.slice(t);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(o)?o.match(n.re.mailto)[0].length:0}}},Rl="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",zl="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");Rs.prototype.add=function(e,t){return this.__schemas__[e]=t,Ps(this),this},Rs.prototype.set=function(e){return this.__opts__=Cs(this.__opts__,e),this},Rs.prototype.test=function(e){var t=this;if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;var n,o,s,i,r,a,c,l;if(this.re.schema_test.test(e))for((c=this.re.schema_search).lastIndex=0;null!==(n=c.exec(e));)if(i=t.testSchemaAt(e,n[2],c.lastIndex)){t.__schema__=n[2],t.__index__=n.index+n[1].length,t.__last_index__=n.index+n[0].length+i;break}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(l=e.search(this.re.host_fuzzy_test))>=0&&(this.__index__<0||l<this.__index__)&&null!==(o=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))&&(r=o.index+o[1].length,(this.__index__<0||r<this.__index__)&&(this.__schema__="",this.__index__=r,this.__last_index__=o.index+o[0].length)),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&e.indexOf("@")>=0&&null!==(s=e.match(this.re.email_fuzzy))&&(r=s.index+s[1].length,a=s.index+s[0].length,(this.__index__<0||r<this.__index__||r===this.__index__&&a>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=r,this.__last_index__=a)),this.__index__>=0},Rs.prototype.pretest=function(e){return this.re.pretest.test(e)},Rs.prototype.testSchemaAt=function(e,t,n){return this.__compiled__[t.toLowerCase()]?this.__compiled__[t.toLowerCase()].validate(e,n,this):0},Rs.prototype.match=function(e){var t=this,n=0,o=[];this.__index__>=0&&this.__text_cache__===e&&(o.push(Ns(this,n)),n=this.__last_index__);for(var s=n?e.slice(n):e;this.test(s);)o.push(Ns(t,n)),s=s.slice(t.__last_index__),n+=t.__last_index__;return o.length?o:null},Rs.prototype.tlds=function(e,t){return e=Array.isArray(e)?e:[e],t?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(e,t,n){return e!==n[t-1]}).reverse(),Ps(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,Ps(this),this)},Rs.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),"mailto:"!==e.schema||/^mailto:/i.test(e.url)||(e.url="mailto:"+e.url)},Rs.prototype.onCompile=function(){};var Hl=new Rs;Hl.tlds("chat",!0);var Fl=new Map([[":-)","😊"],[":)","😊"],[":-(","😞"],[":(","😞"],[";-)","😉"],[";)","😉"],[":-D","😃"],[":-@","😣"],["^o)","😑"],[":-S","😖"],["*-)","😐"],[":-|","😠"],["8oI","😡"],[":'(","😢"],[":-P","😜"],[":-$","☺"],[":-O","😲"],["|-)","😪"],["(ch)","😏"],["(lo)","😍"],["(sr)","😔"],["|-(","😴"],["(H)","😎"],["(hu)","😬"],["(tr)","😒"],["(md)","😵"],["(fr)","😄"],["(dt)","😟"],["(sc)","😕"],["(Y)","👍"],["(y)","👍"],["(N)","👎"],["(v)","✌"],["(L)","❤"],["(U)","💔"],["(K)","💋"],["(F)","🌼"],["(*)","⭐"],["(^)","🎂"],["(G)","🎁"],["(B)","🍺"],["(D)","🍸"],["(CC)","☕"],["(pi)","🍕"],["(pl)","🍴"],["(ic)","🍦"],["($)","💰"],["(so)","⚽"],["(te)","🎾"],["(nt)","🎵"],["(E)","✉"],["(Z)","👦"],["(X)","👧"],["(S)","🌙"],["☹","😦"]]),Ul=["😄","😃","😀","😊","☺","😉","😍","😘","😚","😗","😙","😜","😝","😛","😳","😁","😔","😌","😒","😞","😣","😢","😂","😭","😪","😥","😰","😅","😓","😩","😫","😨","😱","😠","😡","😤","😖","😆","😋","😷","😎","😴","😵","😲","😟","😦","😧","😈","👿","😮","😬","😐","😕","😯","😶","😇","😏","😑","👲","👳","👮","👷","💂","👶","👦","👧","👨","👩","👴","👵","👱","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💀","👽","💩","🔥","✨","🌟","💫","💥","💢","💦","💧","💤","💨","👂","👀","👃","👅","👄","👍","👎","👌","👊","✊","✌","👋","✋","👐","👆","👇","👉","👈","🙌","🙏","☝","👏","💪","🚶","🏃","💃","👫","👪","👬","👭","💏","💑","👯","🙆","🙅","💁","🙋","💆","💇","💅","👰","🙎","🙍","🙇","🎩","👑","👒","👟","👞","👡","👠","👢","👕","👔","👚","👗","🎽","👖","👘","👙","💼","👜","👝","👛","👓","🎀","🌂","💄","💛","💙","💜","💚","❤","💔","💗","💓","💕","💖","💞","💘","💌","💋","💍","💎","👤","👥","💬","👣","💭"],ql=["🐶","🐺","🐱","🐭","🐹","🐰","🐸","🐯","🐨","🐻","🐷","🐽","🐮","🐗","🐵","🐒","🐴","🐑","🐘","🐼","🐧","🐦","🐤","🐥","🐣","🐔","🐍","🐢","🐛","🐝","🐜","🐞","🐌","🐙","🐚","🐠","🐟","🐬","🐳","🐋","🐄","🐏","🐀","🐃","🐅","🐇","🐉","🐎","🐐","🐓","🐕","🐖","🐁","🐂","🐲","🐡","🐊","🐫","🐪","🐆","🐈","🐩","🐾","💐","🌸","🌷","🍀","🌹","🌻","🌺","🍁","🍃","🍂","🌿","🌾","🍄","🌵","🌴","🌲","🌳","🌰","🌱","🌼","🌐","🌞","🌝","🌚","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌜","🌛","🌙","🌍","🌎","🌏","🌋","🌌","🌠","⭐","☀","⛅","☁","⚡","☔","❄","⛄","🌀","🌁","🌈","🌊"],$l=["🎍","💝","🎎","🎒","🎓","🎏","🎆","🎇","🎐","🎑","🎃","👻","🎅","🎄","🎁","🎋","🎉","🎊","🎈","🎌","🔮","🎥","📷","📹","📼","💿","📀","💽","💾","💻","📱","☎","📞","📟","📠","📡","📺","📻","🔊","🔉","🔈","🔇","🔔","🔕","📢","📣","⏳","⌛","⏰","⌚","🔓","🔒","🔏","🔐","🔑","🔎","💡","🔦","🔆","🔅","🔌","🔋","🔍","🛁","🛀","🚿","🚽","🔧","🔩","🔨","🚪","🚬","💣","🔫","🔪","💊","💉","💰","💴","💵","💷","💶","💳","💸","📲","📧","📥","📤","✉","📩","📨","📯","📫","📪","📬","📭","📮","📦","📝","📄","📃","📑","📊","📈","📉","📜","📋","📅","📆","📇","📁","📂","✂","📌","📎","✒","✏","📏","📐","📕","📗","📘","📙","📓","📔","📒","📚","📖","🔖","📛","🔬","🔭","📰","🎨","🎬","🎤","🎧","🎼","🎵","🎶","🎹","🎻","🎺","🎷","🎸","👾","🎮","🃏","🎴","🀄","🎲","🎯","🏈","🏀","⚽","⚾","🎾","🎱","🏉","🎳","⛳","🚵","🚴","🏁","🏇","🏆","🎿","🏂","🏊","🏄","🎣","☕","🍵","🍶","🍼","🍺","🍻","🍸","🍹","🍷","🍴","🍕","🍔","🍟","🍗","🍖","🍝","🍛","🍤","🍱","🍣","🍥","🍙","🍘","🍚","🍜","🍲","🍢","🍡","🍳","🍞","🍩","🍮","🍦","🍨","🍧","🎂","🍰","🍪","🍫","🍬","🍭","🍯","🍎","🍏","🍊","🍋","🍒","🍇","🍉","🍓","🍑","🍈","🍌","🍐","🍍","🍠","🍆","🍅","🌽"],Gl=["🏠","🏡","🏫","🏢","🏣","🏥","🏦","🏪","🏩","🏨","💒","⛪","🏬","🏤","🌇","🌆","🏯","🏰","⛺","🏭","🗼","🗾","🗻","🌄","🌅","🌃","🗽","🌉","🎠","🎡","⛲","🎢","🚢","⛵","🚤","🚣","⚓","🚀","✈","💺","🚁","🚂","🚊","🚉","🚞","🚆","🚄","🚅","🚈","🚇","🚝","🚋","🚃","🚎","🚌","🚍","🚙","🚘","🚗","🚕","🚖","🚛","🚚","🚨","🚓","🚔","🚒","🚑","🚐","🚲","🚡","🚟","🚠","🚜","💈","🚏","🎫","🚦","🚥","⚠","🚧","🔰","⛽","🏮","🎰","♨","🗿","🎪","🎭","📍","🚩","🇯🇵","🇰🇷","🇩🇪","🇨🇳","🇺🇸","🇫🇷","🇪🇸","🇮🇹","🇷🇺","🇬🇧"],Bl=["1⃣","2⃣","3⃣","4⃣","5⃣","6⃣","7⃣","8⃣","9⃣","0⃣","🔟","🔢","#⃣","🔣","⬆","⬇","⬅","➡","🔠","🔡","🔤","↗","↖","↘","↙","↔","↕","🔄","◀","▶","🔼","🔽","↩","↪","ℹ","⏪","⏩","⏫","⏬","⤵","⤴","🆗","🔀","🔁","🔂","🆕","🆙","🆒","🆓","🆖","📶","🎦","🈁","🈯","🈳","🈵","🈴","🈲","🉐","🈹","🈺","🈶","🈚","🚻","🚹","🚺","🚼","🚾","🚰","🚮","🅿","♿","🚭","🈷","🈸","🈂","Ⓜ","🛂","🛄","🛅","🛃","🉑","㊙","㊗","🆑","🆘","🆔","🚫","🔞","📵","🚯","🚱","🚳","🚷","🚸","⛔","✳","❇","❎","✅","✴","💟","🆚","📳","📴","🅰","🅱","🆎","🅾","💠","➿","♻","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","⛎","🔯","🏧","💹","💲","💱","❌","‼","⁉","❗","❓","❕","❔","⭕","🔝","🔚","🔙","🔛","🔜","🔃","🕛","🕧","🕐","🕜","🕑","🕝","🕒","🕞","🕓","🕟","🕔","🕠","🕕","🕖","🕗","🕘","🕙","🕚","🕡","🕢","🕣","🕤","🕥","🕦","✖","➕","➖","➗","♠","♥","♣","♦","💮","💯","✔","☑","🔘","🔗","➰","〰","〽","🔱","◼","◻","◾","◽","▪","▫","🔺","🔲","🔳","⚫","⚪","🔴","🔵","🔻","⬜","⬛","🔶","🔷","🔸","🔹"],Vl=[].concat(Array.from(Fl.keys()),Ul,ql,$l,Gl,Bl),Wl=function(e){this.emojiDict=e},Kl={emojiDict:{},emojiTree:{}};Kl.emojiDict.set=function(e){this._emojiDict=e,this._emojiTree=this.createEmojiTree(e)},Kl.emojiDict.get=function(){return this._emojiDict},Kl.emojiTree.get=function(){return this._emojiTree},Wl.prototype.createEmojiTree=function(e){var t=new Map;return e&&e.forEach(function(e){si(t,e)}),t},Object.defineProperties(Wl.prototype,Kl);var Yl=new Wl(Vl),Zl=function(){};Zl.prototype.parse=function(e,t){void 0===t&&(t={});var n=ds(e||"",Yl.emojiTree);return n.length&&(n=zs(n,t),t.highlights&&(n=Ks(n,t.highlights)),t.focusHighlight>=0&&(n=Ys(n,t.focusHighlight)),t.cutFormattingChars&&(n=n.filter(function(e){return e.type!==e.types.FORMATTING})),n=ni(n)),n};var Jl=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},Ql=new Zl;defineComponent("ok-search-results",function(e){var t={search:{type:"json",value:null},chats:{type:"json",value:null}},n=function(){var e={class:"not-found __gaokal"},t=function(e){"chat"===e.get("value","type")?(e.open(0,"ok-chats-list-item",{chat:e.get("value","item"),selected:e.get("value","item","selected"),"data-item-id":e.get("value","id"),class:"__gaokal"}),e.close()):"delimiter"===e.get("value","type")?(e.open(1,"h4",{class:"h4 __gaokal","data-item-id":e.get("value","id")}),"PUBLIC_CHATS"==e.get("value","id")?(e.addText(2,"Открытые чаты и каналы"),e.variable("more",e.get(["max",e.get("$public-chats")-2,0])),e.get("$more")&&(e.open(3,"span",{class:"header-more __gaokal","on-click":["onSearchContext",e.get("value","item")]}),e.setText("Ещё "+e.get("$more")),e.close())):"CHATS"==e.get("value","id")?e.addText(4,"Чаты"):"MESSAGES"==e.get("value","id")&&e.addText(5,"Текст в сообщениях"),e.close()):(e.open(6,"ok-search-results-item",{data:e.get("value","item"),selected:e.get("value","item","selected"),"data-item-id":e.get("value","id"),class:"__gaokal"}),e.close())},n=function(e){return e.get("value","id")};return function(o){o.variable("list",o.get(["state","scroll-list"])),o.variable("public-chats",o.get("@search","counters","PUBLIC_CHATS")||0),o.open(0,"div",{style:"height: "+(o.get("$list","before")||0)+"px;",class:"__gaokal"}),o.close(),o.iterate(1,o.get("$list","items"),t,n),o.open(2,"div",{style:"height: "+(o.get("$list","after")||0)+"px;",class:"__gaokal"}),o.close(),o.get(["count",o.get("$list","items",function(e){return"search"===e.get("value","type")})])||(o.open(3,"div",e),o.setText("Ничего не найдено"),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"gaokal"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var t=this;e.prototype.init.call(this),this._list=new wl({itemHeight:64,initialItems:30,onUpdate:function(e){return t.state.set("scroll-list",e)}}),this.addEventListener("scroll",function(){return t.handleScroll()}),this._timeMark=Date.now(),this._firstChatId=null},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.emit("log-screen","CHATS_SEARCH")},o.prototype.attributeChangedCallback=function(e,t){var n=this;if("chats"===e){var o=ri(t).filter(function(e){return e.lastEventTime>n._timeMark&&Wc(e)}).sort(function(e,t){return t.lastEventTime-e.lastEventTime}).map(function(e){return hi("chat",e.id,e)});this.state.set("chats",o)}else if("search"===e){var s,i=ri(t&&t.result).reduce(function(e,t){return t.section!==s&&(s=t.section,e.push(hi("delimiter",s,s))),e.push(hi("search",t.section+"-"+t.chatId,pi(t))),e},[]);this.state.set("search",i)}},o.prototype.willRender=function(){var e=this.state.get("chats")||[],t=this.state.get("search")||[];this._list.update(e.concat(t),this)},o.prototype.didRender=function(){var e=this,t=this.state.get("chats"),n=t&&t[0];if(this._list.readRects(this,"data-item-id"),n&&n.id!==this._firstChatId){this._firstChatId=n.id;var o=this.scrollTop;o&&this._list.animateScroll(this,o,0)}requestAnimationFrame(function(){return e._loadMoreIfNeeded()})},o.prototype.handleScroll=function(){this._list.handleScroll(this),this._loadMoreIfNeeded()},o.prototype.onSearchContext=function(e,t,n){n.emit("chat-search-set-context",{type:e})},o.prototype._loadMoreIfNeeded=function(){var e=this.scrollHeight-this.scrollTop-this.offsetHeight<100,t=this.scrollHeight>this.offsetHeight;!e&&t||this.emit("chat-search-more")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-search-context-results",function(e){var t={search:{type:"json",value:null}},n=function(){var e={"on-click":"onReset",class:"__ytfh7z"},t={name:"label",class:"__ytfh7z"},n={class:"scroller __ytfh7z","on-scroll":"onScroll"},o=function(e){e.open(0,"ok-search-results-item",{data:e.get("value"),selected:e.get("value","selected"),class:"__ytfh7z"}),e.close()},s=function(e){return e.get("value","chat","id")};return function(i){i.open(0,"ok-button",e),i.open(1,"slot",t),i.emptySlot()&&i.setText("Все результаты"),i.close(),i.close(),i.open(2,"div",n),i.variable("list",i.get(["state","scroll-list"])),i.open(3,"div",{style:"height: "+(i.get("$list","before")||0)+"px;",class:"__ytfh7z"}),i.close(),i.iterate(4,i.get("$list","items"),o,s),i.open(5,"div",{style:"height: "+(i.get("$list","after")||0)+"px;",class:"__ytfh7z"}),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},scroller:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ytfh7z"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"chat-search-select-result":function(e,t){e.stopPropagation(),t.emit("chat-search-select-context-result",e.detail)}}},o.prototype.init=function(){var t=this;e.prototype.init.call(this),this._list=new wl({itemHeight:64,initialItems:30,onUpdate:function(e){return t.state.set("scroll-list",e)}})},s.scroller.get=function(){return this._scroller||(this._scroller=this.componentView.querySelector(".scroller")),this._scroller},o.prototype.attributeChangedCallback=function(e,t){if("search"===e){var n=t&&t.result;this._list.update(n||[],this.scroller)}},o.prototype.didRender=function(){var e=this;requestAnimationFrame(function(){return e._loadMoreIfNeeded()})},o.prototype.disconnectedCallback=function(){this._scroller=null,e.prototype.disconnectedCallback.call(this)},o.prototype.handleScroll=function(){this._list.handleScroll(this.scroller),this._loadMoreIfNeeded()},o.prototype.onScroll=function(e,t){t.handleScroll()},o.prototype._loadMoreIfNeeded=function(){if(this.getAttribute("search")){var e=this.scroller,t=e.scrollHeight-e.scrollTop-e.offsetHeight<100,n=e.scrollHeight>e.offsetHeight;!t&&n||this.emit("chat-search-context-more")}},o.prototype.reset=function(){this.emit("chat-search-reset-context")},o.prototype.onReset=function(e,t){t.reset()},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-connecting-indicator",function(e){var t={paused:{type:"boolean",value:!1}},n=function(){var e={class:"text __tu51ju"};return function(t){t.open(0,"slot",e),t.emptySlot()&&t.setText("Подключаюсь"),t.close(),t.open(1,"ok-loader",{type:"1",paused:t.get("@paused"),class:"__tu51ju"}),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"tu51ju"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-typing-indicator",function(e){var t={paused:{type:"boolean",value:!1},"hide-text":{type:"boolean",value:!1}},n=function(){var e={class:"dot __kn82vh"},t={class:"text __kn82vh"};return function(n){n.open(0,"i",e),n.close(),n.open(1,"i",e),n.close(),n.open(2,"i",e),n.close(),n.open(3,"slot",t),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"kn82vh"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var Xl=864e5,eu=6e4*(new Date).getTimezoneOffset(),tu={today:"сегодня",yesterday:"вчера"},nu=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],ou="unread",su=new Set(["PHOTO","VIDEO"]),iu={key:"uid",showReadMarkLimits:[15,200]},ru=function(e){this._prev=[],this._list=null,this._firstUnread=null,this._prevArgs=[],this.setOptions(e)},au={list:{}};au.list.get=function(){return this._list||[]},au.list.set=function(e){e&&this._list&&ko(e,this._list,!0)||(this._list=e)},ru.prototype.get=function(e){if(this._list){var t=this._list.length;return this._list[(t+e)%t]}return null},ru.prototype.setOptions=function(e){this.options=Object.assign({},iu,e)},ru.prototype.update=function(e,t,n){for(var o=this,s=[e,t,n],i=0;i<s.length;i++)if(s[i]!==o._prevArgs[i]){o.list=o.transform(e,t,n,o._list);break}return this._prevArgs=s,this.list},ru.prototype.transform=function(e,t,n,o){var s=this.options.key,i=Oo(o||[],s),r=Ni(e),a=Li(e.messages,s,i);return a=gi(a,s,i),null===this._firstUnread&&(this._firstUnread=Hi(a,s),console.log("got first unread",this._firstUnread)),this._firstUnread&&(a=yi(a,s,this._firstUnread,i)),a=ki(a),a=Ri(a,s,t,n),"DIALOG"===e.type?a=Ii(a,s,r,i):this.options.showReadMarkLimits[0]>e.participantsCount?a=Oi(a,s,r,i):this.options.showReadMarkLimits[1]>e.participantsCount&&(a=xi(a,s,r,i)),zi(a,e)},ru.prototype.reset=function(){this._firstUnread=null},Object.defineProperties(ru.prototype,au);var cu=function(e,t){this.fetchArea=t||0,this._request=e,this._cache=new Set};cu.prototype.fetch=function(e,t){var n,o=this;if(e.scrollTop<=this.fetchArea)for(n=0;n<t.length;){if(t[n].time){o._fetch(t[n].time,"backward");break}n++}if(e.scrollTop>=e.scrollHeight-e.offsetHeight-this.fetchArea)for(n=t.length-1;n>=0;){if(t[n].time){o._fetch(t[n].time,"forward");break}n--}},cu.prototype.reset=function(){this._cache.clear()},cu.prototype._fetch=function(e,t){var n=e+":"+t;this._cache.has(n)||(this._cache.add(n),this._request(e,t))};var lu=new Set(["ok-message","ok-control-message"]),uu=function(e,t){var n=Ki(Ui());if(n&&n.anchorNode!==n.focusNode){var o=$i(n,t),s=o.reversed,i=o.messages;!i||i.length<2||Wi(e,Vi(n,i,s))}},pu=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].find(function(e){return"on"+e in document}),hu=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"].find(function(e){return e in document}),du=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-message-list",function(e){var t={chat:{type:"json",value:null},selected:{type:"json",value:null},highlighted:{type:"string",value:""},"multi-mode":{type:"boolean",value:!1},"show-rm-limits":{value:""}},n=function(){var e={class:"scroller __cry7km","on-scroll":"onScroll"},t={type:"1",class:"__cry7km"},n={class:"date __cry7km"},o={class:"unread __cry7km"},s={class:"control-message __cry7km"},i={icon:"arrow-down",size:"medium",class:"__cry7km"},r=function(e){e.variable("id",e.get("value","uid")),e.variable("is-own",!(!e.get("value","sender","current")||"CHANNEL"===e.get("value","type")||"CHANNEL_ADMIN"===e.get("value","type"))),"date"===e.get("value","type")?(e.open(0,"div",{class:"date-delimiter __cry7km","data-item-id":e.get("$id")}),e.open(1,"span",n),e.setText(e.get("value","label")),e.close(),e.close()):"unread"===e.get("value","type")?(e.open(2,"div",{class:"unread-delimiter __cry7km","data-item-id":e.get("$id")}),e.open(3,"span",o),e.setText("Новые сообщения"),e.close(),e.close()):"readMark"===e.get("value","type")?(e.open(4,"ok-message-delimiter-participants",{message:e.get("value"),"is-own":e.get("$is-own"),"data-item-id":e.get("$id"),class:"__cry7km"}),e.close()):"CONTROL"===e.get("value","attaches",0,"_type")?(e.open(5,"div",s),e.open(6,"ok-control-message",{message:e.get("value"),"is-own":e.get("$is-own"),"data-item-id":e.get("$id"),class:"__cry7km"}),e.close(),e.close()):(e.open(7,"ok-message",{message:e.get("value"),"is-own":e.get("$is-own"),"in-chat":e.get("$in-chat"),"is-channel-admin":e.get("$is-chat-admin"),unread:e.get("value","unread"),"select-mode":e.get("$select-mode"),"data-item-id":e.get("$id"),"is-visible":e.get(["state","visible-messages"],["has",e.get("value","id")]),class:"__cry7km"}),e.get("value","highlighted")&&e.addClass("__highlighted"),e.close())},a=function(e){return e.get("value","uid")},c=function(e){e.open(0,"div",{"data-group":e.get("id"),class:"__cry7km"}),e.iterate(1,e.get("items"),r,a),e.close()},l=function(e){return e.get("id")};return function(n){n.open(0,"div",e),n.variable("list",n.get(["state","scroll-list"])),n.variable("is-chat-admin",n.get("@chat","owner","current")||n.get("@chat","admins",function(e){return e.get("current")})),n.variable("in-chat","DIALOG"!==n.get("@chat","type")),n.variable("select-mode",n.get("@multi-mode")),n.open(1,"div",{style:"height: "+(n.get("$list","before")||0)+"px; text-align: center;",class:"__cry7km"}),"loading"==n.get("@chat","loadState")&&(n.open(2,"ok-loader",t),n.close()),n.close(),n.iterate(3,n.get("$list","groups"),c,l),n.open(4,"div",{style:"height: "+(n.get("$list","after")||0)+"px",class:"__cry7km"}),n.close(),n.close(),n.open(5,"ok-button",{shape:"circle",role:"secondary",size:"big","on-click":"onScrollToBottom",class:"__cry7km"}),n.get(["state","arrow-visible"])&&n.addClass("__visible"),n.get("@chat","unreadCount")&&n.addClass("__has-unread"),n.open(6,"ok-icon",i),n.close(),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},scroller:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cry7km"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._messages=new ru,this._list=new wl({initialItems:25,itemHeight:34,paddingTop:7,paddingBottom:20,alignBottom:!0,reconcile:"prepend",key:"uid",onUpdate:function(t){return e._setScrollModel(t)}}),this._fetcher=new cu(function(t,n){var o=e.getAttribute("chat");("forward"!==n||t<o.lastMessage.time)&&("loading"===o.loadState||Yi()||e.emit("fetch-messages",{chatId:e.getAttribute("chat").id,options:{from:t,direction:n}}))},500),this._windowFocused=!0,this._onFocus=function(){e._windowFocused=!0,e._debouncedMarkAsRead()},this._onBlur=function(){e._windowFocused=!1},this._onFullscreenChange=function(){Yi()||(e.scroller.scrollTop=e._lastScrollTop)},this._prevChatId=null,this._lastMessage=null,this._lastFocusedMessage=null,this._hlTimer=null,this._markAsReadTimer=null,this._lastScrollTop=0,this._viewedMessages=new Set,this._debouncedMarkAsRead=function(){clearTimeout(e._markAsReadTimer),e._windowFocused&&(e._markAsReadTimer=setTimeout(function(){return e.markVisibleAsRead()},500))},this._debouncedUpdateVisible=function(){clearTimeout(e._updateVisibleTimer),e._updateVisibleTimer=setTimeout(function(){return e.updateVisibleMessages()},500)},this.addEventListener("copy",function(t){return uu(t,e._messages.list)})},o.prototype.attributeChangedCallback=function(e,t){var n=this;"highlighted"===e&&t&&(clearTimeout(this._hlTimer),this._hlTimer=setTimeout(function(){return n.emit("highlight-message-end")},1500))},o.prototype.willRender=function(){if(this.state.get("_initial")){var e=this.getAttribute("chat"),t=this.getAttribute("selected"),n=this.getAttribute("highlighted"),o=e&&e.id;o!==this._prevChatId?this.reset():this._anchor=this._list.getAnchor(this.scroller,Zi),this._prevChatId=o,this._messages.update(e,t,n),this._scrollTo=this._getScrollTo(),this._list.update(this._messages.list,this._scroller,this._scrollTo&&this._scrollTo.target)}},o.prototype.didRender=function(){if(!this.state.get("_initial"))return this.state.set("_initial",!0),void Fi(this.scroller);var e=this.scroller;if(this._list.readRects(this.scroller,"data-item-id"),this._anchor&&(this._list.restoreAnchor(this._anchor,e),this._anchor=null),this._scrollTo){var t=this._scrollTo,n=t.target,o=t.pos,s=t.animate;this._list.scrollTo(n,e,o,s)}e.scrollHeight===e.clientHeight&&this.handleScroll(),this._checkArrowState(),this._debouncedMarkAsRead()},o.prototype.connectedCallback=function(){window.addEventListener("focus",this._onFocus),window.addEventListener("blur",this._onBlur),document.addEventListener(pu,this._onFullscreenChange),e.prototype.connectedCallback.call(this)},o.prototype.disconnectedCallback=function(){this._scroller=null,window.removeEventListener("focus",this._onFocus),window.removeEventListener("blur",this._onBlur),document.removeEventListener(pu,this._onFullscreenChange),e.prototype.disconnectedCallback.call(this)},s.scroller.get=function(){return this._scroller||(this._scroller=this.componentView.querySelector(".scroller")),this._scroller},o.prototype.handleScroll=function(){if(!Yi()){var e=this.scroller;this._lastScrollTop=e.scrollTop,this._list.handleScroll(e),this._fetcher.fetch(e,this._messages.list),this._checkArrowState(),this._debouncedMarkAsRead(),this._debouncedUpdateVisible()}},o.prototype.scrollTo=function(e){e&&this.state.set("scroll-to",e)},o.prototype.scrollToBottom=function(){var e=this.getAttribute("chat");Ji(this._messages.list,e.lastMessage)?this.scrollTo(this._messages.get(-1)):(this._lastMessage=null,this.emit("fetch-messages",{chatId:e.id,options:{from:e.lastMessage.time,direction:"backward"}}))},o.prototype.onScroll=function(e,t){t.handleScroll()},o.prototype.onScrollToBottom=function(e,t){t.scrollToBottom()},o.prototype.reset=function(){console.log("reset chat state"),this._lastMessage=null,this._lastFocusedMessage=null,this._fetcher.reset(),this._list.reset(),this._messages.reset(),this._messages.setOptions({showReadMarkLimits:this.getAttribute("show-rm-limits")})},o.prototype.markVisibleAsRead=function(){var e=this,t=this._list.visibleItems(this.scroller).filter(function(e){return e.time}),n=this.getAttribute("chat");if(t.length&&this.emit("update-read-mark",{chatId:n.id,mark:t[t.length-1].time}),"CHANNEL"===n.type){var o=t.map(function(e){return e.uid}).filter(function(t){return!(!t||e._viewedMessages.has(t))&&(e._viewedMessages.add(t),!0)});o.length&&this.emit("update-messages-stats",{chatId:n.id,messageUids:o})}},o.prototype.updateVisibleMessages=function(){var e=this._list.visibleItems(this.scroller).reduce(function(e,t){return e.add(t.id)},new Set);this.state.set("visible-messages",e)},o.prototype._getScrollTo=function(){var e=null,t=0,n=null,o=this.getAttribute("chat"),s=this._messages,i=s.get(-1),r=o.focusedMessage;if(this.state.get("scroll-to"))e=this.state.get("scroll-to"),this.state.delete("scroll-to");else if(r&&r!==this._lastFocusedMessage){var a=s.list.find(function(e){return e.uid===r||e.id===r});a&&(e=a,t=.5,this._lastFocusedMessage=o.focusedMessage,Ji(s.list,e)||(n=!1))}else this._lastMessage||(e=s.list.find(function(e){return"unread"===e.type})||i,n=!1);o.focusedMessage||(this._lastFocusedMessage=null);var c=this._handleLastMessageUpdate();return e||(e=c),e?{target:e,pos:t,animate:n}:null},o.prototype._handleLastMessageUpdate=function(){var e,t=this.getAttribute("chat"),n=this._messages.get(-1);if(n&&n.time===t.lastMessage.time){if(this._lastMessage&&this._lastMessage.uid!==n.uid)if(t.lastMessage.sender&&t.lastMessage.sender.current)e=n;else{var o=this.scroller.scrollTop+this.scroller.clientHeight,s=this._list.itemPos(n,this._messages.list)-o+this._list.options.paddingBottom;s>=-125&&s<250&&(e=n)}this._lastMessage=n}return this._lastMessage||(this._lastMessage=t.lastMessage),e},o.prototype._checkArrowState=function(){var e=this.scroller,t=e.scrollHeight-e.scrollTop-e.clientHeight;this.state.set("arrow-visible",t>250)},o.prototype._getUnreadItem=function(){return this._messages.list.find(function(e){return"unread"===e.type||e.unread})},o.prototype._setScrollModel=function(e){var t=this;if(e.items.length&&"date"!==e.items[0].type)for(var n=e.from,o=this._messages.list;--n>=0;)if("date"===o[n].type){e=du({},e,{items:[{value:o[n]}].concat(e.items),before:e.before-t._list.itemHeight(o[n])});break}var s,i=[];e.items.forEach(function(e){"date"===e.value.type?(s=[e],i.push({id:"g-"+e.value.date.getTime(),items:s})):s.push(e)}),this.state.set("scroll-list",du({},e,{groups:i}))},Object.defineProperties(o.prototype,s),o}(e)});var fu=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-message-search-results",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={class:"date __ym90pb"},t={type:"1",class:"__ym90pb"},n={class:"search-empty __ym90pb"},o=function(t){t.variable("id",t.get("value","id")),"date"===t.get("value","type")?(t.open(0,"div",{class:"date-delimiter __ym90pb","data-item-id":t.get("$id")}),t.open(1,"span",e),t.setText(t.get("value","label")),t.close(),t.close()):(t.open(2,"ok-message-search-results-item",{data:t.get("value"),"data-item-id":t.get("$id"),class:"__ym90pb"}),t.close())},s=function(e){return e.get("value","id")},i=function(e){e.open(0,"div",{"data-group":e.get("id"),class:"__ym90pb"}),e.iterate(1,e.get("items"),o,s),e.close()},r=function(e){return e.get("id")};return function(e){e.variable("list",e.get(["state","scroll-list"])),e.get(["count",e.get("$list","items")])?(e.open(0,"div",{style:"height: "+(e.get("$list","before")||0)+"px;",class:"__ym90pb"}),e.close(),e.iterate(1,e.get("$list","groups"),i,r),e.open(2,"div",{style:"height: "+(e.get("$list","after")||0)+"px; text-align: center;",class:"__ym90pb"}),"loading"==e.get("@chat","loadState")&&(e.open(3,"ok-loader",t),e.close()),e.close()):"idle"==e.get("@chat","loadState")&&(e.open(4,"div",n),e.setText("Не найдено сообщений по такому запросу"),e.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ym90pb"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var t=this;e.prototype.init.call(this),this._list=new wl({initialItems:25,itemHeight:34,paddingBottom:10,onUpdate:function(e){return t._setScrollModel(e)}}),this.addEventListener("scroll",function(){return t.handleScroll()})},o.prototype.willRender=function(){var e=Qi(this.getAttribute("chat"),this._prevItems);this._prevItems&&ko(e,this._prevItems,!0)||(this._prevItems=e,this._list.update(e,this))},o.prototype.didRender=function(){this._readRects()},o.prototype.handleScroll=function(){this._list.handleScroll(this),this.scrollHeight-this.scrollTop-this.offsetHeight<200&&this.emit("message-search-more")},o.prototype._readRects=function(){for(var e=this,t=this.componentView.querySelectorAll("[data-item-id]"),n=0,o=t.length,s=void 0;n<o;n++)s=t[n],e._list.itemHeight(s.getAttribute("data-item-id"),s.offsetHeight)},o.prototype._setScrollModel=function(e){var t=this;if(e.items.length&&"date"!==e.items[0].type)for(var n=e.from,o=this._list.items;--n>=0;)if("date"===o[n].type){e=fu({},e,{items:[{value:o[n]}].concat(e.items),before:e.before-t._list.itemHeight(o[n])});break}var s,i=[];e.items.forEach(function(e){"date"===e.value.type?(s=[e],i.push({id:"g-"+e.value.date.getTime(),items:s})):s.push(e)}),this.state.set("scroll-list",fu({},e,{groups:i}))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-info",function(){var e={chat:{type:"json",value:null},contacts:{type:"json",value:null},active:{type:"boolean",value:!1}},t=function(){var e={"on-click":"close",class:"__7z4y2p"},t={class:"back __7z4y2p",shape:"square"},n={icon:"back",size:"medium",class:"__7z4y2p"},o={class:"title __7z4y2p"},s={class:"header __7z4y2p"},i={class:"header_inner __7z4y2p"},r={class:"header_avatar __7z4y2p"},a={for:"icon",class:"stub __7z4y2p"},c={shape:"circle",class:"__7z4y2p"},l={icon:"edit",size:"medium",class:"__7z4y2p"},u={type:"file",name:"icon",id:"icon","on-change":"onIconChange",class:"__7z4y2p"},p={class:"header_info __7z4y2p"},h={class:"header_name __7z4y2p"},d={icon:"edit",size:"medium","on-click":"showChatTitleInput",class:"__7z4y2p"},f={class:"header_meta __7z4y2p"},g={class:"channel_descr __7z4y2p"},_={class:"__7z4y2p"},m={class:"body __7z4y2p"},v={class:"block __7z4y2p"},y={"on-click":"copyLink",class:"__7z4y2p"},k={spaced:"true",icon:"link",size:"medium",class:"__7z4y2p"},b={"on-click":"enterChannelEditMode",class:"__7z4y2p"},w={spaced:"true",icon:"edit",size:"medium",class:"__7z4y2p"},C={key:"edit-channel",class:"__7z4y2p"},E={class:"tico __7z4y2p"},A={icon:"arrow-down",size:"medium",class:"__7z4y2p"},T={class:"tico_tx __7z4y2p"},S={key:"more",class:"__7z4y2p"},I={"on-click":"clearChat",class:"__7z4y2p"},O={spaced:"true",icon:"clean",size:"medium",class:"__7z4y2p"},x={key:"clear-chat-history",class:"__7z4y2p"},D={"on-click":"leaveChat",class:"__7z4y2p"},M={spaced:"true",icon:"leave",size:"medium",class:"__7z4y2p"},j={"on-click":"unblockContact",class:"__7z4y2p"},P={spaced:"true",size:"medium",icon:"unblock",class:"__7z4y2p"},L={key:"unblock",class:"__7z4y2p"},N={"on-click":"blockContact",class:"__7z4y2p"},R={spaced:"true",size:"medium",icon:"block",class:"__7z4y2p"},z={key:"block",class:"__7z4y2p"},H={"on-click":"removeDialog",class:"__7z4y2p"},F={spaced:"true",icon:"delete",size:"medium",class:"__7z4y2p"},U={key:"delete-chat",class:"__7z4y2p"},q={class:"block __flex __7z4y2p"},$={class:"inner __7z4y2p"},G={spaced:"true",icon:"add",size:"medium","on-click":"createChat",class:"add __7z4y2p"};return function(B){B.variable("contact",B.get("@chat","participants","*","user",function(e){return!e.get("current")})),B.variable("participants",B.get("@chat","participants","*","user")),B.variable("online",B.get("$participants",function(e){return e.get("presence","on")||e.get("current")})),B.open(0,"ok-toolbar",e),B.open(1,"ok-button",t),B.open(2,"ok-tico",n),B.setText("Назад"),B.close(),B.close(),B.open(3,"div",o),B.addText(4,"Информация "),"DIALOG"==B.get("@chat","type")?B.addText(5,"о контакте"):"CHAT"==B.get("@chat","type")?B.addText(6,"о чате"):"CHANNEL"==B.get("@chat","type")&&B.addText(7,"о канале"),B.close(),B.close(),B.open(8,"div",s),B.open(9,"div",i),B.open(10,"div",r),"DIALOG"==B.get("@chat","type")?(B.open(11,"ok-user-card",{user:B.get("$contact"),size:"big","show-status":"false",class:"__7z4y2p"}),B.close()):(B.open(12,"ok-avatar",{url:B.get("@chat","iconUrl"),id:B.get("@chat","id"),caption:B.get("@chat","title")||B.get("@chat","placeholder"),size:"big",class:"__7z4y2p"}),B.close(),"CHAT"==B.get("@chat","type")&&(B.open(13,"label",a),B.open(14,"ok-button",c),B.open(15,"ok-icon",l),B.close(),B.close(),B.open(16,"input",u),B.close(),B.close())),B.close(),B.open(17,"div",p),B.get(["state","edit-chat-title"])?(B.open(18,"ok-input",{value:B.get("@chat","title"),autofocus:"true",class:"__secondary __7z4y2p","on-keyup":"setNewChatTitle","on-focusout":"setNewChatTitle"}),B.close()):(B.open(19,"div",h),B.addText(20,B.get("@chat","title")||B.get("@chat","placeholder")),"CHAT"==B.get("@chat","type")&&"LEFT"!=B.get("@chat","status")&&(B.open(21,"ok-icon",d),B.close()),B.close(),B.open(22,"div",f),B.open(23,"ok-chat-meta",{chat:B.get("@chat"),class:"__7z4y2p"}),B.close(),B.close()),B.close(),B.close(),B.close(),B.get("@chat","description")&&(B.open(24,"div",g),B.open(25,"ok-parsed-text",_),B.setText(B.get("@chat","description")),B.close(),B.close()),B.open(26,"div",m),B.open(27,"div",v),B.open(28,"div",{class:"inner __7z4y2p"}),("CHAT"==B.get("@chat","type")&&B.get("@chat","participants","*","user",function(e){return e.get("current")})||"CHANNEL"==B.get("@chat","type")&&!B.get("@chat","owner","current")&&!B.get("@chat","admins",function(e){return e.get("current")}))&&B.addClass("__nb"),B.open(29,"ok-menu",_),B.get("@chat","link")&&(B.open(30,"ok-menu-item",y),B.open(31,"ok-tico",k),B.setText(B.get("@chat","link")),B.close(),B.close(),B.open(32,"input",{type:"text",value:B.get("@chat","link"),class:"chat-link-input __7z4y2p"}),B.close()),B.get("@chat","participants","*","user",function(e){return e.get("current")})&&(B.open(33,"ok-menu-item",_),B.open(34,"ok-chat-alerts-button",{chat:B.get("@chat"),class:"__7z4y2p"}),B.close(),B.close()),"CHANNEL"==B.get("@chat","type")&&B.get("@chat","owner","current")&&(B.open(35,"ok-menu-item",b),B.open(36,"ok-tico",w),B.open(37,"ok-l10n",C),B.close(),B.close(),B.close()),B.get("@chat","participants","*","user",function(e){return e.get("current")})&&(B.open(38,"ok-menu-item",{expanded:B.get(["state","expanded-menu"]),"on-click":"toggleExpanded",class:"__7z4y2p"}),B.open(39,"div",E),B.open(40,"ok-icon",A),B.close(),B.open(41,"div",T),B.open(42,"ok-l10n",S),B.close(),B.close(),B.close(),B.open(43,"ok-menu",_),"CHAT"==B.get("@chat","type")&&(B.open(44,"ok-menu-item",I),B.open(45,"ok-tico",O),B.open(46,"ok-l10n",x),B.close(),B.close(),B.close()),"DIALOG"!=B.get("@chat","type")&&(B.open(47,"ok-menu-item",D),B.open(48,"ok-tico",M),B.open(49,"ok-l10n",{key:"leave-chat","data-type":B.get("@chat","type"),class:"__7z4y2p"}),B.close(),B.close(),B.close()),"DIALOG"==B.get("@chat","type")&&("BLOCKED"==B.get("$contact","status")?(B.open(50,"ok-menu-item",j),B.open(51,"ok-tico",P),B.open(52,"ok-l10n",L),B.close(),B.close(),B.close()):(B.open(53,"ok-menu-item",N),B.open(54,"ok-tico",R),B.open(55,"ok-l10n",z),B.close(),B.close(),B.close()),B.open(56,"ok-menu-item",H),B.open(57,"ok-tico",F),B.open(58,"ok-l10n",U),B.close(),B.close(),B.close()),B.close(),B.close()),B.close(),B.close(),B.close(),"DIALOG"==B.get("@chat","type")&&(B.open(59,"div",q),B.open(60,"div",$),B.open(61,"ok-menu",_),B.open(62,"ok-menu-item",_),B.open(63,"ok-tico",G),B.setText("Добавить участников"),B.close(),B.close(),B.close(),B.close(),B.open(64,"div",{class:"modal __7z4y2p"}),"create-chat"==B.get(["state","active-state"])&&(B.addClass("__enabled"),B.open(65,"ok-chat-add-participants",{users:B.get(["state","own-contacts"]),disabled:B.get("@chat","participants","*","user","id"),"show-history-button":"false","data-type":"add-admins",class:"__7z4y2p"}),B.close()),B.close(),B.close()),"CHAT"==B.get("@chat","type")&&B.get("@chat","participants","*","user",function(e){return e.get("current")})&&(B.open(66,"div",q),B.open(67,"ok-chat-participants",{chat:B.get("@chat"),contacts:B.get(["state","contacts"]),class:"__7z4y2p"}),B.close(),B.open(68,"div",{class:"modal __7z4y2p"}),"add-participants"==B.get(["state","active-state"])&&(B.addClass("__enabled"),B.open(69,"ok-chat-add-participants",{users:B.get(["state","own-contacts"]),disabled:B.get("@chat","participants","*","user","id"),"data-type":"add-participants",class:"__7z4y2p"}),B.close()),B.close(),B.close()),"CHANNEL"==B.get("@chat","type")&&(B.get("@chat","owner","current")||B.get("@chat","admins",function(e){return e.get("current")}))&&(B.open(70,"div",q),B.open(71,"ok-channel-members-list",{chat:B.get("@chat"),class:"__7z4y2p"}),B.close(),B.open(72,"div",{class:"modal __7z4y2p"}),"add-members"==B.get(["state","active-state"])?(B.addClass("__enabled"),B.open(73,"ok-chat-add-participants",{users:B.get(["state","own-contacts"]),disabled:B.get("@chat","members","items","*","id"),"show-history-button":"false","data-type":"add-members",class:"__7z4y2p"}),B.close()):"add-admins"==B.get(["state","active-state"])&&(B.addClass("__enabled"),B.open(74,"ok-chat-add-participants",{users:B.get(["state","own-contacts"]),disabled:B.get("@chat","admins","*","id"),"show-history-button":"false","data-type":"add-admins",class:"__7z4y2p"}),B.close()),B.close(),B.close()),B.close(),"CHANNEL"==B.get("@chat","type")&&B.get("@chat","owner","current")&&(B.open(75,"div",{class:"modal __7z4y2p"}),"channel-settings"==B.get(["state","modal-state"])&&(B.addClass("__enabled"),B.open(76,"ok-channel-settings",{chat:B.get("@chat"),class:"__7z4y2p"}),B.close()),B.close())}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"7z4y2p"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},i.events.get=function(){return{"close-channel-settings":function(e,t){e.stopPropagation(),t.state.delete("modal-state")},"change-active-state":function(e,t){if(e.stopPropagation(),t.state.get("active-state")){var n=t.getAddMenuElement();n&&n.hasAdded()?this.showAddMenuConfirm(function(){n.reset(),t.state.set("active-state",e.detail)}):t.state.set("active-state",e.detail)}else t.state.set("active-state",e.detail)},"add-participants":function(e,t){e.stopPropagation();var n=e.detail,o=n.userIds,s=n.showHistory,i=t.getAttribute("chat"),r=i.id,a=t.state.get("active-state");"create-chat"===a?t.emit("create-chat-from-dialog",{chatId:r,userIds:o}):"add-admins"===a?t.emit("add-channel-admins",{chatId:r,userIds:o}):t.emit("add-participants",{chatId:r,userIds:o,showHistory:s}),"CHANNEL"===i.type?t.state.delete("active-state"):t.doClose()}}},o.prototype.disconnectedCallback=function(){delete this._sortedContacts},o.prototype.attributeChangedCallback=function(e,t,n){"chat"===e&&n&&t&&n.id!==t.id&&this.reset(),"contacts"===e&&t&&(this._sortedContacts?this._sortedContacts.update(t):this._sortedContacts=new yl(t,{skipCurrent:!0}),this.state.set("contacts",this._sortedContacts.items),this.state.set("own-contacts",Array.from(this._sortedContacts.items.values()).filter(function(e){return e.own})))},o.prototype.reset=function(){this.state.delete("active-state"),this.state.delete("modal-state")},o.prototype.doClose=function(){this.state.get("modal-state")?this.state.delete("modal-state"):this._doClose()},o.prototype.showChatTitleInput=function(e,t){t.state.set("edit-chat-title",!0)},o.prototype.setNewChatTitle=function(e,t){if(13===e.keyCode){var n=this.value.trim();if(n.length>0){var o=t.getAttribute("chat");if(n===o.title)return;var s=o.id;t.emit("update-chat-title",{chatId:s,title:n}),t.state.set("edit-chat-title",!1)}}else"focusout"!==e.type&&27!==e.keyCode||(e.stopPropagation(),t.state.set("edit-chat-title",!1))},o.prototype.onIconChange=function(e,t){var n=t.getAttribute("chat").id,o=e.target.files&&e.target.files[0];o&&/^image\//.test(o.type)&&(t.state.set("icon",o),t.emit("update-chat-icon",{chatId:n,icon:o}))},o.prototype.copyLink=function(e,t){var n=t.shadowDOM.querySelector(".chat-link-input");window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",n.value):(n.focus(),n.setSelectionRange(0,n.value.length),document.execCommand("copy")),t.emit("show-toast","Ссылка скопирована")},o.prototype.createChat=function(e,t){t.state.set("active-state","create-chat")},o.prototype.blockContact=function(e,t){t.emit("show-confirm",{header:"Заблокировать",body:"Всяких зануд и тех, с кем не хотите общаться, отправляйте в «чёрный список» – и они больше не будут вас беспокоить!",buttons:[{label:"Заблокировать",action:function(){return t.updateContact("BLOCK")}},"Отменить"]})},o.prototype.unblockContact=function(e,t){t.updateContact("UNBLOCK")},o.prototype.removeDialog=function(e,t){t.emit("show-confirm",{header:"Удалить чат",body:"Удалить весь чат? Восстановить его будет невозможно!",buttons:[{label:"Удалить",action:function(){t.doClose(),t.emitChatEvent("remove-chat")}},"Отменить"]})},o.prototype.clearChat=function(e,t){t.emit("show-confirm",{header:"Очистить чат",body:"Вы хотите очистить историю чата?",buttons:[{label:"Очистить",action:function(){t.doClose(),t.emitChatEvent("clear-chat")}},"Отменить"]})},o.prototype.leaveChat=function(e,t){var n=t.getAttribute("chat");t.emit("show-confirm",{header:ro("leave-chat-confirm-header",{type:n.type}),body:ro("leave-chat-confirm-body",{type:n.type}),buttons:[{label:ro("leave-chat-confirm-button"),action:function(){t.doClose(),t.emitChatEvent("remove-chat")}},ro("confirm-cancel-button")]})},o.prototype.toggleChatMute=function(e,t){var n=t.getAttribute("chat");if(n.settings){var o=0!==n.settings.dontDisturbUntil?0:-1;t.emit("update-chat-settings",{chatId:n.id,settings:{dontDisturbUntil:o}})}},o.prototype.enterChannelEditMode=function(e,t){t.state.set("modal-state","channel-settings")},o.prototype.emitChatEvent=function(e){var t=this.getAttribute("chat").id;this.emit(e,{chatId:t})},o.prototype.updateContact=function(e){var t=this.getAttribute("chat").participants.find(function(e){return!e.user.current}).user.id;this.emit("update-contact",{contactId:t,action:e})},o.prototype.toggleExpanded=function(e,t){var n=t.state.get("expanded-menu");t.state.set("expanded-menu",!n)},o.prototype._doClose=function(){var e=this,t=this.getAddMenuElement();t&&t.hasAdded()?this.showAddMenuConfirm(function(){t.reset(),e.reset(),n.prototype.doClose.call(e)}):(this.reset(),n.prototype.doClose.call(this))},o.prototype.showAddMenuConfirm=function(e){this.emit("show-confirm",{header:"Создание чата",body:"Вы выбрали пользователей, но не добавили их. Уверены, что хотите выйти?",buttons:[{label:"Выйти",action:e},"Отменить"]})},o.prototype.getAddMenuElement=function(){var e=this.state.get("active-state");return e?this.shadowDOM.querySelector('ok-chat-add-participants[data-type="'+e+'"]'):null},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(vl)}),defineComponent("ok-chat-meta",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={key:"empty-chat-participants-label",class:"__7z95rw"};return function(t){t.variable("participants",t.get("@chat","participants","*","user")),"DIALOG"==t.get("@chat","type")?(t.variable("contact",t.get("$participants",function(e){return!e.get("current")})),t.open(0,"ok-online-label",{user:t.get("$contact"),class:"__7z95rw"}),t.close()):"CHANNEL"==t.get("@chat","type")||t.get("@chat","participantsCount")>t.get(["count",t.get("$participants")])||!t.get("@chat","participants","*","user",function(e){return e.get("current")})?t.get("@chat","participantsCount")&&(t.open(1,"ok-l10n",{key:"subscribers-count","data-count":t.get("@chat","participantsCount"),class:"__7z95rw"}),t.close()):1==t.get("@chat","participantsCount")?(t.open(2,"ok-l10n",e),t.close()):(t.variable("online",t.get("$participants",function(e){return e.get("presence","on")||e.get("current")})),t.open(3,"ok-l10n",{key:"online-participants","data-total":t.get(["count",t.get("$participants")]),"data-online":t.get(["count",t.get("$online")]),class:"__7z95rw"}),t.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"7z95rw"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-search-input",function(e){var t={name:{value:""},value:{value:""},placeholder:{value:""},focused:{value:"false"},role:{value:""},"show-icon":{type:"boolean",value:!1},loading:{type:"boolean",value:!1}},n=function(){var e={icon:"search",size:"medium",class:"__co5yhn"},t={class:"controls __co5yhn"},n={shape:"circle",size:"medium",class:"controls-internal __co5yhn","on-click":"onClearClick"},o={icon:"clear",size:"small",class:"__co5yhn"},s={type:"2",class:"__co5yhn"},i={class:"controls-external __co5yhn"},r={name:"controls",class:"__co5yhn"};return function(a){a.open(0,"div",{class:"container __co5yhn"}),a.get(["state","empty"])&&a.addClass("__empty"),a.get("@show-icon")&&(a.open(1,"ok-icon",e),a.close()),a.open(2,"ok-input",{name:a.get("@name"),value:a.get("@value"),placeholder:a.get("@placeholder")||a.get(["state","placeholder"]),autofocus:a.get("@focused"),autocomplete:"off",class:"__co5yhn"}),"secondary"==a.get("@role")&&a.addClass("__secondary"),a.close(),a.open(3,"div",t),a.open(4,"ok-button",n),a.open(5,"ok-icon",o),a.close(),a.close(),a.get("@loading")&&(a.open(6,"ok-loader",s),a.close()),a.open(7,"div",i),a.open(8,"slot",r),a.close(),a.close(),a.close(),a.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},inputNode:{},value:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"co5yhn"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{input:function(e,t){t.state.set("empty",!t.value)},change:function(e,t){t.state.set("empty",!t.value)},keydown:function(e,t){27===e.keyCode&&t.clear()}}},o.prototype.attributeChangedCallback=function(e,t){"value"===e&&this.state.set("empty",!t)},o.prototype.init=function(){e.prototype.init.call(this),this.state.set("empty",!0),this.state.set("placeholder",ro("search"))},o.prototype.clear=function(){this.value="",this.state.set("empty",!0),this.emit("input")},o.prototype.onClearClick=function(e,t){t.clear(),t.focus()},s.inputNode.get=function(){return this.shadowDOM.querySelector("ok-input")},s.value.get=function(){return this.inputNode.value},s.value.set=function(e){this.inputNode.value=e},o.prototype.focus=function(){var e=this.inputNode;e&&e.focus()},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-online-label",function(e){var t={user:{type:"json",value:null}},n=function(){var e={key:"online",class:"__cp9ad6"},t={key:"was-online-recently",class:"__cp9ad6"};return function(n){n.get("@user","presence","on")||n.get("@user","current")?(n.open(0,"ok-l10n",e),n.close()):(n.open(1,"ok-l10n",{key:"was-online","data-gender":n.get("@user","gender"),class:"__cp9ad6"}),n.close(),n.get("@user","presence","seen")?(n.open(2,"ok-relative-date",{date:1e3*n.get("@user","presence","seen"),class:"__cp9ad6"}),n.close()):(n.open(3,"ok-l10n",t),n.close()))}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cp9ad6"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-toolbar",function(e){var t={controls:{type:"boolean",value:!0}},n=function(){var e={class:"controls __5yzpx7"},t={name:"controls",class:"__5yzpx7"},n={class:"content __5yzpx7"},o={class:"__5yzpx7"};return function(s){s.open(0,"div",e),s.open(1,"slot",t),s.close(),s.close(),s.open(2,"div",n),s.open(3,"slot",o),s.close(),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"5yzpx7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-item-container",function(e){var t={size:{value:"normal"},foldable:{type:"boolean",value:!1}},n=function(){var e={name:"image",class:"__q7feyc"},t={class:"image-stub __q7feyc"},n={class:"content __q7feyc"},o={name:"title",class:"__q7feyc"},s={name:"badge",class:"__q7feyc"},i={class:"text __q7feyc"};return function(r){r.open(0,"slot",e),r.emptySlot()&&(r.open(1,"span",t),r.close()),r.close(),r.open(2,"div",n),r.open(3,"slot",o),r.emptySlot()&&r.setText("Chat title"),r.close(),r.open(4,"slot",s),r.close(),r.open(5,"slot",i),r.emptySlot()&&r.setText("Chat text"),r.close(),r.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"q7feyc"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var gu=new Zl;defineComponent("ok-chat-title",function(e){var t=function(){var e={class:"__9eu4mv"},t={shape:"circle",class:"__9eu4mv"},n={icon:"link",size:"medium",class:"__9eu4mv"};return function(o){o.open(0,"span",{class:"title __9eu4mv"}),o.addClass("__has-link"),o.open(1,"slot",e),o.close(),o.get(["state","chat-link"])&&(o.open(2,"a",{target:"_blank",class:"link __9eu4mv",href:o.get(["state","chat-link"],"opts","link",0,"url"),"on-click":"openLink"}),o.open(3,"ok-button",t),o.open(4,"ok-icon",n),o.close(),o.close(),o.close()),o.close()}}();return function(e){function n(t){return t=e.call(this,t)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var o={__production:{},hash:{},modelDefinition:{},template:{}};return o.__production.get=function(){return!0},o.hash.get=function(){return"9eu4mv"},o.modelDefinition.get=function(){return null},o.template.get=function(){return t},n.prototype.willRender=function(){var e=this.getSlot(null);if(e){var t=gu.parse(e.textContent);this.state.set("chat-link",t.find(function(e){return e.type===e.types.LINK}))}else this.state.delete("chat-link")},n.prototype.openLink=function(e){e.stopPropagation()},Object.defineProperties(n.prototype,o),n}(e)});var _u={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"x","ц":"c","ч":"ch","ш":"sh","щ":"sсh","ъ":"","ы":"y","ь":"'","э":"e","ю":"u","я":"ya"},mu=Object.assign({},_u,tr(_u)),vu={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"Х","]":"ъ","}":"Ъ","|":"/","`":"ё","~":"Ё",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"Ж","'":"э",'"':"Э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"Б",".":"ю",">":"Ю","/":".","?":",","@":'"',"#":"№",$:";","^":":","&":"?"},yu=Object.assign({},vu,tr(vu)),ku=function(e){if(!e)return e;var t=[];return e.split("").forEach(function(e){t.push(yu[e])}),t.join("")},bu=function(e){this.original="",this.update(e)},wu={isEmpty:{},highlights:{}};wu.isEmpty.get=function(){return!this.normalized},wu.highlights.get=function(){return this._highlights},bu.prototype.update=function(e){return void 0===e&&(e=""),this.original!==e&&(this.original=e,this.normalized=Yo(this.original),this.transliterated=nr(this.original),this.mapped=ku(this.normalized),this.transliteratedMapped=nr(this.mapped),this._highlights=this.isEmpty?null:[this.normalized,this.transliterated,this.mapped,this.transliteratedMapped],!0)},bu.prototype.matches=function(e){return!!this.isEmpty||((e=Yo(e)).includes(this.normalized)||e.includes(this.transliterated)||e.includes(this.mapped)||e.includes(this.transliteratedMapped))},Object.defineProperties(bu.prototype,wu),defineComponent("ok-chat-participants",function(e){var t={chat:{type:"json",value:null},contacts:{type:"json",value:null}},n=function(e){e.open(0,"ok-search-input",{value:e.get(["state","query"]),"on-input":"search",role:"secondary",class:"__m6zch3"}),e.close(),e.open(1,"ok-chat-participants-list",{users:e.get(["state","items"],"*","user"),editable:"LEFT"!=e.get("@chat","status"),removable:e.get("@chat","owner","current"),highlights:e.get(["state","highlights"]),class:"__m6zch3"}),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"m6zch3"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("query",""),this.query=new bu},o.prototype.willRender=function(){var t=this,n=ri(this.getAttribute("chat").participants),o=[];this.getAttribute("contacts").forEach(function(e){var t=n.find(function(t){return t.user.id===e.id});t&&o.push(t)});var s=this.query.isEmpty?o:o.filter(function(e){return t.query.matches(e.user.name)});return this.state.set("items",s),e.prototype.willRender.call(this)},o.prototype.search=function(e,t){var n=e.target.value;t.query.update(n),t.state.set("query",n),t.state.set("highlights",t.query.highlights)},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-messages-controls",function(e){var t={messages:{type:"json",value:null},"posting-enabled":{type:"boolean",value:!1}},n=function(){var e={class:"left __y9ki4u"},t={role:"secondary",shape:"square",size:"small","on-click":"reply",class:"__y9ki4u"},n={icon:"reply",size:"medium",class:"__y9ki4u"},o={role:"secondary",shape:"circle","on-click":"reply",class:"__y9ki4u"},s={role:"secondary",shape:"square",size:"small","on-click":"forwardMessages",class:"__y9ki4u"},i={icon:"share",size:"medium",class:"__y9ki4u"},r={role:"secondary",shape:"circle","on-click":"forwardMessages",class:"__y9ki4u"},a={role:"secondary",shape:"square",size:"small","on-click":"removeMessages",class:"__y9ki4u"},c={icon:"delete",size:"small",class:"__y9ki4u"},l={role:"secondary",shape:"circle","on-click":"removeMessages",class:"__y9ki4u"},u={role:"secondary",shape:"square",size:"small","on-click":"edit",class:"__y9ki4u"},p={icon:"edit",size:"small",class:"__y9ki4u"},h={role:"secondary",shape:"circle","on-click":"edit",class:"__y9ki4u"},d={class:"right __y9ki4u"},f={class:"counter __y9ki4u"},g={shape:"circle","on-click":"reset",class:"__y9ki4u"},_={icon:"clear",size:"small",class:"__y9ki4u"};return function(m){m.open(0,"div",e),1==m.get(["count",m.get("@messages")])&&m.get("@posting-enabled")&&m.get(["state","removable"])&&m.get(["state","editable"]),1==m.get(["count",m.get("@messages")])&&m.get("@posting-enabled")&&(m.open(1,"ok-button",t),m.open(2,"ok-tico",n),m.setText("Ответить"),m.close(),m.close(),m.open(3,"ok-button",o),m.open(4,"ok-icon",n),m.close(),m.close()),m.open(5,"ok-button",s),m.open(6,"ok-tico",i),m.setText("Переслать"),m.close(),m.close(),m.open(7,"ok-button",r),m.open(8,"ok-icon",i),m.close(),m.close(),m.get(["state","removable"])&&(m.open(9,"ok-button",a),m.open(10,"ok-tico",c),m.setText("Удалить"),m.close(),m.close(),m.open(11,"ok-button",l),m.open(12,"ok-icon",c),m.close(),m.close()),m.get(["state","editable"])&&(m.open(13,"ok-button",u),m.open(14,"ok-tico",p),m.setText("Редактировать"),m.close(),m.close(),m.open(15,"ok-button",h),m.open(16,"ok-icon",p),m.close(),m.close()),m.close(),m.open(17,"div",d),m.open(18,"span",f),m.open(19,"ok-l10n",{key:"message-count","data-count":m.get(["count",m.get("@messages")]),class:"__y9ki4u"}),m.close(),m.close(),m.open(20,"ok-button",g),m.open(21,"ok-icon",_),m.close(),m.close(),m.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"y9ki4u"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e){if("messages"===e){var t=this.getMessages();this.state.set("removable",t.every(function(e){return e.removable})),this.state.set("editable",t.every(function(e){return e.editable}))}},o.prototype.reply=function(e,t){var n=t.getAttribute("messages"),o=Array.isArray(n)?n[0].uid:n.uid;t.emit("reply-message",o)},o.prototype.edit=function(e,t){var n=t.getAttribute("messages"),o=Array.isArray(n)?n[0].uid:n.uid;t.emit("edit-message",o)},o.prototype.removeMessages=function(e,t){t.emit("show-confirm",{header:"Удалить сообщения",body:"Эти сообщения будут удалены безвозвратно.",buttons:[{label:"Удалить",action:function(){return t.emit("remove-messages",t.getMessages().map(function(e){return e.uid}))}},"Отменить"]})},o.prototype.forwardMessages=function(e,t){t.emit("forward-messages-enter",t.getMessages().map(function(e){return e.id}))},o.prototype.reset=function(e,t){t.emit("reset-selected-messages")},o.prototype.getMessages=function(){var e=this.getAttribute("messages");return e?Array.isArray(e)?e:[e]:[]},Object.defineProperties(o.prototype,s),o}(e)});var Cu=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-posting-form",function(e){var t={"chat-id":{type:"number",value:0},data:{type:"json",value:null},"auto-focus":{type:"boolean",value:!0},"auto-upload":{type:"boolean",value:!0},"show-notify-control":{type:"boolean",value:!1},assets:{type:"json",value:null},"alternative-behaviour":{type:"boolean",value:!1},"popular-queries":{value:""}},n=function(){var e={class:"container __d2ag31"},t={class:"add-comment __d2ag31"},n={class:"edit-title __d2ag31"},o={class:"edit-text __d2ag31"},s={class:"cancel __d2ag31",shape:"circle","on-click":"resetPosting"},i={icon:"clear",size:"small",class:"__d2ag31"},r={class:"form __d2ag31"},a={class:"buttons __left __d2ag31"},c={class:"button __smiles __d2ag31"},l={icon:"smiles",size:"medium",class:"__d2ag31"},u={name:"input",class:"__d2ag31"},p={class:"buttons __right __d2ag31"},h={class:"button __notify __d2ag31"},d={shape:"circle",role:"secondary",size:"big","on-click":"toggleNotify",class:"__d2ag31"},f={icon:"alert-off",size:"medium",class:"__d2ag31"},g={icon:"alert-on",size:"medium",class:"__d2ag31"},_={class:"button __attach __d2ag31"},m={name:"attach",class:"__d2ag31"},v={"on-click":"selectFiles",shape:"circle",role:"secondary",size:"big",class:"__d2ag31"},y={icon:"attach",size:"medium",class:"__d2ag31"},k={type:"file",class:"attach-file __d2ag31",multiple:"multiple","on-change":"onSelectFiles"},b={class:"button __send __d2ag31"},w={name:"submit",class:"__d2ag31"},C={"on-click":"sendMessage",shape:"circle",size:"big",role:"primary",class:"__d2ag31"},E={icon:"send",size:"medium",class:"__d2ag31"},A={class:"form_share __d2ag31"},T={class:"form_attach __d2ag31"},S=function(e){e.open(0,"ok-posting-attach",{file:e.get("self","file"),type:e.get("self","_type"),class:"__d2ag31",progress:null}),e.get("progress")&&"completed"!=e.get("status")&&e.attr("progress",e.get("progress","loaded")/e.get("progress","total")),e.close()};return function(I){I.open(0,"ok-assets-panel",{assets:I.get("@assets"),"search-query":I.get(["state","stickers-search-query"]),active:I.get(["state","assets"]),"popular-queries":I.get("@popular-queries"),"on-close":"onAssetsClose",class:"__d2ag31"}),I.close(),I.open(1,"div",e),I.get("@data","link")&&(I.open(2,"div",t),"EDIT"==I.get("@data","type")&&I.get("@data","link")?(I.open(3,"div",n),I.setText("Редактирование сообщения"),I.close(),I.open(4,"div",o),I.setText(I.get("@data","link","text")),I.close()):"REPLY"==I.get("@data","type")?(I.open(5,"ok-message-quote",{message:I.get("@data","link"),preview:"true",class:"__d2ag31"}),I.close()):I.addText(6,I.get("@data","text")),I.open(7,"ok-button",s),I.open(8,"ok-icon",i),I.close(),I.close(),I.close()),I.open(9,"div",r),I.open(10,"div",a),I.open(11,"div",c),I.open(12,"ok-button",{shape:"circle",role:"secondary",size:"big","on-click":"toggleAssets",class:"__d2ag31"}),I.get(["state","assets"])&&I.addClass("__active"),I.open(13,"ok-icon",l),I.close(),I.close(),I.close(),I.close(),I.open(14,"div",{class:"input __d2ag31"}),I.get("@show-notify-control")&&I.addClass("__narrow"),I.open(15,"slot",u),I.emptySlot()&&(I.open(16,"ok-posting-form-input",{"chat-id":I.get("@chat-id"),text:I.get("@data","text"),"alternative-behaviour":I.get("@alternative-behaviour"),assets:I.get(["state","assets"]),class:"__d2ag31"}),I.close()),I.close(),I.close(),I.open(17,"div",p),I.get("@show-notify-control")&&(I.open(18,"div",h),I.open(19,"ok-button",d),I.get(["state","notify-disabled"])?(I.open(20,"ok-icon",f),I.close()):(I.open(21,"ok-icon",g),I.close()),I.close(),I.close()),I.open(22,"div",_),I.open(23,"slot",m),I.emptySlot()&&(I.open(24,"ok-button",v),I.open(25,"ok-icon",y),I.close(),I.close(),I.open(26,"input",k),I.close()),I.close(),I.close(),I.open(27,"div",b),I.open(28,"slot",w),I.emptySlot()&&(I.open(29,"ok-button",C),I.open(30,"ok-icon",E),I.close(),I.close()),I.close(),I.close(),I.close(),I.close(),I.get(["count",I.get(["state","attachments"])])&&(I.open(31,"div",A),I.open(32,"ok-posting-share",{attachments:I.get(["state","attachments"]),selected:I.get("@data","shares","selected"),class:"__d2ag31"}),I.close(),I.close()),I.get(["count",I.get("@data","upload")])&&(I.open(33,"div",T),I.iterate(34,I.get("@data","upload"),S),I.close()),I.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},inputField:{},assetsPanel:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"d2ag31"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"commit-posting-message":function(e,t){e.stopPropagation(),t.emit("commit-posting-message",Cu({},e.detail,{notifyDisabled:!!this.state.get("notify-disabled")})),t.hideAssets()},"attach-files":function(e,t){e.stopPropagation(),t.attachFiles(e.detail)},"remove-posting-attach":function(e,t){t.removeFile(e.detail)},"show-assets":function(e,t){t.showAssets()},"post-sticker":function(e,t){e.stopPropagation(),t.hideAssets(),t.emit("send-sticker",t._eventPayload(e.detail))},"post-smile":function(e,t){e.stopPropagation(),e.detail.text&&t.inputField.insertText(e.detail.text)},"select-share-preview":function(e,t){e.stopPropagation(),t.emit("select-share-preview",t._eventPayload(e.detail))},"remove-share-preview":function(e,t){e.stopPropagation();var n=t.getAttribute("chat-id");t.emit("remove-share-preview",{chatId:n})}}},o.prototype.init=function(){var e=this;this._shouldFocusOnInput=!1,this.addEventListener("click",function(t){for(var n=!1,o=t.target;o&&o!==e;){if(o.classList.contains("buttons")){n=!0;break}o=o.parentNode}n||e.focus()})},s.inputField.get=function(){return this.componentView.querySelector("slot[name=input] > *")},o.prototype.attributeChangedCallback=function(e,t,n){"data"===e?(t&&t.shares&&t.shares.links&&!t.shares.disabled?this.state.set("attachments",t.shares.links.reduce(function(e,n){var o=t.shares.attachments.get(n);return o&&e.set(n,o),e},new Map)):this.state.delete("attachments"),t&&!n&&(this._shouldFocusOnInput=!0)):"chat-id"===e&&t&&(this.hideAssets(),this._shouldFocusOnInput=!0),!1===this.getAttribute("auto-focus")&&(this._shouldFocusOnInput=!1)},s.assetsPanel.get=function(){return this.componentView.querySelector("ok-assets-panel")},o.prototype.showAssets=function(){this.getAttribute("assets")&&this.state.set("assets",!0)},o.prototype.hideAssets=function(){this.state.delete("assets"),this.emit("sticker-search-reset")},o.prototype.toggleAssets=function(e,t){t.state.get("assets")?t.hideAssets():t.showAssets()},o.prototype.onAssetsClose=function(e,t){t.hideAssets()},o.prototype.toggleNotify=function(e,t){var n=t.state,o=!n.get("notify-disabled");n.set("notify-disabled",o),o?t.emit("show-toast","Запись отправится без оповещения"):t.emit("show-toast","Запись отправится с оповещением")},o.prototype._eventPayload=function(e){return Cu({chatId:this.getAttribute("chat-id"),notifyDisabled:!!this.state.get("notify-disabled"),autoUpload:!!this.getAttribute("auto-upload")},e)},o.prototype.resetPosting=function(e,t){var n=t.componentView.querySelector(".add-comment");n.classList.add("__hide"),n.addEventListener("transitionend",function(){t.emit("reset-posting",t._eventPayload())},!1)},o.prototype.selectFiles=function(e,t){t.componentView.querySelector(".attach-file").click()},o.prototype.onSelectFiles=function(e,t){for(var n=e.target,o=n.files,s=[],i=0;i<o.length;i++)s.push(o.item(i));s.length&&(t.attachFiles(s),n.value=null)},o.prototype.removeFile=function(e){this.emit("remove-attach",this._eventPayload({file:e}))},o.prototype.sendMessage=function(e,t){t.hideAssets(),t.emit("commit-posting-message",t._eventPayload())},o.prototype.focus=function(){var e=this.inputField;e&&e.focus()},o.prototype.blur=function(){var e=this.inputField;e&&e.blur()},o.prototype.didRender=function(){var e=this;this._shouldFocusOnInput&&(this._shouldFocusOnInput=!1,requestAnimationFrame(function(){return e.focus()}))},o.prototype.attachFiles=function(e){this.emit("attach-files",this._eventPayload({files:e}))},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)});var Eu=new Map([[":-)","😊"],[":)","😊"],[":-(","😞"],[":(","😞"],[";-)","😉"],[";)","😉"],[":-D","😃"],[":-@","😣"],["^o)","😑"],[":-S","😖"],["*-)","😐"],[":-|","😠"],["8oI","😡"],[":'(","😢"],[":-P","😜"],[":-$","☺"],[":-O","😲"],["|-)","😪"],["(ch)","😏"],["(lo)","😍"],["(sr)","😔"],["|-(","😴"],["(H)","😎"],["(hu)","😬"],["(tr)","😒"],["(md)","😵"],["(fr)","😄"],["(dt)","😟"],["(sc)","😕"],["(Y)","👍"],["(y)","👍"],["(N)","👎"],["(v)","✌"],["(L)","❤"],["(U)","💔"],["(K)","💋"],["(F)","🌼"],["(*)","⭐"],["(^)","🎂"],["(G)","🎁"],["(B)","🍺"],["(D)","🍸"],["(CC)","☕"],["(pi)","🍕"],["(pl)","🍴"],["(ic)","🍦"],["($)","💰"],["(so)","⚽"],["(te)","🎾"],["(nt)","🎵"],["(E)","✉"],["(Z)","👦"],["(X)","👧"],["(S)","🌙"],["☹","😦"]]),Au=["😄","😃","😀","😊","☺","😉","😍","😘","😚","😗","😙","😜","😝","😛","😳","😁","😔","😌","😒","😞","😣","😢","😂","😭","😪","😥","😰","😅","😓","😩","😫","😨","😱","😠","😡","😤","😖","😆","😋","😷","😎","😴","😵","😲","😟","😦","😧","😈","👿","😮","😬","😐","😕","😯","😶","😇","😏","😑","👲","👳","👮","👷","💂","👶","👦","👧","👨","👩","👴","👵","👱","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💀","👽","💩","🔥","✨","🌟","💫","💥","💢","💦","💧","💤","💨","👂","👀","👃","👅","👄","👍","👎","👌","👊","✊","✌","👋","✋","👐","👆","👇","👉","👈","🙌","🙏","☝","👏","💪","🚶","🏃","💃","👫","👪","👬","👭","💏","💑","👯","🙆","🙅","💁","🙋","💆","💇","💅","👰","🙎","🙍","🙇","🎩","👑","👒","👟","👞","👡","👠","👢","👕","👔","👚","👗","🎽","👖","👘","👙","💼","👜","👝","👛","👓","🎀","🌂","💄","💛","💙","💜","💚","❤","💔","💗","💓","💕","💖","💞","💘","💌","💋","💍","💎","👤","👥","💬","👣","💭"],Tu=["🐶","🐺","🐱","🐭","🐹","🐰","🐸","🐯","🐨","🐻","🐷","🐽","🐮","🐗","🐵","🐒","🐴","🐑","🐘","🐼","🐧","🐦","🐤","🐥","🐣","🐔","🐍","🐢","🐛","🐝","🐜","🐞","🐌","🐙","🐚","🐠","🐟","🐬","🐳","🐋","🐄","🐏","🐀","🐃","🐅","🐇","🐉","🐎","🐐","🐓","🐕","🐖","🐁","🐂","🐲","🐡","🐊","🐫","🐪","🐆","🐈","🐩","🐾","💐","🌸","🌷","🍀","🌹","🌻","🌺","🍁","🍃","🍂","🌿","🌾","🍄","🌵","🌴","🌲","🌳","🌰","🌱","🌼","🌐","🌞","🌝","🌚","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌜","🌛","🌙","🌍","🌎","🌏","🌋","🌌","🌠","⭐","☀","⛅","☁","⚡","☔","❄","⛄","🌀","🌁","🌈","🌊"],Su=["🎍","💝","🎎","🎒","🎓","🎏","🎆","🎇","🎐","🎑","🎃","👻","🎅","🎄","🎁","🎋","🎉","🎊","🎈","🎌","🔮","🎥","📷","📹","📼","💿","📀","💽","💾","💻","📱","☎","📞","📟","📠","📡","📺","📻","🔊","🔉","🔈","🔇","🔔","🔕","📢","📣","⏳","⌛","⏰","⌚","🔓","🔒","🔏","🔐","🔑","🔎","💡","🔦","🔆","🔅","🔌","🔋","🔍","🛁","🛀","🚿","🚽","🔧","🔩","🔨","🚪","🚬","💣","🔫","🔪","💊","💉","💰","💴","💵","💷","💶","💳","💸","📲","📧","📥","📤","✉","📩","📨","📯","📫","📪","📬","📭","📮","📦","📝","📄","📃","📑","📊","📈","📉","📜","📋","📅","📆","📇","📁","📂","✂","📌","📎","✒","✏","📏","📐","📕","📗","📘","📙","📓","📔","📒","📚","📖","🔖","📛","🔬","🔭","📰","🎨","🎬","🎤","🎧","🎼","🎵","🎶","🎹","🎻","🎺","🎷","🎸","👾","🎮","🃏","🎴","🀄","🎲","🎯","🏈","🏀","⚽","⚾","🎾","🎱","🏉","🎳","⛳","🚵","🚴","🏁","🏇","🏆","🎿","🏂","🏊","🏄","🎣","☕","🍵","🍶","🍼","🍺","🍻","🍸","🍹","🍷","🍴","🍕","🍔","🍟","🍗","🍖","🍝","🍛","🍤","🍱","🍣","🍥","🍙","🍘","🍚","🍜","🍲","🍢","🍡","🍳","🍞","🍩","🍮","🍦","🍨","🍧","🎂","🍰","🍪","🍫","🍬","🍭","🍯","🍎","🍏","🍊","🍋","🍒","🍇","🍉","🍓","🍑","🍈","🍌","🍐","🍍","🍠","🍆","🍅","🌽"],Iu=["🏠","🏡","🏫","🏢","🏣","🏥","🏦","🏪","🏩","🏨","💒","⛪","🏬","🏤","🌇","🌆","🏯","🏰","⛺","🏭","🗼","🗾","🗻","🌄","🌅","🌃","🗽","🌉","🎠","🎡","⛲","🎢","🚢","⛵","🚤","🚣","⚓","🚀","✈","💺","🚁","🚂","🚊","🚉","🚞","🚆","🚄","🚅","🚈","🚇","🚝","🚋","🚃","🚎","🚌","🚍","🚙","🚘","🚗","🚕","🚖","🚛","🚚","🚨","🚓","🚔","🚒","🚑","🚐","🚲","🚡","🚟","🚠","🚜","💈","🚏","🎫","🚦","🚥","⚠","🚧","🔰","⛽","🏮","🎰","♨","🗿","🎪","🎭","📍","🚩","🇯🇵","🇰🇷","🇩🇪","🇨🇳","🇺🇸","🇫🇷","🇪🇸","🇮🇹","🇷🇺","🇬🇧"],Ou=["1⃣","2⃣","3⃣","4⃣","5⃣","6⃣","7⃣","8⃣","9⃣","0⃣","🔟","🔢","#⃣","🔣","⬆","⬇","⬅","➡","🔠","🔡","🔤","↗","↖","↘","↙","↔","↕","🔄","◀","▶","🔼","🔽","↩","↪","ℹ","⏪","⏩","⏫","⏬","⤵","⤴","🆗","🔀","🔁","🔂","🆕","🆙","🆒","🆓","🆖","📶","🎦","🈁","🈯","🈳","🈵","🈴","🈲","🉐","🈹","🈺","🈶","🈚","🚻","🚹","🚺","🚼","🚾","🚰","🚮","🅿","♿","🚭","🈷","🈸","🈂","Ⓜ","🛂","🛄","🛅","🛃","🉑","㊙","㊗","🆑","🆘","🆔","🚫","🔞","📵","🚯","🚱","🚳","🚷","🚸","⛔","✳","❇","❎","✅","✴","💟","🆚","📳","📴","🅰","🅱","🆎","🅾","💠","➿","♻","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","⛎","🔯","🏧","💹","💲","💱","❌","‼","⁉","❗","❓","❕","❔","⭕","🔝","🔚","🔙","🔛","🔜","🔃","🕛","🕧","🕐","🕜","🕑","🕝","🕒","🕞","🕓","🕟","🕔","🕠","🕕","🕖","🕗","🕘","🕙","🕚","🕡","🕢","🕣","🕤","🕥","🕦","✖","➕","➖","➗","♠","♥","♣","♦","💮","💯","✔","☑","🔘","🔗","➰","〰","〽","🔱","◼","◻","◾","◽","▪","▫","🔺","🔲","🔳","⚫","⚪","🔴","🔵","🔻","⬜","⬛","🔶","🔷","🔸","🔹"],xu=([].concat(Array.from(Eu.keys()),Au,Tu,Su,Iu,Ou),"emoji emoji"),Du=35,Mu=48,ju=57,Pu=8419,Lu=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-assets-panel",function(){var e={assets:{type:"json",value:null},"search-query":{type:"string",value:""},tab:{type:"string",value:"recent"},active:{type:"boolean",value:!1},"popular-queries":{value:""}},t=function(){var e={class:"cancel __cu228o",shape:"circle","on-click":"close"},t={icon:"arrow-down",size:"medium",class:"__cu228o"},n={"on-click":"stop",class:"content __cu228o"},o={class:"tabs __cu228o"},s={class:"text __cu228o"},i={key:"recent",class:"__cu228o"},r={class:"icon __cu228o"},a={icon:"recent",size:"medium",class:"__cu228o"},c={key:"smiles",class:"__cu228o"},l={icon:"smiles2",size:"medium",class:"__cu228o"},u={key:"live-stickers",class:"__cu228o"},p={icon:"live-stickers",size:"medium",class:"__cu228o"},h={class:"container __cu228o"},d={class:"scroller __search __cu228o","on-scroll":"onSearchScroll"},f={class:"not-found __cu228o"},g={key:"not-found",class:"__cu228o"},_={class:"popular-queries __cu228o"},m={class:"popular-queries_title __cu228o"},v={key:"popular-queries",class:"__cu228o"},y={class:"emoji-set __cu228o"},k={class:"container __subtabs __cu228o"},b={class:"scroller __emoji __cu228o","on-scroll":"onEmojiScroll"},w={class:"subtabs __cu228o"},C={class:"scroller __stickers __cu228o","on-scroll":"onStickersScroll"},E={class:"h4 __cu228o"},A={class:"scroller __recent __cu228o","on-scroll":"onScroll"},T={class:"emoji-set __inline __cu228o"},S=function(e){e.open(0,"ok-button",{"on-click":"onPopularQueryClick",title:e.get("self"),role:"secondary",class:"__cu228o"}),e.setText(e.get("self")),e.close()},I=function(e){e.open(0,"ok-assets-sticker",{sticker:e.get("self"),"is-visible":"true","on-mouseenter":"onMouseEnter","on-mouseleave":"onMouseLeave","on-click":"selectSticker",class:"__cu228o"}),e.close()},O=function(e){e.open(0,"ok-assets-emoji",{text:e.get("text"),"on-mouseenter":["onMouseEnter",e.get("text")],"on-mouseleave":"onMouseLeave","on-click":"selectEmoji",class:"__cu228o"}),e.close()},x=function(e){e.open(0,"div",{class:"emoji-set __cu228o",id:"emoji-set_"+e.get(["position"])}),e.iterate(1,e.get("list"),O),e.close()},D=function(e){e.open(0,"div",{class:"tabs_i __cu228o","on-click":"setActiveSet","data-set":e.get(["position"])}),e.get(["position"])==e.get(["state","active-set"])&&e.addClass("__active"),e.open(1,"ok-icon",{icon:"emoji-set-"+e.get(["position"]),size:"medium",class:"__cu228o"}),e.close(),e.close()},M=function(e){e.open(0,"ok-assets-sticker",{sticker:e.get("self"),"on-mouseenter":"onMouseEnter","on-mouseleave":"onMouseLeave","on-click":"selectSticker","is-visible":"position() < 50 ? true : null",class:"__cu228o"}),e.close()},j=function(e){e.variable("sectionId",e.get("self")),e.variable("section",e.get("$sections",function(e){return e.get(["name"])==e.get("$sectionId")})),e.open(0,"div",y),e.get("$section","title")&&(e.open(1,"div",E),e.setText(e.get("$section","title")),e.close()),e.iterate(2,e.get("$section","result"),M),e.close()},P=function(e){e.open(0,"ok-sticker",{sticker:e.get("self"),repeat:"true",controls:"false","on-click":"selectSticker",class:"__cu228o"}),e.close()};return function(E){E.open(0,"ok-button",e),E.open(1,"ok-icon",t),E.close(),E.close(),E.open(2,"div",n),E.open(3,"div",o),E.get("@assets","stickerSearch")||(E.open(4,"div",{class:"tabs_i __cu228o","on-click":["onSelectTab","recent"]}),"recent"==E.get("@tab")&&E.addClass("__active"),E.open(5,"span",s),E.open(6,"ok-l10n",i),E.close(),E.close(),E.open(7,"span",r),E.open(8,"ok-icon",a),E.close(),E.close(),E.close(),E.open(9,"div",{class:"tabs_i __cu228o","on-click":["onSelectTab","emoji"]}),"emoji"==E.get("@tab")&&E.addClass("__active"),E.open(10,"span",s),E.open(11,"ok-l10n",c),E.close(),E.close(),E.open(12,"span",r),E.open(13,"ok-icon",l),E.close(),E.close(),E.close(),E.open(14,"div",{class:"tabs_i __cu228o","on-click":["onSelectTab","stickers"]}),"stickers"==E.get("@tab")&&E.addClass("__active"),E.open(15,"span",s),E.open(16,"ok-l10n",u),E.close(),E.close(),E.open(17,"span",r),E.open(18,"ok-icon",p),E.close(),E.close(),E.close()),E.open(19,"ok-search-input",{class:"search-stickers __cu228o",placeholder:E.get(["state","l10n"])("search-stickers"),value:E.get("@assets","stickerSearch","query"),"on-input":"onSearchStickersInput","show-icon":"true"}),"loading"==E.get("@assets","stickerSearch","loadState")&&E.addClass("__loading"),E.close(),E.close(),E.get("@assets","stickerSearch")?(E.open(20,"div",h),E.open(21,"div",d),E.get("@assets","stickerSearch","loaded")&&"idle"==E.get("@assets","stickerSearch","loadState")&&!E.get("@assets","stickerSearch","result","length")?(E.open(22,"div",f),E.open(23,"ok-l10n",g),E.close(),E.close(),E.open(24,"div",_),E.open(25,"div",m),E.open(26,"ok-l10n",v),E.close(),E.close(),E.iterate(27,E.get("@popular-queries"),S),E.close()):(E.open(28,"div",y),E.iterate(29,E.get("@assets","stickerSearch","result"),I),E.close()),E.close(),E.close()):"emoji"==E.get("@tab")?(E.open(30,"div",k),E.open(31,"div",b),E.iterate(32,E.get(["state","emoji-set"]),x),E.close(),E.open(33,"div",w),E.iterate(34,E.get(["state","emoji-set"]),D),E.close(),E.close()):"stickers"==E.get("@tab")?(E.open(35,"div",h),E.open(36,"div",C),E.variable("sections",E.get("@assets","stickerSections")),E.iterate(37,E.get("@assets","stickerSectionsOrder"),j),E.close(),E.close()):(E.open(38,"div",h),E.open(39,"div",A),E.open(40,"div",T),E.iterate(41,E.get(["state","recent-emoji"]),O),E.close(),E.open(42,"div",y),E.iterate(43,E.get("@assets","stickerSections","RECENT","result"),I),E.close(),E.close(),E.close()),E.get(["count",E.get(["state","preview-stickers"],"stickers")])>0&&(E.open(44,"ok-assets-preview",{"on-mouseenter":"onPreviewMouseEnter","on-mouseleave":"onMouseLeave",class:"__cu228o",top:null,left:null,target:null}),E.get(["state","preview-stickers"],"top")&&E.attr("top",E.get(["state","preview-stickers"],"top")),E.get(["state","preview-stickers"],"left")&&E.attr("left",E.get(["state","preview-stickers"],"left")),E.get(["state","preview-stickers"],"target")&&E.attr("target",E.get(["state","preview-stickers"],"target")),E.iterate(45,E.get(["state","preview-stickers"],"stickers"),P),E.close()),E.close()}}(),n=new Set(["👍","😂","😽","🌻","🐺","👽","🇷🇺","🔔","😈","⭐","🐶","🍭","😴","🌹","🌍","😎","👻","🔔","🎱","🐭","😇"]);return function(o){function s(e){return e=o.call(this,e)}o&&(s.__proto__=o),(s.prototype=Object.create(o&&o.prototype)).constructor=s;var i={__production:{},hash:{},modelDefinition:{},template:{},scroller:{}};return i.__production.get=function(){return!0},i.hash.get=function(){return"cu228o"},i.modelDefinition.get=function(){return e},i.template.get=function(){return t},s.prototype.init=function(){var e=this;this.state.set("emoji-set",this.collectEmojiSet()),this.state.set("active-set",0),this.state.set("l10n",ro),this.throttleSearchScrolling=Xn(function(){return e.scrollSearchStickers()},150),this.throttleEmojiScrolling=Xn(function(){return e.scrollEmoji()},150),this.throttleStickersScrolling=Xn(function(){return e.scrollStickers()},150)},s.prototype.disconnectedCallback=function(){clearTimeout(this._stickersPreviewTimer)},s.prototype.attributeChangedCallback=function(e,t){"active"!==e||t||(this.state.delete("recent-emoji-set"),this.state.delete("recent-emoji"),this.state.delete("emoji-set"),this.hideStickersPreview(),this.setAttribute("tab","recent"),this.scroller&&(this.scroller.scrollTop=0)),"search-query"===e&&t&&this.searchStickers(t)},s.prototype.willRender=function(){var e=this.getAttribute("assets");if(!e)return!1;var t=e.get("recentEmoji");this.state.has("recent-emoji-set")||this.state.set("recent-emoji-set",t||n);var s=this.state.get("recent-emoji-set"),i=e.get("stickerSuggestions"),r=this._suggestions!==i;return r&&(this._suggestions=i),!r&&this.state.has("recent-emoji")||this.state.set("recent-emoji",this.collectRecentEmoji(s,i)),!r&&this.state.has("emoji-set")||this.state.set("emoji-set",this.collectEmojiSet(i)),o.prototype.willRender.call(this)},s.prototype.collectEmojiSet=function(e){return void 0===e&&(e=new Map),or().map(function(t){return Lu({},t,{list:t.list.map(function(t){return{text:t,suggestions:e.get(t)}})})})},s.prototype.collectRecentEmoji=function(e,t){if(e=new Set(e),t=new Map(t),e.size<n.size)for(var o=n.values();e.size<n.size;){var s=o.next().value;e.has(s)||e.add(s)}return Array.from(e).map(function(e){return{text:e,suggestions:t.get(e)}})},s.prototype.didRender=function(){"stickers"===this.getAttribute("tab")&&this.updateVisibleStickers();var e=this.state.get("preview-stickers"),t=this.getAttribute("assets"),n=t&&t.get("stickerSuggestions");if(e&&n&&n.has(e.text)&&(!e.stickers||e.stickers.size<n.get(e.text).size)){var o=Lu({},e,{stickers:n.get(e.text)});this._previewDescr=o,this.state.set("preview-stickers",o)}},s.prototype.onScroll=function(e,t){t.hideStickersPreview()},s.prototype.onEmojiScroll=function(e,t){t.onScroll(e,t),t.throttleEmojiScrolling()},s.prototype.onStickersScroll=function(e,t){t.onScroll(e,t),t.throttleStickersScrolling()},s.prototype.onSearchScroll=function(e,t){t.onScroll(e,t),t.throttleSearchScrolling()},s.prototype.scrollEmoji=function(){for(var e=this.scroller,t=this.componentView.querySelectorAll(".emoji-set"),n=Array.from(t).map(function(e){return e.offsetTop}),o=e.offsetHeight/2,s=n.length-1;e.scrollTop+o<n[s];)s--;this.state.set("active-set",s)},s.prototype.scrollStickers=function(){var e=this.scroller,t=e.scrollHeight-e.offsetHeight;(t?e.scrollTop/t:null)>.8&&this.emit("stickers-load-next"),this.updateVisibleStickers()},s.prototype.scrollSearchStickers=function(){var e=this.scroller,t=this.getAttribute("assets");if(t&&t.get("stickerSearch")){var n=e.scrollHeight-e.offsetHeight;(n?e.scrollTop/n:null)>.8&&this.emit("sticker-search-more")}},s.prototype.updateVisibleStickers=function(){var e=this.scroller;ir(e,e.querySelectorAll("ok-assets-sticker")).forEach(function(e){return e.setAttribute("is-visible",!0)})},s.prototype.stop=function(e){e.stopPropagation()},s.prototype.onSelectTab=function(e,t,n){n.setAttribute("tab",e)},s.prototype.selectSticker=function(e,t){t.hideStickersPreview(),t.emit("post-sticker",{id:this.getAttribute("sticker").id})},s.prototype.selectEmoji=function(e,t){t.emit("post-smile",{text:this.getAttribute("text")})},s.prototype.scrollToSet=function(e){var t=document.getElementById("emoji-set_"+e),n=this.scroller,o=function(e,t,n,o){return(e/=o/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},s=Date.now(),i=n.scrollTop,r=t.offsetTop-40,a=r-i,c=function(){var e=Date.now()-s;e>=600?n.scrollTop=r:(n.scrollTop=o(e,i,a,600),requestAnimationFrame(c))};requestAnimationFrame(c)},s.prototype.setActiveSet=function(e,t){var n=this.getAttribute("data-set");t.scrollToSet(n)},s.prototype.onSearchStickersInput=function(e,t){t.hideStickersPreview(),t.searchStickers(e.target.value)},s.prototype.searchStickers=function(e){this.emit("sticker-search",{query:e})},s.prototype.searchSuggestingStickers=function(e){this.emit("suggest-emoji-stickers",e)},s.prototype.onPopularQueryClick=function(e,t){t.searchStickers(this.title)},s.prototype.onMouseEnter=function(e,t,n){"string"!=typeof e&&(n=t,t=e,e=null),n.scheduleShowStickersPreview(t.target,e),e&&n.searchSuggestingStickers(e)},s.prototype.onMouseLeave=function(e,t){t.scheduleHideStickersPreview()},s.prototype.onPreviewMouseEnter=function(e,t){clearTimeout(t._stickersPreviewTimer)},s.prototype.scheduleShowStickersPreview=function(e,t){var n=this;if(this._previewDescr&&this._previewDescr.el===e||this.hideStickersPreview(),!(this._getVisibleRatio(e)<.5)){if(this._previewDescr={el:e,text:t,top:e.offsetTop,left:e.offsetLeft},t){var o=this.getAttribute("assets"),s=o&&o.get("stickerSuggestions");s&&(this._previewDescr.stickers=s.get(t)),this._previewDescr.target="emoji"}else{var i=e.getAttribute("sticker");this._previewDescr.stickers=(new Map).set(i.id,i),this._previewDescr.target="sticker"}clearTimeout(this._stickersPreviewTimer),this._stickersPreviewTimer=setTimeout(function(){return n.showStickersPreview()},500)}},s.prototype.scheduleHideStickersPreview=function(){var e=this;clearTimeout(this._stickersPreviewTimer),this._stickersPreviewTimer=setTimeout(function(){return e.hideStickersPreview()},500)},s.prototype.showStickersPreview=function(){this.state.set("preview-stickers",this._previewDescr)},s.prototype.hideStickersPreview=function(){this._previewDescr=null,this.state.delete("preview-stickers")},s.prototype._getVisibleRatio=function(e){var t=e.getBoundingClientRect(),n=this.scroller;if(n){var o=n.getBoundingClientRect();if(t.top<o.top)return 1-(o.top-t.top)/t.height}return 1},i.scroller.get=function(){return this.componentView.querySelector(".scroller")},Object.defineProperties(s.prototype,i),s}(vl)}),defineComponent("ok-forward-form",function(){var e={chats:{type:"json",value:null},contacts:{type:"json",value:null},"messages-ids":{type:"json",value:null},"chat-id":{type:"number",value:0},active:{type:"boolean",value:!1}},t=function(){var e={class:"__cw5wwu"},t={class:"back __cw5wwu",shape:"square","on-click":"close"},n={icon:"back",size:"medium",class:"__cw5wwu"},o={class:"footer __cw5wwu"},s={shape:"square",role:"secondary","on-click":"close",class:"__cw5wwu"};return function(i){i.open(0,"ok-toolbar",e),i.open(1,"ok-button",t),i.open(2,"ok-tico",n),i.setText("Назад"),i.close(),i.close(),i.open(3,"ok-l10n",{key:"forward-messages","data-count":i.get(["count",i.get("@messages-ids")]),class:"__cw5wwu"}),i.close(),i.close(),i.get("@active")&&(i.open(4,"ok-chat-picker",{chats:i.get(["state","chats"]),contacts:i.get("@contacts"),selected:i.get(["state","selected"]),"header-label":i.get(["state","l10n"])("forward-picker-label"),"header-placeholder":i.get(["state","l10n"])("forward-picker-placeholder"),class:"__cw5wwu"}),i.close()),i.open(5,"div",o),i.open(6,"ok-button",{shape:"square",role:"primary",disabled:!i.get(["count",i.get(["state","selected"])]),"on-click":"onSubmit",class:"__cw5wwu"}),i.setText("Переслать"),i.close(),i.open(7,"ok-button",s),i.setText("Отменить"),i.close(),i.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cw5wwu"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){this.state.set("l10n",ro)},i.events.get=function(){return{"select-item":function(e,t){var n=e.detail,o=t.state.get("selected");o?o.includes(n)||t.state.set("selected",o.concat(n)):t.state.set("selected",[n])},"unselect-item":function(e,t){var n=event.detail,o=t.state.get("selected");o&&o.includes(n)&&t.state.set("selected",o.filter(function(e){return e!==n}))}}},o.prototype.attributeChangedCallback=function(e,t){"chats"===e?this.state.set("chats",ri(t).filter(cr)):"active"!==e||t||this.state.delete("selected")},o.prototype.didRender=function(){if(this.getAttribute("active")){var e=this.componentView.querySelector("ok-picker ok-picker-header ok-input");e&&e.focus()}},o.prototype.submit=function(){var e=this.state.get("selected");if(e&&e.length){var t=[],n=[];e.forEach(function(e){rr(e)?t.push(ar(e)):n.push(ar(e))}),this.emit("forward-messages",{toChatIds:t,toContactIds:n,fromChatId:this.getAttribute("chat-id"),messageIds:this.getAttribute("messages-ids")})}},o.prototype.onSubmit=function(e,t){t.submit()},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(vl)});defineComponent("ok-media-layer",function(e){var t={media:{type:"json",value:null},chat:{type:"json",value:null}},n=function(){var e={"view-type":"black",class:"__aucac2"},t={class:"close __aucac2","on-click":"close"},n={icon:"close",class:"__aucac2"},o={class:"container __aucac2"},s={class:"inner __aucac2","on-click":"showNext"},i={class:"navigation __aucac2"},r={"view-type":"arrow",class:"prev __aucac2","on-click":"showPrevious"},a={icon:"arrow-prev",class:"__aucac2"},c={"view-type":"arrow",class:"next __aucac2","on-click":"showNext"},l={icon:"arrow-next",class:"__aucac2"},u={class:"panel __aucac2"},p={class:"panel-container __aucac2"},h={class:"panel-left __aucac2"},d={class:"panel_avatar __aucac2"},f={class:"panel_inf __aucac2"},g={class:"panel_inf-name __aucac2"},_={class:"il __aucac2","on-click":"close"},m={class:"il __aucac2","on-click":"openDialog"},v={class:"panel_inf-tx __aucac2"},y={class:"panel-menu __aucac2"},k={role:"inverted",shape:"circle",size:"big","on-click":"saveImage",class:"__aucac2"},b={icon:"photo-save",size:"medium",class:"__aucac2"},w={role:"inverted",shape:"circle",size:"big","on-click":"forward",class:"__aucac2"},C={icon:"share",size:"medium",class:"__aucac2"};return function(E){E.variable("media",E.get("@chat","media")),"loading"==E.get("$media","loadState")&&(E.open(0,"ok-spinner",e),E.close()),("idle"==E.get("$media","loadState")||E.get("$media","selected"))&&(E.variable("message",E.get("$media","items",function(e){return e.get(["name"])==e.get("$media","selected")},"message")),E.variable("photo",E.get("$media","items",function(e){return e.get(["name"])==e.get("$media","selected")},"photo")),E.variable("nextPhoto",E.get("$media","items",function(e){return e.get(["name"])==e.get("$media","next")},"photo")),E.variable("previousPhoto",E.get("$media","items",function(e){return e.get(["name"])==e.get("$media","previous")},"photo")),E.open(1,"ok-button",t),E.open(2,"ok-icon",n),E.close(),E.close(),E.open(3,"div",o),E.open(4,"span",s),E.open(5,"div",i),E.get("$media","previous")&&(E.open(6,"ok-button",r),E.open(7,"ok-icon",a),E.close(),E.close()),E.close(),E.get("$previousPhoto")&&(E.open(8,"ok-photo",{class:"hidden __aucac2",photo:E.get("$previousPhoto"),width:E.get("$previousPhoto","width"),height:E.get("$previousPhoto","height"),"max-width":E.get(["state","max-width"]),"max-height":E.get(["state","max-height"])}),E.close()),E.get("$photo")&&(E.open(9,"ok-photo",{photo:E.get("$photo"),width:E.get("$photo","width"),height:E.get("$photo","height"),"gif-autoplay":"true","max-width":E.get(["state","max-width"]),"max-height":E.get(["state","max-height"]),class:"__aucac2"}),E.close()),E.get("$nextPhoto")&&(E.open(10,"ok-photo",{class:"hidden __aucac2",photo:E.get("$nextPhoto"),width:E.get("$nextPhoto","width"),height:E.get("$nextPhoto","height"),"max-width":E.get(["state","max-width"]),"max-height":E.get(["state","max-height"])}),E.close()),E.open(11,"div",i),E.get("$media","next")&&(E.open(12,"ok-button",c),E.open(13,"ok-icon",l),E.close(),E.close()),E.close(),E.close(),E.close(),E.open(14,"div",u),E.open(15,"div",p),E.open(16,"div",h),E.open(17,"div",d),"CHANNEL"==E.get("@chat","type")?(E.open(18,"ok-chat-image",{chat:E.get("@chat"),size:"small","on-click":"close",class:"__aucac2"}),E.close()):(E.open(19,"ok-user-card",{user:E.get("$message","sender"),size:"small","on-click":"openDialog",class:"__aucac2"}),E.close()),E.close(),E.open(20,"div",f),E.open(21,"div",g),"CHANNEL"==E.get("@chat","type")?(E.open(22,"span",_),E.setText(E.get("@chat","title")),E.close()):(E.open(23,"span",m),E.setText(E.get("$message","sender","name")),E.close()),E.close(),E.open(24,"div",v),E.open(25,"ok-relative-date",{date:E.get("$message","time"),class:"__aucac2"}),E.close(),E.close(),E.close(),E.open(26,"div",y),E.open(27,"ok-button",k),E.open(28,"ok-icon",b),E.close(),E.close(),E.open(29,"ok-button",w),E.open(30,"ok-icon",C),E.close(),E.close(),E.close(),E.close(),E.close(),E.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"aucac2"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.connectedCallback=function(){var t=this;e.prototype.connectedCallback.call(this),Qo(this,function(){return t.emit("close-media")},function(e){switch(e.keyCode){case 37:t.showPrevious(e,t);break;case 39:t.showNext(e,t)}}),this._resizeListener=Xn(this._onResize.bind(this),100),window.addEventListener("resize",this._resizeListener),this._resizeListener(),this.emit("log-screen","MEDIA_VIEWER")},o.prototype.disconnectedCallback=function(){Xo(this),window.removeEventListener("resize",this._resizeListener),e.prototype.disconnectedCallback.call(this)},o.prototype.close=function(e,t){t.emit("close-media")},o.prototype.showNext=function(e,t){var n=t.getAttribute("chat").id,o=t.getMedia();o.next&&t.emit("show-media",{chatId:n,mediaId:o.next})},o.prototype.showPrevious=function(e,t){var n=t.getAttribute("chat").id,o=t.getMedia();e.stopPropagation(),o.previous&&t.emit("show-media",{chatId:n,mediaId:o.previous})},o.prototype.saveImage=function(e,t){var n=t.getMedia(),o=n.items.get(n.selected);if(o){var s=document.createElement("a");s.setAttribute("href",o.photo.url),s.setAttribute("download","download"),s.click()}},o.prototype.forward=function(e,t){var n=t.getMedia(),o=n.items.get(n.selected);o&&(t.emit("forward-messages-enter",[o.message.id]),t.close(e,t))},o.prototype._onResize=function(){this.state.set("max-width",window.innerWidth-38-38-52),this.state.set("max-height",window.innerHeight-50-50)},o.prototype.openDialog=function(e,t){var n=t.getMedia(),o=n.items.get(n.selected);t.emit("open-dialog",{userId:o.message.sender.id}),t.close(e,t)},o.prototype.getMedia=function(){return this.getAttribute("chat").media},Object.defineProperties(o.prototype,s),o}(e)});var Nu=function(e,t){this.wrappers=e.map(function(e){var n=t(e);return n=Array.isArray(n)?n.map(function(e){return Yo(e)}):[Yo(n)],{item:e,fields:n}})};Nu.prototype.search=function(e){var t=new bu(e);return this.wrappers.map(function(e){return e.fields.some(function(e){return t.matches(e)})&&e.item}).filter(Boolean)};var Ru=function(e,t,n){var o=lr(e);this.users=o.filter(function(e){return!e.deleted}),this.contacts=this.users.filter(function(e){return e.own}),this.seacher=new Nu(this.users,function(e){return e.names.map(function(e){return e.name})}),this.size=t,this.component=n,this.listItemElementName="ok-user-picker-list-item",this._updateItem=this._updateItem.bind(this),this._createItem=this._createItem.bind(this)};Ru.prototype.getItems=function(e){return e&&0!==e.length?this.seacher.search(e):this.contacts},Ru.prototype.getListOptions=function(){return{create:this._createItem,update:this._updateItem,getId:this._getItemId,avgHeight:62,alignBottom:!1,batchSize:35}},Ru.prototype.getToken=function(e){return{itemId:e.id,id:e.id,caption:e.name,url:e.avatarUrl}},Ru.prototype.getClosestElementId=function(e){var t=e.target.closest(this.listItemElementName);return t?t.getAttribute("user").id:null},Ru.prototype._getItemId=function(e){return e.item.id},Ru.prototype._updateItem=function(e,t){var n=t.firstChild;n.setAttribute("user",e.item),n.setAttribute("highlights",e.highlights),n.setAttribute("selected",e.selected),n.setAttribute("disabled",e.disabled),n.setAttribute("avatar-size",this.size),n.classList.toggle("active",e.active),n.render&&n.render(!0)},Ru.prototype._createItem=function(e,t){t.appendChild(this._createElement(e)),this._updateItem(e,t),this.component&&this.component.scopeStyle(t)},Ru.prototype._createElement=function(){return document.createElement(this.listItemElementName)};var zu=/[A-Za-zА-Яа-я]/;defineComponent("ok-chat-read-participants",function(e){var t={participants:{value:""},total:{value:""}},n=function(){var e={controls:"false",class:"__xpbhdc"},t={slot:"header",class:"__xpbhdc"},n={slot:"body",class:"__xpbhdc"},o={class:"list __xpbhdc"},s={class:"h4 __1st __xpbhdc"},i={class:"list_i __xpbhdc"},r={class:"text __xpbhdc"},a={class:"time __xpbhdc"},c={class:"h4 __xpbhdc"},l={class:"list_i __unread __xpbhdc"},u=function(e){e.open(0,"div",i),e.open(1,"ok-user-card",{user:e.get("self","user"),size:"medium","on-click":["openDialog",e.get("self","user","id")],class:"__xpbhdc"}),e.close(),e.open(2,"div",r),e.open(3,"span",{class:"name __xpbhdc","on-click":["openDialog",e.get("self","user","id")]}),e.setText(e.get("self","user","name")),e.close(),e.open(4,"div",a),e.addText(5,"в "),e.open(6,"ok-time",{timestamp:e.get("self","time"),class:"__xpbhdc"}),e.close(),e.close(),e.close(),e.close()},p=function(e){e.open(0,"div",l),e.open(1,"ok-user-card",{user:e.get("self"),size:"medium","on-click":["openDialog",e.get("self","id")],class:"__xpbhdc"}),e.close(),e.open(2,"div",r),e.open(3,"span",{class:"name __xpbhdc","on-click":["openDialog",e.get("self","id")]}),e.setText(e.get("self","name")),e.close(),e.open(4,"ok-online-label",{user:e.get("self"),class:"__xpbhdc"}),e.close(),e.close(),e.close()};return function(i){i.variable("read",i.get(["state","read"])),i.variable("unread",i.get(["state","unread"])),i.variable("current",i.get("@participants","*","user",function(e){return e.get("current")})),i.open(0,"ok-layer",e),i.open(1,"div",t),i.setText("Кто прочитал сообщение"),i.close(),i.open(2,"div",n),i.get(["count",i.get("$read")])>0&&(i.open(3,"div",o),0==i.get(["count",i.get("$unread")])?(i.open(4,"h4",s),i.setText("Прочитали все"),i.close()):(i.open(5,"h4",s),i.setText("Прочитали "+i.get(["count",i.get("$read")])),i.close()),i.iterate(6,i.get("@participants"),u),i.close()),i.get(["count",i.get("$unread")])>0&&(i.open(7,"div",o),i.open(8,"h4",c),i.setText("Еще не прочитали "+i.get(["count",i.get("$unread")])),i.close(),i.iterate(9,i.get("$unread"),p),i.close()),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"xpbhdc"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"close-layer":function(e,t){t.emit("close-chat-read-participants")}}},o.prototype.willRender=function(){var e=this.getAttribute("participants"),t=this.getAttribute("total"),n=new Set(e.map(function(e){return e.user.id})),o=t.map(function(e){return e.user}).filter(function(e){return!n.has(e.id)});this.state.set("read",e.sort(function(e,t){return t.time-e.time})),this.state.set("unread",o.sort(ur))},o.prototype.openDialog=function(e,t,n){console.log("open chat with",e),n.emit("open-dialog",{userId:e}),n.emit("close-chat-read-participants")},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-chat-actions",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={"on-click":"leaveChat",class:"__cd78w6"},t={icon:"leave",size:"medium",class:"__cd78w6"},n={"on-click":"toggleNotifications",class:"__cd78w6"},o={icon:"alert-solid-off",size:"medium",slot:"on",class:"__cd78w6"},s={key:"alerts-off",class:"__cd78w6"},i={icon:"alert-solid-on",size:"medium",slot:"off",class:"__cd78w6"},r={key:"alerts-on",class:"__cd78w6"},a={class:"subscribe __cd78w6","on-click":"join"};return function(c){"CHAT"==c.get("@chat","type")&&"ACTIVE"!=c.get("@chat","status")||"CHANNEL"==c.get("@chat","type")&&"CLOSED"==c.get("@chat","status")?(c.open(0,"ok-button",e),c.open(1,"ok-tico",t),c.open(2,"ok-l10n",{key:"leave-chat","data-type":c.get("@chat","type"),class:"__cd78w6"}),c.close(),c.close(),c.close()):c.get("@chat","participants","*","user",function(e){return e.get("current")})?(c.open(3,"ok-button",n),c.open(4,"ok-chat-alerts",{chat:c.get("@chat"),class:"__cd78w6"}),c.open(5,"ok-tico",o),c.open(6,"ok-l10n",s),c.close(),c.close(),c.open(7,"ok-tico",i),c.open(8,"ok-l10n",r),c.close(),c.close(),c.close(),c.close()):(c.open(9,"span",a),c.open(10,"ok-l10n",{key:"join-chat","data-type":c.get("@chat","type"),class:"__cd78w6"}),c.close(),c.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cd78w6"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.leaveChat=function(e,t){var n=t.getAttribute("chat");t.emit("show-confirm",{header:ro("leave-chat-confirm-header",{type:n.type}),body:ro("leave-chat-confirm-body",{type:n.type}),buttons:[{label:ro("leave-chat-confirm-button"),action:function(){t.emit("remove-chat",{chatId:n.id})}},ro("confirm-cancel-button")]})},o.prototype.join=function(e,t){var n=t.getAttribute("chat");t.emit("join-chat",n.link)},o.prototype.toggleNotifications=function(e,t){var n=t.getAttribute("chat");if(n.settings){var o=0!==n.settings.dontDisturbUntil?0:-1;t.emit("update-chat-settings",{chatId:n.id,settings:{dontDisturbUntil:o}})}},Object.defineProperties(o.prototype,s),o}(e)});var Hu=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-channel-members-list",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={class:"h4 __t2mr4y"},t={icon:"add","on-click":"onAddAdmins",class:"__t2mr4y"},n={icon:"add","on-click":"onAddMembers",class:"__t2mr4y"},o=function(e){e.open(0,"ok-chat-participants-list-item",{user:e.get("self"),removable:"false",class:"__t2mr4y"}),e.close()},s=function(e){return e.get("id")},i=function(e){e.open(0,"ok-chat-participants-list-item",{user:e.get("value"),removable:"true",class:"__t2mr4y"}),e.close()},r=function(e){return e.get("value","id")};return function(a){a.variable("admins",a.get(["state","admins"])),a.variable("list",a.get(["state","scroll-list"])),a.open(0,"h4",e),a.setText("Администраторы "+a.get(["count",a.get("$admins")])),a.close(),a.get("@chat","owner","current")&&(a.open(1,"ok-add-stub",t),a.setText("Добавить администраторов"),a.close()),a.iterate(2,a.get("$admins"),o,s),a.open(3,"h4",e),a.setText("Подписчики "+(a.get("@chat","participantsCount")?a.get("@chat","participantsCount")-a.get(["count",a.get("@chat","admins")]):"")),a.close(),a.open(4,"ok-add-stub",n),a.setText("Добавить подписчиков"),a.close(),a.open(5,"div",{class:"scroll-beacon __t2mr4y",style:"height: "+(a.get("$list","before")||0)+"px;"}),a.close(),a.iterate(6,a.get("$list","items"),i,r),a.open(7,"div",{style:"height: "+(a.get("$list","after")||0)+"px;",class:"__t2mr4y"}),a.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},scrollBeacon:{},scrollItemsOffset:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"t2mr4y"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._list=new wl({itemHeight:48,offscreenArea:50,onUpdate:function(t){return e.state.set("scroll-list",t)}}),this.addEventListener("scroll",function(){return e.handleScroll()}),this._prevSelected=null,this._loadMembersTimer=null},s.scrollBeacon.get=function(){return this._scrollBeacon||(this._scrollBeacon=this.componentView.querySelector(".scroll-beacon")),this._scrollBeacon},s.scrollItemsOffset.get=function(){var e=this.scrollBeacon;return e?e.offsetTop:0},o.prototype.attributeChangedCallback=function(e,t){var n=this;if("chat"===e)if(t&&t.admins&&this.state.set("admins",t.admins.map(hr)),t&&t.members){var o=new Set(t.admins.map(pr)),s=t.members.items.filter(function(e){return!o.has(e.id)}).map(hr);this._list.update(s),this._list.fill(this,this.scrollItemsOffset)}else this._list.update(),this._loadMembersTimer||(this._loadMembersTimer=setTimeout(function(){n._loadMembersTimer=null,n._loadItems()},300))},o.prototype.handleScroll=function(){if(this._list.handleScroll(this,this.scrollItemsOffset),!this._loadRequested){this.scrollHeight-this.scrollTop-this.offsetHeight<100&&this._loadItems(this.getAttribute("chat"))}},o.prototype.onAddAdmins=function(e,t){t.emit("change-active-state","add-admins")},o.prototype.onAddMembers=function(e,t){t.emit("change-active-state","add-members")},o.prototype._loadItems=function(){var e=this.getAttribute("chat");!e||e.members&&"loading"===e.members.loadState||e.members&&!e.members.marker||this.emit("load-chat-members",{chatId:e.id})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-onboarding",function(e){var t={model:{type:"json",value:null}},n=function(){var e={class:"__9uisyz"},t={class:"title __9uisyz"},n={key:"onboarding-title",class:"__9uisyz"},o={class:"contacts __9uisyz"},s={class:"h4 __9uisyz"},i={key:"write-to-friends",class:"__9uisyz"},r={class:"all __9uisyz",shape:"square","on-click":"viewContacts"},a={icon:"arrow-right",size:"medium",position:"right",class:"__9uisyz"},c={key:"show-all-contacts",class:"__9uisyz"},l={class:"contacts_list __9uisyz"},u={class:"name __9uisyz"},p={class:"channels __9uisyz"},h={class:"channels_list __9uisyz"},d={class:"scroller __9uisyz","on-scroll":"onScroll"},f={class:"not-found __9uisyz"},g={key:"not-found",class:"__9uisyz"},_=function(e){e.open(0,"div",{class:"contacts_i __9uisyz","on-click":["openDialog",e.get("self","id")]}),e.open(1,"ok-user-card",{user:e.get("self"),size:"big",class:"__9uisyz"}),e.close(),e.open(2,"div",u),e.setText(e.get("self","name")),e.close(),e.open(3,"ok-online-label",{user:e.get("self"),class:"__9uisyz"}),e.close(),e.close()},m=function(e){e.open(0,"ok-onboarding-chats-item",{chat:e.get("self","chat"),highlights:e.get("self","highlights"),class:"__9uisyz"}),e.close()},v=function(e){e.open(0,"ok-onboarding-chats-item",{chat:e.get("self"),class:"__9uisyz"}),e.close()};return function(u){u.open(0,"ok-toolbar",e),u.open(1,"div",t),u.open(2,"ok-l10n",n),u.close(),u.close(),u.close(),u.get(["count",u.get("@model","contacts")])>0&&(u.open(3,"div",o),u.open(4,"h4",s),u.open(5,"ok-l10n",i),u.close(),u.close(),u.open(6,"ok-button",r),u.open(7,"ok-tico",a),u.open(8,"ok-l10n",c),u.close(),u.close(),u.close(),u.open(9,"div",l),u.iterate(10,u.get("@model","contacts",function(e){return e.get(["position"])<5}),_),u.close(),u.close()),u.get(["count",u.get("@model","chats")])>0&&(u.open(11,"ok-search-input",{value:u.get("@model","search","query"),placeholder:"Поиск по интересным каналам",role:"secondary","on-input":"search",class:"__9uisyz"}),u.close(),u.open(12,"div",p),u.open(13,"div",h),u.open(14,"div",d),u.get("@model","search")?u.get(["count",u.get("@model","search","result")])>0?u.iterate(15,u.get("@model","search","result"),m):(u.open(16,"div",f),u.open(17,"ok-l10n",g),u.close(),u.close()):u.iterate(18,u.get(["state","chats"],function(e){return e.get(["position"])<10}),v),u.close(),u.close(),u.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},scroller:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9uisyz"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t,n){"model"!==e||n&&t.chats===n.chats||this.state.set("chats",t.chats.filter(fr).concat(t.chats.filter(dr)))},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.emit("log-screen","ONBOARDING")},o.prototype.openDialog=function(e,t,n){n.emit("open-dialog",{userId:e}),n.emit("log-action","ACTION_ONBOARDING_CONTACT_CLICKED")},o.prototype.viewContacts=function(e,t){t.emit("contacts-enter")},o.prototype.search=function(e,t){t.emit("onboarding-search",this.value)},o.prototype.onScroll=function(e,t){if(t.getAttribute("model").search){var n=t.scroller,o=n.scrollHeight-n.scrollTop-n.offsetHeight<100,s=n.scrollHeight>n.offsetHeight;!o&&s||t.emit("onboarding-search-load-more")}},s.scroller.get=function(){return this._scroller||(this._scroller=this.componentView.querySelector(".scroller")),this._scroller},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-layer",function(e){var t={controls:{type:"boolean",value:!0}},n=function(){var e={class:"overlay __3tf8rp","on-click":"close"},t={class:"container __3tf8rp"},n={class:"center __3tf8rp"},o={name:"center",class:"__3tf8rp"},s={class:"header __3tf8rp"},i={name:"header",class:"__3tf8rp"},r={class:"inner __3tf8rp"},a={name:"body",class:"__3tf8rp"},c={class:"buttons __3tf8rp"},l={name:"buttons",class:"__3tf8rp"},u={class:"close __3tf8rp","on-click":"close"},p={class:"close_ovr __3tf8rp"},h={shape:"circle",class:"__3tf8rp"},d={icon:"clear",size:"medium",class:"__3tf8rp"},f={class:"va __3tf8rp"};return function(g){g.open(0,"div",e),g.close(),g.open(1,"div",t),g.open(2,"div",n),g.open(3,"slot",o),g.emptySlot()&&(g.open(4,"div",s),g.open(5,"slot",i),g.close(),g.close(),g.open(6,"div",r),g.open(7,"slot",a),g.close(),g.close(),g.get("@controls")&&(g.open(8,"div",c),g.open(9,"slot",l),g.close(),g.close())),g.close(),g.close(),g.open(10,"div",u),g.open(11,"div",p),g.close(),g.open(12,"ok-button",h),g.open(13,"ok-icon",d),g.close(),g.close(),g.close(),g.close(),g.open(14,"div",f),g.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3tf8rp"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.connectedCallback=function(){var t=this;e.prototype.connectedCallback.call(this),Qo(this,function(){return t.emitClose()})},o.prototype.disconnectedCallback=function(){Xo(this),e.prototype.disconnectedCallback.call(this)},o.prototype.close=function(e,t){t.emitClose()},o.prototype.emitClose=function(){this.emit("close-layer")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-form",function(e){var t={},n=function(){var e={class:"form-inner __2yhccc"},t={class:"__2yhccc"};return function(n){n.open(0,"div",e),n.open(1,"slot",t),n.close(),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2yhccc"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-avatar",function(e){var t={url:{type:"string",value:""},id:{type:"number",value:0},caption:{type:"string",value:""},size:{type:"string",value:"normal"}},n=function(e){e.get("@url")&&e.get(["state","loaded"])&&!e.get(["state","error"])||(e.open(0,"div",{class:"stub __bg-"+e.get(["state","color-index"])+" __4rhimf"}),e.setText(e.get(["state","initials"])),e.close()),e.get("@url")&&!e.get(["state","error"])&&(e.open(1,"img",{"on-error":"onError","on-load":"onLoad",src:e.get("@url"),class:"__4rhimf"}),e.close())};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4rhimf"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("error",!1),this.state.set("loaded",!1)},o.prototype.onError=function(e,t){t.state.set("error",!0)},o.prototype.onLoad=function(e,t){t.state.set("loaded",!0)},o.prototype.attributeChangedCallback=function(e,t){"url"===e&&this.init(),"caption"===e&&this.state.set("initials",_r(t)),"id"===e&&this.state.set("color-index",mr(t))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-auth-avatar",function(e){var t={type:{type:"string",value:"PHONE"},model:{type:"json",value:null}},n=function(){var e={class:"online-ok __azrjae"};return function(t){"OKWEB"==t.get("@type")?(t.open(0,"ok-avatar",{id:t.get("$model","id"),url:t.get("@model","avatar"),caption:t.get("@model","name"),size:"large",class:"__azrjae"}),t.close(),t.open(1,"span",e),t.close()):"CONFIRM"==t.get("@type")&&(t.open(2,"ok-avatar",{size:"large",url:t.get("@model","avatarUrl"),id:t.get("@model","id"),caption:t.get("@model","name"),class:"__azrjae"}),t.close(),t.open(3,"span",e),t.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"azrjae"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-input",function(e){var t={name:{type:"string",value:""},value:{type:"string",value:""},type:{type:"string",value:"text"},placeholder:{type:"string",value:""},disabled:{type:"boolean",value:!1},autofocus:{type:"boolean",value:!1},autocomplete:{type:"string",value:"on"},align:{type:"string",value:"left"}},n=function(e){e.open(0,"input",{type:e.get("@type"),name:e.get("@name"),placeholder:e.get("@placeholder"),value:e.get("@value"),align:e.get("@align"),disabled:e.get("@disabled")||e.get("null"),autofocus:e.get("@autofocus"),autocomplete:e.get("@autocomplete"),class:"__3v51rs"}),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},inputNode:{},value:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3v51rs"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},s.inputNode.get=function(){return this.shadowDOM.querySelector("input")},s.value.get=function(){return this.inputNode.value},s.value.set=function(e){var t=this.inputNode;t&&(t.value=e)},o.prototype.didRender=function(){var e=this;this.getAttribute("autofocus")&&!this._focused&&requestAnimationFrame(function(){e.focus().setCursorPosition(),e._focused=!0})},o.prototype.attributeChangedCallback=function(e,t){"value"===e&&(this.value=null!=t?t:"")},o.prototype.focus=function(e){var t=this.inputNode;return t.focus(),!0===e&&t.setSelectionRange(0,t.value.length),this},o.prototype.setCursorPosition=function(e){return"number"!=typeof e&&(e=this.value.length),this.inputNode.setSelectionRange(e,e),this},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-form-error",function(e){var t={},n=function(){var e={class:"__9kug43"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9kug43"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-form-description",function(e){var t={},n=function(){var e={class:"__k9ua31"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"k9ua31"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-form-field",function(e){var t={},n=function(){var e={class:"field-w __9hc0z1"},t={name:"field",class:"__9hc0z1"},n={name:"spinner",class:"__9hc0z1"},o={name:"error",class:"__9hc0z1"};return function(s){s.open(0,"div",e),s.open(1,"slot",t),s.close(),s.open(2,"slot",n),s.close(),s.close(),s.open(3,"slot",o),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9hc0z1"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var Fu=1e3,Uu=60,qu=60,$u=3600,Gu=yr,Bu=(new Map).set("HH:MM",yr),Vu=br,Wu=(new Map).set("H:MM:SS",br);defineComponent("ok-duration",function(e){var t={duration:{type:"number",value:0},format:{type:"string",value:"H:MM:DD"}},n=function(e){e.addText(0,e.get(["state","duration"]))};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"75r8fi"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(){var e=this.getAttribute("format");this.state.set("duration",wr(this.getAttribute("duration"),e))},Object.defineProperties(o.prototype,s),o}(e)});var Ku={width:0,height:0,fit:"contain"};defineComponent("ok-preview-image",function(e){function t(e,t){return!(!e||!t)&&Object.keys(e).every(function(n){return e[n]===t[n]})}var n={file:{value:""},width:{type:"number",value:0},height:{type:"number",value:0},fit:{type:"string",value:"contain"}},o=function(e){e.get(["state","preview"])&&(e.open(0,"img",{src:e.get(["state","preview"],"url"),width:e.get(["state","preview"],"width"),height:e.get(["state","preview"],"height"),class:"__eoz29m"}),e.close())};return function(e){function s(t){return t=e.call(this,t)}e&&(s.__proto__=e),(s.prototype=Object.create(e&&e.prototype)).constructor=s;var i={__production:{},hash:{},modelDefinition:{},template:{}};return i.__production.get=function(){return!0},i.hash.get=function(){return"eoz29m"},i.modelDefinition.get=function(){return n},i.template.get=function(){return o},s.prototype.willRender=function(){var e=this,n=this.getAttribute("file"),o={width:this.getAttribute("width"),height:this.getAttribute("height"),fit:this.getAttribute("fit")};n?n===this._prevFile&&t(o,this._prevOptions)||(this._prevFile=n,this._prevOptions=o,Er(n,o).then(function(t){e.getAttribute("file")===n?(e._disposePreview(),e.state.set("preview",t)):URL.revokeObjectURL(t.url)})):this._disposePreview()},s.prototype.disconnectedCallback=function(){this._disposePreview(),this._prevFile=this._prevOptions=null},s.prototype._disposePreview=function(){var e=this.state.get("preview");e&&(URL.revokeObjectURL(e.url),this.state.delete("preview"))},Object.defineProperties(s.prototype,i),s}(e)}),defineComponent("ok-user-card",function(e){var t={size:{type:"string",value:"normal"},user:{type:"json",value:null},"show-status":{type:"boolean",value:!0}},n=function(e){e.open(0,"ok-avatar",{size:e.get("@size"),url:e.get("@user","avatarUrl"),id:e.get("@user","id"),caption:e.get("@user","name"),class:"__87kcr2"}),e.close(),e.get("@user","presence","on")&&e.get("@show-status")&&(e.open(1,"span",{class:"online __"+e.get("@size")+" __87kcr2","data-view-type":e.get("@user","presence","on")}),e.close())};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"87kcr2"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-check",function(e){var t={checked:{type:"boolean",value:!1},name:{type:"string",value:""},value:{type:"string",value:""},size:{type:"string",value:""}},n=function(){var e={class:"__3pzmrq"};return function(t){t.open(0,"label",e),t.open(1,"input",{type:"checkbox",name:t.get("@name"),value:t.get("@value"),checked:t.get("@checked")||t.get("null"),class:"__3pzmrq"}),t.close(),t.open(2,"slot",e),t.close(),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3pzmrq"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-menu",function(e){var t=function(){var e={class:"__2yej7h"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function n(t){return t=e.call(this,t)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var o={__production:{},hash:{},modelDefinition:{},template:{}};return o.__production.get=function(){return!0},o.hash.get=function(){return"2yej7h"},o.modelDefinition.get=function(){return null},o.template.get=function(){return t},Object.defineProperties(n.prototype,o),n}(e)}),defineComponent("ok-menu-item",function(e){var t={delimiter:{type:"boolean",value:!1},expanded:{type:"boolean",value:!1}},n=function(){var e={class:"__861km1"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"861km1"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var Yu=function(e){function t(t){return(t=e.call(this,t))._init(),t}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={scroller:{}},o={events:{}};return o.events.get=function(){return{"activate-item":function(e,t){t.activate(e.detail)},"select-item":function(e,t){t.setQuery("")},input:function(e,t){t.setQuery(e.target.value)}}},t.prototype.init=function(e){this._list=new wl(e),this.query=new Xc},n.scroller.get=function(){return this._scroller||(this._scroller=this.componentView.querySelector(".scroller")),this._scroller},t.prototype.willRender=function(){var t=this.getItems();this.state.set("highlights",this.query.highlights),this.state.set("tokens",this.getTokens(t)),this._list.update(this.filterItems(t),this.scroller),e.prototype.willRender.call(this)},t.prototype.getItems=function(){throw new Error("Not implemented")},t.prototype.filterItems=function(e){throw new Error("Not implemented")},t.prototype.getTokens=function(e){return null},t.prototype.setQuery=function(e){this.state.set("query",e),this.query.update(e)},t.prototype.handleScroll=function(e){this._list.handleScroll(e)},t.prototype.activate=function(e){this.state.set("active",e)},t.prototype.deactivate=function(e){e===this.state.get("active")&&this.state.delete("active")},t.prototype.onScroll=function(e,t){t.handleScroll(e.currentTarget)},Object.defineProperties(t.prototype,n),Object.defineProperties(t,o),t}(defineComponent.BaseComponent),Zu=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-user-picker",function(){var e={users:{type:"json",value:null},selected:{type:"json",value:null},disabled:{type:"json",value:null},placeholder:{type:"string",value:""},"avatar-size":{type:"string",value:"normal"},multiple:{type:"boolean",value:!0}},t=function(){var e={class:"scroller __b5yvle","on-scroll":"onScroll"},t=function(e){e.open(0,"ok-user-picker-list-item",{user:e.get("value"),"avatar-size":e.get("$avatar-size"),highlights:e.get("$hl"),disabled:e.get("disabled"),selected:e.get("selected"),"on-mouseenter":"onActivate",class:"__b5yvle","data-picker-item":null}),e.get("$active")==e.get("value","id")&&e.addClass("active"),e.get("disabled")||e.attr("data-picker-item",e.get("value","id")),e.close()},n=function(e){return e.get("value","id")};return function(o){o.variable("avatar-size",o.get("@avatar-size")),o.variable("active",o.get(["state","active"])),o.variable("hl",o.get(["state","highlights"])),o.open(0,"ok-picker",{query:o.get(["state","query"]),tokens:o.get(["state","tokens"]),multiple:o.get("@multiple"),"header-label":o.get(["state","l10n"])("user-picker-label"),"header-placeholder":o.get(["state","l10n"])("user-picker-placeholder"),class:"__b5yvle"}),o.open(1,"div",e),o.variable("list",o.get(["state","scroll-list"])),o.open(2,"div",{style:"height: "+(o.get("$list","before")||0)+"px;",class:"__b5yvle"}),o.close(),o.iterate(3,o.get("$list","items"),t,n),o.open(4,"div",{style:"height: "+(o.get("$list","after")||0)+"px",class:"__b5yvle"}),o.close(),o.close(),o.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"b5yvle"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){var e=this;n.prototype.init.call(this,{itemHeight:62,initialItems:20,batchSize:10,onUpdate:function(t){if(t&&t.items){var n=e.getAttribute("disabled"),o=e.getAttribute("selected");t=Zu({},t,{items:t.items.map(function(e){return Zu({},e,{selected:ai(o,e.value.id),disabled:ai(n,e.value.id)})})})}e.state.set("scroll-list",t)}}),this.state.set("l10n",ro)},o.prototype.getItems=function(){return ri(this.getAttribute("users"))},o.prototype.filterItems=function(e){var t=this,n=function(e){return e.name&&t.query.matches(e.name)};return e.filter(function(e){return!e.deleted&&e.names.some(n)})},o.prototype.getTokens=function(e){var t=this.getAttribute("selected");return t?e.filter(function(e){return ai(t,e.id)}).map(Ar):null},o.prototype.activate=function(e){n.prototype.activate.call(this,Number(e))},o.prototype.deactivate=function(e){n.prototype.deactivate.call(this,Number(e))},o.prototype.onActivate=function(e,t){t.activate(e.currentTarget.getAttribute("user").id)},Object.defineProperties(o.prototype,s),o}(Yu)});var Ju=/(?:http(:?s)?:\/\/)?(?:tt.me|tamtam.chat)\//i;defineComponent("ok-channel-settings",function(e){var t={chat:{type:"json",value:null},"form-disabled":{type:"boolean",value:!0}},n=function(){var e={"on-click":"onClose",class:"__k7cdq7"},t={class:"back __k7cdq7",shape:"square"},n={icon:"back",size:"medium",class:"__k7cdq7"},o={class:"title __k7cdq7"},s={class:"header __k7cdq7"},i={class:"inner __k7cdq7"},r={for:"icon",class:"stub __k7cdq7"},a={icon:"photo",class:"__k7cdq7"},c={type:"file",name:"icon",id:"icon","on-change":"onIconChange",class:"__k7cdq7"},l={class:"header_info __k7cdq7"},u={class:"channel_descr __k7cdq7"},p={class:"block __k7cdq7"},h={class:"inner __nb __k7cdq7"},d={class:"__k7cdq7"},f={class:"h4 __1st __k7cdq7"},g={class:"fine __k7cdq7"},_={class:"h4 __k7cdq7"},m={class:"permalink __k7cdq7"},v={class:"prefix __k7cdq7"},y={icon:"link",size:"medium",spaced:"true",class:"__k7cdq7"},k={class:"fine __spaced __k7cdq7"},b={icon:"link",size:"medium",class:"__k7cdq7"},w={class:"permalink_tx __k7cdq7"},C={shape:"circle",title:"Изменить ссылку","on-click":"revokeLink",class:"__k7cdq7"},E={icon:"refresh",size:"medium",class:"__k7cdq7"},A={class:"buttons __k7cdq7"},T={shape:"square",role:"secondary","on-click":"onClose",class:"__k7cdq7"};return function(S){S.open(0,"ok-toolbar",e),S.open(1,"ok-button",t),S.open(2,"ok-tico",n),S.setText("Назад"),S.close(),S.close(),S.open(3,"div",o),S.setText("Настройки канала"),S.close(),S.close(),S.open(4,"div",s),S.open(5,"div",i),S.open(6,"label",r),S.get(["state","icon"])?(S.open(7,"ok-preview-image",{width:"92",height:"92",fit:"cover",file:S.get(["state","icon"]),class:"__k7cdq7"}),S.close()):S.get("@chat","iconUrl")?(S.open(8,"ok-avatar",{url:S.get("@chat","iconUrl"),id:S.get("@chat","id"),caption:S.get("@chat","title"),size:"big",class:"__k7cdq7"}),S.close()):(S.open(9,"ok-icon",a),S.close()),S.open(10,"input",c),S.close(),S.close(),S.open(11,"div",l),S.open(12,"ok-input",{class:"__secondary __k7cdq7",value:S.get("@chat","title"),placeholder:"Название канала","on-input":"onTitleInput","on-keyup":"onFormSubmit"}),S.close(),S.close(),S.close(),S.close(),S.open(13,"div",u),S.open(14,"ok-input",{value:S.get("@chat","description"),placeholder:"Добавить описание канала","on-input":"onDescriptionInput","on-keyup":"onFormSubmit",class:"__k7cdq7"}),S.close(),S.close(),S.variable("access",S.get(["state","access"])||S.get("@chat","access")),S.variable("isPublic","PUBLIC"==S.get("$access")),S.variable("isPrivate","PRIVATE"==S.get("$access")),S.open(15,"div",p),S.open(16,"div",h),S.open(17,"ok-menu",d),S.open(18,"h4",f),S.setText("Приватность"),S.close(),S.open(19,"ok-menu-item",d),S.open(20,"ok-radio",{name:"privacy",checked:S.get("$isPrivate"),"on-click":["onChangePrivacy","PRIVATE"],class:"__k7cdq7"}),S.addText(21,"Приватный канал"),S.open(22,"div",g),S.setText("Закрытый канал не отображается в поиске по каналам, а вступить в него можно только по ссылке"),S.close(),S.close(),S.close(),S.open(23,"ok-menu-item",d),S.open(24,"ok-radio",{name:"privacy",checked:S.get("$isPublic"),"on-click":["onChangePrivacy","PUBLIC"],class:"__k7cdq7"}),S.addText(25,"Открытый канал"),S.open(26,"div",g),S.setText("Открытый канал могут найти и просматривать все"),S.close(),S.close(),S.close(),S.open(27,"h4",_),S.setText("Ссылка"),S.close(),"PRIVATE"==S.get(["state","access"])&&"PUBLIC"==S.get("@chat","access")?(S.open(28,"div",m),S.setText("Ссылка появится после сохранения"),S.close()):S.get("$isPublic")?(S.open(29,"div",m),S.open(30,"span",v),S.open(31,"ok-tico",y),S.setText("tt.me/"),S.close(),S.close(),S.open(32,"ok-input",{id:"public-link",class:"__secondary __k7cdq7",value:S.get(["state","stored-public-link"]),placeholder:"channel","on-input":"onPublicLinkInput","on-keyup":"onFormSubmit"}),S.get(["state","public-link-error"])&&S.addClass("__error"),S.close(),S.close(),S.get(["state","public-link-error"])&&(S.open(33,"ok-form-error",d),S.setText(S.get(["state","public-link-error"])),S.close()),S.open(34,"div",k),S.setText("Не более 64 знаков"),S.close()):S.get("$isPrivate")&&(S.open(35,"div",m),S.open(36,"ok-icon",b),S.close(),S.open(37,"span",w),S.setText(S.get("@chat","link")),S.close(),S.open(38,"ok-button",C),S.open(39,"ok-icon",E),S.close(),S.close(),S.close()),S.open(40,"h4",_),S.setText("Действия"),S.close(),S.open(41,"ok-menu-item",d),S.open(42,"ok-check",{size:"medium",checked:S.get(["state","sign-admin"]),"on-click":"onToggleSignAdmin",class:"__k7cdq7"}),S.addText(43,"Подписывать сообщения"),S.open(44,"div",g),S.setText("Добавлять имена администраторов при публикации записи.\n                            В выключенном состоянии сообщения публикуются от имени канала"),S.close(),S.close(),S.close(),S.close(),S.close(),S.close(),S.open(45,"div",p),S.open(46,"div",h),S.open(47,"div",A),S.open(48,"ok-button",{shape:"square",role:"primary","on-click":"onFormSubmit",class:"__k7cdq7",disabled:null}),S.get("@form-disabled")&&!S.get(["state","enabled"])&&S.attr("disabled","disabled"),S.addText(49,"Сохранить"),S.close(),S.open(50,"ok-button",T),S.setText("Отменить"),S.close(),S.close(),S.close(),S.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"k7cdq7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t,n){"chat"===e&&(t.link&&-1===t.link.indexOf("/join/")&&this.state.set("stored-public-link",t.link.replace(Ju,"")),this.state.has("sign-admin")||this.state.set("sign-admin",t.options.SIGN_ADMIN),t&&n&&t.id===n.id&&("PRIVATE"===n.access&&"PRIVATE"===t.access&&t.link!==n.link&&this.emit("show-toast","Ссылка изменена"),t.nextLink&&(this.setStateValue("public-link",t.nextLink.link),this.state.set("public-link-error",t.nextLink.error),this.emit("check-chat-link",{chatId:t.id}))))},o.prototype.onClose=function(e,t){t.emit("close-channel-settings"),t.state.delete("title"),t.state.delete("description"),t.state.delete("icon"),t.state.delete("access"),t.state.delete("public-link"),t.state.delete("sign-admin"),t.state.delete("enabled")},o.prototype.onIconChange=function(e,t){var n=e.target.files&&e.target.files[0];n&&/^image\//.test(n.type)&&(t.state.set("icon",n),t.ensureFormEnabled())},o.prototype.onTitleInput=function(e,t){t.setStateValue("title",e.target.value||"",t.getChat().title)},o.prototype.onDescriptionInput=function(e,t){t.setStateValue("description",e.target.value||"",t.getChat().description||"")},o.prototype.onChangePrivacy=function(e,t,n){var o=n.getAttribute("chat").access;(n.state.get("access")||o)!==e&&(n.setStateValue("access",e,o),"PUBLIC"===e?requestAnimationFrame(function(){n.shadowDOM.querySelector("#public-link").focus()}):n.setStateValue("public-link",null))},o.prototype.onPublicLinkInput=function(e,t){t.emit("check-chat-link",{chatId:t.getChat().id,link:e.target.value})},o.prototype.revokeLink=function(e,t){t.emit("show-confirm",{header:"Смена ссылки",body:"Вы уверены что хотите поменять ссылку на канал? После изменения предыдущая ссылка работать не будет",buttons:[{label:"Изменить",action:function(){return t.emit("revoke-link",t.getAttribute("chat").id)}},"Отменить"]})},o.prototype.onToggleSignAdmin=function(e,t){t.state.set("sign-admin",!t.state.get("sign-admin")),t.ensureFormEnabled()},o.prototype.onFormSubmit=function(e,t){"keyup"===e.type&&13!==e.keyCode||((t.getAttribute("form-disabled")||t.state.get("enabled"))&&t.emit("update-chat",t.getPayload()),t.onClose(e,t))},o.prototype.getChat=function(){return this.getAttribute("chat")},o.prototype.setStateValue=function(e,t,n){void 0===n&&(n=null),t===n?this.state.delete(e):this.state.set(e,t),this.ensureFormEnabled()},o.prototype.ensureFormEnabled=function(){this.state.set("enabled",this.isSubmitEnabled())},o.prototype.isSubmitEnabled=function(){var e=!0,t=this.state.get("access"),n=this.state.get("public-link");e&&t&&(e=!("PUBLIC"===t&&!n));var o=this.state.get("title");return e&&o&&(e=o.length>0),!!e&&(this.state.has("title")||this.state.has("access")||this.state.has("public-link")||this.state.has("icon")||this.state.has("description")||this.state.get("sign-admin")!==this.getChat().options.SIGN_ADMIN)},o.prototype.getPayload=function(){return{chatId:this.getChat().id,theme:this.state.get("title"),description:this.state.get("description"),icon:this.state.get("icon"),access:this._getAccess(),link:this.state.get("public-link"),signAdmin:this.state.get("sign-admin")}},o.prototype._getAccess=function(){var e=this.state.get("access");return e||(this.state.get("public-link")?this.getAttribute("chat").access:null)},Object.defineProperties(o.prototype,s),o}(e)});var Qu=function(e,t,n){var o=Tr(e);this.users=o.filter(function(e){return!e.deleted}),this.contacts=this.users.filter(function(e){return e.own}),this.seacher=new tl(this.users,function(e){return e.names.map(function(e){return e.name})}),this.size=t,this.component=n,this.listItemElementName="ok-user-picker-list-item",this._updateItem=this._updateItem.bind(this),this._createItem=this._createItem.bind(this)};Qu.prototype.getItems=function(e){return e&&0!==e.length?this.seacher.search(e):this.contacts},Qu.prototype.getListOptions=function(){return{create:this._createItem,update:this._updateItem,getId:this._getItemId,avgHeight:62,alignBottom:!1,batchSize:35}},Qu.prototype.getToken=function(e){return{itemId:e.id,id:e.id,caption:e.name,url:e.avatarUrl}},Qu.prototype.getClosestElementId=function(e){var t=e.target.closest(this.listItemElementName);return t?t.getAttribute("user").id:null},Qu.prototype._getItemId=function(e){return e.item.id},Qu.prototype._updateItem=function(e,t){var n=t.firstChild;n.setAttribute("user",e.item),n.setAttribute("highlights",e.highlights),n.setAttribute("selected",e.selected),n.setAttribute("disabled",e.disabled),n.setAttribute("avatar-size",this.size),n.classList.toggle("active",e.active),n.render&&n.render(!0)},Qu.prototype._createItem=function(e,t){t.appendChild(this._createElement(e)),this._updateItem(e,t),this.component&&this.component.scopeStyle(t)},Qu.prototype._createElement=function(){return document.createElement(this.listItemElementName)};var Xu=/[A-Za-zА-Яа-я]/;defineComponent("ok-contact-picker",function(){var e={items:{type:"json",value:null},"header-placeholder":{type:"string",value:""},"avatar-size":{type:"string",value:"normal"}},t=function(){var e={class:"scroller __gb887z","on-scroll":"onScroll"},t=function(e){e.open(0,"ok-contact-picker-item",{user:e.get("value"),"avatar-size":e.get("$avatar-size"),highlights:e.get("$hl"),"data-picker-item":e.get("value","id"),"on-mouseenter":"onActivate",class:"__gb887z"}),e.get("$active")==e.get("value","id")&&e.addClass("active"),e.close()},n=function(e){return e.get("value","id")};return function(o){o.variable("avatar-size",o.get("@avatar-size")),o.variable("active",o.get(["state","active"])),o.variable("hl",o.get(["state","highlights"])),o.open(0,"ok-picker",{query:o.get(["state","query"]),tokens:o.get(["state","tokens"]),multiple:"false","header-placeholder":o.get("@header-placeholder"),class:"__gb887z"}),o.open(1,"div",e),o.variable("list",o.get(["state","scroll-list"])),o.open(2,"div",{style:"height: "+(o.get("$list","before")||0)+"px;",class:"__gb887z"}),o.close(),o.iterate(3,o.get("$list","items"),t,n),o.open(4,"div",{style:"height: "+(o.get("$list","after")||0)+"px;",class:"__gb887z"}),o.close(),o.close(),o.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"gb887z"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){var e=this;n.prototype.init.call(this,{itemHeight:62,initialItems:25,batchSize:10,onUpdate:function(t){return e.state.set("scroll-list",t)}})},o.prototype.getItems=function(){return ri(this.getAttribute("items")).sort(Sr)},o.prototype.filterItems=function(e){var t=this,n=function(e){return e.name&&t.query.matches(e.name)};return e.filter(function(e){return!e.deleted&&e.names.some(n)})},o.prototype.activate=function(e){n.prototype.activate.call(this,Number(e))},o.prototype.onActivate=function(e,t){t.activate(e.currentTarget.getAttribute("user").id)},Object.defineProperties(o.prototype,s),o}(Yu)}),defineComponent("ok-radio",function(e){var t={checked:{type:"boolean",value:!1},name:{type:"string",value:""},value:{type:"string",value:""}},n=function(){var e={class:"__3sbwuv"};return function(t){t.open(0,"label",e),t.open(1,"input",{type:"radio",name:t.get("@name"),value:t.get("@value"),checked:t.get("@checked")||t.get("null"),class:"__3sbwuv"}),t.close(),t.open(2,"slot",e),t.close(),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3sbwuv"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-black-list",function(e){var t={users:{type:"json",value:null}},n=function(){var e={key:"empty-list",class:"__9c6m0e"},t=function(e){e.open(0,"ok-black-list-item",{user:e.get("value"),class:"__9c6m0e"}),e.close()},n=function(e){return e.get("value","id")};return function(o){o.variable("list",o.get(["state","scroll-list"])),o.get(["count",o.get("$list","items")])?(o.open(1,"div",{style:"height: "+(o.get("$list","before")||0)+"px;",class:"__9c6m0e"}),o.close(),o.iterate(2,o.get("$list","items"),t,n),o.open(3,"div",{style:"height: "+(o.get("$list","after")||0)+"px;",class:"__9c6m0e"}),o.close()):(o.open(0,"ok-l10n",e),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9c6m0e"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._list=new wl({itemHeight:48,onUpdate:function(t){return e.state.set("scroll-list",t)}}),this.addEventListener("scroll",function(){return e.handleScroll()})},o.prototype.attributeChangedCallback=function(e,t){"users"===e&&this._list.update(ri(t))},o.prototype.handleScroll=function(){this._list.handleScroll(this)},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chats-list-item",["ok-chat-item-container"],function(e){var t={chat:{type:"json",value:null},selected:{type:"boolean",value:!1},"max-unread":{type:"number",value:99}},n=function(){var e={slot:"title",class:"title __hv2axs"},t={size:"small",icon:"alert-solid-off",slot:"off",class:"__hv2axs"},n={size:"medium",icon:"channel",class:"__hv2axs"},o={slot:"badge",type:"warn",class:"__hv2axs"},s={slot:"badge",class:"__hv2axs"},i={icon:"reply",size:"small",class:"__hv2axs"},r={slot:"badge",class:"my-unread __hv2axs"},a={class:"text-line __hv2axs"},c={class:"draft __hv2axs"},l={key:"draft",class:"draft-label __hv2axs"},u={"disable-links":"true",class:"__hv2axs"};return function(p){p.variable("participants",p.get("@chat","participants","*","user",function(e){return!e.get("current")})),p.variable("lastMessage",p.get("@chat","lastMessage")),p.open(0,"ok-chat-item-container",{foldable:"true",class:"__hv2axs"}),p.get(["state","can-disturb"])&&p.get("@chat","unreadCount")&&p.addClass("__unread"),p.open(1,"ok-chat-image",{slot:"image",chat:p.get("@chat"),class:"__hv2axs"}),p.close(),p.open(2,"div",e),p.open(3,"ok-chat-alerts",{chat:p.get("@chat"),class:"__hv2axs"}),p.open(4,"ok-icon",t),p.close(),p.close(),"CHANNEL"==p.get("@chat","type")&&(p.open(5,"ok-icon",n),p.close()),p.addText(6,p.get("@chat","title")||p.get("@chat","placeholder")),p.close(),p.get("@chat","lastError")?(p.open(7,"ok-notification-bubble",o),p.setText("!"),p.close()):p.get(["state","has-unread-reply"])?(p.open(8,"ok-notification-bubble",s),p.open(9,"ok-icon",i),p.close(),p.close()):"CHANNEL"!=p.get("@chat","type")&&p.get("@chat","participants","length")>1&&p.get("$lastMessage","sender","current")&&p.get("$lastMessage","time")>p.get(["state","last-read-mark"])?(p.open(10,"span",r),p.close()):p.get("@chat","unreadCount")&&(p.open(11,"ok-chat-notification-bubble",{slot:"badge",chat:p.get("@chat"),class:"__hv2axs"}),p.close()),p.open(12,"div",{class:"text __hv2axs"}),p.get(["state","can-disturb"])&&p.get("@chat","typingParticipants")&&p.addClass("__offset"),p.open(13,"div",a),p.get("@chat","posting")&&!p.get("@chat","selected")?(p.open(14,"div",c),p.open(15,"ok-l10n",l),p.close(),p.addText(16," "),p.open(17,"ok-parsed-text",u),p.setText(p.get("@chat","posting","text")),p.close(),p.close()):p.get("$lastMessage")&&(p.open(18,"ok-chat-last-message",{message:p.get("$lastMessage"),"chat-type":p.get("@chat","type"),"can-disturb":p.get(["state","can-disturb"]),class:"__hv2axs"}),p.close()),p.close(),p.open(19,"div",a),p.get(["state","can-disturb"])&&p.get(["state","typing-label"])&&(p.open(20,"ok-typing-indicator",{paused:!p.get("@chat","typingParticipants"),class:"__hv2axs"}),p.setText(p.get(["state","typing-label"])),p.close()),p.close(),p.close(),p.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"hv2axs"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{mousedown:function(e,t){0===e.button&&t.selectChat()},drop:function(e,t){e.stopPropagation(),e.preventDefault(),t.handleFiles(e.dataTransfer.files)}}},o.prototype.attributeChangedCallback=function(e,t){if("chat"===e&&t&&(this._saveLastReadMark(t),this.state.set("has-unread-reply",this._hasUnreadReply(t)),this.state.set("can-disturb",Wc(t)),t.typingParticipants)){var n="";"CHAT"===t.type&&(n=t.typingParticipants.entries().next().value[1].name+" "),this.state.set("typing-label",""+n+ro("typing"))}},o.prototype.selectChat=function(){this.emit("select-chat",{chatId:this.getAttribute("chat").id})},o.prototype.handleFiles=function(e){var t=this.getAttribute("chat");this.selectChat(),this.emit("attach-files",{chatId:t.id,files:e})},o.prototype._saveLastReadMark=function(e){var t=e.participants.reduce(function(e,t){return!t.user.current&&t.time>e?t.time:e},0);this.state.set("last-read-mark",t)},o.prototype._hasUnreadReply=function(e){return!!(e.messages?Array.from(e.messages.values()):[e.lastMessage]).filter(function(e){return e&&e.unread&&e.link&&"REPLY"===e.link.type&&e.link.message.sender.current}).length},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-search-results-item",function(e){var t={data:{type:"json",value:null},selected:{type:"boolean",value:!1}},n=function(){var e={class:"title __r23hcp",slot:"title"},t={size:"medium",icon:"channel",class:"__r23hcp"},n={size:"small",icon:"alert-solid-off",slot:"off",class:"__r23hcp"},o={slot:"badge",type:"count",class:"__r23hcp"};return function(s){s.variable("chat",s.get("@data","chat")),s.open(0,"ok-chat-item-container",{"on-click":"selectItem",class:"__r23hcp"}),s.get("@data","section")==s.get("null")&&s.get("$chat","unreadCount")&&s.addClass("__unread"),s.open(1,"ok-chat-image",{slot:"image",chat:s.get("$chat"),class:"__r23hcp"}),s.close(),s.open(2,"div",e),"CHANNEL"==s.get("$chat","type")&&(s.open(3,"ok-icon",t),s.close()),s.open(4,"ok-chat-alerts",{chat:s.get("$chat"),class:"__r23hcp"}),s.open(5,"ok-icon",n),s.close(),s.close(),s.open(6,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true",highlights:s.get("@data","highlights"),"disable-links":"true",class:"__r23hcp"}),s.setText(s.get("$chat","title")||s.get("$chat","placeholder")),s.close(),s.close(),"MESSAGES"==s.get("@data","section")?(s.open(7,"ok-parsed-text",{highlights:s.get("@data","highlights"),"focus-highlight":"2","disable-links":"true",class:"__r23hcp"}),s.setText(s.get("@data","message","link","message","text")||s.get("@data","message","text")),s.close(),s.get("@data","count")&&(s.open(8,"ok-notification-bubble",o),s.setText(s.get("@data","count")),s.close())):(s.get("@data","matchedParticipants")?(s.open(9,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true",highlights:s.get("@data","highlights"),"focus-highlight":"2","disable-links":"true",class:"__r23hcp"}),s.setText(s.get("@data","matchedParticipants")),s.close()):(s.open(10,"ok-chat-last-message",{message:s.get("$chat","lastMessage"),"chat-type":s.get("$chat","type"),"can-disturb":s.get(["state","can-disturb"]),class:"__r23hcp"}),s.close()),s.get("$chat","unreadCount")&&(s.open(11,"ok-chat-notification-bubble",{slot:"badge",chat:s.get("$chat"),class:"__r23hcp"}),s.close())),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"r23hcp"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){"data"===e&&t&&t.chat&&this.state.set("can-disturb",Wc(t.chat))},o.prototype.selectItem=function(e,t){t.emit("chat-search-select-result",t.getAttribute("data"))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-search-results-header",function(e){var t={text:{type:"string",value:""},counter:{type:"number",value:0},section:{type:"string",value:""}},n=function(){var e={class:"h4 __w1cifn"},t={"on-click":"showMore",class:"__w1cifn"};return function(n){n.open(0,"h4",e),n.addText(1,n.get("@text")),n.get("@counter")>0&&(n.open(2,"span",t),n.setText("Еще "+n.get("@counter")),n.close()),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"w1cifn"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.showMore=function(e,t){t.emit("chat-search-set-context",{type:t.getAttribute("section")})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-search-results-reset-filter",function(e){var t=function(){var e={class:"__-l3x64g"};return function(t){t.open(0,"h3",e),t.setText("ВСЕ РЕЗУЛЬТАТЫ"),t.close()}}();return function(e){function n(t){return t=e.call(this,t)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var o={__production:{},hash:{},modelDefinition:{},template:{}},s={events:{}};return o.__production.get=function(){return!0},o.hash.get=function(){return"-l3x64g"},o.modelDefinition.get=function(){return null},o.template.get=function(){return t},s.events.get=function(){return{click:function(e,t){t.emit("chat-search-change-filter")}}},Object.defineProperties(n.prototype,o),Object.defineProperties(n,s),n}(e)}),defineComponent("ok-loader",function(e){var t={type:{type:"string",value:"1"},size:{type:"string",value:"medium"},paused:{type:"boolean",value:!1}},n=function(){var e={class:"dots __4r4vi7"},t={class:"dot __4r4vi7"},n={icon:"progress",size:"medium",class:"__4r4vi7"};return function(o){"1"==o.get("@type")?(o.open(0,"div",e),o.open(1,"i",t),o.close(),o.open(2,"i",t),o.close(),o.open(3,"i",t),o.close(),o.close()):"2"==o.get("@type")&&(o.open(4,"ok-icon",n),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4r4vi7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var ep=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-message",function(e){var t={message:{type:"json",value:null},unread:{type:"boolean",value:!1},"is-own":{type:"boolean",value:!1},"is-active":{type:"boolean",value:!1},"in-chat":{type:"boolean",value:!1},"is-channel-admin":{type:"boolean",value:!1},"select-mode":{type:"boolean",value:!1},"is-visible":{type:"boolean",value:!1}},n=function(){var e={icon:"error",size:"small",class:"message-icon __5wgezx"},t={icon:"wait",size:"small",class:"message-icon __5wgezx"},n={key:"message-removed",class:"text __5wgezx"};return function(o){o.variable("seq",o.get("@message","sequence")),o.variable("sender",o.get("@message","sender")),o.variable("isForward","FORWARD"==o.get("@message","link","type")),o.variable("firstAttachType",o.get("@message","attaches",0,"_type")||o.get("$isForward")&&o.get("@message","link","message","attaches",0,"_type")),o.variable("show-avatar",!o.get("@is-own")&&"USER"==o.get("@message","type")),o.variable("firstOrSingleSeq","first"==o.get("$seq","item")||"single"==o.get("$seq","item")),o.variable("isChannelMessage","CHANNEL"==o.get("@message","type")||"CHANNEL_ADMIN"==o.get("@message","type")),o.variable("show-name","USER"==o.get("@message","type")&&o.get("@in-chat")&&!o.get("@is-own")&&o.get("$firstOrSingleSeq")||o.get("$isChannelMessage")&&(o.get("@message","text")||"FORWARD"==o.get("@message","link","type"))),o.variable("hasMedia","PHOTO"===o.get("$firstAttachType")||"VIDEO"===o.get("$firstAttachType")),(o.get("@select-mode")||o.get(["state","active"]))&&(o.open(0,"ok-checkbox",{class:"selectable_check __5wgezx",checked:o.get("@message","selected"),"on-click":"onToggleSelect"}),o.get("$firstOrSingleSeq")&&o.addClass("__shift"),o.close()),o.open(1,"ok-message-container",{class:"__5wgezx",position:null}),o.get("@is-own")&&o.attr("position","right"),o.addClass("__default"),o.get("$seq")&&o.addClass("__seq-item-"+o.get("$seq","item")+" __seq-view-"+o.get("$seq","view")),"STICKER"==o.get("$firstAttachType")&&"REPLY"!=o.get("@message","link","type")&&"REMOVED"!=o.get("@message","status")&&"FORWARD"!=o.get("@message","link","type")||o.addClass("__bg"),o.get("$show-avatar")&&!o.get("$firstOrSingleSeq")&&o.addClass("__shift"),o.get("@is-own")&&!o.get("@message","id")&&o.addClass("__unsent"),o.get("@message","selected")&&o.addClass("__selected"),"CHANNEL"!=o.get("@message","type")&&"CHANNEL_ADMIN"!=o.get("@message","type")||o.addClass("__channel"),o.get("@message","error")&&o.addClass("__has-error"),o.get("@is-own")&&o.addClass("__mine"),o.get("@message","error")?(o.open(2,"ok-icon",e),o.close()):o.get("@is-own")&&!o.get("@message","id")&&(o.open(3,"ok-icon",t),o.close()),o.get("$show-avatar")&&o.get("$firstOrSingleSeq")&&(o.open(4,"ok-user-card",{slot:"user-pic",size:"small",user:o.get("$sender"),"show-status":o.get("@in-chat"),class:"__5wgezx","on-click":null}),o.get("@in-chat")&&o.attr("on-click","onOpenDialog"),o.get("@in-chat")&&o.addClass("link"),o.close()),"REMOVED"==o.get("@message","status")?(o.open(5,"ok-l10n",n),o.close()):(o.get("$show-name")&&(o.open(6,"div",{slot:"author",class:"__5wgezx","on-click":null}),"USER"!=o.get("@message","type")&&"CHANNEL_ADMIN"!=o.get("@message","type")||o.attr("on-click","onOpenDialog"),"USER"!=o.get("@message","type")&&"CHANNEL_ADMIN"!=o.get("@message","type")||o.addClass("link"),"STICKER"==o.get("$firstAttachType")&&o.addClass("__sticker"),o.addClass("__color-"+o.get(["state","color-index"])),o.addText(7,o.get("$sender","name")),o.close()),"REPLY"==o.get("@message","link","type")?(o.open(8,"ok-message-quote",{message:o.get("@message","link","message"),"on-click":"onQuoteClick",class:"__5wgezx"}),o.close()):"FORWARD"==o.get("@message","link","type")&&(o.open(9,"ok-message-forwarded",{link:o.get("@message","link"),class:"__5wgezx"}),"CHANNEL"==o.get("@message","type")&&o.addClass("__channel"),o.close()),"STICKER"==o.get("$firstAttachType")&&"FORWARD"!=o.get("@message","link","type")?(o.open(10,"ok-sticker",{sticker:o.get("@message","attaches",0),autoplay:o.get("@is-visible"),class:"__5wgezx"}),o.close()):o.get("@message","text")&&(o.open(11,"ok-parsed-text",{class:"text __5wgezx"}),o.get("@message","attaches","length")&&o.addClass("__hide"),"EDITED"==o.get("@message","status")&&o.addClass("__edited"),o.addText(12,o.get("@message","text")),o.close()),o.get("@message","attaches","length")&&(o.open(13,"ok-message-attachments",{attachments:o.get("@message","attaches"),class:"__5wgezx"}),o.get("$hasMedia")||o.addClass("__top"),(o.get("$show-name")||o.get("$isForward")||"REPLY"===o.get("@message","link","type"))&&o.addClass("__top-radii"),o.get("@message","text")&&o.addClass("__has-text"),o.close()),o.open(14,"div",{slot:"meta",class:"__5wgezx"}),o.get("$hasMedia")&&o.addClass("__secondary"),"EDITED"===o.get("@message","status")&&(o.open(15,"ok-icon",{icon:"edited"+(o.get("$hasMedia")?"-white":""),size:"nano",class:"__5wgezx"}),o.close()),o.get("@message","stats")&&(o.open(16,"ok-message-stats",{stats:o.get("@message","stats"),class:"__5wgezx"}),o.close()),o.open(17,"ok-time",{timestamp:o.get("@message","time"),"view-type":o.get("$hasMedia")?"secondary":"primary",class:"__5wgezx"}),o.close(),o.close(),o.get(["state","active"])&&!o.get("@select-mode")&&(o.open(18,"ok-message-controls",{slot:"controls",message:o.get("@message"),"show-read":o.get("@in-chat"),"is-own":o.get("@is-own"),"is-channel-admin":o.get("@is-channel-admin"),class:"__5wgezx"}),o.get("$isChannelMessage")&&o.addClass("__visible"),"STICKER"==o.get("$firstAttachType")&&"REPLY"!=o.get("@message","link","type")&&o.addClass("__shift"),o.close())),o.close(),o.get("@message","error")&&(o.open(19,"ok-l10n",{class:"error-text __5wgezx",key:"error-"+o.get("@message","error","code")}),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"5wgezx"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){"message"===e&&this.state.set("color-index",mr(t.sender.id))},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.addEventListener("mouseenter",this),this.addEventListener("mouseleave",this),this.addEventListener("click",this)},o.prototype.disconnectedCallback=function(){this.removeEventListener("mouseenter",this),this.removeEventListener("mouseleave",this),this.removeEventListener("click",this),e.prototype.disconnectedCallback.call(this)},o.prototype.toggleSelect=function(){var e=this.getAttribute("message");this.emit(e.selected?"unselect-message":"select-message",{messageUid:e.uid})},o.prototype.onOpenDialog=function(e,t){var n=t.getAttribute("message");t.emit("open-dialog",{userId:n.sender.id})},o.prototype.onQuoteClick=function(e,t){var n=t.getAttribute("message").link.message;t.emit("highlight-message",{messageTime:n.time,messageId:n.id})},o.prototype.onToggleSelect=function(e,t){t.toggleSelect()},o.prototype.handleEvent=function(e){"mouseenter"===e.type?this.state.set("active",!0):"mouseleave"===e.type?this.state.delete("active"):"click"===e.type&&this.getAttribute("select-mode")&&(e.stopPropagation(),e.preventDefault(),this.toggleSelect())},i.events.get=function(){return{"show-media":function(e,t){e.stopPropagation(),t.emit("show-media",{mediaId:t.getAttribute("message").id+"-"+e.detail.photoId})},"get-video-url-data":function(e,t){e.stopPropagation(),t.emit("get-video-url-data",ep({},e.detail,{messageUid:t.getAttribute("message").uid}))}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-control-message",function(e){var t={message:{type:"json",value:null},"is-own":{type:"boolean",value:!1}},n=function(){var e={class:"message __ijrggr"},t={key:"you",class:"__ijrggr"},n={key:"created-channel",class:"__ijrggr"};return function(o){o.variable("control",o.get("@message","attaches",0)),o.variable("type",o.get("@message","type")),o.variable("gender",o.get("@message","sender","gender")||1),o.open(0,"div",e),o.get("@is-own")?(o.open(1,"ok-l10n",t),o.close()):"USER"!=o.get("@message","type")||"system"==o.get("$control","event")&&!o.get("@message","sender")||(o.open(2,"ok-users-list",{users:o.get("@message","sender"),size:"nano",clickable:"USER"==o.get("@message","type"),class:"__ijrggr"}),o.close()),o.addText(3," "),"new"==o.get("$control","event")?"USER"==o.get("$type")?(o.open(4,"ok-l10n",{key:"created-chat","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close()):(o.open(5,"ok-l10n",n),o.close()):"add"==o.get("$control","event")?(o.open(6,"ok-l10n",{key:"added","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close(),o.addText(7," "),o.open(8,"ok-users-list",{users:o.get("$control","users"),size:"nano",clickable:"USER"==o.get("@message","type"),class:"__ijrggr"}),o.close()):"remove"==o.get("$control","event")?(o.open(9,"ok-l10n",{key:"deleted","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close(),o.addText(10," "),o.open(11,"ok-users-list",{users:o.get("$control","user"),size:"nano",clickable:"USER"==o.get("@message","type"),class:"__ijrggr"}),o.close()):"joinByLink"==o.get("$control","event")?(o.open(12,"ok-l10n",{key:"joinByLink","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close()):"leave"==o.get("$control","event")?(o.open(13,"ok-l10n",{key:"left-chat","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close()):"title"==o.get("$control","event")?(o.open(14,"ok-l10n",{key:"changed-chat-title","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close()):"icon"==o.get("$control","event")?(o.open(15,"ok-l10n",{key:"changed-chat-icon","data-gender":o.get("$gender"),class:"__ijrggr"}),o.close()):"system"==o.get("$control","event")?o.addText(16,o.get("$control","message")):o.addText(17,o.get("@message","text")),o.close(),"icon"==o.get("$control","event")&&(o.open(18,"img",{class:"icon __ijrggr",src:o.get("$control","url")}),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ijrggr"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-delimiter-participants",function(e){var t={message:{type:"json",value:null},"max-visible":{type:"number",value:10},"max-label":{type:"number",value:99},"is-own":{type:"boolean",value:!1}},n=function(){var e={size:"small",slot:"bubble",class:"__-alpr6w"},t={class:"overflow-label __-alpr6w","on-click":"showAll"},n=function(t){t.open(0,"ok-bubble",{container:"ok-message-list","on-mouseenter":["onSetActive",t.get("user","id")],class:"__-alpr6w"}),t.open(1,"ok-avatar",{url:t.get("user","avatarUrl"),id:t.get("user","id"),caption:t.get("user","name"),size:"nano",slot:"element",class:"__-alpr6w"}),t.close(),t.get(["contains",t.get(["state","active"]),t.get("user","id")])&&(t.open(2,"ok-chat-item-container",e),t.open(3,"ok-avatar",{url:t.get("user","avatarUrl"),id:t.get("user","id"),caption:t.get("user","name"),slot:"image",size:"small",class:"__-alpr6w"}),t.close(),t.open(4,"div",{class:"link __-alpr6w",slot:"title",id:t.get("user","id"),"on-click":"openDialog"}),t.setText(t.get("user","name")),t.close(),t.open(5,"ok-time",{timestamp:t.get("time"),class:"__-alpr6w"}),t.setText(2==t.get("user","gender")?"Прочитала в ":"Прочитал в "),t.close(),t.close()),t.close()};return function(e){e.variable("max-visible",e.get("@max-visible")),e.variable("overflow-label",e.get(["min",e.get("@message","participants","length")-e.get("@max-visible")])),e.variable("own",e.get("@is-own")),e.iterate(0,e.get("@message","participants",function(e){return e.get(["position"])<e.get("$max-visible")&&!e.get("user","current")}),n),e.get("$overflow-label")>0&&(e.open(1,"div",t),e.setText(e.get(["min",e.get("$overflow-label"),e.get("@max-label")])),e.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"-alpr6w"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.showAll=function(e,t){var n=t.getAttribute("message");t.emit("open-chat-read-participants",n.participants)},o.prototype.openDialog=function(e,t){var n=this.getAttribute("id");t.emit("open-dialog",{userId:n})},o.prototype.onSetActive=function(e,t,n){var o=n.state.get("active");o&&o.has(e)||n.state.set("active",new Set(o).add(e))},o.prototype.onRemoveActive=function(e,t,n){var o=n.state.get("active");o&&o.has(e)&&((o=new Set(o)).delete(e),n.state.set("active",o))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-search-results-item",function(e){var t={data:{type:"json",value:null}},n=function(){var e={slot:"author",class:"__-le3sd1"};return function(t){t.variable("sender",t.get("@data","message","sender")),t.open(0,"ok-message-container",{"on-click":"selectItem",class:"__-le3sd1"}),t.addClass("__search-results"),"CHANNEL"==t.get("@data","message","type")?(t.open(1,"ok-chat-image",{slot:"user-pic",chat:t.get("@data","chat"),size:"small",class:"__-le3sd1"}),t.close(),t.open(2,"div",e),t.setText(t.get("@data","chat","title")||t.get("@data","chat","placeholder")),t.close()):(t.open(3,"ok-user-card",{slot:"user-pic",size:"small",user:t.get("$sender"),class:"__-le3sd1"}),t.close(),t.open(4,"div",e),t.setText(t.get("$sender","name")),t.close()),"REPLY"==t.get("@data","message","link","type")?(t.open(5,"ok-message-quote",{message:t.get("@data","message","link","message"),"on-click":"onQuoteClick",class:"__-le3sd1"}),t.close()):"FORWARD"==t.get("@data","message","link","type")&&(t.open(6,"ok-message-forwarded",{link:t.get("@data","message","link"),class:"__-le3sd1"}),t.close()),t.open(7,"ok-parsed-text",{highlights:t.get("@data","highlights"),class:"__-le3sd1"}),t.setText(t.get("@data","message","text")),t.close(),t.get("@data","message","attaches","length")&&(t.open(8,"ok-message-attachments",{slot:"attachments",attachments:t.get("@data","message","attaches"),class:"__-le3sd1"}),t.close()),t.open(9,"ok-time",{slot:"meta",timestamp:t.get("@data","message","time"),"view-type":"primary",class:"__-le3sd1"}),t.close(),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"-le3sd1"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.selectItem=function(e,t){t.emit("message-search-select-result",t.getAttribute("data"))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-delimiter-date",function(e){var t={message:{type:"json",value:null},aliases:{type:"json",value:{today:"сегодня",yesterday:"вчера"}},months:{type:"json",value:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]}},n=function(){var e={class:"date __yn3x5w"};return function(t){t.open(0,"span",e),t.setText(t.get(["state","label"])),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"yn3x5w"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e){"message"===e&&this.update()},o.prototype.update=function(){var e=this.getAttribute("message"),t="";if(e){var n=this.getAttribute("aliases"),o=this.getAttribute("months"),s=new Date,i=di(fi(s)),r=di(e.date);r===i?t=n.today:r===i-1?t=n.yesterday:(t=e.date.getDate()+" "+o[e.date.getMonth()],e.date.getFullYear()!==s.getFullYear()&&(t+=" "+e.date.getFullYear()))}this.state.set("label",t)},Object.defineProperties(o.prototype,s),o}(e)});defineComponent("ok-chat-alerts-button",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={spaced:"true",icon:"alert-solid-on",size:"medium",slot:"on",class:"__o33w2x"},t={key:"alerts",class:"__o33w2x"},n={"y-axis":"bottom",container:"ok-chat-info",class:"__o33w2x"},o={key:"alerts-enabled",slot:"element",class:"__o33w2x"},s={slot:"bubble",class:"__o33w2x"},i={class:"__o33w2x"},r={class:"h4 __o33w2x"},a={key:"alerts-off",class:"__o33w2x"},c={"on-click":"disable","data-hours":"1",class:"__o33w2x"},l={key:"alerts-off-period","data-hours":"1",class:"__o33w2x"},u={"on-click":"disable","data-hours":"2",class:"__o33w2x"},p={key:"alerts-off-period","data-hours":"2",class:"__o33w2x"},h={"on-click":"disable","data-hours":"24",class:"__o33w2x"},d={key:"alerts-off-period","data-hours":"24",class:"__o33w2x"},f={"on-click":"disable","data-hours":"-1",class:"__o33w2x"},g={key:"alerts-off-period","data-hours":"-1",class:"__o33w2x"},_={spaced:"true",icon:"alert-solid-off",size:"medium",slot:"off",class:"__o33w2x"},m={key:"alerts-disabled",slot:"element",class:"__o33w2x"},v={"on-click":"enable",class:"__o33w2x"},y={key:"alerts-on",class:"__o33w2x"};return function(k){k.open(0,"ok-chat-alerts",{chat:k.get("@chat"),"on-update":"update",class:"__o33w2x"}),k.open(1,"ok-tico",e),k.open(2,"ok-l10n",t),k.close(),k.open(3,"ok-bubble",n),k.open(4,"ok-l10n",o),k.close(),k.open(5,"ok-menu",s),k.open(6,"ok-menu-item",i),k.open(7,"h4",r),k.open(8,"ok-l10n",a),k.close(),k.close(),k.close(),k.open(9,"ok-menu-item",c),k.open(10,"ok-l10n",l),k.close(),k.close(),k.open(11,"ok-menu-item",u),k.open(12,"ok-l10n",p),k.close(),k.close(),k.open(13,"ok-menu-item",h),k.open(14,"ok-l10n",d),k.close(),k.close(),k.open(15,"ok-menu-item",f),k.open(16,"ok-l10n",g),k.close(),k.close(),k.close(),k.close(),k.close(),k.open(17,"ok-tico",_),k.open(18,"ok-l10n",t),k.close(),k.open(19,"ok-bubble",n),k.get(["state","units"])?(k.open(20,"ok-l10n",{key:"alerts-disabled-for-"+k.get(["state","units"]),"data-count":k.get(["state","count"]),slot:"element",class:"__o33w2x"}),k.close()):(k.open(21,"ok-l10n",m),k.close()),k.open(22,"ok-menu",s),k.open(23,"ok-menu-item",v),k.open(24,"ok-l10n",y),k.close(),k.close(),k.close(),k.close(),k.close(),k.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"o33w2x"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{"chat-alerts-updated":function(e,t){t.update()}}},o.prototype.attributeChangedCallback=function(e){"chat"===e&&this.update()},o.prototype.disable=function(e,t){var n=parseInt(this.getAttribute("data-hour"),10)||-1;t.changeProperty(-1===n?-1:Date.now()+36e5*n)},o.prototype.enable=function(e,t){t.changeProperty(0)},o.prototype.changeProperty=function(e){var t=this.getAttribute("chat");this.emit("update-chat-settings",{chatId:t.id,settings:{dontDisturbUntil:e}})},o.prototype.update=function(){var e=this.getAttribute("chat").settings.dontDisturbUntil;if(-1===e)this.state.delete("units");else{var t=e-Date.now();t<36e5?(this.state.set("units","minutes"),this.state.set("count",Math.ceil(t/6e4))):(this.state.set("units","hours"),this.state.set("count",Math.ceil(t/36e5)))}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-chat-add-participants",function(e){var t={users:{type:"json",value:null},disabled:{type:"json",value:null},"show-history-button":{type:"boolean",value:!0}},n=function(){var e={class:"content __uso665"},t={class:"footer __uso665"},n={class:"buttons __uso665"},o={shape:"square",role:"secondary",class:"action __uso665","on-click":"cancel"};return function(s){s.open(0,"div",e),s.open(1,"ok-user-picker",{users:s.get("@users"),selected:s.get(["state","selected"]),disabled:s.get("@disabled"),class:"__uso665"}),s.close(),s.close(),s.open(2,"div",t),s.get("@show-history-button")&&(s.open(3,"ok-check",{checked:s.get(["state","show-history"]),size:"medium","on-click":"toggleChatHistory",class:"__uso665"}),s.setText("Открыть историю переписки"),s.close()),s.open(4,"div",n),s.open(5,"ok-button",{shape:"square",role:"primary",class:"action __uso665",disabled:0==s.get(["count",s.get(["state","selected"])]),"on-click":"submit"}),s.setText("Добавить"),s.close(),s.open(6,"ok-button",o),s.setText("Отменить"),s.close(),s.close(),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"uso665"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this.state.set("show-history",!0)},o.prototype.hasAdded=function(){var e=this.state.get("selected");return e&&e.length},o.prototype.reset=function(){this.state.delete("selected")},o.prototype.toggleChatHistory=function(e,t){t.state.set("show-history",!t.state.get("show-history"))},o.prototype.submit=function(e,t){var n=t.state.get("selected")||[],o=t.state.get("show-history");t.state.delete("selected"),t.emit("add-participants",{userIds:n,showHistory:o}),t.emit("change-active-state")},o.prototype.cancel=function(e,t){t.emit("change-active-state")},i.events.get=function(){return{"select-item":function(e,t){e.stopPropagation();var n=Number(e.detail),o=t.state.get("selected");o?o.includes(n)||t.state.set("selected",o.concat(n)):t.state.set("selected",[n])},"unselect-item":function(e,t){e.stopPropagation();var n=Number(e.detail),o=t.state.get("selected");o&&o.includes(n)&&t.state.set("selected",o.filter(function(e){return e!==n}))}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)});var tp=new Zl;defineComponent("ok-parsed-text",function(e){var t={"cut-formatting-chars":{type:"boolean",value:!0},highlights:{value:""},"focus-highlight":{type:"number",value:-1},"disable-formatting":{type:"boolean",value:!1},"disable-links":{type:"boolean",value:!1},"disable-mentioning":{type:"boolean",value:!1},"user-sticker-url":{type:"string",value:"https://dsm.ok.ru/getImage?smileId="},"user-sticker-size":{type:"string",value:""}},n=function(){var e=function(e){e.get("type")==e.get("types","LINK")?(e.open(0,"a",{href:e.get("opts","link",0,"url"),title:e.get("opts","link",0,"text"),target:"_blank",class:e.get("className")+" __b5yvll"}),e.setText(e.get("value")),e.close()):e.get("type")==e.get("types","EMOJI")?(e.open(1,"img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",alt:e.get("value"),class:e.get("className")+" __b5yvll"}),e.close()):e.get("type")==e.get("types","USER_STICKER")?(e.open(2,"img",{src:e.get("$userStickerUrl")+e.get("opts","code"),alt:e.get("value"),class:"user-sticker __b5yvll"}),e.close()):e.get("format")?(e.open(3,"span",{class:e.get("className")+" __b5yvll"}),e.setText(e.get("value")),e.close()):e.addText(4,e.get("value"))};return function(t){t.variable("userStickerUrl",t.get("@user-sticker-url")),-1!==t.get("@focus-highlight")&&t.get(["count",t.get(["state","tokens"])])&&0!==t.get(["state","tokens"],0,"start")&&t.addText(0,"..."),t.iterate(1,t.get(["state","tokens"]),e)}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"b5yvll"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.willRender=function(){var e=this.getSlot(null).textContent.trim(),t=this.getAttribute("highlights");"string"==typeof t&&t.length&&(t=[t]);var n=this.getAttribute("focus-highlight"),o=this.getAttribute("disable-formatting"),s=this.getAttribute("disable-links"),i=this.getAttribute("disable-mentioning"),r={disableLinks:s,highlights:t,focusHighlight:n,cutFormattingChars:this.getAttribute("cut-formatting-chars")};i||(r.mentionHandler=Or());var a=tp.parse(e,r).map(function(e){return o&&(e.format=e.format&e.formats.HIGHLIGHTED?e.formats.HIGHLIGHTED:e.formats.NONE),e.className=e.type===e.types.EMOJI?sr(e.value):Ir(e),e});this.state.set("tokens",a)},Object.defineProperties(o.prototype,s),o}(e)});var np=function(e){this._elems=new Set,this._timer=null,this.updateInterval=e||3e4,this._update=this._update.bind(this,this._update)};np.prototype.add=function(e){this._elems.add(e),this._timer||(this._timer=setTimeout(this._update,this.updateInterval))},np.prototype.remove=function(e){this._elems.delete(e),!this._elems.size&&this._timer&&(clearTimeout(this._timer),this._timer=null)},np.prototype._startTimer=function(){!this._timer&&this._elems.size&&(this._timer=setTimeout(this._update,this.updateInterval))},np.prototype._update=function(){var e=Date.now();this._timer=null,this._elems.forEach(function(t){return t.update(e)}),this._startTimer()};var op=6e4,sp=60*op,ip=55*op,rp=sp+15*op,ap=sp+40*op,cp=4*sp,lp=["минуту","минуты","минут"],up=["час","часа","часов"],pp=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],hp=new np;defineComponent("ok-relative-date",function(e){var t={date:{type:"number",value:0}},n=function(e){e.addText(0,e.get(["state","value"]))};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ekkc33"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e){"date"===e&&this.update()},o.prototype.connectedCallback=function(){hp.add(this),this.update()},o.prototype.disconnectedCallback=function(){hp.remove(this)},o.prototype.update=function(e){var t=this.getAttribute("date");this.state.set("value",t?xr(t,e):"")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-participants-list",function(e){var t={users:{type:"json",value:null},removable:{type:"boolean",value:!1},editable:{type:"boolean",value:!0},highlights:{value:""}},n=function(){var e={icon:"add","on-click":"onAddParticipants",class:"__yl2vo0"},t={class:"not-found __yl2vo0"},n={class:"link pl __yl2vo0","on-click":"onAddParticipants"},o=function(e){e.open(0,"ok-chat-participants-list-item",{user:e.get("value"),removable:e.get("$removable"),highlights:e.get("$highlights"),class:"__yl2vo0"}),e.close()},s=function(e){return e.get("value","id")};return function(i){i.variable("list",i.get(["state","scroll-list"])),i.variable("removable",i.get("@removable")),i.variable("highlights",i.get("@highlights")),i.get("@editable")&&i.get(["count",i.get("$list","items")])&&(i.open(0,"ok-add-stub",e),i.setText("Добавить участников"),i.close()),i.get(["count",i.get("$list","items")])||(i.open(1,"div",t),i.addText(2,"Нет участников с таким именем. "),i.open(3,"span",n),i.setText("Добавим?"),i.close(),i.close()),i.open(4,"div",{style:"height: "+(i.get("$list","before")||0)+"px;",class:"__yl2vo0"}),i.close(),i.iterate(5,i.get("$list","items"),o,s),i.open(6,"div",{style:"height: "+(i.get("$list","after")||0)+"px;",class:"__yl2vo0"}),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"yl2vo0"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._list=new wl({itemHeight:48,onUpdate:function(t){return e.state.set("scroll-list",t)}}),this.addEventListener("scroll",function(){return e.handleScroll()})},o.prototype.attributeChangedCallback=function(e,t){"users"===e?this._list.update(ri(t),this):"query"===e&&this._list.reset()},o.prototype.handleScroll=function(){this._list.handleScroll(this)},o.prototype.onAddParticipants=function(e,t){t.emit("change-active-state","add-participants")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-quote",function(e){var t={message:{type:"json",value:null},preview:{type:"boolean",value:!1}},n=function(){var e={class:"user-name __ekkc3s"},t={class:"text __ekkc3s"};return function(n){n.open(0,"div",e),n.setText(n.get("@message","sender","name")),n.close(),n.variable("message","FORWARD"===n.get("@message","link","type")?n.get("@message","link","message"):n.get("@message")),"STICKER"==n.get("$message","attaches",0,"_type")?(n.open(1,"ok-sticker",{sticker:n.get("$message","attaches",0),size:"small",controls:"false",preview:n.get("@preview"),class:"__ekkc3s"}),n.close()):n.get("$message","text")?(n.open(3,"ok-parsed-text",t),n.setText(n.get("$message","text")),n.close()):(n.open(2,"ok-message-attachments",{attachments:n.get("$message","attaches",0),preview:n.get("@preview"),class:"__ekkc3s"}),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ekkc3s"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-posting-share",function(e){var t={attachments:{type:"json",value:null},selected:{type:"string",value:""}},n=function(){var e={class:"carousel_controls __et9kr0"},t={"on-click":"onPickPrev",class:"__et9kr0"},n={icon:"arrow-prev",size:"nano",class:"__et9kr0"},o={"on-click":"onPickNext",class:"__et9kr0"},s={icon:"arrow-next",size:"nano",class:"__et9kr0"},i={class:"close_btn __et9kr0","on-click":"onRemove",shape:"circle",role:"secondary",size:"small"},r={icon:"clear",size:"nano",class:"__et9kr0"};return function(a){a.variable("selected",a.get("@selected")),a.variable("attachment",a.get("@attachments",function(e){return e.get(["name"])==e.get("$selected")})),a.get("$attachment")&&(a.open(0,"ok-message-share-attach",{attachment:a.get("$attachment"),"small-preview":"true",class:"__et9kr0"}),a.close(),a.get(["count",a.get("@attachments")])>1&&(a.open(1,"div",e),a.open(2,"ok-button",t),a.open(3,"ok-icon",n),a.close(),a.close(),a.addText(4,a.get(["state","selected-number"])+" из "+a.get(["count",a.get("@attachments")])),a.open(5,"ok-button",o),a.open(6,"ok-icon",s),a.close(),a.close(),a.close()),a.open(7,"ok-button",i),a.open(8,"ok-icon",r),a.close(),a.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"et9kr0"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.willRender=function(){var e=this.getAttribute("attachments"),t=this.getAttribute("selected");return e&&t?(this.state.set("selected-number",Array.from(e.keys()).indexOf(t)+1),!0):(this.state.delete("selected-number"),!1)},o.prototype.onPickPrev=function(e,t){var n=t.getAttribute("attachments"),o=t.getAttribute("selected"),s=Array.from(n.keys()),i=s.indexOf(o),r=i-1>=0?i-1:s.length-1;t.emit("select-share-preview",{selected:s[r]})},o.prototype.onPickNext=function(e,t){var n=t.getAttribute("attachments"),o=t.getAttribute("selected"),s=Array.from(n.keys()),i=s.indexOf(o),r=i+1<s.length?i+1:0;t.emit("select-share-preview",{selected:s[r]})},o.prototype.onRemove=function(e,t){t.emit("remove-share-preview")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-posting-attach",function(e){var t={file:{value:""},type:{type:"string",value:"PHOTO"},progress:{type:"string",value:""}},n=function(){var e={"on-click":"onRemoveAttach",shape:"circle",role:"secondary",size:"medium",class:"__gn620e"},t={icon:"clear",size:"nano",class:"__gn620e"};return function(n){"PHOTO"==n.get("@type")?(n.open(0,"ok-preview-image",{file:n.get("@file"),height:"64",class:"__gn620e"}),n.close()):"VIDEO"==n.get("@type")&&(n.open(1,"ok-preview-video",{file:n.get("@file"),width:"64",height:"64",class:"__gn620e"}),n.close()),n.open(2,"ok-button",e),n.open(3,"ok-icon",t),n.close(),n.close(),n.get("@progress")&&(n.open(4,"progress",{value:n.get("@progress"),class:"__gn620e"}),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"gn620e"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.onRemoveAttach=function(e,t){t.emit("remove-posting-attach",t.getAttribute("file"))},Object.defineProperties(o.prototype,s),o}(e)});var dp="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",fp=function(){this.reset()};fp.prototype.reset=function(){this.history=[],this.historyPointer=-1},fp.prototype.remember=function(e,t){var n=this;if((-1!==this.historyPointer&&this.history.length>this.historyPointer?this.history[this.historyPointer].text:null)!==e){for(;-1!==this.historyPointer&&this.historyPointer<this.history.length-1;)n.history.pop();this.history.push({text:e,caretData:t}),this.historyPointer++}},fp.prototype.undo=function(){return this.historyPointer>0?this.history[--this.historyPointer]:null},fp.prototype.redo=function(){return this.historyPointer!==this.history.length-1?this.history[++this.historyPointer]:null};var gp=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},_p=new Zl;defineComponent("ok-posting-form-input",function(e){var t={"chat-id":{type:"number",value:0},text:{type:"string",value:""},"alternative-behaviour":{type:"boolean",value:!1},assets:{type:"boolean",value:!1}},n=function(){var e={class:"textarea __p0e2iy",contenteditable:"true","data-placeholder":"Напишите сообщение...","on-input":"onInputChange","on-keydown":"onKeyDown","on-paste":"onPaste","on-blur":"onBlur"};return function(t){t.open(0,"div",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},inputField:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"p0e2iy"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this._undoManager=new fp,this._throttleUpdateSharePreview=Xn(function(){return e.updateSharePreview()},1e3),this._throttleUpdateRecentEmoji=Xn(function(){return e.updateRecentEmoji()},1e3),this._throttleSaveUndo=Xn(function(){return e._saveUndoPoint()},500)},o.prototype.attributeChangedCallback=function(e){"chat-id"===e&&(this.clearUndo(),this._selection=null)},o.prototype.didRender=function(){var e=this.getAttribute("text");this.getText()!==e&&this.update(e,e.length)},s.inputField.get=function(){return this._input||(this._input=this.componentView.querySelector(".textarea")),this._input},o.prototype.focus=function(){var e=this.inputField,t=this.componentView.activeElement||document.activeElement;e&&e!==t&&(e.focus(),this.setSelection(0,this.getText().length))},o.prototype.blur=function(){var e=this.inputField;e&&e.blur()},o.prototype.undo=function(){var e=this._undoManager.undo();e&&this.update(e.text,e.caretData,!0)},o.prototype.redo=function(){var e=this._undoManager.redo();e&&this.update(e.text,e.caretData,!0)},o.prototype.clearUndo=function(){this._undoManager.reset()},o.prototype.reset=function(){this.emit("reset-posting",this._eventPayload()),this.clearUndo()},o.prototype.insertText=function(e){var t=this.getSelection(),n=this.getText(),o=t?Math.min(t.anchor,t.focus):n.length,s=t?Math.max(t.anchor,t.focus):n.length;this.update(""+n.slice(0,o)+e+n.slice(s),o+e.length)},o.prototype.insertNewLine=function(){this.insertText("\n")},o.prototype.getText=function(){var e="",t=this.inputField;if(t)for(var n=0,o=t.childNodes.length;n<o;n++)e+=$r(t.childNodes[n]);return e.replace(/\n$/,"")},o.prototype.getSelection=function(){return Ur(this.inputField)||this._selection},o.prototype.setSelection=function(e,t){qr(this.inputField,e,t)},o.prototype.parse=function(e){var t="__"+this.hash;return _p.parse(e||"").map(function(e){return e.className=e.type===e.types.EMOJI?sr(e.value):Ir(e),e.type===e.types.LINK&&(e.className=(e.className||"")+" href"),e.className&&(e.className+=" "+t),e})},o.prototype.reconcile=function(e,t){var n=this,o=this.parse(e&&e+"\n");"number"==typeof t?t={focus:t,anchor:t}:t||(t=this.getSelection()),Lr(this.inputField,o),t&&requestAnimationFrame(function(){return n.setSelection(t.anchor,t.focus)}),this._textLinks=o.filter(function(e){return e.type===e.types.LINK}).map(function(e){return e.value}),this._textLinks.length&&this._throttleUpdateSharePreview(),this._recentEmoji=o.filter(function(e){return e.type===e.types.EMOJI}).map(function(e){return e.value}).reduce(function(e,t){return-1===e.indexOf(t)&&e.push(t),e},[]).reverse(),this._recentEmoji.length&&this._throttleUpdateRecentEmoji()},o.prototype.update=function(e,t,n){this.emit("update-posting-message",this._eventPayload({text:e})),this.reconcile(e,t),n||this._throttleSaveUndo()},o.prototype.updateSharePreview=function(){this._textLinks&&this._textLinks.length&&this.emit("update-share-preview",this._eventPayload({links:this._textLinks}))},o.prototype.updateRecentEmoji=function(){this._recentEmoji&&this._recentEmoji.length&&this.emit("update-recent-emoji",this._recentEmoji)},o.prototype.attachFiles=function(e){e&&e.length&&this.emit("attach-files",e)},o.prototype.storeSelection=function(){this._selection=Ur(this.inputField)},o.prototype._eventPayload=function(e){return gp({chatId:this.getAttribute("chat-id")},e)},o.prototype._saveUndoPoint=function(){this._undoManager.remember(this.getText(),this.getSelection())},o.prototype.onKeyDown=function(e,t){switch(e.keyCode){case 13:var n=t.getAttribute("alternative-behaviour"),o=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey,s=n?o:!o;e.preventDefault(),s?(t.emit("commit-posting-message",t._eventPayload()),t.clearUndo()):t.insertNewLine();break;case 9:e.preventDefault(),t.emit("show-assets");break;case 38:t.emit("edit-last-message",t._eventPayload()),t.clearUndo();break;case 89:(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t.redo());break;case 90:(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.shiftKey?t.redo():t.undo())}},o.prototype.onPaste=function(e,t){var n=e.clipboardData;if(-1!==n.types.indexOf("Files"))e.preventDefault(),t.attachFiles(Kr(n));else{var o=n.getData("text/plain");o&&(e.preventDefault(),t.insertText(o))}},o.prototype.onInputChange=function(e,t){var n=e.currentTarget,o=Array.from(n.querySelectorAll("img")).filter(function(e){return/^blob:/.test(e.src)});o.length&&Promise.all(o.map(Wr)).then(function(e){return t.attachFiles(e)}).catch(function(e){return console.error(e)}),t.update(t.getText())},o.prototype.onBlur=function(e,t){t.storeSelection()},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-assets-sticker",function(e){var t={sticker:{type:"json",value:null},"is-visible":{type:"boolean",value:!1}},n=function(e){e.open(0,"img",{class:"sticker-img __gizr99","on-load":"onImageLoad",slot:"element",src:e.get("@is-visible")?e.get("@sticker","previewUrl")||e.get("@sticker","url"):e.get("null")}),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"gizr99"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.onImageLoad=function(){this.classList.add("__loaded")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-assets-emoji",function(e){var t={text:{type:"string",value:""}},n=function(e){e.open(0,"span",{class:"__cu69y4"}),e.get(["state","emoji-class"])&&e.addClass(e.get(["state","emoji-class"])),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cu69y4"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){"text"===e&&t&&this.state.set("emoji-class",sr(t))},Object.defineProperties(o.prototype,s),o}(e)});defineComponent("ok-assets-preview",function(e){var t={top:{type:"string",value:""},left:{type:"string",value:""},"x-axis":{type:"string",value:"center"},target:{type:"string",value:"sticker"}},n=function(){var e={class:"container __gjunre"},t={class:"contents __gjunre"},n={class:"__gjunre"};return function(o){o.variable("top",o.get(["state","top"])),o.open(0,"div",e),o.open(1,"div",t),o.open(2,"slot",n),o.close(),o.close(),o.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"gjunre"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.emit("log-action","STICKER_PREVIEW")},o.prototype.didRender=function(){var e=document.querySelector("ok-assets-panel"),t=e.offsetWidth,n=e.querySelector(".scroller"),o=parseInt(this.getAttribute("top"),10),s=parseInt(this.getAttribute("left"),10),i=this.shadowDOM.querySelector(".container"),r=o-n.scrollTop,a="sticker"===this.getAttribute("target")?96:28;i.setAttribute("style","top:"+r+"px;left:"+s+"px"),s<i.offsetWidth/2-a/2?this.setAttribute("x-axis","left"):s+i.offsetWidth/2+a/2>t&&this.setAttribute("x-axis","right")},Object.defineProperties(o.prototype,s),o}(e)});var mp=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-chat-picker",function(){var e={chats:{type:"json",value:null},contacts:{type:"json",value:null},selected:{type:"json",value:null},disabled:{type:"json",value:null},"header-label":{type:"string",value:""},"header-placeholder":{type:"string",value:""},"avatar-size":{type:"string",value:"normal"},multiple:{type:"boolean",value:!0}},t=function(){var e={class:"scroller __at65ar","on-scroll":"onScroll"},t=function(e){"chat"==e.get("value","itemType")?(e.open(0,"ok-chat-picker-list-item",{chat:e.get("value"),"avatar-size":e.get("$avatar-size"),highlights:e.get("$hl"),disabled:e.get("disabled"),selected:e.get("selected"),"on-mouseenter":"onActivate",class:"__at65ar","data-picker-item":null}),e.get("$active")==e.get("value","itemId")&&e.addClass("active"),e.get("disabled")||e.attr("data-picker-item",e.get("value","itemId")),e.close()):(e.open(1,"ok-user-picker-list-item",{user:e.get("value"),"avatar-size":e.get("$avatar-size"),highlights:e.get("$hl"),disabled:e.get("disabled"),selected:e.get("selected"),"on-mouseenter":"onActivate",class:"__at65ar","data-picker-item":null}),e.get("$active")==e.get("value","itemId")&&e.addClass("active"),e.get("disabled")||e.attr("data-picker-item",e.get("value","itemId")),e.close())},n=function(e){return e.get("value","itemId")};return function(o){o.variable("avatar-size",o.get("@avatar-size")),o.variable("active",o.get(["state","active"])),o.variable("hl",o.get(["state","highlights"])),o.open(0,"ok-picker",{query:o.get(["state","query"]),tokens:o.get(["state","tokens"]),multiple:o.get("@multiple"),"header-label":o.get("@header-label"),"header-placeholder":o.get("@header-placeholder"),class:"__at65ar"}),o.open(1,"div",e),o.variable("list",o.get(["state","scroll-list"])),o.open(2,"div",{style:"height: "+(o.get("$list","before")||0)+"px;",class:"__at65ar"}),o.close(),o.iterate(3,o.get("$list","items"),t,n),o.open(4,"div",{style:"height: "+(o.get("$list","after")||0)+"px",class:"__at65ar"}),o.close(),o.close(),o.close()}}();return function(n){function o(e){return e=n.call(this,e)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"at65ar"},s.modelDefinition.get=function(){return e},s.template.get=function(){return t},o.prototype.init=function(){var e=this;n.prototype.init.call(this,{itemHeight:62,initialItems:20,batchSize:10,onUpdate:function(t){if(t&&t.items){var n=e.getAttribute("disabled"),o=e.getAttribute("selected");t=mp({},t,{items:t.items.map(function(e){return mp({},e,{selected:ai(o,e.value.itemId),disabled:ai(n,e.value.itemId)})})})}e.state.set("scroll-list",t)}})},o.prototype.attributeChangedCallback=function(e,t){"chats"===e?(this.state.set("chats",Jr(t,"chat").filter(is).sort(as)),this._updateItems()):"contacts"===e&&(this.state.set("contacts",Jr(t,"contact")),this._updateItems())},o.prototype.getItems=function(){return this.state.get("items")},o.prototype.filterItems=function(e){var t=this;if(this.query.isEmpty)return e.filter(function(e){return"chat"===e.itemType});var n=function(e){return e.name&&t.query.matches(e.name)};return e.filter(function(e){return"contact"===e.itemType?!e.deleted&&e.names.some(n):t.query.matches(e.title||e.placeholder)})},o.prototype.getTokens=function(e){var t=this.getAttribute("selected");return t?e.filter(function(e){return ai(t,e.itemId)}).map(Zr):null},o.prototype.onActivate=function(e,t){t.activate(e.currentTarget.getAttribute("data-picker-item"))},o.prototype._updateItems=function(){var e=this.state.get("chats")||[],t=this.state.get("contacts")||[],n=new Set;e.forEach(function(e){"DIALOG"===e.type&&e.participants.forEach(function(e){return n.add(e.user.id)})}),this.state.set("items",e.concat(t.filter(function(e){return!n.has(e.id)})))},Object.defineProperties(o.prototype,s),o}(Yu)});defineComponent("ok-photo",function(e){var t={photo:{type:"json",value:null},width:{type:"number",value:100},height:{type:"number",value:100},"max-width":{type:"number",value:374},"max-height":{type:"number",value:300},fill:{type:"boolean",value:!1},"gif-autoplay":{type:"boolean",value:!1},preview:{type:"boolean",value:!1}},n=function(){var e={class:"photo_fill-bg-w __3v6gc2"},t={class:"gif_ic __3v6gc2"};return function(n){n.open(0,"div",{class:"photo-w __3v6gc2"}),n.get("@photo","gif")&&n.get(["state","playing"])&&n.get(["state","loading-video"])&&n.addClass("__loading"),n.get("@photo","gif")&&n.get(["state","playing"])&&!n.get(["state","loading-video"])&&n.addClass("__playing"),n.variable("ratio",n.get(["min",1,n.get("@max-width")/n.get("@width"),n.get("@max-height")/n.get("@height")])),n.get("@fill")&&(n.open(1,"div",e),n.open(2,"div",{class:"photo_fill-bg __3v6gc2",style:null}),n.get(["state","src"])&&n.attr("style","background-image: url("+n.get(["state","src"])+")"),n.close(),n.close()),n.get("@photo","gif")&&n.get(["state","playing"])&&(n.open(3,"video",{src:n.get("@photo","mp4Url"),class:"photo-video __3v6gc2",width:n.get(["round",n.get("@width")*n.get("$ratio")]),height:n.get(["round",n.get("@height")*n.get("$ratio")]),loop:"loop","on-playing":"onGifPlaying"}),n.close()),n.open(4,"img",{class:"photo-img __3v6gc2",src:n.get(["state","src"]),width:n.get(["round",n.get("@width")*n.get("$ratio")]),height:n.get(["round",n.get("@height")*n.get("$ratio")])}),n.close(),n.get("@photo","gif")&&(n.open(5,"div",t),n.close()),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"3v6gc2"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t,n){if("photo"===e)if(t&&n&&n.id!==t.id&&this._setUrl(null),t){var o=t.thumbnail||t.url;t.file?o=URL.createObjectURL(t.file):t.gif&&t.previewUrl&&(o=t.previewUrl),!this.state.get("src")&&t.previewData?(this._setUrl("data:image/png;base64, "+t.previewData),this._prefetchAndShow(o)):this._setUrl(o)}else this._setUrl(null);"gif-autoplay"===e&&this.state.set("playing",t)},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.addEventListener("mouseenter",this),this.addEventListener("mouseleave",this)},o.prototype.disconnectedCallback=function(){this.removeEventListener("mouseenter",this),this.removeEventListener("mouseleave",this),e.prototype.disconnectedCallback.call(this)},o.prototype.didRender=function(){if(this.state.get("playing")){var e=this.shadowDOM.querySelector("video");e&&e.play()}},o.prototype.handleEvent=function(e){this.getAttribute("photo").gif&&!this.getAttribute("gif-autoplay")&&("mouseenter"===e.type?(this.state.set("playing",!0),this.state.set("loading-video",!0)):"mouseleave"===e.type&&this.state.get("playing")&&this.state.set("playing",!1))},o.prototype.onGifPlaying=function(e,t){t.state.set("loading-video",!1)},o.prototype._setUrl=function(e){var t=this.state.get("url");t!==e&&(t&&URL.revokeObjectURL(t),null==e?this.state.delete("src"):this.state.set("src",e))},o.prototype._prefetchAndShow=function(e){var t=this,n=new Image;n.onload=function(){return t._setUrl(e)},n.src=e},Object.defineProperties(o.prototype,s),o}(e)});defineComponent("ok-bubble",function(e){var t={"y-axis":{type:"string",value:"bottom"},"x-axis":{type:"string",value:""},container:{type:"string",value:""}},n=function(){var e={name:"element",class:"__4pxbw4"};return function(t){t.open(0,"slot",e),t.close(),t.open(1,"slot",{name:"bubble",class:"__x-"+t.get(["state","x-axis"])+" __y-"+t.get(["state","y-axis"])+" "+(t.get(["state","active"])?"__active":"")+" __4pxbw4"}),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4pxbw4"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),this.addEventListener("mouseenter",this),this.addEventListener("mouseleave",this)},o.prototype.disconnectedCallback=function(){this.removeEventListener("mouseenter",this),this.removeEventListener("mouseleave",this),clearTimeout(this._delayTimeout),this._toggle(!1),e.prototype.disconnectedCallback.call(this)},o.prototype.handleEvent=function(e){"mouseenter"===e.type?this._toggle(!0):"mouseleave"===e.type&&this._toggle(!1)},o.prototype._toggle=function(e){var t=this;void 0===e&&(e=!0),clearTimeout(this._delayTimeout),this._delayTimeout=setTimeout(function(){e&&t._positionMenu(),t.state.set("active",e)},300)},o.prototype._positionMenu=function(){var e=this.getBoundingClientRect(),t=this._getMenuDimensions(),n=this._getConstraints(),o=e.right+t.width>n.right?"right":"left",s=e.bottom+t.height>n.bottom?"top":"bottom";this.state.set("x-axis",o),this.state.set("y-axis",s)},o.prototype._getMenuDimensions=function(){var e=this.getSlot("bubble");return{height:e.offsetHeight,width:e.offsetWidth}},o.prototype._getConstraints=function(){var e=this.getAttribute("container");return e?document.querySelector(e).getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth}},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-image",function(e){var t={chat:{type:"json",value:null},size:{type:"string",value:"normal"}},n=function(e){e.variable("participants",e.get("@chat","participants","*","user",function(e){return!e.get("current")})),"DIALOG"==e.get("@chat","type")?(e.open(0,"ok-user-card",{user:e.get("$participants"),size:e.get("@size"),class:"__9ap8ew"}),e.close()):(e.open(1,"ok-avatar",{url:e.get("@chat","iconUrl"),id:e.get("@chat","id"),caption:e.get("@chat","title")||e.get("@chat","placeholder"),size:e.get("@size"),class:"__9ap8ew"}),e.close())};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9ap8ew"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-time",function(e){var t={timestamp:{type:"number",value:0},format:{type:"string",value:"HH:MM"},"view-type":{type:"string",value:""}},n=function(){var e={class:"__2z9fp3"};return function(t){t.open(0,"slot",e),t.close(),t.addText(1,t.get(["state","time"]))}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"2z9fp3"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.willRender=function(){var e=this.getAttribute("timestamp"),t=this.getAttribute("format");this.state.set("time",kr(e,t))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-participants-list-item",function(e){var t={user:{type:"json",value:null},removable:{type:"boolean",value:!1},highlights:{value:""}},n=function(){var e={size:"small",class:"__-lf2wk4"},t={class:"text __-lf2wk4"},n={shape:"circle","on-click":"remove",class:"__-lf2wk4"},o={icon:"clear",size:"medium",class:"__-lf2wk4"};return function(s){s.open(0,"ok-chat-item-container",e),s.open(1,"ok-user-card",{slot:"image",user:s.get("@user"),size:"small",class:"__-lf2wk4","on-click":null}),s.get("@user","current")||s.attr("on-click","openDialog"),s.get("@user","current")||s.addClass("link"),s.close(),s.open(2,"div",{slot:"title",class:"title __-lf2wk4",id:s.get("@user","id")}),s.open(3,"span",{class:"__-lf2wk4","on-click":null}),s.get("@user","current")||s.addClass("link"),s.get("@user","current")||s.attr("on-click","openDialog"),s.open(4,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true",highlights:s.get("@highlights"),class:"__-lf2wk4"}),s.setText(s.get("@user","name")),s.close(),s.close(),s.close(),s.open(5,"div",t),s.open(6,"ok-online-label",{user:s.get("@user"),class:"__-lf2wk4"}),s.close(),s.close(),s.get("@removable")&&!s.get("@user","current")&&(s.open(7,"ok-button",n),s.open(8,"ok-icon",o),s.close(),s.close()),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"-lf2wk4"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.remove=function(e,t){var n=t.getAttribute("user");t.emit("show-confirm",{header:ro("remove-participant-confirm-header"),body:ro("remove-participant-confirm-body",{user:n.name,gender:n.gender}),buttons:[{label:ro("remove-participant-confirm-button"),action:function(){return t.emit("remove-participant",n.id)}},ro("confirm-cancel-button")]})},o.prototype.openDialog=function(e,t){var n=t.getAttribute("user").id;t.emit("open-dialog",{userId:n}),t.emit("change-active-state")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-add-stub",function(e){var t={icon:{type:"string",value:""},text:{type:"string",value:""}},n=function(){var e={class:"icon __6nvw9o"},t={class:"text __6nvw9o"},n={class:"__6nvw9o"};return function(o){o.open(0,"div",e),o.open(1,"ok-icon",{icon:o.get("@icon"),size:"medium",class:"__6nvw9o"}),o.close(),o.close(),o.open(2,"div",t),o.open(3,"slot",n),o.emptySlot()&&o.setText(o.get("@text")),o.close(),o.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"6nvw9o"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-onboarding-chats-item",function(e){var t={chat:{type:"json",value:null},highlights:{value:""}},n=function(){var e={class:"text __w4l3k7"},t={class:"name __w4l3k7"},n={size:"medium",icon:"channel",class:"__w4l3k7"},o={class:"description __w4l3k7"},s={class:"participants __w4l3k7"};return function(i){i.open(0,"a",{href:i.get("@chat","link"),class:"ovr __w4l3k7","on-click":"log"}),i.close(),i.open(1,"ok-chat-image",{chat:i.get("@chat"),size:"big",class:"__w4l3k7"}),i.close(),i.open(2,"div",e),i.open(3,"div",t),"CHANNEL"==i.get("@chat","type")&&(i.open(4,"ok-icon",n),i.close()),i.open(5,"ok-parsed-text",{highlights:i.get("@highlights"),class:"__w4l3k7"}),i.setText(i.get("@chat","title")),i.close(),i.close(),i.get("@chat","description")&&(i.open(6,"div",o),i.open(7,"ok-parsed-text",{highlights:i.get("@highlights"),class:"__w4l3k7"}),i.setText(i.get("@chat","description")),i.close(),i.close()),i.open(8,"div",s),i.open(9,"ok-chat-meta",{chat:i.get("@chat"),class:"__w4l3k7"}),i.close(),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"w4l3k7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.log=function(e,t){t.emit("log-action","ACTION_ONBOARDING_CHANNEL_CLICKED")},Object.defineProperties(o.prototype,s),o}(e)});var vp="data-picker-item";defineComponent("ok-picker",function(e){var t={multiple:{type:"boolean",value:!0},tokens:{type:"json",value:null},query:{type:"string",value:""},"header-label":{type:"string",value:""},"header-placeholder":{type:"string",value:""}},n=function(){var e={name:"header",class:"__4s16km"},t={class:"__4s16km"};return function(n){n.open(0,"slot",e),n.emptySlot()&&(n.open(1,"ok-picker-header",{items:n.get("@tokens"),multiple:n.get("@multiple"),query:n.get("@query"),label:n.get("@header-label"),placeholder:n.get("@header-placeholder"),class:"__4s16km"}),n.close()),n.close(),n.open(2,"slot",t),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"4s16km"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{click:function(e,t){var n=e.target.closest("["+vp+"]");n&&t.toggleSelect(Qr(n))},keydown:function(e,t){if("query"===e.target.getAttribute("name"))if(38===e.keyCode)e.preventDefault(),t.previousActive();else if(40===e.keyCode)e.preventDefault(),t.nextActive();else if(13===e.keyCode){var n=t.getActive();n&&t.toggleSelect(Qr(n))}}}},o.prototype.init=function(){this._items=null},o.prototype.didRender=function(){this._reset()},o.prototype.disconnectedCallback=function(){this._reset()},o.prototype.getItems=function(){if(!this._items){var e=this.getSlot(null);this._items=e?Array.from(e.querySelectorAll("["+vp+"]")):[]}return this._items},o.prototype.getItemById=function(e){var t=this.getSlot(null);return t&&t.querySelector("["+vp+'="'+e+'"]')},o.prototype.getActive=function(e){return(e||this.getItems()).find(Xr)},o.prototype.setActive=function(e){this.emit("activate-item",e)},o.prototype.nextActive=function(){this._setActiveWithOffset(this.getItems(),1)},o.prototype.previousActive=function(){this._setActiveWithOffset(this.getItems(),-1)},o.prototype.select=function(e){this.emit("select-item",e)},o.prototype.unselect=function(e){this.emit("unselect-item",e)},o.prototype.isSelected=function(e){var t=this.getItemById(e);return t&&t.getAttribute("selected")},o.prototype.toggleSelect=function(e){this.isSelected(e)?this.unselect(e):this.select(e)},o.prototype._reset=function(){this._items=null},o.prototype._setActiveWithOffset=function(e,t){if(e.length){var n=e[e.findIndex(Xr)+t];if(n)return n.scrollIntoViewIfNeeded(),this.setActive(Qr(n)),!0}return!1},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-user-picker-list-item",function(e){var t={user:{type:"json",value:null},highlights:{value:""},selected:{type:"boolean",value:!1},disabled:{type:"boolean",value:!1},"avatar-size":{type:"string",value:"normal"}},n=function(){var e={class:"name __vrlcfr"};return function(t){t.open(0,"ok-user-card",{user:t.get("@user"),size:t.get("@avatar-size"),class:"__vrlcfr"}),t.close(),t.open(1,"span",e),t.open(2,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true","disable-links":"true",highlights:t.get("@highlights"),class:"__vrlcfr"}),t.setText(t.get("@user","name")),t.close(),t.close(),t.get("@disabled")||(t.open(3,"ok-checkbox",{name:"user",value:t.get("@user","id"),checked:t.get("@selected"),class:"__vrlcfr"}),t.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"vrlcfr"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-contact-picker-item",function(e){var t={user:{type:"json",value:null},highlights:{value:""},selected:{type:"boolean",value:!1},disabled:{type:"boolean",value:!1},"avatar-size":{type:"string",value:"normal"}},n=function(){var e={class:"name __qwsg3f"};return function(t){t.open(0,"ok-user-card",{user:t.get("@user"),size:t.get("@avatar-size"),class:"__qwsg3f"}),t.close(),t.open(1,"span",e),t.open(2,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true",highlights:t.get("@highlights"),class:"__qwsg3f"}),t.setText(t.get("@user","name")),t.close(),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"qwsg3f"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-black-list-item",function(e){var t={user:{type:"json",value:null}},n=function(){var e={size:"small",class:"__hl9qdm"},t={class:"__hl9qdm"},n={class:"text __hl9qdm"},o={shape:"circle","on-click":"unblock",class:"__hl9qdm"},s={icon:"clear",size:"medium",class:"__hl9qdm"};return function(i){i.open(0,"ok-chat-item-container",e),i.open(1,"ok-user-card",{slot:"image",user:i.get("@user"),size:"small",class:"__hl9qdm"}),i.close(),i.open(2,"div",{slot:"title",class:"title __hl9qdm",id:i.get("@user","id")}),i.open(3,"span",t),i.setText(i.get("@user","name")),i.close(),i.close(),i.open(4,"div",n),i.open(5,"ok-online-label",{user:i.get("@user"),class:"__hl9qdm"}),i.close(),i.close(),i.open(6,"ok-button",o),i.open(7,"ok-icon",s),i.close(),i.close(),i.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"hl9qdm"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.unblock=function(e,t){var n=t.getAttribute("user");t.emit("show-confirm",{header:ro("unblock-user-confirm-header"),body:ro("unblock-user-confirm-body",{user:n.name}),buttons:[{label:ro("unblock-user-confirm-button"),action:function(){return t.emit("unblock-user",n.id)}},ro("unblock-user-cancel-button")]})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-notification-bubble",function(e){var t={type:{type:"string",value:""}},n=function(){var e={class:"__rmw620"};return function(t){t.open(0,"slot",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"rmw620"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-notification-bubble",function(e){var t={chat:{type:"json",value:null},"max-unread":{type:"number",value:99}},n=function(){var e={slot:"on",class:"__-uv8rrf"},t={type:"muted",slot:"off",class:"__-uv8rrf"};return function(n){n.open(0,"ok-chat-alerts",{chat:n.get("@chat"),class:"__-uv8rrf"}),n.open(1,"ok-notification-bubble",e),n.get("@chat","unreadCount")>n.get("@max-unread")?n.addText(2,n.get("@max-unread")+"+"):n.addText(3,n.get("@chat","unreadCount")),n.close(),n.open(4,"ok-notification-bubble",t),n.get("@chat","unreadCount")>n.get("@max-unread")?n.addText(5,n.get("@max-unread")+"+"):n.addText(6,n.get("@chat","unreadCount")),n.close(),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"-uv8rrf"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-last-message",function(e){var t={message:{type:"json",value:null},"chat-type":{type:"string",value:"DIALOG"},forward:{type:"boolean",value:!1},"can-disturb":{type:"boolean",value:!0}},n=function(){var e={class:"attachment-icon __lovkwr"},t={"disable-links":"true","user-sticker-size":"compact",class:"__lovkwr"},n={key:"sticker",class:"attachment-label __lovkwr"},o={key:"photo",class:"attachment-label __lovkwr"},s={key:"video",class:"attachment-label __lovkwr"},i={key:"audio",class:"attachment-label __lovkwr"};return function(r){r.get("@forward")||("DIALOG"==r.get("@chat-type")?r.get("@message","sender","current")&&(r.open(0,"ok-avatar",{url:r.get("@message","sender","avatarUrl"),id:r.get("@message","sender","id"),caption:r.get("@message","sender","name"),size:"nano",class:"__lovkwr"}),r.close()):"CHAT"==r.get("@chat-type")&&(r.open(1,"ok-avatar",{url:r.get("@message","sender","avatarUrl"),id:r.get("@message","sender","id"),caption:r.get("@message","sender","name"),size:"nano",class:"__lovkwr"}),r.close())),r.variable("attachment",r.get("@message","attaches",0)),r.variable("attachment-type",r.get("$attachment","_type")),"STICKER"==r.get("$attachment-type")?(r.open(2,"span",e),r.open(3,"ok-parsed-text",t),r.setText(r.get("$attachment","tags",0)),r.close(),r.close(),r.open(4,"ok-l10n",n),r.close()):r.get("@message","text")?(r.open(5,"ok-parsed-text",t),r.setText(r.get("@message","text")),r.close()):"CONTROL"==r.get("$attachment-type")?(r.open(6,"ok-chat-last-control-message",{message:r.get("@message"),class:"__lovkwr"}),r.close()):"PHOTO"==r.get("$attachment-type")?(r.open(7,"span",e),r.setText("📷"),r.close(),r.open(8,"ok-l10n",o),r.close()):"VIDEO"==r.get("$attachment-type")?(r.open(9,"span",e),r.setText("📹"),r.close(),r.open(10,"ok-l10n",s),r.close()):"AUDIO"==r.get("$attachment-type")?(r.open(11,"span",e),r.setText("🔈"),r.close(),r.open(12,"ok-l10n",i),r.close()):"SHARE"==r.get("$attachment-type")?r.addText(13,r.get("$attachment","url")):r.get("$attachment-type")?r.addText(14,"("+r.get("$attachment-type")+")"):"FORWARD"==r.get("@message","link","type")&&(r.open(15,"ok-chat-last-message",{message:r.get("@message","link","message"),"chat-type":r.get("@chat-type"),"can-disturb":r.get("@can-disturb"),forward:"true",class:"__lovkwr"}),r.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"lovkwr"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){if("message"===e&&t){var n=t.sender&&t.sender.gender?t.sender.gender:1;this.state.set("gender",{gender:n})}},Object.defineProperties(o.prototype,s),o}(e)});var yp=new np(5e3);defineComponent("ok-chat-alerts",function(e){var t={chat:{type:"json",value:null}},n=function(){var e={name:"on",class:"__asl2sg"},t={name:"off",class:"__asl2sg"};return function(n){n.get(["state","can-disturb"])?(n.open(0,"slot",e),n.close()):(n.open(1,"slot",t),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"asl2sg"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e){"chat"!==e||this.update()||yp.add(this)},o.prototype.disconnectedCallback=function(){yp.remove(this)},o.prototype.update=function(){var e=this.getAttribute("chat"),t=Wc(e);return this.state.set("can-disturb",t),this.emit("chat-alerts-updated"),t&&yp.remove(this),t},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-container",function(e){var t={position:{type:"string",value:"default"}},n=function(){var e={name:"user-pic",class:"__mha6e5"},t={class:"content __mha6e5"},n={name:"author",class:"__mha6e5"},o={class:"__mha6e5"},s={name:"meta",class:"__mha6e5"},i={name:"controls",class:"__mha6e5"};return function(r){r.open(0,"slot",e),r.close(),r.open(1,"div",t),r.open(2,"slot",n),r.close(),r.open(3,"slot",o),r.close(),r.open(4,"slot",s),r.close(),r.close(),r.open(5,"slot",i),r.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"mha6e5"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-sticker",function(e){var t={sticker:{type:"json",value:null},size:{type:"string",value:"default"},controls:{type:"boolean",value:!0},preview:{type:"boolean",value:!1},autoplay:{type:"boolean",value:!1},repeat:{type:"boolean",value:!1},reply:{type:"boolean",value:!1}},n=function(){var e={shape:"circle",role:"primary",size:"small",class:"__5yohdp"},t={icon:"play",size:"small",class:"__5yohdp"};return function(n){n.get("@sticker","mp4Url")||(n.open(0,"img",{class:"sticker-img __5yohdp",src:n.get("@sticker","url"),"on-load":"onFirstFrameLoad",width:n.get("@sticker","width"),height:n.get("@sticker","height")}),n.close()),n.get("@sticker","mp4Url")&&(n.open(1,"div",{class:"sticker __5yohdp"}),n.get(["state","play-state"])&&n.addClass("__"+n.get(["state","play-state"])),n.open(2,"img",{class:"sticker_first __5yohdp","on-load":"onFirstFrameLoad","on-transitionend":"firstFrameTransitionEnd",src:n.get("@sticker","firstUrl")||n.get("@sticker","url"),width:n.get("@sticker","width"),height:n.get("@sticker","height")}),n.close(),n.open(3,"video",{src:n.get("@sticker","mp4Url"),"on-ended":"videoEnded",class:"sticker_video __5yohdp",width:n.get("@sticker","width"),height:n.get("@sticker","height")}),n.close(),n.open(4,"img",{"on-transitionend":"lastFrameTransitionEnd",class:"sticker_last __5yohdp",src:n.get("@sticker","url"),width:n.get("@sticker","width"),height:n.get("@sticker","height")}),n.close(),"playing"!=n.get(["state","play-state"])&&n.get("@controls")&&(n.open(5,"ok-button",e),n.open(6,"ok-icon",t),n.close(),n.close()),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"5yohdp"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.didRender=function(){var e=this,t=this.getAttribute("autoplay"),n=this.getAttribute("repeat"),o=this.state.get("play-state"),s=this.state.get("already-played");switch(o){case"firstFrame":break;case"video":this.playVideo();break;case"lastFrame":break;default:(t&&!s||n)&&requestAnimationFrame(function(){return e.playSticker()})}},o.prototype.onFirstFrameLoad=function(){this.classList.add("__loaded")},o.prototype.playSticker=function(){var e=this.getAttribute("sticker"),t=this.state.get("play-state")||"firstFrame";e&&e.mp4Url&&(this.loop=e.loop,this.state.set("already-played",!0),"lastFrame"===t?this.state.set("play-state","firstFrame"):this.state.set("play-state","video"))},o.prototype.firstFrameTransitionEnd=function(e,t){"firstFrame"===t.state.get("play-state")&&t.state.set("play-state","video")},o.prototype.playVideo=function(){var e=this,t=this.componentView.querySelector("video");t&&(t.currentTime=0,t.play().catch(function(){e.state.set("play-state","lastFrame")}))},o.prototype.videoEnded=function(e,t){t.loop>1?(t.loop--,t.playVideo()):t.state.set("play-state","lastFrame")},o.prototype.lastFrameTransitionEnd=function(e,t){t.getAttribute("repeat")&&setTimeout(function(){return t.playSticker()},1e3)},i.events.get=function(){return{click:function(e,t){requestAnimationFrame(function(){return t.playSticker()}),t.emit("log-action","STICKER_PLAY_MANUAL")}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-message-attachments",function(e){var t={attachments:{type:"json",value:null},preview:{type:"boolean",value:!1}},n=function(){var e=function(e){"PHOTO"==e.get("_type")?(e.open(0,"ok-message-photo-attach",{preview:e.get("$preview"),class:"attachment __r4tt4m",attachment:e.get("self")}),e.close()):"VIDEO"==e.get("_type")?(e.open(1,"ok-message-video-attach",{preview:e.get("$preview"),class:"attachment __r4tt4m",attachment:e.get("self")}),e.close()):"AUDIO"==e.get("_type")?(e.open(2,"ok-message-audio-attach",{class:"attachment __r4tt4m",attachment:e.get("self")}),e.close()):"SHARE"==e.get("_type")&&(e.open(3,"ok-message-share-attach",{class:"attachment __r4tt4m",attachment:e.get("self")}),e.close())};return function(t){t.variable("preview",t.get("@preview")),t.iterate(0,t.get("@attachments"),e)}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"r4tt4m"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-controls",function(e){var t={message:{type:"json",value:null},"show-read":{type:"boolean",value:!1},"is-own":{type:"boolean",value:!1},"is-channel-admin":{type:"boolean",value:!1}},n=function(){var e={role:"secondary",shape:"circle",size:"small",class:"forward __kehfny",title:"Переслать","on-click":"forward"},t={icon:"share",size:"medium",class:"__kehfny"},n={class:"expanded-menu __kehfny"},o={class:"expanded-menu_ovr __kehfny"},s={class:"expanded-menu_cnt __kehfny"},i={role:"secondary",shape:"circle",size:"small",title:"Еще",class:"__kehfny"},r={icon:"menu",size:"medium",class:"__kehfny"},a={class:"expanded-menu_more __kehfny"},c={role:"secondary",shape:"circle",size:"small",title:"Ответить","on-click":"reply",class:"__kehfny"},l={icon:"reply",size:"medium",class:"__kehfny"},u={role:"secondary",shape:"circle",size:"small",title:"Редактировать","on-click":"edit",class:"__kehfny"},p={icon:"edit",size:"medium",class:"__kehfny"},h={role:"secondary",shape:"circle",size:"small",title:"Удалить","on-click":"remove",class:"__kehfny"},d={icon:"delete",size:"small",class:"__kehfny"},f={role:"secondary",shape:"circle",size:"small",title:"Еще",slot:"element",class:"__kehfny"},g={slot:"bubble",class:"__kehfny"},_={icon:"share",size:"medium","on-click":"forward",class:"__kehfny"},m={icon:"reply",size:"medium","on-click":"reply",class:"__kehfny"},v={icon:"edit",size:"small","on-click":"edit",class:"__kehfny"},y={icon:"delete",size:"small","on-click":"remove",class:"__kehfny"},k={role:"promo",shape:"circle",size:"small",class:"reply __kehfny",title:"Ответить","on-click":"reply"},b={role:"secondary",shape:"circle",size:"small",title:"Переслать","on-click":"forward",class:"__kehfny"},w={role:"secondary",shape:"circle",size:"small",title:"Кто прочитал","on-click":"openReadParticipants",class:"__kehfny"},C={icon:"looked",size:"medium",class:"__kehfny"},E={"y-axis":"bottom","x-axis":"left",container:"ok-message-list",class:"__kehfny"},A={icon:"reply",size:"small","on-click":"reply",class:"__kehfny"},T={icon:"looked",size:"medium","on-click":"openReadParticipants",class:"__kehfny"};return function(S){"CHANNEL"==S.get("@message","type")||"CHANNEL_ADMIN"==S.get("@message","type")?(S.open(0,"ok-button",e),S.open(1,"ok-icon",t),S.close(),S.close(),S.get("@is-channel-admin")&&(S.open(2,"div",n),S.open(3,"div",o),S.close(),S.open(4,"div",s),S.open(5,"ok-button",i),S.open(6,"ok-icon",r),S.close(),S.close(),S.open(7,"div",a),S.open(8,"ok-button",c),S.open(9,"ok-icon",l),S.close(),S.close(),S.get("@message","editable")&&(S.open(10,"ok-button",u),S.open(11,"ok-icon",p),S.close(),S.close()),S.get("@message","removable")&&(S.open(12,"ok-button",h),S.open(13,"ok-icon",d),S.close(),S.close()),S.close(),S.close(),S.close(),S.open(14,"ok-bubble",{"y-axis":"bottom","x-axis":"left",container:"ok-message-list",class:"__kehfny"}),S.addClass("channel"),S.open(15,"ok-button",f),S.open(16,"ok-icon",r),S.close(),S.close(),S.open(17,"div",g),S.open(18,"ok-tico",_),S.setText("Переслать"),S.close(),S.open(19,"ok-tico",m),S.setText("Ответить"),S.close(),S.get("@message","editable")&&(S.open(20,"ok-tico",v),S.setText("Редактировать"),S.close()),S.get("@message","removable")&&(S.open(21,"ok-tico",y),S.setText("Удалить"),S.close()),S.close(),S.close())):(S.get("@is-own")||(S.open(22,"ok-button",k),S.open(23,"ok-icon",l),S.close(),S.close()),S.open(24,"div",n),S.open(25,"div",o),S.close(),S.open(26,"div",s),S.open(27,"ok-button",i),S.open(28,"ok-icon",r),S.close(),S.close(),S.open(29,"div",a),S.open(30,"ok-button",b),S.open(31,"ok-icon",t),S.close(),S.close(),S.get("@message","removable")&&(S.open(32,"ok-button",h),S.open(33,"ok-icon",d),S.close(),S.close()),S.get("@show-read")&&(S.open(34,"ok-button",w),S.open(35,"ok-icon",C),S.close(),S.close()),S.get("@message","editable")&&(S.open(36,"ok-button",u),S.open(37,"ok-icon",p),S.close(),S.close()),S.close(),S.close(),S.close(),S.open(38,"ok-bubble",E),S.open(39,"ok-button",f),S.open(40,"ok-icon",r),S.close(),S.close(),S.open(41,"div",g),S.open(42,"ok-tico",A),S.setText("Ответить"),S.close(),S.get("@message","editable")&&(S.open(43,"ok-tico",v),S.setText("Редактировать"),S.close()),S.open(44,"ok-tico",_),S.setText("Переслать"),S.close(),S.get("@message","removable")&&(S.open(45,"ok-tico",y),S.setText("Удалить"),S.close()),S.get("@show-read")&&(S.open(46,"ok-tico",T),S.setText("Кто прочитал"),S.close()),S.close(),S.close(),S.get("@is-own")&&(S.open(47,"ok-button",k),S.open(48,"ok-icon",l),S.close(),S.close()))}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"kehfny"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.forward=function(e,t){t.emit("forward-messages-enter",[t.getMessage().id])},o.prototype.reply=function(e,t){t.emit("reply-message",t.getMessage().uid)},o.prototype.edit=function(e,t){t.emit("edit-message",t.getMessage().uid)},o.prototype.remove=function(e,t){for(var n=t.parentNode;!n.emit;)n=n.parentNode;t.emit("show-confirm",{header:"Удалить сообщение",body:"Это сообщение будет удалено безвозвратно.",buttons:[{label:"Удалить",action:function(){return n.emit("remove-messages",[t.getMessage().uid])}},"Отменить"]})},o.prototype.openReadParticipants=function(e,t){t.emit("open-chat-read-participants-for-message",t.getMessage().uid)},o.prototype.getMessage=function(){return this.getAttribute("message")},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-forwarded",function(e){var t={link:{type:"json",value:null}},n=function(){var e={class:"title __mjthaw"},t={class:"author __mjthaw"},n={class:"__mjthaw"};return function(o){o.variable("message",o.get("@link","message")),o.variable("fromChannel","CHANNEL"==o.get("$message","type")||"CHANNEL_ADMIN"==o.get("$message","type")),o.variable("sender",o.get("$message","sender")),o.variable("firstAttachType",o.get("$message","attaches",0,"_type")),o.open(0,"div",e),o.setText("Пересланное сообщение:"),o.close(),o.open(1,"div",{class:"user __mjthaw","on-click":"openSender"}),(o.get("$fromChannel")&&o.get("@link","chatLink")||!o.get("$sender","current"))&&o.addClass("__clickable"),o.get("$fromChannel")?(o.open(2,"ok-avatar",{class:"user-pic __mjthaw",size:"micro",url:o.get("@link","chatIconUrl"),id:o.get("@link","chatId"),caption:o.get("@link","chatName")}),o.close(),o.open(3,"div",t),o.setText(o.get("@link","chatName")),o.close()):(o.open(4,"ok-user-card",{class:"user-pic __mjthaw",size:"micro",user:o.get("$sender"),"show-status":"false"}),o.close(),o.open(5,"div",t),o.setText(o.get("$sender","name")),o.close()),o.close(),"STICKER"==o.get("$firstAttachType")&&(o.open(6,"ok-sticker",{sticker:o.get("$message","attaches",0),controls:"false",class:"__mjthaw"}),o.close()),o.get("$message","text")&&"STICKER"!=o.get("$firstAttachType")&&(o.open(7,"ok-parsed-text",n),o.setText(o.get("$message","text")),o.close()),o.get("$message","attaches","length")&&(o.open(8,"ok-message-attachments",{slot:"attachments",attachments:o.get("$message","attaches"),class:"__mjthaw"}),o.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"mjthaw"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.openSender=function(e,t){var n=t.getAttribute("link"),o=n.message;if("CHANNEL"===o.type||"CHANNEL_ADMIN"===o.type){if(!n.chatLink)return;t.emit("open-channel",{link:n.chatLink,chatId:n.chatId,time:o.time})}else{var s=o.sender;if(s.current)return;t.emit("open-dialog",{userId:s.id})}},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-stats",function(e){var t={stats:{type:"json",value:null}},n=function(){var e={icon:"looked-nano",size:"nano",class:"__ejpfm1"};return function(t){t.get("@stats","views")>0&&(t.open(0,"ok-tico",e),t.setText(t.get(["state","views"])),t.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ejpfm1"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){"stats"===e&&this.state.set("views",this.format(t.views))},o.prototype.format=function(e){return e?e<1e3?e:e<1e6?(e/1e3).toFixed(e%1e3<100?0:1)+"K":(e/1e6).toFixed(e%1e6<1e3?0:1)+"M":0},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-users-list",function(e){var t={users:{type:"json",value:null},size:{type:"string",value:"nano"},clickable:{type:"boolean",value:!0}},n=function(){var e={class:"name __9t9usj"},t={key:"and",class:"__9t9usj"},n={class:"user __9t9usj"},o={class:"others __9t9usj","on-click":"showOthers"},s=function(t){t.open(0,"div",{class:"user __9t9usj","on-click":["openDialog",t.get("self","id")]}),t.get("$clickable")&&t.addClass("link"),t.open(1,"ok-user-card",{user:t.get("self"),size:t.get("$card-size"),class:"__9t9usj"}),t.close(),t.open(2,"span",e),t.setText(t.get("self","name")),t.close(),t.close(),t.get(["position"])<t.get(["count",t.get(["state","visible-users"])])-1&&t.addText(3,", ")},i=function(e){e.addText(0," "),e.open(1,"ok-l10n",t),e.close(),e.addText(2," "),e.open(3,"div",n),e.open(4,"ok-user-card",{user:e.get("self"),size:e.get("$card-size"),class:"__9t9usj","on-click":null}),e.get("$clickable")&&e.attr("on-click","openDialog({self.id})"),e.get("$clickable")&&e.addClass("link"),e.close(),e.open(5,"span",{class:"name __9t9usj","on-click":null}),e.get("$clickable")&&e.attr("on-click","openDialog({self.id})"),e.get("$clickable")&&e.addClass("__clickable"),e.addText(6,e.get("self","name")),e.close(),e.close()};return function(e){e.variable("card-size",e.get("@size")),e.variable("clickable",e.get("@clickable")),e.iterate(0,e.get(["state","visible-users"]),s),e.get(["count",e.get(["state","other-users"])])>0&&(1==e.get(["count",e.get(["state","other-users"])])?e.iterate(1,e.get(["state","other-users"]),i):(e.open(2,"span",o),e.open(3,"ok-l10n",{key:"and-more-people","data-number":e.get(["count",e.get(["state","other-users"])]),class:"__9t9usj"}),e.close(),e.close()))}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9t9usj"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.willRender=function(){var t=this.getAttribute("users"),n=Array.isArray(t)?t:[t];return this.state.get("show-other-users")?(this.state.set("visible-users",n.slice(0,n.length-1)),this.state.set("other-users",n.slice(n.length-1))):(this.state.set("visible-users",n.slice(0,2)),this.state.set("other-users",n.slice(2))),e.prototype.willRender.call(this)},o.prototype.showOthers=function(e,t){t.state.set("show-other-users",!0)},o.prototype.openDialog=function(e,t,n){n.getAttribute("clickable")&&n.emit("open-dialog",{userId:e})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-share-attach",function(e){var t={attachment:{type:"json",value:null},"small-preview":{type:"boolean",value:!1}},n=function(){var e={class:"share-card_content __t7tknj"},t={class:"share-card_h __t7tknj"},n={class:"share-card_host __t7tknj"},o={class:"share-card_t __t7tknj"},s={class:"share-card_dsc __t7tknj"},i={class:"share-card_pic __t7tknj"};return function(r){r.open(0,"div",{class:"share-card __t7tknj"}),r.get("@small-preview")&&r.addClass("__small-preview"),r.open(1,"div",e),r.open(2,"div",t),"PHOTO"==r.get("@attachment","_type")?r.addText(3,"Фотография"):"VIDEO"==r.get("@attachment","_type")&&r.addText(4,"Видеозапись"),r.get("@attachment","host")&&(r.open(5,"div",n),r.setText(r.get("@attachment","host")),r.close()),r.get("@attachment","title")&&(r.open(6,"div",o),r.setText(r.get("@attachment","title")),r.close()),r.close(),r.get("@attachment","description")&&(r.open(7,"div",s),r.setText(r.get("@attachment","description")),r.close()),"PHOTO"==r.get("@attachment","_type")||"VIDEO"==r.get("@attachment","_type")?(r.open(8,"div",i),r.open(9,"ok-photo",{photo:r.get("@attachment"),width:r.get("@attachment","width"),height:r.get("@attachment","height"),"max-width":"64","max-height":"64",class:"__t7tknj"}),r.close(),r.close()):"VIDEO"==r.get("@attachment","media","_type")?(r.open(10,"a",{class:"share-card_link __t7tknj",href:r.get("@attachment","url"),target:"_blank"}),r.close(),r.variable("video",r.get("@attachment","media")),r.open(11,"ok-video-player",{video:r.get("$video"),width:r.get("$video","width"),height:r.get("$video","height"),"max-width":"340","max-height":"210",class:"__t7tknj"}),r.close()):((r.get("@attachment","image")||r.get("@attachment","media"))&&(r.variable("img",r.get("@attachment","image")||r.get("@attachment","media")),r.open(12,"div",{class:"share-card_pic __t7tknj",style:null}),r.get("@small-preview")?(r.open(13,"ok-photo",{photo:r.get("$img"),width:r.get("$img","width"),height:r.get("$img","height"),"max-width":"64","max-height":"64",class:"__t7tknj"}),r.close()):(r.addClass("__big-preview"),r.attr("style","background-image: url("+r.get("$img","url")+")")),r.close()),r.open(14,"a",{class:"share-card_link __t7tknj",href:r.get("@attachment","url"),target:"_blank"}),r.close()),r.close(),r.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"t7tknj"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-preview-video",function(e){var t={file:{value:""},width:{type:"number",value:0},height:{type:"number",value:0},fit:{type:"string",value:"contain"}},n=function(e){e.get(["state","preview"])&&(e.open(0,"video",{src:e.get(["state","preview"],"url"),type:e.get(["state","preview"],"type"),width:e.get("@width"),height:e.get("@height"),"on-click":"onClickVideo",class:"__ergymm"}),e.close())};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"ergymm"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.attributeChangedCallback=function(e,t){"file"===e&&(t?t!==this._prevFile&&(this._prevFile=t,this.state.set("preview",{url:URL.createObjectURL(t),type:t.type})):this._disposePreview())},o.prototype.onClickVideo=function(e){e.target.paused?e.target.play():e.target.pause()},o.prototype.disconnectedCallback=function(){this._disposePreview(),this._prevFile=null},o.prototype._disposePreview=function(){var e=this.state.get("preview");e&&(URL.revokeObjectURL(e.url),this.state.delete("preview"))},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-chat-picker-list-item",function(e){var t={chat:{type:"json",value:null},highlights:{value:""},selected:{type:"boolean",value:!1},disabled:{type:"boolean",value:!1},"avatar-size":{type:"string",value:"normal"}},n=function(){var e={class:"name __v2p63c"},t={size:"medium",icon:"channel",class:"__v2p63c"};return function(n){n.open(0,"ok-chat-image",{chat:n.get("@chat"),class:"__v2p63c"}),n.close(),n.open(1,"span",e),"CHANNEL"==n.get("@chat","type")&&(n.open(2,"ok-icon",t),n.close()),n.open(3,"ok-parsed-text",{"cut-formatting-chars":"false","disable-formatting":"true",highlights:n.get("@highlights"),"disable-links":"true",class:"__v2p63c"}),n.setText(n.get("@chat","title")||n.get("@chat","placeholder")),n.close(),n.close(),n.get("@disabled")||(n.open(4,"ok-checkbox",{name:"chat",value:n.get("@chat","uid"),checked:n.get("@selected"),class:"__v2p63c"}),n.close())}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"v2p63c"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-picker-header",function(e){var t={items:{type:"json",value:null},label:{type:"string",value:""},placeholder:{type:"string",value:""},query:{type:"string",value:""},multiple:{type:"boolean",value:!0}},n=function(){var e={name:"label",class:"__e9wv18"};return function(t){t.get("@multiple")&&(t.open(0,"slot",e),t.emptySlot()&&t.setText(t.get("@label")),t.close(),t.open(1,"ok-picker-tokens",{items:t.get("@items"),class:"__e9wv18"}),t.close()),t.open(2,"ok-input",{name:"query",value:t.get("@query"),placeholder:t.get("@placeholder"),class:"__e9wv18"}),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"e9wv18"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){var e=this;this.addEventListener("click",function(){return e.focusInput()})},o.prototype.attributeChangedCallback=function(e){"items"===e&&this.focusInput()},o.prototype.focusInput=function(){var e=this.componentView.querySelector("ok-input");e&&e.focus()},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-checkbox",function(e){var t={name:{value:""},value:{value:""},checked:{type:"boolean",value:!1}},n=function(){var e={class:"checkbox __6xemvj"},t={icon:"check",class:"__6xemvj"};return function(n){n.open(0,"span",e),n.open(1,"ok-icon",t),n.close(),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{},checked:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"6xemvj"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{click:function(e,t){t.checked=!t.checked}}},s.checked.get=function(){return!!this.getAttribute("checked")},s.checked.set=function(e){this.setAttribute("checked",!!e)},o.prototype.attributeChangedCallback=function(e,t,n){"checked"===e&&t===n&&this.emit("change",{name:this.getAttribute("name"),value:t?this.getAttribute("value"):null,checked:t})},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-chat-last-control-message",function(e){var t={message:{type:"json",value:null},unread:{type:"boolean",value:!1},"is-own":{type:"boolean",value:!1}},n=function(){var e={class:"message __-sivvw7"},t={class:"user __-sivvw7"},n={key:"and",class:"__-sivvw7"},o={class:"span __-sivvw7"};return function(s){s.variable("control",s.get("@message","attaches",0)),s.variable("gender",s.get("@message","sender","gender")||1),s.open(0,"div",e),"hello"==s.get("$control","event")?(s.open(1,"ok-l10n",{key:"joined","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"new"==s.get("$control","event")?(s.open(2,"ok-l10n",{key:"created-new-chat","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"add"==s.get("$control","event")?(s.open(3,"ok-l10n",{key:"added","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close(),s.addText(4," "),s.open(5,"span",t),s.setText(s.get("$control","users",0,"name")),s.close(),2==s.get("$control","users","length")?(s.addText(6," "),s.open(7,"ok-l10n",n),s.close(),s.addText(8," "),s.open(9,"span",t),s.setText(s.get("$control","users",1,"name")),s.close()):s.get("$control","users","length")>2&&(s.addText(10,", "),s.open(11,"span",t),s.setText(s.get("$control","users",1,"name")),s.close(),s.addText(12," "),s.open(13,"ok-l10n",n),s.close(),s.addText(14," "),s.open(15,"span",o),s.setText(s.get("$control","users","length")-2),s.close())):"remove"==s.get("$control","event")?(s.open(16,"ok-l10n",{key:"deleted","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close(),s.addText(17," "),s.open(18,"span",t),s.setText(s.get("$control","user","name")),s.close()):"leave"==s.get("$control","event")?(s.open(19,"ok-l10n",{key:"left-chat","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"joinByLink"==s.get("$control","event")?(s.open(20,"ok-l10n",{key:"joinByLink","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"title"==s.get("$control","event")?(s.open(21,"ok-l10n",{key:"changed-chat-title","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"icon"==s.get("$control","event")?(s.open(22,"ok-l10n",{key:"changed-chat-icon","data-gender":s.get("$gender"),class:"__-sivvw7"}),s.close()):"system"==s.get("$control","event")&&s.addText(23,s.get("$control","shortMessage")),s.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"-sivvw7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-photo-attach",function(e){var t={attachment:{type:"json",value:null},preview:{type:"boolean",value:!1}},n=function(e){e.open(0,"ok-photo",{photo:e.get("@attachment"),width:e.get("@attachment","width")||e.get("@attachment","file","width"),height:e.get("@attachment","height")||e.get("@attachment","file","height"),fill:!e.get("@preview"),preview:e.get("@preview"),class:"__tfpbdy"}),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"tfpbdy"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{click:function(e,t){var n=t.getAttribute("attachment");t.emit("show-media",{photoId:n.photoId})}}},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)}),defineComponent("ok-message-video-attach",function(e){var t={attachment:{type:"json",value:null},preview:{type:"boolean",value:!1}},n=function(e){e.open(0,"ok-video-player",{video:e.get("@attachment"),width:e.get("@attachment","width"),height:e.get("@attachment","height"),fill:!e.get("@preview"),preview:e.get("@preview"),class:"__t9drdf"}),e.close()};return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"t9drdf"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-message-audio-attach",function(e){var t={attachment:{value:""}},n=function(){var e={class:"audio-cnt __t63rny"},t={size:"medium",role:"secondary",shape:"circle","on-click":"onPlay",class:"__t63rny"},n={icon:"play-audio",size:"medium",class:"__t63rny"},o={size:"medium",role:"secondary",shape:"circle","on-click":"onPause",class:"__t63rny"},s={icon:"pause-audio",size:"medium",class:"__t63rny"};return function(i){i.open(0,"div",e),"PLAYING"!=i.get(["state","player-state"])&&(i.open(1,"ok-button",t),i.open(2,"ok-icon",n),i.close(),i.close()),"PLAYING"==i.get(["state","player-state"])&&(i.open(3,"ok-button",o),i.open(4,"ok-icon",s),i.close(),i.close()),i.open(5,"ok-audio-wave",{wave:i.get("@attachment","wave"),progress:i.get(["state","progress"]),class:"__t63rny"}),i.close(),i.open(6,"ok-media-duration",{duration:i.get("@attachment","duration"),class:"__t63rny"}),i.close(),i.open(7,"audio",{src:i.get("@attachment","url"),"on-timeupdate":"onTimeUpdate",class:"__t63rny"}),i.close(),i.close()}}(),o=null;return function(e){function s(t){return t=e.call(this,t)}e&&(s.__proto__=e),(s.prototype=Object.create(e&&e.prototype)).constructor=s;var i={__production:{},hash:{},modelDefinition:{},template:{},audioTag:{}};return i.__production.get=function(){return!0},i.hash.get=function(){return"t63rny"},i.modelDefinition.get=function(){return t},i.template.get=function(){return n},s.prototype.init=function(){this.state.set("progress",0),this.state.set("player-state","PAUSE")},i.audioTag.get=function(){return this.shadowDOM.querySelector("audio")},s.prototype.onPlay=function(e,t){o&&o.stop(!0),t.state.set("player-state","PLAYING"),t.audioTag.play(),o=t},s.prototype.onPause=function(e,t){t.stop(!1)},s.prototype.onTimeUpdate=function(e,t){var n=this.currentTime/this.duration;t.state.set("progress",n),1===n&&t.stop(!0)},s.prototype.stop=function(e){var t=this.audioTag;e&&(t.currentTime=0),this.state.set("player-state","PAUSE"),t.pause()},Object.defineProperties(s.prototype,i),s}(e)});var kp=null;defineComponent("ok-video-player",function(e){var t={video:{type:"json",value:null},width:{type:"number",value:100},height:{type:"number",value:100},"max-width":{type:"number",value:374},"max-height":{type:"number",value:210},fill:{type:"boolean",value:!1},preview:{type:"boolean",value:!1}},n=function(){var e={icon:"video-play",class:"__cphpsp"},t={icon:"video",size:"small",class:"__cphpsp"};return function(n){n.variable("ratio",n.get(["min",1,n.get("@max-width")/n.get("@width"),n.get("@max-height")/n.get("@height")])),n.variable("width",n.get(["round",n.get("@width")*n.get("$ratio")])),n.variable("height",n.get(["round",n.get("@height")*n.get("$ratio")])),n.open(0,"div",{class:"wrap __cphpsp",style:"width: "+n.get("$width")+"px; height: "+n.get("$height")+"px;"}),n.get(["state","url"])?(n.open(1,"iframe",{src:n.get(["state","url"]),width:n.get("$width"),height:n.get("$height"),frameborder:"0",allowfullscreen:"allowfullscreen",class:"__cphpsp"}),n.close()):(n.get("@fill")&&(n.open(2,"div",{class:"fill __cphpsp",style:"background-image: url("+n.get("@video","thumbnail")+")"}),n.close()),n.open(3,"img",{src:n.get("@video","thumbnail"),class:"__cphpsp"}),n.close(),n.open(4,"ok-icon",e),n.close(),n.open(5,"ok-media-duration",{duration:n.get("@video","duration"),class:"__cphpsp"}),n.open(6,"ok-icon",t),n.close(),n.close()),n.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}},i={events:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"cphpsp"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},i.events.get=function(){return{click:function(e,t){var n=t.getAttribute("video");n.urlData?t.activateVideoPlayer(ea(n.urlData)):t.emit("get-video-url-data",{videoId:n.videoId})}}},o.prototype.attributeChangedCallback=function(e,t,n){"video"===e&&n&&!n.urlData&&t&&t.urlData&&this.activateVideoPlayer(ea(t.urlData))},o.prototype.activateVideoPlayer=function(e){kp&&kp.state.delete("url"),kp=this,this.state.set("url",e)},Object.defineProperties(o.prototype,s),Object.defineProperties(o,i),o}(e)});var bp=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};defineComponent("ok-picker-tokens",function(e){var t={items:{type:"json",value:null},duration:{type:"number",value:400}},n=function(){var e=function(e){e.open(0,"span",{class:"item __eh3bk7",style:"width: "+e.get("self","width"),"data-item-id":e.get("self","id")}),e.open(1,"ok-picker-tokens-item",{"item-id":e.get("self","itemId")||e.get("self","id"),id:e.get("self","id"),caption:e.get("self","caption"),url:e.get("self","url"),class:"__eh3bk7"}),e.close(),e.close()};return function(t){t.open(0,"div",{class:"items __eh3bk7"}),t.get(["state","highlight"])&&t.addClass("__highlight"),t.iterate(1,t.get(["state","items"]),e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"eh3bk7"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this._handleKeyDown=this._handleKeyDown.bind(this),this._removeHighlight=this._removeHighlight.bind(this)},o.prototype.connectedCallback=function(){e.prototype.connectedCallback.call(this),window.addEventListener("keydown",this._handleKeyDown),window.addEventListener("click",this._removeHighlight)},o.prototype.disconnectedCallback=function(){window.removeEventListener("keydown",this._handleKeyDown),window.removeEventListener("click",this._removeHighlight),e.prototype.disconnectedCallback.call(this)},o.prototype.attributeChangedCallback=function(e,t){var n=this;if("items"===e){var o=this.state.get("items")||[],s=new Map;t&&t.forEach(function(e){return s.set(e.id,e)});var i=o.map(function(e){return s.has(e.id)?e.removed&&(e=bp({},e,{removed:!1})):e.removed||(e=bp({},e,{removed:!0})).animation.start+e.animation.duration<Date.now()&&(e.animation=n._animData()),s.delete(e.id),e});s.forEach(function(e){return i.push(n._createItem(e))}),this.state.set("items",i)}},o.prototype.didRender=function(){e.prototype.didRender.call(this);var t=Date.now(),n=!1,o=this._calculateItemsTargetWidths(this.state.get("items")||[]).map(function(e){var o=e.animation,s=e;if(o.start+o.duration>t){var i=ta(t-o.start,0,1,o.duration);e.removed&&(i=1-i),e=bp({},e,{width:Math.floor(i*e.targetWidth)+"px"})}else e.removed?e=null:"auto"!==e.width&&(e=bp({},e,{width:"auto"}));return n=n||e!==s,e}).filter(Boolean);n&&(this.state.set("items",o),this.emit("animating-tokens"))},o.prototype._calculateItemsTargetWidths=function(e){var t=e.filter(function(e){return!e.targetWidth});if(t.length){var n=this._getRenderedItems();t.forEach(function(e){return n[e.id].classList.add("measure")}),t.forEach(function(e){return e.targetWidth=n[e.id].firstChild.offsetWidth}),t.forEach(function(e){return n[e.id].classList.remove("measure")})}return e},o.prototype._animData=function(){return{start:Date.now(),duration:this.getAttribute("duration")}},o.prototype._getRenderedItems=function(){return Array.from(this.componentView.querySelectorAll(".item[data-item-id]")).reduce(function(e,t){return e[t.getAttribute("data-item-id")]=t,e},{})},o.prototype._createItem=function(e){return bp({},e,{width:0,targetWidth:0,removed:!1,animation:this._animData()})},o.prototype._handleKeyDown=function(e){if(8!==e.keyCode||e.target.value)8!==e.keyCode&&this.state.set("highlight",!1);else if(this.state.get("highlight")){var t=this.state.get("items");e.stopPropagation(),this.state.set("highlight",!1);var n=t[t.length-1];t&&t.length&&this.emit("unselect-item",n.id)}else this.state.set("highlight",!0)},o.prototype._removeHighlight=function(){this.state.set("highlight",!1)},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-media-duration",function(e){var t={duration:{type:"number",value:0}},n=function(){var e={class:"__fzvgyj"};return function(t){t.open(0,"slot",e),t.close(),t.open(1,"ok-duration",{duration:t.get("@duration"),format:"HH:MM:DD",class:"__fzvgyj"}),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"fzvgyj"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},Object.defineProperties(o.prototype,s),o}(e)});var wp={width:1,gap:1,paddingTop:0,paddingBottom:0,borderRadius:1,minHeight:1},Cp=function(e){this._style=e?Object.assign({},wp,e):wp};Cp.prototype.getWidth=function(){return this._style.width},Cp.prototype.getGap=function(){return this._style.gap},Cp.prototype.drawShape=function(e,t,n,o,s){var i=this._style,r=i.borderRadius*s,a=(o-(i.paddingBottom+i.paddingTop)*s)*t;return a<r&&(a=i.minHeight*s),na(e,n,.5*(o-a-i.paddingBottom*s),i.width*s,a,r),this},Cp.prototype.colorize=function(e,t){return e.save(),e.fillStyle=t,e.fill(),e.restore(),this};var Ep=new Cp;defineComponent("ok-audio-wave",function(e){var t={wave:{type:"string",value:""},color:{type:"string",value:"#999"},progress:{type:"number",value:0},"progress-color":{type:"string",value:"#697cff"}},n=function(){var e={class:"wave __9iw7p6"};return function(t){t.open(0,"canvas",e),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"9iw7p6"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.init=function(){this._wasDrawnOnce=!1,this._pixelRatio=1,this._ctx=null,this._ctxWidth=null,this._ctxHeight=null,this._waveCahce=null,this._colorCache=null,this._parsedWave=null,this._wavePeak=Ep,this._needRedrawWaveFromModel=!1,this._hiddenCanvas=document.createElement("canvas"),this._hiddenCtx=this._hiddenCanvas.getContext("2d"),this._hiddenCtxWidth=null,this._hiddenCtxHeight=null},o.prototype.attributeChangedCallback=function(e){"progress"===e&&this._wasDrawnOnce&&this._redrawWave()},o.prototype._parseWave=function(){var e=this.getAttribute("wave");e&&(this._parsedWave=ii(e))},o.prototype._findAudioWaveCanvas=function(){return this.shadowDOM.querySelector(".wave")},o.prototype._prepareUIForDraw=function(){var e=this._findAudioWaveCanvas(),t=e?e.offsetWidth:0;if(0!==t){var n=this._pixelRatio=window.devicePixelRatio,o=e.offsetHeight;t*=n,o*=n,e.setAttribute("width",t),e.setAttribute("height",o),this._ctxWidth=t,this._ctxHeight=o,this._ctx=e.getContext("2d")}},o.prototype._needPrepareHiddenWaveCtx=function(){return this._hiddenCtxWidth!==this._ctxWidth||this._hiddenCtxHeight!==this._ctxHeight},o.prototype._needRedrawHiddenWave=function(){return this._needRedrawWaveFromModel||this._needPrepareHiddenWaveCtx()},o.prototype._prepareHiddenCanvas=function(){this._needPrepareHiddenWaveCtx()&&(this._hiddenCtxWidth=this._ctxWidth,this._hiddenCtxHeight=this._ctxHeight,this._hiddenCanvas.setAttribute("width",this._hiddenCtxWidth),this._hiddenCanvas.setAttribute("height",this._hiddenCtxHeight))},o.prototype._calcPeaksDrawData=function(){var e=this._wavePeak,t=this._hiddenCtxWidth,n=this._pixelRatio,o=(e.getGap()+e.getWidth())*n,s=Math.floor(t/o);return{peakWithGapWidth:o,drawingPeaksCount:s,xOffset:Math.floor((t-o*s+e.getGap()*n)/2),halfOfPeakWidth:e.getWidth()*n/2}},o.prototype._drawHiddenWave=function(){var e=this._parsedWave,t=e.length,n=this._pixelRatio,o=this._wavePeak,s=this._hiddenCtxWidth,i=this._hiddenCtxHeight,r=this._hiddenCtx;r.clearRect(0,0,s,i);for(var a=this._calcPeaksDrawData(),c=a.drawingPeaksCount,l=a.peakWithGapWidth,u=a.xOffset,p=a.halfOfPeakWidth,h=0;h!==c;h+=1){var d=l*h+u,f=e[Math.round((d+p)/s*(t-1))]/127;o.drawShape(r,f,d,i,n)}o.colorize(r,this.getAttribute("color"))},o.prototype._drawWaveProgress=function(){var e=this.getAttribute("progress"),t=this._ctx,n=this._ctxWidth,o=this._ctxHeight;if(t.clearRect(0,0,n,o),t.drawImage(this._hiddenCanvas,0,0),0!==e){var s=this._calcPeaksDrawData(),i=s.peakWithGapWidth,r=s.xOffset,a=(n-2*r)*e,c=Math.round(a/i)*i+r;t.save(),t.globalCompositeOperation="source-atop",t.fillStyle=this.getAttribute("progress-color"),t.fillRect(0,0,c,o),t.restore()}},o.prototype._checkCaches=function(){var e=this.getAttribute("wave"),t=this.getAttribute("color"),n=this._waveCahce!==e,o=this._colorCache!==t;n&&(this._parseWave(),this._waveCahce=e),o&&(this._colorCache=t),(n||o)&&(this._needRedrawWaveFromModel=!0)},o.prototype._redrawWave=function(){this._checkCaches(),this._parsedWave&&(this._prepareUIForDraw(),this._ctx&&(this._needRedrawHiddenWave()&&(this._prepareHiddenCanvas(),this._drawHiddenWave()),this._drawWaveProgress(),this._wasDrawnOnce=!0))},o.prototype.willRender=function(){return!this._wasDrawnOnce},o.prototype.didRender=function(){var e=this;this._wasDrawnOnce?this._redrawWave():requestAnimationFrame(function(){e._redrawWave()})},Object.defineProperties(o.prototype,s),o}(e)}),defineComponent("ok-picker-tokens-item",function(e){var t={id:{type:"string",value:""},"item-id":{type:"string",value:""},url:{type:"string",value:""},caption:{type:"string",value:""}},n=function(){var e={class:"name __olhhk3"};return function(t){t.open(0,"ok-avatar",{id:t.get("@id")||t.get("@item-id"),size:"nano",url:t.get("@url"),caption:t.get("@caption"),class:"__olhhk3"}),t.close(),t.open(1,"span",e),t.setText(t.get("@caption")),t.close(),t.open(2,"ok-icon",{icon:"clear",size:"small","on-click":["onRemove",t.get("@item-id")],class:"__olhhk3"}),t.close()}}();return function(e){function o(t){return t=e.call(this,t)}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var s={__production:{},hash:{},modelDefinition:{},template:{}};return s.__production.get=function(){return!0},s.hash.get=function(){return"olhhk3"},s.modelDefinition.get=function(){return t},s.template.get=function(){return n},o.prototype.onRemove=function(e,t,n){n.emit("unselect-item",e)},Object.defineProperties(o.prototype,s),o}(e)})}();

//# sourceMappingURL=components.2863413955.js.map
